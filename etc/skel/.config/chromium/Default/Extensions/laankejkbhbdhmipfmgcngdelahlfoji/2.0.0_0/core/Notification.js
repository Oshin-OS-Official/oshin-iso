define(["core/Logger"],function(Logger){function log(funcName,message,payload,level){Logger.log("Notification."+funcName,message,payload,level)}var API;return{settings:[300,60,10],NOTIFICATION_TTL:5e3,initAPI:function(theAPI){(API=theAPI).mixin("Notification",{get:this.get.bind(this),saveSettings:this.saveSettings.bind(this)})},init:function(callback){log("init","Initializing Notification",null,"DEBUG"),this.loadSettings(),"function"==typeof callback&&callback()},initAsync(){return new Promise(resolve=>this.init(resolve))},get:function(){return this.settings},show:function(type){log("show","Showing "+type+" notification");var icon="",message="",totalSecondsRemaining=0,self=this,type=("nuclear"===type?(totalSecondsRemaining=API.NuclearOption.getSecondsUntilActive(),icon="common/img/icon-nuclear-48.png",message=API.Chrome.Translation.get("nuclearNotification")||"The Nuclear Option will start blocking sites in"):"block"===type&&(totalSecondsRemaining=API.StayFocusd.getTotalSecondsRemaining(),icon="common/img/icon-red-48.png",message=API.Chrome.Translation.get("blockNotification")||"StayFocusd will start blocking your Blocked Sites in"),{type:"basic",title:"StayFocusd",iconUrl:icon,message:message+=60<totalSecondsRemaining?" "+API.Date.secondsToMinsAndSecs(totalSecondsRemaining):" "+totalSecondsRemaining+" seconds"});API.Chrome.Notification.create("",type,function(notificationID){setTimeout(function(){API.Chrome.Notification.clear(notificationID,function(){})},self.NOTIFICATION_TTL)})},isset:function(timeToCheck){return this.settings.inArray(timeToCheck)},saveSettings:function(settings){log("saveSettings","Saving settings",settings,"TRACE"),this.settings=settings,API.Settings.set({notificationSettings:settings})},loadSettings:function(){log("loadSettings","Loading settings",null,"TRACE");var notificationSettings=API.Settings.get("notificationSettings");notificationSettings&&(this.settings=notificationSettings)}}});