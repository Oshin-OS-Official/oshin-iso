define(["core/Logger","core/CoreAPI","core/vendor/jquery.min","core/vendor/Brightline.min","core/vendor/text!components/List/list.tpl"],function(Logger,API,$,Brightline,listTpl){function log(originator,funcName,message,payload,level){Logger.log(originator+"."+funcName,message,payload,level)}return class{model=null;rendered=!1;init(){log(this.originator,"init","Initializing view",null,"DEBUG"),this.addListeners()}isRendered(){return!0===this.rendered}setJQuery(jQuery){log(this.originator,"setJQuery","Setting jQuery"),$=jQuery||$}inject($container){log(this.originator,"inject","Injecting view"),($container=$container||$("body")).html(this.render()),this.bindUIHandlers()}render(tpl){log(this.originator,"render","Rendering view");tpl=new Brightline(tpl=tpl||"");return tpl.set("list",this.renderList()),this.rendered=!0,tpl.render()}renderList(removeBtnAttribute){removeBtnAttribute=removeBtnAttribute||"",log(this.originator,"renderList","Rendering list");var template=new Brightline(listTpl),list=this.model.get();if(0===list.length)template.set("noSitesYet",API.Chrome.Translation.get("noSitesYet"));else for(var i=0;i<list.length;i++)template.set("id",this.getInstanceName()+"-"+i),template.set("removeBtnAttribute",removeBtnAttribute),template.set("removeFromList",API.Chrome.Translation.get("removeFromList")),template.set("domain",list[i]),template.parse("removeDomain");return template.render()}refreshList($listContainer,$listTextarea,removeBtnAttribute){log(this.originator,"refreshList","Refreshing list",removeBtnAttribute),$listContainer.html(this.renderList(removeBtnAttribute)),$listTextarea.val(""),this.bindListUIHandlers()}bindUIHandlers(){log(this.originator,"bindUIHandlers","Binding UI handlers",null,"TRACE"),this.bindListUIHandlers()}bindListUIHandlers(){log(this.originator,"bindListUIHandlers","Binding list UI handlers",null,"TRACE");for(var list=this.model.get(),self=this,i=0;i<list.length;i++)!function(domain,id){$("#"+id+" button").click(function(){API.PubSub.publish(self.getClassName()+".domain.remove."+self.model.descriptor,{domain:domain})})}(list[i],this.getInstanceName()+"-"+i)}addListeners(){log(this.originator,"addListeners","Adding listeners",null,"TRACE");var self=this;API.PubSub.listen(["*.list.loaded."+this.model.descriptor,"*.list.saved."+this.model.descriptor],function(){self.isRendered()&&self.refreshList()})}getNewDomains(newDomains){newDomains=newDomains||"";var finalList=[];if(log(this.originator,"getNewDomains","Getting new "+this.getInstanceName()+" sites",newDomains,"TRACE"),""!==newDomains)for(var newDomainsArray=newDomains.split("\n"),i=0;i<newDomainsArray.length;i++){var domain=newDomainsArray[i];0<domain.length&&finalList.push(domain)}return finalList}}});