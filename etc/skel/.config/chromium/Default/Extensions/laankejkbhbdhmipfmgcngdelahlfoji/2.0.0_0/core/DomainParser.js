define(["core/Logger"],function(Logger){function log(funcName,message,payload,level){Logger.log("DomainParser."+funcName,message,payload,level)}return{initAPI:function(API){API.mixin("Domain",{extractBaseDomain:this.extractBaseDomain.bind(this),extractFullDomain:this.extractFullDomain.bind(this),isMoreGeneralURL:this.isMoreGeneralURL.bind(this),matchesWildcard:this.matchesWildcard.bind(this)})},getCurrentURL:function(){API.Chrome.Tab.getSelected(null,function(tab){if(void 0!==tab)return log("getCurrentURL","Getting current url",tab.url,"DEBUG"),tab.url})},extractFullDomain:function(url){if(!url)return null;log("extractFullDomain","Extracting full domain from",url,"TRACE");var matches=url.match(/\/\/(.[^/]+)/);return null===matches||matches.length<2?url.split("/")[0]:matches[1]},extractBaseDomain:function(url){log("extractBaseDomain","Extracting base domain from",url,"TRACE");var domainArray,baseDomain,url=this.extractFullDomain(url);return url&&0!==url.length?1===(domainArray=url.split(".")).length?url:(baseDomain=domainArray[domainArray.length-1],baseDomain=domainArray[domainArray.length-2]+"."+baseDomain,this.isMultiPartDomain(url)?domainArray[domainArray.length-3]+"."+baseDomain:baseDomain):""},isMultiPartDomain:function(fullDomain){var logMsg="Is "+fullDomain+" multi-part domain?",fullDomain=fullDomain.split("."),domainTokens=[];if(1!==fullDomain.length){var penultimate=fullDomain[fullDomain.length-2];if(1===penultimate.length)return log("isMultiPartDomain",logMsg,"YES","TRACE"),!0;if(2===penultimate.length&&3<fullDomain.length)return log("isMultiPartDomain",logMsg,"YES","TRACE"),!0;if(3===penultimate.length&&3<=fullDomain.length)for(var key in domainTokens=["com","edu","gov","mil","net","org","biz","www","pro","int","web","xxx"])if(domainTokens.hasOwnProperty(key)&&penultimate===domainTokens[key])return log("isMultiPartDomain",logMsg,"YES","TRACE"),!0;if(4===penultimate.length&&3<=fullDomain.length)for(var key2 in domainTokens=["info","mobi","name","jobs","kiwi","aero","asia","coop"])if(domainTokens.hasOwnProperty(key2)&&penultimate===domainTokens[key2])return log("isMultiPartDomain",logMsg,"YES","TRACE"),!0;if(3<=fullDomain.length){var antepenultimate=fullDomain[fullDomain.length-3];if(2===penultimate.length&&3===fullDomain.length&&2<antepenultimate.length&&"www"!==antepenultimate)return log("isMultiPartDomain",logMsg,"YES","TRACE"),!0}}return log("isMultiPartDomain",logMsg,"NO","TRACE"),!1},isMoreGeneralURL:function(domainToCheck,domainToCompare){var baseDomainToCheck,logMsg="Is "+(domainToCheck="string"==typeof domainToCheck?domainToCheck.toLowerCase():domainToCheck)+" more general than "+(domainToCompare="string"==typeof domainToCompare?domainToCompare.toLowerCase():domainToCompare)+"?",baseDomainToCompare=(domainToCheck=this.stripProtocol(domainToCheck),domainToCompare=this.stripProtocol(domainToCompare),this.extractBaseDomain(domainToCompare));return domainToCheck===domainToCompare||domainToCheck===baseDomainToCompare||0===domainToCompare.indexOf(domainToCheck)||(baseDomainToCheck=this.extractBaseDomain(domainToCheck))===baseDomainToCompare&&domainToCheck.length<=domainToCompare.length&&0<=domainToCompare.indexOf(domainToCheck)&&(0<=domainToCompare.indexOf("/")||0<=domainToCompare.indexOf("?"))||baseDomainToCompare.length>baseDomainToCheck.length&&-1<baseDomainToCompare.indexOf(domainToCheck)?(log("isMoreGeneralURL",logMsg,"YES","TRACE"),!0):(log("isMoreGeneralURL",logMsg,"NO","TRACE"),!1)},matchesWildcard:function(wildcard,domainToCompare){var domainUpToWildcard,logMsg="Does "+domainToCompare+" match wildcard "+wildcard+"?",wildcard=wildcard.replace("*","");return-1===(domainToCompare=domainToCompare||"").indexOf(wildcard)?(log("matchesWildcard",logMsg,"NO","TRACE"),!1):(domainUpToWildcard=domainToCompare.substring(0,domainToCompare.indexOf(wildcard)+wildcard.length),domainToCompare=domainToCompare.substring(domainUpToWildcard.length-wildcard.length,domainUpToWildcard.length)===wildcard,log("matchesWildcard",logMsg,domainToCompare?"YES":"NO","TRACE"),domainToCompare)},stripProtocol:function(url){return url?-1<url.indexOf("://")?url.slice(url.indexOf("://")+3,url.length):url:""}}});