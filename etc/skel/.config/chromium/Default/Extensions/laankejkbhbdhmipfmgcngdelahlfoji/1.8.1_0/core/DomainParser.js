define(["core/Logger"],function(Logger){return{initAPI:function(API){API.mixin("Domain",{extractBaseDomain:this.extractBaseDomain.bind(this),extractFullDomain:this.extractFullDomain.bind(this),isMoreGeneralURL:this.isMoreGeneralURL.bind(this),matchesWildcard:this.matchesWildcard.bind(this)})},getCurrentURL:function(){API.Chrome.Tab.getSelected(null,function(tab){if(void 0!==tab)return tab.url})},extractFullDomain:function(url){var matches;return url?null===(matches=url.match(/\/\/(.[^/]+)/))||matches.length<2?url.split("/")[0]:matches[1]:null},extractBaseDomain:function(url){var domainArray,baseDomain,url=this.extractFullDomain(url);return url&&0!==url.length?1===(domainArray=url.split(".")).length?url:(baseDomain=domainArray[domainArray.length-1],baseDomain=domainArray[domainArray.length-2]+"."+baseDomain,this.isMultiPartDomain(url)?domainArray[domainArray.length-3]+"."+baseDomain:baseDomain):""},isMultiPartDomain:function(fullDomain){var fullDomain=fullDomain.split("."),domainTokens=[];if(1!==fullDomain.length){var penultimate=fullDomain[fullDomain.length-2];if(1===penultimate.length)return!0;if(2===penultimate.length&&3<fullDomain.length)return!0;if(3===penultimate.length&&3<=fullDomain.length)for(var key in domainTokens=["com","edu","gov","mil","net","org","biz","www","pro","int","web","xxx"])if(domainTokens.hasOwnProperty(key)&&penultimate===domainTokens[key])return!0;if(4===penultimate.length&&3<=fullDomain.length)for(var key2 in domainTokens=["info","mobi","name","jobs","kiwi","aero","asia","coop"])if(domainTokens.hasOwnProperty(key2)&&penultimate===domainTokens[key2])return!0;if(3<=fullDomain.length){var antepenultimate=fullDomain[fullDomain.length-3];if(2===penultimate.length&&3===fullDomain.length&&2<antepenultimate.length&&"www"!==antepenultimate)return!0}}return!1},isMoreGeneralURL:function(domainToCheck,domainToCompare){domainToCheck="string"==typeof domainToCheck?domainToCheck.toLowerCase():domainToCheck,domainToCompare="string"==typeof domainToCompare?domainToCompare.toLowerCase():domainToCompare,domainToCheck=this.stripProtocol(domainToCheck),domainToCompare=this.stripProtocol(domainToCompare);var baseDomainToCheck,baseDomainToCompare=this.extractBaseDomain(domainToCompare);return domainToCheck===domainToCompare||domainToCheck===baseDomainToCompare||0===domainToCompare.indexOf(domainToCheck)||(baseDomainToCheck=this.extractBaseDomain(domainToCheck))===baseDomainToCompare&&domainToCheck.length<=domainToCompare.length&&0<=domainToCompare.indexOf(domainToCheck)&&(0<=domainToCompare.indexOf("/")||0<=domainToCompare.indexOf("?"))||baseDomainToCompare.length>baseDomainToCheck.length&&-1<baseDomainToCompare.indexOf(domainToCheck)},matchesWildcard:function(wildcard,domainToCompare){var domainUpToWildcard,wildcard=wildcard.replace("*","");return-1!==(domainToCompare=domainToCompare||"").indexOf(wildcard)&&(domainUpToWildcard=domainToCompare.substring(0,domainToCompare.indexOf(wildcard)+wildcard.length),domainToCompare.substring(domainUpToWildcard.length-wildcard.length,domainUpToWildcard.length)===wildcard)},stripProtocol:function(url){return url?-1<url.indexOf("://")?url.slice(url.indexOf("://")+3,url.length):url:""}}});