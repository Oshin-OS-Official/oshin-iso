define(["core/Logger","core/CoreAPI","core/vendor/jquery.min"],function(Logger,API,$){return class{view=null;model=null;timer=null;init(){this.model.init(),this.addListeners(),API.PubSub.publish("ActivityMonitor.component.initialized"),this.view.bindActivityDetectors()}activate(){this.view.bindActivityDetectors(),this.startTimer()}addListeners(){var self=this;API.PubSub.listen("ActivityMonitor.overlay.shown",function(message,payload){self.stopTimer()}),API.PubSub.listen("ActivityMonitor.overlay.hidden",function(message,payload){self.resetTimer(),self.startTimer()}),API.PubSub.listen("ActivityMonitor.activity.detected",function(message,payload){self.resetTimer()}),API.PubSub.listen("*.tab.selected",function(message,payload){self.onTabSelected(payload.tab,payload.blockable)}),API.PubSub.listen("*.page.killed",function(message,payload){self.killPage(payload.redirectURL)})}onTabSelected(selectedTab,blockable){null!==this.model.currentTabID&&this.stopTimer(),this.model.currentTabID=selectedTab.id,this.model.currentURL=selectedTab.url,this.model.blockable=blockable,this.resetTimer(),this.view.hide(),blockable&&!this.model.isDisabled()&&this.startTimer()}startTimer(){clearInterval(this.timer),this.timer=setInterval(this.tick.bind(this),1e3*this.model.interval)}stopTimer(){clearInterval(this.timer),this.timer=null}resetTimer(){this.model.elapsedTime=0}killPage(redirectURL){top.location.href=redirectURL+"?content&customMsg="+API.Settings.get("customStayFocusdMsg")}tick(){this.model.elapsedTime+=this.model.interval,this.model.isMaxInactiveTimeExceeded()&&this.view.show()}}});