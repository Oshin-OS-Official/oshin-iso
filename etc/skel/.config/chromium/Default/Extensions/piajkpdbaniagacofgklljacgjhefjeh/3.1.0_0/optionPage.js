(()=>{"use strict";class e{static ALL_WORDS_WORDLIST_ID=0;static BUILD_TARGET_BOOKMARKLET="bookmarklet";static BUILD_TARGET_CHROME="chrome";static BUILD_TARGET_FIREFOX="firefox";static DOMAIN_MODES={NORMAL:0,ADVANCED:1,DEEP:2};static FALSE=0;static FILTER_METHODS={CENSOR:0,SUBSTITUTE:1,REMOVE:2,OFF:3};static LOGGING_LEVELS={DEBUG:0,INFO:1,WARN:2,ERROR:3};static MATCH_METHODS={EXACT:0,PARTIAL:1,WHOLE:2,REGEX:3};static MESSAGING={BACKGROUND:"background",CONTEXT:"context",OPTION:"option",POPUP:"popup"};static STATS_TYPE_TEXT="text";static STATUS={DISABLED:0,NORMAL:1,ADVANCED:2,DEEP:3};static TAB_DISABLE_ONCE={NOT_SET:0,DISABLED:1,WILL_DISABLE:2};static TOP_WINDOW_FRAME_ID=0;static TRUE=1;static filterMethodName(e){return this.nameById(this.FILTER_METHODS,e)}static loggingLevelName(e){return this.nameByValue(this.LOGGING_LEVELS,e)}static matchMethodName(e){return this.nameById(this.MATCH_METHODS,e)}static nameById(e,t){return y(Object.entries(e).filter((e=>e[1]===t))[0][0])}static nameByValue(e,t){return Object.keys(e).find((s=>e[s]==t))}static orderedArray(t){const s=[];return Object.values(t).sort().forEach((i=>{s.push(e.nameById(t,i))})),s}}function t(t){return t?e.TRUE:e.FALSE}function s(e,t,s=!1,i){p(t),(void 0!==i?[i].concat(e):e).forEach((e=>{const o=document.createElement("option");o.value=i&&e===i?"":e,o.textContent=s?y(e):e,t.appendChild(o)}))}function i(e,t=document){return o(e,t,"querySelector")}function o(e,t=document,s="querySelector"){let i;const o=e.split(">>>");if(1==o.length)return t[s](e);for(;o.length;){if(!t)return null;{const e=o.shift().trim();if(0==o.length)return t[s](e);if(i=t.querySelector(e),!i)return null;t=i.shadowRoot}}}function a(e,t=document){return o(e,t,"querySelectorAll")}function r(e,t=1){return e?t>0?r(e.parentElement,t-1):e:null}function n(e){const t=e.split(".");return{major:parseInt(t[0]),minor:parseInt(t[1]),patch:parseInt(t[2])}}function l(e,t=3){const[s="0",i="0",o="0"]=(e||"0:0:0").split(":"),a=parseInt(s,10)||0,r=parseInt(i,10)||0,n=parseFloat(o)||0;return parseFloat((3600*a+60*r+n).toFixed(t))}function d(e,t){return e.major<t.major||e.major==t.major&&e.minor<t.minor||e.major==t.major&&e.minor==t.minor&&e.patch<t.patch}function c(e){return e[e.length-1]}function u(t){return t>e.FALSE}function h(e){if("object"==typeof Intl&&"function"==typeof Intl.NumberFormat)return"string"==typeof e&&(e=parseInt(e).toString()),e.toLocaleString();{const t=(e=e.toString()).indexOf(".");let s=-1===t?e:e.slice(0,t);for(let e=s.length-3;e>0;e-=3)s=s.slice(0,e)+","+s.slice(e);return-1!==t&&(s+=e.slice(t)),s}}function m(e){return`[${e.toString().replace(/,/g,", ")}]`}function p(e){if(e.hasChildNodes)for(;e.firstChild;)e.firstChild.remove()}function g(e,t){return e.filter((e=>e!==t))}function f(e){return"string"==typeof e&&(e=[e]),e}function y(e,t=!0){let s=e.charAt(0).toUpperCase();return s+=t?e.toLowerCase().slice(1):e.slice(1),s}class E{censorCharacter;censorFixedLength;defaultSubstitution;defaultWordMatchMethod;defaultWordRepeat;defaultWordSeparators;filterMethod;filterWordList;iWordAllowlist;loggingLevel;preserveCase;preserveFirst;preserveLast;showCounter;showSummary;substitutionMark;wordAllowlist;wordlistId;wordlists;wordlistsEnabled;words;wordSubSeparator;static initializeDefaults(...e){return Object.assign({},this._configDefaults,...e)}static _allWordlists=["All words"];static _configDefaults={censorCharacter:"*",censorFixedLength:0,defaultSubstitution:"censored",defaultWordMatchMethod:e.MATCH_METHODS.EXACT,defaultWordRepeat:e.FALSE,defaultWordSeparators:e.FALSE,filterMethod:e.FILTER_METHODS.SUBSTITUTE,filterWordList:!0,iWordAllowlist:[],loggingLevel:e.LOGGING_LEVELS.WARN,preserveCase:!0,preserveFirst:!0,preserveLast:!1,showCounter:!0,showSummary:!0,substitutionMark:!1,wordAllowlist:[],wordlistId:0,wordlists:["Wordlist 1","Wordlist 2","Wordlist 3","Wordlist 4","Wordlist 5","Wordlist 6"],wordlistsEnabled:!0,words:void 0,wordSubSeparator:";;"};static _defaultWords={ass:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"butt"},asses:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.FALSE,separators:e.FALSE,sub:"butts"},asshole:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"jerk"},badass:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.TRUE,sub:"cool"},bastard:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"idiot"},bitch:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"bench"},cocksucker:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.TRUE,sub:"suckup"},cunt:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"expletive"},dammit:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.FALSE,separators:e.TRUE,sub:"dangit"},damn:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.FALSE,separators:e.FALSE,sub:"dang"},dumbass:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"idiot"},fag:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"gay"},faggot:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"gay"},fags:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"gays"},fuck:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.TRUE,sub:"freak"},goddammit:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.TRUE,sub:"dangit"},hell:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.FALSE,separators:e.FALSE,sub:"heck"},jackass:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.TRUE,sub:"jerk"},nigga:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"bruh"},nigger:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"man"},niggers:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"people"},piss:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"pee"},pissed:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"ticked"},pussies:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"softies"},pussy:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"softie"},shit:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"crap"},slut:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"tramp"},tits:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"chest"},twat:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"dumbo"},twats:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"dumbos"},whore:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"tramp"}};static _defaults=this.initializeDefaults(this._configDefaults);static _persistableKeys=Object.keys(this._defaults);constructor(e={}){Object.assign(this,E._defaults,e)}get _persistableKeys(){return this.constructor._persistableKeys}addWord(t,s=this.defaultWordOptions()){return t=t.trim(),(s=Object.assign({},this.defaultWordOptions(),s)).matchMethod!==e.MATCH_METHODS.REGEX&&(t=t.toLowerCase()),!Object.keys(this.words).includes(t)&&(s.sub=s.case==e.TRUE?s.sub.trim():s.sub.trim().toLowerCase(),this.words[t]=s,!0)}defaultWordOptions(){return{lists:[],matchMethod:this.defaultWordMatchMethod,repeat:this.defaultWordRepeat,separators:this.defaultWordSeparators,sub:""}}removeWord(e){const t=(e=e.trim()).toLowerCase();return Object.keys(this.words).includes(t)?(delete this.words[t],!0):!!this.words[e]&&(delete this.words[e],!0)}repeatForWord(t){return this.words[t].repeat===e.TRUE||this.words[t].repeat===e.FALSE?this.words[t].repeat:this.defaultWordRepeat}sanitizeWords(){const e={};Object.keys(this.words).sort().forEach((t=>{e[t.trim().toLowerCase()]=this.words[t]})),this.words=e}}class S{level;prefix;static app="APF";static debugLevel=e.LOGGING_LEVELS.DEBUG;static debugName=e.loggingLevelName(this.debugLevel).toLowerCase();static defaultLevel=e.LOGGING_LEVELS.WARN;static errorLevel=e.LOGGING_LEVELS.ERROR;static errorName=e.loggingLevelName(this.errorLevel).toLowerCase();static infoLevel=e.LOGGING_LEVELS.INFO;static infoName=e.loggingLevelName(this.infoLevel).toLowerCase();static warnLevel=e.LOGGING_LEVELS.WARN;static warnName=e.loggingLevelName(this.warnLevel).toLowerCase();static debug(e,...t){this.log(this.debugName,e,t)}static debugTime(e,t=[]){this.logTime(this.debugName,e,t)}static error(e,...t){this.log(this.errorName,e,t)}static errorTime(e,t=[]){this.logTime(this.errorName,e,t)}static info(e,...t){this.log(this.infoName,e,t)}static infoTime(e,t=[]){this.logTime(this.infoName,e,t)}static log(e,t,s=[]){t=`[${S.app}] ${t}`,s.length?console[e](t,s):console[e](t)}static logTime(e,t,s=[]){const i=(new Date).toLocaleString();t=`[${S.app}] ${t}`,s.length?console[e](t,i,s):console[e](t,i)}static warn(e,...t){this.log(this.warnName,e,t)}static warnTime(e,t=[]){this.logTime(this.warnName,e,t)}constructor(e){this.level=S.defaultLevel,this.prefix="",e&&(this.prefix=`[${e}] `)}debug(e,...t){S.debugLevel>=this.level&&S.log(S.debugName,`${this.prefix}${e}`,t)}debugTime(e,...t){S.debugLevel>=this.level&&S.logTime(S.debugName,`${this.prefix}${e}`,t)}error(e,...t){S.errorLevel>=this.level&&S.log(S.errorName,`${this.prefix}${e}`,t)}errorTime(e,...t){S.errorLevel>=this.level&&S.logTime(S.errorName,`${this.prefix}${e}`,t)}info(e,...t){S.infoLevel>=this.level&&S.log(S.infoName,`${this.prefix}${e}`,t)}infoTime(e,...t){S.infoLevel>=this.level&&S.logTime(S.infoName,`${this.prefix}${e}`,t)}setLevel(e){this.level=e}warn(e,...t){S.warnLevel>=this.level&&S.log(S.warnName,`${this.prefix}${e}`,t)}warnTime(e,...t){S.warnLevel>=this.level&&S.logTime(S.warnName,`${this.prefix}${e}`,t)}}const w={config:{},manifestVersion:3,release:!0,target:"chrome",version:"1.0.0"},v=new S("WebConfig");class C extends E{_lastSplitKeys;collectStats;contextMenu;darkMode;domains;enabledDomainsOnly;enabledFramesOnly;password;showUpdateNotification;syncLargeKeys;get Class(){return this.constructor}static BUILD=void 0==={release:!0,config:{muteMethod:null},manifestVersion:3,target:"chrome",version:"3.1.0"}?w:{release:!0,config:{muteMethod:null},manifestVersion:3,target:"chrome",version:"3.1.0"};static _webDefaults={collectStats:!0,contextMenu:!0,darkMode:null,domains:{},enabledDomainsOnly:!1,enabledFramesOnly:!1,password:null,showUpdateNotification:!1,syncLargeKeys:!0};static _defaults=this.initializeDefaults({},this._configDefaults,this._webDefaults);static _persistableKeys=Object.keys(this._defaults);static _localConfigKeys=["domains","syncLargeKeys","words"];static _localOnlyKeys=["background","stats"];static _maxSplitKeys=64;static _largeKeys=["domains","words"];static get _maxBytes(){try{if(chrome.storage.sync.QUOTA_BYTES_PER_ITEM)return Math.round(.98*chrome.storage.sync.QUOTA_BYTES_PER_ITEM);throw"QUOTA_BYTES_PER_ITEM not defined, using default"}catch(e){return 8028}}static chromeStorageAvailable(){return!!("object"==typeof chrome&&chrome.storage&&chrome.storage.sync&&chrome.storage.local)}static combineData(e,t){if(e[t]={},void 0!==e[`_${t}0`]){const s=this.getDataContainerKeys(e,t);return s.forEach((s=>{Object.assign(e[t],e[s]),delete e[s]})),s}}static getDataContainerKeys(e,t){const s=new RegExp(`^_${t}\\d+`);return Object.keys(e).filter((e=>s.test(e))).sort()}static getLocalStorage(e){return"string"==typeof e&&(e=[e]),new Promise(((t,s)=>{chrome.storage.local.get(e,(e=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(e)}))}))}static getMaxSplitKeyFromArray(e=[]){if(Array.isArray(e)){const t=e.sort()[e.length-1];if(t){const e=new RegExp("\\d+$"),s=t.match(e);if(s)return parseInt(s[0])}}}static getMaxSplitKeyFromData(e,t){const s=this.getDataContainerKeys(e,t);return this.getMaxSplitKeyFromArray(s)}static getSyncStorage(e){return"string"==typeof e&&(e=[e]),new Promise(((t,s)=>{chrome.storage.sync.get(e,(e=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(e)}))}))}static includesLargeKeys(e){return e.some((e=>this._largeKeys.includes(e)))}static async load(e=[]){e=f(e);const t={};let s;const i=[];let o=[];0===e.length&&(e=this._persistableKeys);try{if(this.includesLargeKeys(e)?(e.includes("syncLargeKeys")||e.push("syncLargeKeys"),this._localConfigKeys.forEach((t=>{e.includes(t)&&i.push(t)})),s=await this.getLocalStorage(i),t.syncLargeKeys=!1===s.syncLargeKeys?s.syncLargeKeys:this._defaults.syncLargeKeys,!1===t.syncLargeKeys?(i.forEach((e=>{void 0===s[e]?t[e]="words"===e?this._defaultWords:this._defaults[e]:t[e]=s[e]})),o=e.filter((e=>!this._localConfigKeys.includes(e)))):o=e.filter((e=>"syncLargeKeys"!==e))):o=e.filter((e=>"syncLargeKeys"!==e)),o.length){let e=[].concat(o);this._largeKeys.forEach((t=>{o.includes(t)&&(e.splice(e.indexOf(t),1),e=e.concat(this.splitKeyNames(t)))}));const s=await this.getSyncStorage(e);t._lastSplitKeys={},o.forEach((e=>{if(this._largeKeys.includes(e)){const i=this.combineData(s,e);i?(t._lastSplitKeys[e]=this.getMaxSplitKeyFromArray(i),t[e]=s[e]):(t._lastSplitKeys[e]=0,t[e]="words"===e?this._defaultWords:this._defaults[e])}else void 0===s[e]?t[e]=this._defaults[e]:t[e]=s[e]}))}return new this(t)}catch(t){throw v.error("Failed to load items.",e,t),new Error(`Failed to load items: ${m(e)}. [${t.message}]`)}}static removeLocalStorage(e){return e=f(e),new Promise(((t,s)=>{chrome.storage.local.remove(e,(()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(0)}))}))}static removeSyncStorage(e){return e=f(e),new Promise(((t,s)=>{chrome.storage.sync.remove(e,(()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(0)}))}))}static resetLocalStorage(){return new Promise(((e,t)=>{chrome.storage.local.clear((()=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(0)}))}))}static resetSyncStorage(){return new Promise(((e,t)=>{chrome.storage.sync.clear((()=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(0)}))}))}static saveLocalStorage(e){return new Promise(((t,s)=>{chrome.storage.local.set(e,(()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(0)}))}))}static saveSyncStorage(e){return new Promise(((t,s)=>{chrome.storage.sync.set(e,(()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(0)}))}))}static splitKeyNames(e,t=0){return Array(this._maxSplitKeys-t).fill(1).map(((s,i)=>"_"+e+(i+t)))}constructor(e){if(void 0===e)throw new Error("Cannot be called directly, call load() instead.");super(e),Object.assign(this,this.Class._webDefaults,e)}ordered(){return Object.keys(this).sort().reduce(((e,t)=>("_"!=t[0]&&(e[t]=this[t]),e)),{})}async remove(e){e=f(e);let t=[];const s=[];if(e.length>0){e.forEach((e=>{"syncLargeKeys"==e?s.push(e):this.Class._largeKeys.includes(e)?this.syncLargeKeys?t=t.concat(this.Class.splitKeyNames(e)):s.push(e):t.push(e)}));try{t.length&&await this.Class.removeSyncStorage(t),s.length&&await this.Class.removeLocalStorage(s),e.forEach((e=>{delete this[e]}))}catch(t){throw v.error("Failed to remove items.",e,t),new Error(`Failed to remove items: ${m(e)}. ${t.message}`)}}}async reset(){try{await this.Class.resetSyncStorage(),await this.Class.resetLocalStorage()}catch(e){throw v.error("Failed to clear storage.",e),new Error(`Failed to clear storage. ${e.message}`)}}async resetPreserveStats(){try{await this.Class.resetSyncStorage(),await this.Class.removeLocalStorage(this.Class._localConfigKeys)}catch(e){throw v.error("Failed to clear storage.",e),new Error(`Failed to clear storage. ${e.message}`)}}async save(e=[]){e=f(e);const t={},s={};0===e.length&&(e=this._persistableKeys);let i=[];e.forEach((e=>{if("syncLargeKeys"==e)s[e]=this[e];else if(this.Class._largeKeys.includes(e))if(this.syncLargeKeys){if(Object.assign(t,this.splitData(e)),this._lastSplitKeys){const s=this.Class.getMaxSplitKeyFromData(t,e);this._lastSplitKeys[e]>s?i=i.concat(this.Class.splitKeyNames(e,s+1)):this._lastSplitKeys[e]<s&&(this._lastSplitKeys[e]=s)}}else s[e]=this[e];else t[e]=this[e]}));try{if("safari"===this.Class.BUILD.target){const e=Object.keys(s).filter((e=>null==s[e])),i=Object.keys(t).filter((e=>null==t[e]));e.length&&(await this.Class.removeLocalStorage(e),e.forEach((e=>delete s[e]))),i.length&&(await this.Class.removeSyncStorage(i),i.forEach((e=>delete t[e])))}Object.keys(t).length&&await this.Class.saveSyncStorage(t),Object.keys(s).length&&await this.Class.saveLocalStorage(s),i.length&&await this.remove(i)}catch(t){throw v.error("Failed to save items.",e,t),new Error(`Failed to save items: ${m(e)}. [${t.message}]`)}}splitData(e){const t=new TextEncoder;let s=0,i=2;const o={};let a=`_${e}${s}`;return o[a]={},i+=t.encode(`{"${a}":{}}`).length,Object.keys(this[e]).sort().forEach((r=>{let n=t.encode(`",${r}":`).length;n+=t.encode(JSON.stringify(this[e][r])).length,i+n>=this.Class._maxBytes&&(s++,a=`_${e}${s}`,o[a]={},i=t.encode(`"${a}":{}`).length),i+=n,o[a][r]=this[e][r]})),o}}class b{cfg;static get Config(){return C}static get Constants(){return e}get Class(){return this.constructor}static _migrations=[{version:"1.0.13",name:"moveToNewWordsStorage",runOnImport:!1,async:!0},{version:"1.1.0",name:"sanitizeWords",runOnImport:!0},{version:"1.2.0",name:"singleWordSubstitution",runOnImport:!0},{version:"2.1.4",name:"updateDefaultSubs",runOnImport:!1},{version:"2.3.0",name:"fixSmartWatch",runOnImport:!1},{version:"2.7.0",name:"addWordlistsToWords",runOnImport:!0},{version:"2.7.0",name:"removeGlobalMatchMethod",runOnImport:!0},{version:"2.7.0",name:"removeOldDomainArrays",runOnImport:!0},{version:"2.22.0",name:"updateWordRepeatAndSeparatorDataTypes",runOnImport:!0},{version:"2.26.0",name:"changeShowUpdateNotificationDefaultToFalse",runOnImport:!1},{version:"2.40.0",name:"renameToWordAllowlist",runOnImport:!0,async:!0}];static migrations=this.compileMigrations();static async build(){return new this(this.loadCfg())}static compileMigrations(...e){return this._migrations.concat(...e).sort(this.sortByVersions)}static latestMigration(){return this.migrations[this.migrations.length-1]}static async loadCfg(){return await this.Config.load()}static migrationNeeded(e){return d(n(e),n(this.latestMigration().version))}static sortByVersions(e,t){return e.version==t.version?0:d(n(e.version),n(t.version))?-1:1}constructor(e){this.cfg=e}_renameConfigKeys(e,t,s){for(const i of t){const t=s[i];if(e[i]||(e[i]=this.Class.Config._defaults[t]),e[i].length){if(this.cfg[t].length)throw new Error(`'${i}' and '${t}' both exist. Please combine them manually into '${t}'.`);this.cfg[t]=e[i]}}}addWordlistsToWords(){const e=this.cfg;Object.keys(e.words).forEach((t=>{const s=e.words[t];Array.isArray(s.lists)||(s.lists=[])}))}async byVersion(e){const t=n(e);let s=!1;for(const e of this.constructor.migrations)d(t,n(e.version))&&(s=!0,e.async?await this[e.name]():this[e.name]());return s}fixSmartWatch(){const e=this.cfg,t="twat",s=this.Class.Constants.MATCH_METHODS.PARTIAL,i={twat:{matchMethod:this.Class.Constants.MATCH_METHODS.EXACT,repeat:!0,sub:"dumbo"},twats:{matchMethod:this.Class.Constants.MATCH_METHODS.EXACT,repeat:!0,sub:"dumbos"}};e.words[t]&&e.words[t].matchMethod==s&&"dumbo"==e.words[t].sub&&Object.keys(i).forEach((t=>{e.words[t]=i[t]}))}async moveToNewWordsStorage(){const e="words",t=await this.Class.Config.getSyncStorage(e);t.words&&(await this.Class.Config.saveSyncStorage({_words0:t.words}),await this.Class.Config.removeSyncStorage(e))}removeGlobalMatchMethod(){const e=this.cfg;void 0!==e.globalMatchMethod&&(Object.keys(e.words).forEach((t=>{const s=e.words[t];4===s.matchMethod&&(s.matchMethod=this.Class.Constants.MATCH_METHODS.REGEX)})),e.remove("globalMatchMethod"))}removeOldDomainArrays(){const e=this.cfg;e.domains||(e.domains={});const t={advancedDomains:"adv",disabledDomains:"disabled",enabledDomains:"enabled"};Object.keys(t).forEach((s=>{e[s]&&Array.isArray(e[s])&&e[s].length>0&&e[s].forEach((i=>{i&&(null==e.domains[i]&&(e.domains[i]={}),e.domains[i][t[s]]=!0)})),delete e[s]}))}async renameToWordAllowlist(){const e={iWordWhitelist:"iWordAllowlist",wordWhitelist:"wordAllowlist"},t=Object.keys(e);if(this.Class.Config.chromeStorageAvailable()){const s=await this.Class.Config.getSyncStorage(t);Object.keys(s).some((e=>t.includes(e)))&&(this._renameConfigKeys(s,t,e),await this.Class.Config.removeSyncStorage(t))}this._renameConfigKeys(this.cfg,t,e)}async runImportMigrations(){let e=!1;for(const t of this.constructor.migrations)t.runOnImport&&(e=!0,t.async?await this[t.name]():this[t.name]());return e}sanitizeWords(){this.cfg.sanitizeWords()}singleWordSubstitution(){const e=this.cfg;Object.keys(e.words).forEach((t=>{const s=e.words[t];s.hasOwnProperty("words")&&(s.sub=s.words[0]||"",delete s.words)}))}updateDefaultSubs(){const e=this.cfg,t={bastard:{original:"jerk",update:"idiot"},bitch:{original:"jerk",update:"bench"},cocksucker:{original:"idiot",update:"suckup"},cunt:{original:"explative",update:"expletive"},fag:{original:"slur",update:"gay"},faggot:{original:"slur",update:"gay"},fags:{original:"slur",update:"gays"},fuck:{original:"fudge",update:"freak"},goddammit:{original:"goshdangit",update:"dangit"},jackass:{original:"idiot",update:"jerk"},nigga:{original:"ethnic slur",update:"bruh"},nigger:{original:"ethnic slur",update:"man"},niggers:{original:"ethnic slurs",update:"people"},tits:{original:"explative",update:"chest"},twat:{original:"explative",update:"dumbo"}};Object.keys(t).forEach((s=>{if(e.words[s]){const i=e.words[s];i.sub==t[s].original&&(i.sub=t[s].update)}}))}updateWordRepeatAndSeparatorDataTypes(){const e=this.cfg;Object.keys(e.words).forEach((s=>{const i=e.words[s];!0===i.repeat||!1===i.repeat?i.repeat=t(i.repeat):null==i.repeat&&(i.repeat=e.defaultWordRepeat),!0===i.separators||!1===i.separators?i.separators=t(i.separators):null==i.separators&&(i.separators=e.defaultWordSeparators)}))}changeShowUpdateNotificationDefaultToFalse(){this.cfg.showUpdateNotification=this.Class.Config._defaults.showUpdateNotification}}class T extends e{static BUILD_TARGET_IOS="ios";static BUILD_TARGET_SAFARI="safari";static MUTE_METHODS={TAB:0,VIDEO_VOLUME:1,VIDEO_MUTE:2,NONE:9};static SHOW_SUBTITLES={ALL:0,FILTERED:1,UNFILTERED:2,NONE:3};static STATS_TYPE_AUDIO="audio";static STATUS={DISABLED:0,NORMAL:1,ADVANCED:2,DEEP:3,MUTE_PAGE:4,CAPTIONS:5}}class A extends C{audioWordlistId;customAudioSites;fillerAudio;muteAudio;muteAudioOnly;muteCueRequireShowing;muteMethod;showSubtitles;youTubeAutoMatchCensored;youTubeAutoSubsMax;youTubeAutoSubsMin;static get Constants(){return T}get Class(){return this.constructor}static _premiumDefaults={audioWordlistId:0,customAudioSites:null,fillerAudio:"",muteAudio:!1,muteAudioOnly:!1,muteCueRequireShowing:!1,muteMethod:this.BUILD.config.muteMethod||this.Constants.MUTE_METHODS.TAB,showSubtitles:T.SHOW_SUBTITLES.ALL,youTubeAutoMatchCensored:!0,youTubeAutoSubsMax:0,youTubeAutoSubsMin:0};static _defaults=this.initializeDefaults({},this._configDefaults,this._webDefaults,this._premiumDefaults);static _persistableKeys=Object.keys(this._defaults);static async load(e=[]){return super.load(e)}constructor(e){super(e),Object.assign(this,this.Class._premiumDefaults,e)}}class I extends b{static get Config(){return A}static get Constants(){return T}static _premiumMigrations=[{version:"2.12.0",name:"overwriteMuteCueRequireShowingDefault",runOnImport:!1}];static migrations=this.compileMigrations(this._premiumMigrations);overwriteMuteCueRequireShowingDefault(){const e=this.cfg;!0===e.muteCueRequireShowing&&(e.muteCueRequireShowing=!1)}}class L{advanced;cfg;cfgKey;deep;disabled;enabled;framesOff;framesOn;hostname;tab;wordlistId;static get Constants(){return e}get Class(){return this.constructor}static _domainCfgDefaults={adv:void 0,deep:void 0,disabled:void 0,enabled:void 0,framesOff:void 0,framesOn:void 0,wordlist:void 0};static byHostname(e,t){const s=this.findDomainKey(e,t)||e,i=this.byKey(s,t);return i.hostname=e,i}static byKey(e,t){return new this(e,t[e])}static findDomainKey(e,t){return Object.keys(t).sort(((e,t)=>t.length-e.length)).find((t=>new RegExp(`(^|.)${t}$`).test(e)))}static getCurrentTab(){return new Promise(((e,t)=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{e(t[0])}))}))}static sortedKeys(e){return Object.keys(e).sort(((e,t)=>{const s=this.sortingKey(e),i=this.sortingKey(t);return s==i?e<t?-1:e>t?1:0:s<i?-1:s>i?1:0}))}static sortingKey(e){const t=e.split(".");switch(t.length){case 1:case 2:return t[0];case 3:return t[1];case 4:return t[1].match(/^\d+$/)?e:t[3].length?t[1]:t[2];default:return t[2]}}constructor(e,t){this.cfgKey=e,this.cfg={},t?this.cfg=t:Object.assign(this.cfg,this.Class._domainCfgDefaults),this.updateFromCfg()}getModeIndex(){return this.advanced?this.Class.Constants.DOMAIN_MODES.ADVANCED:this.deep?this.Class.Constants.DOMAIN_MODES.DEEP:this.Class.Constants.DOMAIN_MODES.NORMAL}async save(e){if(e.domains)return this.updateCfg(),"{}"===JSON.stringify(this.cfg)?delete e.domains[this.cfgKey]:e.domains[this.cfgKey]=this.cfg,await e.save("domains")}updateCfg(){this.cfg.adv=!0===this.advanced||void 0,this.cfg.deep=!0===this.deep||void 0,this.cfg.disabled=!0===this.disabled||void 0,this.cfg.enabled=!0===this.enabled||void 0,this.cfg.framesOff=!0===this.framesOff||void 0,this.cfg.framesOn=!0===this.framesOn||void 0,this.cfg.wordlist=this.wordlistId>=0?this.wordlistId:void 0}updateFromCfg(){this.advanced=this.cfg.adv,this.deep=this.cfg.deep,this.disabled=this.cfg.disabled,this.enabled=this.cfg.enabled,this.framesOff=this.cfg.framesOff,this.framesOn=this.cfg.framesOn,this.wordlistId=this.cfg.wordlist}updateFromModeIndex(e){switch(e){case this.Class.Constants.DOMAIN_MODES.NORMAL:this.advanced=!1,this.deep=!1;break;case this.Class.Constants.DOMAIN_MODES.ADVANCED:this.advanced=!0,this.deep=!1;break;case this.Class.Constants.DOMAIN_MODES.DEEP:this.advanced=!1,this.deep=!0}}}class M extends L{audioWordlistId;get Class(){return this.constructor}static _cfgDefaultAudioList=void 0;static byHostname(e,t){return super.byHostname(e,t)}constructor(e,t){super(e,t),this.cfg.hasOwnProperty("audioList")||(this.cfg.audioList=this.Class._cfgDefaultAudioList),this.audioWordlistId=this.cfg.audioList}updateCfg(){super.updateCfg(),this.cfg.audioList=this.audioWordlistId>=0?this.audioWordlistId:void 0}updateFromCfg(){super.updateFromCfg(),this.audioWordlistId=this.cfg.audioList}}class x{_filterMethod;case;escaped;lists;matchMethod;matchRepeated;matchSeparators;regExp;sub;subs;unicode;value;static _edgePunctuationRegExp=/(^[,.'"!?%$+]|[,.'"!?%$+]$)/;static _escapeRegExp=/[\/\\^$*+?.()|[\]{}]/g;static _unicodeRegExp=/[^\u0000-\u00ff]/;static _unicodeWordBoundary="[\\s.,'\"+!?|-]";static nonWordRegExp=new RegExp("^\\s*[^\\w]+\\s*$","g");static separatorsRegExp="[-_ ]*";static whitespaceRegExp=/^\s+$/;static allLowerCase(e){return e.toLowerCase()===e}static allUpperCase(e){return e.toUpperCase()===e}static capitalizeEachWord(e){return e.split(/[-_ ]+/i).forEach((t=>{e=e.replace(t,this.capitalizeFirst(t))})),e}static capitalizeFirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}static containsDoubleByte(e){return!!e.length&&(e.charCodeAt(0)>127||x._unicodeRegExp.test(e))}static eachWordCapitalized(e){return e.split(/[-_ ]+/i).every((e=>this.firstCapitalized(e)))}static escapeRegExp(e){return e.replace(x._escapeRegExp,"\\$&")}static firstCapitalized(e){const t=e.charAt(0);return t===t.toUpperCase()&&t!==t.toLowerCase()}constructor(t,s,i){this.value=t,this.case=s.case>e.FALSE?e.TRUE:e.FALSE,this.lists=void 0===s.lists?[]:s.lists,this.matchMethod=void 0===s.matchMethod?i.defaultWordMatchMethod:s.matchMethod,this.matchRepeated=void 0===s.repeat?i.defaultWordRepeat:s.repeat,this.matchSeparators=void 0===s.separators?i.defaultWordSeparators:s.separators,this.sub=s.sub||i.defaultSubstitution,this.subs=this.sub.split(i.wordSubSeparator),this._filterMethod=void 0===s._filterMethod?i.filterMethod:s._filterMethod,this.unicode=x.containsDoubleByte(t),this.escaped=this.matchMethod===e.MATCH_METHODS.REGEX?this.value:x.escapeRegExp(this.value),this.regExp=this.buildRegExp()}buildRegExp(){try{switch(this.matchMethod){case e.MATCH_METHODS.PARTIAL:return this._filterMethod===e.FILTER_METHODS.REMOVE?this.unicode?new RegExp("(^|"+x._unicodeWordBoundary+"?)([\\w-]*"+this.processedPhrase()+"[\\w-]*)("+x._unicodeWordBoundary+"?|$)",this.regexOptions()):this.hasEdgePunctuation()?new RegExp("(^|\\s)([\\w-]*"+this.processedPhrase()+"[\\w-]*)(\\s|$)",this.regexOptions()):new RegExp("\\s?\\b[\\w-]*"+this.processedPhrase()+"[\\w-]*\\b\\s?",this.regexOptions()):new RegExp(this.processedPhrase(),this.regexOptions());case e.MATCH_METHODS.WHOLE:return this.unicode?new RegExp("(^|"+x._unicodeWordBoundary+"*)([\\S]*"+this.processedPhrase()+"[\\S]*)("+x._unicodeWordBoundary+"*|$)",this.regexOptions()):this.hasEdgePunctuation()?new RegExp("(^|\\s)([\\S]*"+this.processedPhrase()+"[\\S]*)(\\s|$)",this.regexOptions()):new RegExp("\\b[\\w-]*"+this.processedPhrase()+"[\\w-]*\\b",this.regexOptions());case e.MATCH_METHODS.REGEX:return new RegExp(this.value,this.regexOptions());case e.MATCH_METHODS.EXACT:default:return this.unicode||"-"!=this.value[0]&&"-"!=this.value[this.value.length-1]||(this.unicode=!0),this._filterMethod===e.FILTER_METHODS.REMOVE?this.unicode?new RegExp("(^|"+x._unicodeWordBoundary+")("+this.processedPhrase()+")("+x._unicodeWordBoundary+"|$)",this.regexOptions()):this.hasEdgePunctuation()?new RegExp("(^|\\s)("+this.processedPhrase()+")(\\s|$)",this.regexOptions()):new RegExp("\\s?\\b"+this.processedPhrase()+"\\b\\s?",this.regexOptions()):this.unicode?new RegExp("(^|"+x._unicodeWordBoundary+"+)("+this.processedPhrase()+")("+x._unicodeWordBoundary+"+|$)",this.regexOptions()):this.hasEdgePunctuation()?new RegExp("(^|\\s)("+this.processedPhrase()+")(\\s|$)",this.regexOptions()):new RegExp("\\b"+this.processedPhrase()+"\\b",this.regexOptions())}}catch(e){throw new Error(`Failed to create RegExp for '${this.value}'. [${e.name}: ${e.message}]`)}}hasEdgePunctuation(){return x._edgePunctuationRegExp.test(this.value)}processedPhrase(){const e=this.escaped.includes("\\");let t="";const s=this.escaped.length-1;for(let i=0;i<this.escaped.length;i++)e&&"\\"===this.escaped[i]&&(t+=this.escaped[i],i++),t+=this.escaped[i],this.matchRepeated&&(t+="+"),this.matchSeparators&&i!=s&&(t+=x.separatorsRegExp);return t}regexOptions(){let e="gi";return this.unicode&&(e+="u"),e}}const k=new S("Wordlist");class O{all;list;regExps;constructor(t,s){this.all=[],this.list=[],this.regExps=[],k.setLevel(t.loggingLevel),Object.keys(t.words).sort(((e,t)=>t.length-e.length)).forEach((i=>{if(s===e.ALL_WORDS_WORDLIST_ID||!Array.isArray(t.words[i].lists)||t.words[i].lists.includes(s))try{const e=new x(i,t.words[i],t);this.list.push(i),this.all.push(e),this.regExps.push(e.regExp)}catch(e){k.warn(`Failed to add '${i}' to wordlist.`,e)}}))}find(e){return"string"==typeof e?this.all[this.list.indexOf(e)]:"number"==typeof e?this.all[e]:void 0}}class R{allowlist;cfg;counter;iAllowlist;wordlistId;wordlists;constructor(){this.allowlist=[],this.counter=0,this.iAllowlist=[],this.wordlists={}}buildWordlist(e,t=!1){return!1===e&&(e=this.wordlistId),!t&&this.wordlists[e]||(this.wordlists[e]=new O(this.cfg,e)),e}checkAllowlist(t,s,i,o){const a=this.allowlist.length,r=this.iAllowlist.length;if(a||r){if(a&&this.allowlist.includes(t))return!0;if(r&&this.iAllowlist.includes(t.toLowerCase()))return!0;if(o.matchMethod===e.MATCH_METHODS.PARTIAL){const o={matchMethod:e.MATCH_METHODS.WHOLE,repeat:e.FALSE,separators:e.FALSE,sub:""},n=new x(t,o,this.cfg).regExp;let l;for(;null!==(l=n.exec(s));){const e=4==l.length?l[2]:l[0],s=4==l.length?l.index+l[1].length:l.index;if(s<=i&&s+e.length>=i+t.length){if(a&&this.allowlist.includes(e))return!0;if(r&&this.iAllowlist.includes(e.toLowerCase()))return!0}}}}return!1}foundMatch(e,t){this.counter++}init(t=!1){this.iAllowlist=this.cfg.iWordAllowlist,this.allowlist=this.cfg.wordAllowlist,void 0===this.wordlistId&&(this.wordlistId=null==this.cfg.wordlistId?e.ALL_WORDS_WORDLIST_ID:this.cfg.wordlistId),this.buildWordlist(t)}matchData(t,s,i,o){const a=t.find(s),r=o.pop(),n=o.pop(),l=o,d=l.length>0&&a.matchMethod!==e.MATCH_METHODS.REGEX;return d&&(i=l[1]),{word:a,string:r,match:i,matchStartIndex:n,captureGroups:l,internalCaptureGroups:d}}rebuildWordlists(){Object.keys(this.wordlists).forEach((e=>{this.buildWordlist(parseInt(e),!0)}))}replaceText(t,s=!1,i=e.STATS_TYPE_TEXT){s=this.buildWordlist(s);const o=this.wordlists[s];switch(this.cfg.filterMethod){case e.FILTER_METHODS.OFF:case e.FILTER_METHODS.CENSOR:o.regExps.forEach(((e,s)=>{t=t.replace(e,((e,...t)=>{const{word:a,string:r,match:n,matchStartIndex:l,captureGroups:d,internalCaptureGroups:c}=this.matchData(o,s,e,t);if(this.checkAllowlist(n,r,l,a))return n;i&&this.foundMatch(a,i);let u="";const h=this.cfg.censorFixedLength>0?this.cfg.censorFixedLength:n.length;return u=this.cfg.preserveFirst&&this.cfg.preserveLast?n[0]+this.cfg.censorCharacter.repeat(h-2)+n.slice(-1):this.cfg.preserveFirst?n[0]+this.cfg.censorCharacter.repeat(h-1):this.cfg.preserveLast?this.cfg.censorCharacter.repeat(h-1)+n.slice(-1):this.cfg.censorCharacter.repeat(h),c&&(u=d[0]+u+d[2]),u}))}));break;case e.FILTER_METHODS.SUBSTITUTE:o.regExps.forEach(((s,a)=>{t=t.replace(s,((t,...s)=>{const{word:r,string:n,match:l,matchStartIndex:d,captureGroups:c,internalCaptureGroups:u}=this.matchData(o,a,t,s);if(this.checkAllowlist(l,n,d,r))return l;i&&this.foundMatch(r,i);let h=this.shuffleSubstitution(r.subs);return r.matchMethod==e.MATCH_METHODS.REGEX&&c.length&&r.sub.includes("\\1")&&(c.forEach(((e,t)=>{h=h.replace(`\\${t+1}`,this.cfg.preserveCase?e:e.toLowerCase())})),h!==r.sub)?(this.cfg.substitutionMark&&(h="["+h+"]"),h):(r.case==e.FALSE&&this.cfg.preserveCase&&(x.allUpperCase(l)?h=h.toUpperCase():x.eachWordCapitalized(l)?h=x.capitalizeEachWord(h):x.firstCapitalized(l)&&(h=x.capitalizeFirst(h))),this.cfg.substitutionMark&&(h="["+h+"]"),u&&(h=c[0]+h+c[2]),h)}))}));break;case e.FILTER_METHODS.REMOVE:o.regExps.forEach(((e,s)=>{t=t.replace(e,((e,...t)=>{const{word:a,string:r,match:n,matchStartIndex:l,captureGroups:d,internalCaptureGroups:c}=this.matchData(o,s,e,t);return this.checkAllowlist(n.trim(),r,l,a)?n:(i&&this.foundMatch(a,i),c?x.whitespaceRegExp.test(d[0])&&x.whitespaceRegExp.test(d[2])?d[0]:x.nonWordRegExp.test(d[0])||x.nonWordRegExp.test(d[2])?(d[0]+d[2]).trim():"":x.whitespaceRegExp.test(n[0])&&x.whitespaceRegExp.test(n[n.length-1])?n[0]:"")}))}))}return t}replaceTextResult(t,s=!1,i=e.STATS_TYPE_TEXT){const o={original:t,filtered:this.replaceText(t,s,i),modified:!1};return o.modified=o.filtered!=t,o}shuffleSubstitution(e){return function(e){const t=e.length;return t<=1?e[0]:e[Math.floor(Math.random()*t)]}(e)}}class _{authenticated;optionPage;password;static get OptionPage(){return N}get Class(){return this.constructor}authenticate(e){const t=document.getElementById("passwordInput");t.value==this.password?(this.authenticated=!0,this.Class.OptionPage.closeModal("passwordModal"),this.Class.OptionPage.show(document.getElementById("main")),this.Class.OptionPage.hideInputError(t)):this.Class.OptionPage.showInputError(t)}constructor(e,t){this.optionPage=e,this.password=t,this.authenticated=!1}async setPassword(){const e=document.getElementById("setPassword");this.optionPage.cfg.password=e.value;try{await this.optionPage.cfg.save("password"),e.value="",this.setPasswordButton()}catch(e){this.Class.OptionPage.handleError("Failed to update password.",e)}}setPasswordButton(){const e=document.getElementById("setPassword"),t=document.getElementById("setPasswordBtn");this.optionPage.cfg.password?(this.Class.OptionPage.enableBtn(t),e.value?t.innerText="SET":t.innerText="REMOVE"):(t.innerText="SET",e.value?this.Class.OptionPage.enableBtn(t):this.Class.OptionPage.disableBtn(t))}}const B=new S("OptionPage:Bookmarklet");class D{code;static async create(){const e=await this.loadCode();if(e)return new this(e)}static async loadCode(){try{const e="./bookmarkletFilter.js",t=await fetch(e);return await t.text()}catch(e){B.warn("Failed to load bookmarklet script.",e)}}constructor(e){this.code=e}customizedCode(e){const t="/* @preserve - Start User Config */",s="/* @preserve - End User Config */",i=new RegExp(`${t.replace(/[\/\*]/g,"\\$&")}[\\S\\s]*${s.replace(/[\/\*]/g,"\\$&")}`,"m");try{const o=this.code.match(i).toString().match(/const ([a-zA-Z_$]+)=/m);if(o&&o[1]){const a=o[1];return this.code.replace(i,`${t}\nconst ${a}=${JSON.stringify(e)};\n${s}\n`)}throw new Error("Unable to set user config - using defaults.")}catch(e){return window.alert(e.message),this.code}}href(e=null){return"javascript:"+(e?this.customizedCode(e):this.code)}}const W=new S("OptionPage");class N{_confirmEventListeners;auth;bookmarklet;cfg;darkModeButton;filter;lessUsedWords;lightModeButton;prefersDarkScheme;themeElements;static get Bookmarklet(){return D}static get Config(){return C}static get Constants(){return e}static get DataMigration(){return b}static get Domain(){return L}static get Filter(){return R}static get OptionAuth(){return _}get Class(){return this.constructor}static activeClass="w3-flat-belize-hole";static themeElementSelectors=["body","div#page","div.w3-modal"];static closeModal(e){this.hide(document.getElementById(e))}static configureConfirmModal(e={},t){const s=document.getElementById("confirmModalTitle"),i=document.getElementById("confirmModalContent"),o=document.querySelector("#confirmModal header"),a=document.querySelector("#confirmModal span.confirmBackupButton"),r=document.querySelector("#confirmModal button#confirmModalBackup");p(i),e=Object.assign({backup:!1,content:"Are you sure?",title:"Please Confirm",titleClass:"w3-flat-peter-river"},e),t||((t=document.createElement("span")).textContent=e.content),s.textContent=e.title,i.appendChild(t),o.className=`w3-container ${e.titleClass}`,e.backup?(this.show(a),this.enableBtn(r)):(this.hide(a),this.disableBtn(r))}static configureStatusModal(e,t,s){const i=document.getElementById("statusModalTitle"),o=document.getElementById("statusModalContent"),a=document.querySelector("#statusModal header");p(o),a.className=`w3-container ${s}`,i.textContent=t,(e=f(e)).forEach((e=>{const t=document.createElement("p");t.textContent=e,o.appendChild(t)}))}static disableBtn(e){e.classList.add("disabled"),e.classList.add("w3-flat-silver")}static enableBtn(e){e.classList.remove("disabled"),e.classList.remove("w3-flat-silver")}static handleError(e,t){t?(W.error(e,t),this.showErrorModal([e,`Error: ${t.message}`])):(W.error(e),this.showErrorModal([e]))}static hide(e){e.classList.remove("w3-show"),e.classList.add("w3-hide")}static hideInputError(e){e.classList.remove("w3-border-red");try{e.setCustomValidity("")}catch(e){}}static hideStatus(){const e=document.getElementById("notificationPanel");this.hide(e)}static isStorageError(e){if(e.message){const t="[QUOTA_BYTES quota exceeded]",s="[QuotaExceededError: storage.sync API call exceeded its quota limitations.]",i="Storage quota exceeded.";return e.message.includes(t)||e.message.includes(s)||e.message.includes(i)}return!1}static openModal(e){this.show(document.getElementById(e))}static show(e){e.classList.remove("w3-hide"),e.classList.add("w3-show")}static showErrorModal(e=["The requested action failed. Please try again or contact support."],t="Error",s="w3-red"){this.configureStatusModal(e,t,s),this.openModal("statusModal")}static showInputError(e,t=""){if(e.classList.add("w3-border-red"),t)try{e.setCustomValidity(t),e.reportValidity()}catch(e){this.showWarningModal(t)}}static showStatusModal(e=["Status updated."],t="Status",s="w3-flat-peter-river"){this.configureStatusModal(e,t,s),this.openModal("statusModal")}static showWarningModal(e=["Invalid input."],t="Warning",s="w3-orange"){this.configureStatusModal(e,t,s),this.openModal("statusModal")}constructor(){this._confirmEventListeners=[],this.darkModeButton=document.querySelector("div.themes > div.moon"),this.lightModeButton=document.querySelector("div.themes > div.sun"),this.themeElements=this.Class.themeElementSelectors.map((e=>Array.from(document.querySelectorAll(e)))).flat(),this.prefersDarkScheme=!!window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,this.setHelpVersion(),this.filter=new this.Class.Filter}applyDarkTheme(e=!0){document.documentElement.style.setProperty("color-scheme","dark");const t=document.querySelector("table#statsWordTable"),s=document.querySelector("table#bulkWordEditorTable");t.classList.remove("w3-striped"),s.classList.remove("w3-striped"),this.setThemeButton(!0),e&&this.themeElements.forEach((e=>{e.classList.add("dark"),e.classList.remove("light")}))}applyLightTheme(e=!0){document.documentElement.style.setProperty("color-scheme","light");const t=document.querySelector("table#statsWordTable"),s=document.querySelector("table#bulkWordEditorTable");t.classList.add("w3-striped"),s.classList.add("w3-striped"),this.setThemeButton(!1),e&&this.themeElements.forEach((e=>{e.classList.remove("dark"),e.classList.add("light")}))}applyTheme(e=!1){null==this.cfg.darkMode?this.prefersDarkScheme?this.applyDarkTheme(e):this.applyLightTheme(e):this.cfg.darkMode?this.applyDarkTheme():this.applyLightTheme()}backupConfig(){const e=e=>("0"+e).slice(-2),t=new Date,s=`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`,i=`${e(t.getHours())}${e(t.getMinutes())}${e(t.getSeconds())}`;!function(e,t="data.txt"){const s="data:application/json;charset=utf-8,"+encodeURIComponent(e),i=document.createElement("a");i.setAttribute("href",s),i.setAttribute("download",t),i.click(),i.remove()}(JSON.stringify(this.cfg.ordered(),null,2),`apf-backup-${s}_${i}.json`)}bulkEditorAddRow(e="",t){const s=document.querySelector("#bulkWordEditorModal table#bulkWordEditorTable");void 0===t&&(t={lists:[],matchMethod:this.cfg.defaultWordMatchMethod,repeat:this.cfg.defaultWordRepeat,separators:this.cfg.defaultWordSeparators,sub:""});const i=s.tBodies[0].insertRow();i.classList.add("bulkWordRow");const o=i.insertCell(0),a=i.insertCell(1),r=i.insertCell(2),n=i.insertCell(3),l=i.insertCell(4),d=i.insertCell(5),c=i.insertCell(6),h=document.createElement("button");h.textContent="X",h.addEventListener("click",(e=>{this.bulkEditorRemoveRow(e.target)})),o.appendChild(h);const m=document.createElement("input");m.type="text",m.classList.add("bulkAddWordText"),m.value=e,a.appendChild(m);const p=document.createElement("input");p.type="text",r.appendChild(p),p.value=t.sub;const g=document.createElement("input");g.type="checkbox",g.name="subCase",g.checked=u(t.case),n.appendChild(g);const f=document.createElement("select");this.Class.Constants.orderedArray(this.Class.Constants.MATCH_METHODS).forEach(((e,t)=>{const s=e.toUpperCase(),i=document.createElement("option");i.value=this.Class.Constants.MATCH_METHODS[s].toString(),i.classList.add(`bulkMatchMethod${this.Class.Constants.MATCH_METHODS[s]}`),i.textContent=e,f.appendChild(i)})),f.selectedIndex=t.matchMethod,l.appendChild(f);const y=document.createElement("input");y.type="checkbox",y.name="repeat",y.checked=u(t.repeat),d.appendChild(y);const E=document.createElement("input");E.type="checkbox",E.name="separators",E.checked=u(t.separators),c.appendChild(E);const S=i.cells.length;this.cfg.wordlists.forEach(((e,s)=>{const o=i.insertCell(s+S),a=document.createElement("input");a.type="checkbox",a.name="wordlists",a.classList.add("wordlistData"),a.dataset.col=(s+1).toString(),a.checked=t.lists.includes(s+1),o.appendChild(a)})),""===e&&(s.parentElement.scrollTop=s.parentElement.scrollHeight-s.parentElement.clientHeight,m.focus())}bulkEditorAddWords(){const e=document.querySelector("#bulkWordEditorModal textarea#bulkAddWordsText"),t=e.value;if(""!=t){const s=document.querySelector("#bulkWordEditorModal table#bulkWordEditorTable"),i=t.toLowerCase().split("\n").map((e=>e.trim())),o=i.filter(((e,t)=>i.indexOf(e)===t)),a=this.bulkEditorCurrentWords();o.filter((e=>!a.includes(e))).forEach((e=>{""!=e&&this.bulkEditorAddRow(e)})),s.parentElement.scrollTop=s.parentElement.scrollHeight-s.parentElement.clientHeight,e.value=""}}bulkEditorRemoveAll(){p(document.querySelector("#bulkWordEditorModal table tbody")),this.bulkEditorAddRow()}bulkEditorRemoveRow(e){const t=document.querySelector("#bulkWordEditorModal table#bulkWordEditorTable"),s=e.parentElement.parentElement;t.deleteRow(s.rowIndex),1==t.rows.length&&this.bulkEditorAddRow()}async bulkEditorSave(){const e=document.querySelector("#bulkWordEditorModal table#bulkWordEditorTable"),s={};this.cfg.words={},e.querySelectorAll("tr.bulkWordRow").forEach((e=>{const i=e.querySelectorAll("td"),o=[];e.querySelectorAll('input[name="wordlists"]').forEach(((e,t)=>{e.checked&&o.push(t+1)}));const a=i[1].querySelector("input").value;if(""!=a){const e={case:t(i[3].querySelector("input").checked),lists:o,matchMethod:i[4].querySelector("select").selectedIndex,repeat:t(i[5].querySelector("input").checked),separators:t(i[6].querySelector("input").checked),sub:i[2].querySelector("input").value};this.cfg.addWord(a,e)||(s[a]=e)}}));try{await this.cfg.save("words"),this.Class.closeModal("bulkWordEditorModal"),this.Class.showStatusModal("Words saved successfully."),this.filter.rebuildWordlists(),this.populateOptions()}catch(e){this.Class.isStorageError(e)&&this.cfg.syncLargeKeys?this.confirm("bulkEditorSaveRetry"):(W.warn("Failed to save.",e),this.Class.showErrorModal(["Failed to save.",`Error: ${e.message}`]))}}async bulkEditorSaveRetry(){document.getElementById("configSyncLargeKeys").checked=!1;try{await this.convertStorageLocation(null,!0),await this.bulkEditorSave()}catch(e){this.Class.handleError("Failed to save.",e)}}async importConfigRetryCancel(){await this.init()}bulkEditorWordlistCheckbox(e){const t=e.checked;document.querySelectorAll(`#bulkWordEditorModal table td input.wordlistData[data-col="${e.dataset.col}"]`).forEach((e=>{e.checked=t}))}bulkEditorCurrentWords(){const e=document.querySelector("#bulkWordEditorModal table#bulkWordEditorTable"),t=[];return e.querySelectorAll("tr > td > input.bulkAddWordText").forEach(((e,s)=>{t.push(e.value)})),t}bulkWordEditorHeaderRow(){const e=document.createElement("tr"),t=document.createElement("th"),s=document.createElement("button");s.textContent="X",s.id="bulkEditorRemoveAll",s.addEventListener("click",(e=>{this.bulkEditorRemoveAll()}));const i=document.createElement("span");return i.textContent="Remove",t.appendChild(s),t.appendChild(i),e.appendChild(t),["Word","Substitution","Substitution Case","Match Method","Repeated","Separators"].forEach((t=>{const s=document.createElement("th"),i=document.createElement("span");i.textContent=t,s.appendChild(i),e.appendChild(s)})),this.cfg.wordlists.forEach(((t,s)=>{const i=document.createElement("th"),o=document.createElement("label"),a=document.createElement("input"),r=document.createElement("span");a.type="checkbox",a.classList.add("wordlistHeader"),a.dataset.col=(s+1).toString(),r.textContent=`${t}`,o.appendChild(a),o.appendChild(r),i.appendChild(o),e.appendChild(i)})),e}configInlineToggle(){const e=document.getElementById("configInlineInput"),t=document.getElementById("configText");e.checked?(this.Class.show(t),this.exportConfig()):(this.Class.hide(t),t.value="")}async confirm(e){const t=document.getElementById("confirmModalCancel"),s=document.getElementById("confirmModalOK");for(const e of this._confirmEventListeners)t.removeEventListener("click",e),s.removeEventListener("click",e);this._confirmEventListeners=[];const i=document.createElement("span"),o=document.createElement("p"),a=document.createElement("i");let r=!0;switch(e){case"bulkEditorSave":o.textContent="Are you sure you want to save these changes?",a.textContent="Make sure you have a backup first!",i.appendChild(o),i.appendChild(a),this.Class.configureConfirmModal({backup:!0},i),this._confirmEventListeners.push(this.bulkEditorSave.bind(this)),s.addEventListener("click",c(this._confirmEventListeners));break;case"bulkEditorSaveRetry":o.textContent="Failed to save changes because they were too large to be stored. Retry using local storage?",a.textContent="Local storage can store more, but things like words and domains will no longer sync between devices.",i.appendChild(o),i.appendChild(a),this.Class.configureConfirmModal({backup:!0,titleClass:"w3-red"},i),this._confirmEventListeners.push(this.bulkEditorSaveRetry.bind(this)),s.addEventListener("click",c(this._confirmEventListeners));break;case"convertStorageLocation":this.cfg.syncLargeKeys?o.textContent="This will prevent large settings like words and domains from syncing, but allow you to store more.":o.textContent="This will allow large settings like words and domains to sync, but has stricter limits on how much you can store.",a.textContent="Make sure you have a backup first!",i.appendChild(o),i.appendChild(a),this.Class.configureConfirmModal({backup:!0},i),this._confirmEventListeners.push(this.populateConfig.bind(this)),t.addEventListener("click",c(this._confirmEventListeners)),this._confirmEventListeners.push(this.convertStorageLocation.bind(this)),s.addEventListener("click",c(this._confirmEventListeners));break;case"importConfig":this.Class.configureConfirmModal({content:"Are you sure you want to overwrite your existing settings?",backup:!0}),this._confirmEventListeners.push(this.importConfig.bind(this)),s.addEventListener("click",c(this._confirmEventListeners));break;case"importConfigRetry":o.textContent="Import failed due to storage limitations. Would you like to try again using local storage?",a.textContent="Local storage can store more, but things like words and domains will no longer sync between devices.",i.appendChild(o),i.appendChild(a),this.Class.configureConfirmModal({backup:!1,titleClass:"w3-red"},i),this._confirmEventListeners.push(this.importConfigRetryCancel.bind(this)),t.addEventListener("click",c(this._confirmEventListeners)),this._confirmEventListeners.push(this.importConfigRetry.bind(this)),s.addEventListener("click",c(this._confirmEventListeners));break;case"removeAllWords":o.textContent="Are you sure you want to remove all words?",i.appendChild(o),this.Class.configureConfirmModal({backup:!0},i),this._confirmEventListeners.push(this.removeAllWords.bind(this)),s.addEventListener("click",c(this._confirmEventListeners));break;case"removeLessUsedWords":r=this.validateLessUsedWordsNumber(),r&&(await this.prepareLessUsedWords(),Object.keys(this.lessUsedWords).length?(this.Class.configureConfirmModal({backup:!0,content:`Are you sure you want to remove ${Object.keys(this.lessUsedWords).length} words?`}),this._confirmEventListeners.push(this.removeLessUsedWords.bind(this)),s.addEventListener("click",c(this._confirmEventListeners))):(r=!1,this.Class.showStatusModal("All words have been filtered more times than the provided number.\n\nTry increasing the number to include more words.")));break;case"statsReset":this.Class.configureConfirmModal({content:"Are you sure you want to reset filter statistics?"}),this._confirmEventListeners.push(this.statsReset.bind(this)),s.addEventListener("click",c(this._confirmEventListeners));break;case"restoreDefaults":this.Class.configureConfirmModal({content:"Are you sure you want to restore defaults?",backup:!0}),this._confirmEventListeners.push(this.restoreDefaults.bind(this)),s.addEventListener("click",c(this._confirmEventListeners));break;case"setPassword":{const e=document.getElementById("setPassword");if(document.getElementById("setPasswordBtn").classList.contains("disabled"))return!1;const t=""==e.value?"Are you sure you want to remove the password?":`Are you sure you want to set the password to '${e.value}'?`;this.Class.configureConfirmModal({content:t}),this._confirmEventListeners.push(this.auth.setPassword.bind(this.auth)),s.addEventListener("click",c(this._confirmEventListeners));break}}r&&this.Class.openModal("confirmModal")}confirmModalBackup(){const e=document.querySelector("#confirmModal button#confirmModalBackup");e.classList.contains("disabled")||(this.backupConfig(),this.Class.disableBtn(e))}async convertStorageLocation(e=null,t=!1){const s=document.getElementById("configSyncLargeKeys");this.cfg.syncLargeKeys=s.checked;const i=this.Class.Config._localConfigKeys;try{await this.cfg.save(i);try{if(this.cfg.syncLargeKeys)await this.Class.Config.removeLocalStorage(this.Class.Config._largeKeys);else{let e=[];this.Class.Config._largeKeys.forEach((t=>{e=e.concat(this.Class.Config.splitKeyNames(t))})),await this.Class.Config.removeSyncStorage(e)}t||this.Class.showStatusModal("Storage converted successfully.")}catch(e){this.cfg.syncLargeKeys=!this.cfg.syncLargeKeys,this.backupConfig(),this.Class.handleError("Failed to cleanup old storage, backup automatically exported.",e),await this.cfg.save("syncLargeKeys"),this.populateConfig()}}catch(e){this.Class.handleError("Failed to update storage preference.",e),this.cfg.syncLargeKeys=!this.cfg.syncLargeKeys,this.populateConfig()}}domainCfgFromPage(){const e=document.getElementById("domainDisabledCheck"),t=document.getElementById("domainEnabledCheck"),s=document.getElementById("domainFramesOffCheck"),i=document.getElementById("domainFramesOnCheck"),o=document.getElementById("domainWordlistSelect"),a=o.selectedIndex>0?o.selectedIndex-1:void 0;return{disabled:e.checked,enabled:t.checked,framesOn:i.checked,framesOff:s.checked,wordlist:a}}exportConfig(){document.getElementById("configInlineInput").checked?document.getElementById("configText").value=JSON.stringify(this.cfg.ordered(),null,2):this.backupConfig()}async filterWordListUpdate(){const e=document.getElementById("filterWordList"),t=document.getElementById("wordList");this.cfg.filterWordList=e.checked;const s=t.value;try{await this.cfg.save("filterWordList"),this.populateWordPage(),s&&(t.value=s,this.populateWord())}catch(e){return this.Class.showErrorModal(["Failed to save.",`Error: ${e.message}`]),!1}}async getStatsFromStorage(){const{stats:e}=await this.Class.Config.getLocalStorage({stats:{words:{}}});return e}importConfig(){if(document.getElementById("configInlineInput").checked){const e=document.getElementById("configText");this.importConfigText(e.value)}else document.getElementById("importFileInput").click()}async importConfigFile(e){const t=e[0],s=document.getElementById("importFileInput"),i=await function(e){return new Promise(((t,s)=>{const i=new FileReader;i.onload=()=>{t(i.result)},i.readAsText(e)}))}(t);this.importConfigText(i),s.value=""}async importConfigRetry(){document.getElementById("configSyncLargeKeys").checked=!1;try{await this.convertStorageLocation(null,!0),await this.cfg.save(),this.Class.showStatusModal("Settings imported successfully."),await this.init()}catch(e){this.Class.handleError("Failed to import config.",e)}}async importConfigText(e){try{const t=new this.Class.Config(JSON.parse(e)),s=new this.Class.DataMigration(t);if(await s.runImportMigrations(),await this.restoreDefaults(null,!0))try{this.cfg=t,await this.cfg.save(),this.Class.showStatusModal("Settings imported successfully."),await this.init(!0)}catch(e){this.Class.isStorageError(e)&&this.cfg.syncLargeKeys?this.confirm("importConfigRetry"):this.Class.handleError("Failed to import settings.",e)}}catch(e){this.Class.showErrorModal(["Failed to process new settings.",`Error: ${e.message}`])}}async init(e=!1){await this.initializeCfg(),W.setLevel(this.cfg.loggingLevel),this.applyTheme(e),this.auth||(this.auth=new this.Class.OptionAuth(this,this.cfg.password)),this.filter.cfg=this.cfg,this.filter.init(),this.cfg.password&&!this.auth.authenticated?(this.Class.openModal("passwordModal"),document.getElementById("passwordInput").focus()):this.Class.show(document.getElementById("main")),this.bookmarklet||(this.bookmarklet=await this.Class.Bookmarklet.create()),this.populateOptions();const t=window.location.hash.slice(1),s=document.querySelector(`#menu a[href="#${t}"]`);s&&s.click()}async initializeCfg(){this.cfg=await this.Class.Config.load()}newWordWordlistChecked(e){return e==this.cfg.wordlistId-1}populateBookmarkletPage(){if(!this.bookmarklet)return;const e=document.querySelector('input[name="bookmarkletConfig"]:checked'),t=document.getElementById("bookmarkletLink"),s="default"==e.value?null:this.cfg,i=this.bookmarklet.href(s);t.href=i,this.Class.enableBtn(t)}populateConfig(){const e=document.getElementById("configSyncLargeKeys"),t=document.getElementById("configLoggingLevelSelect");s(this.Class.Constants.orderedArray(this.Class.Constants.LOGGING_LEVELS),t,!0),t.selectedIndex=this.cfg.loggingLevel,e.checked=this.cfg.syncLargeKeys,this.auth.setPasswordButton()}populateDomain(){const e=document.getElementById("domainSelect"),t=document.getElementById("domainText"),s=document.getElementById("domainModeSelect"),i=document.getElementById("domainDisabledCheck"),o=document.getElementById("domainEnabledCheck"),a=document.getElementById("domainFramesOffCheck"),r=document.getElementById("domainFramesOnCheck"),n=document.getElementById("domainWordlistSelect"),l=document.getElementById("domainRemove"),d=e.value;let c;t.value=d,d?(this.Class.enableBtn(l),c=this.cfg.domains[e.value]):(this.Class.disableBtn(l),c=Object.assign({},this.Class.Domain._domainCfgDefaults));const u=t.value.trim().toLowerCase();if(""==u)s.selectedIndex=this.Class.Constants.DOMAIN_MODES.NORMAL;else{const e=new this.Class.Domain(u,c);s.selectedIndex=e.getModeIndex()}i.checked=c.disabled,o.checked=c.enabled,a.checked=c.framesOff,r.checked=c.framesOn;const h=c.wordlist>=0?c.wordlist+1:0;return n.selectedIndex=h,c}populateDomainPage(){const e=document.getElementById("domainModeSelect"),t=document.getElementById("domainFilterAllFrames"),i=document.getElementById("domainSelect"),o=document.getElementById("domainText"),a=this.cfg.enabledDomainsOnly?"minimal":"normal",r=document.querySelector(`input[name=domainMode][value='${a}']`),n=document.getElementById("domainWordlistContainer");r.checked=!0;const l=document.getElementById("domainDisabledLabel"),d=document.getElementById("domainEnabledLabel"),c=document.getElementById("domainFramesOffLabel"),u=document.getElementById("domainFramesOnLabel");this.Class.hideInputError(o),p(i);const h=this.Class.Domain.sortedKeys(this.cfg.domains);if(h.unshift("Add, or update existing..."),h.forEach((e=>{const t=document.createElement("option");t.textContent=e,t.value=e===h[0]?"":e,i.appendChild(t)})),t.checked=!this.cfg.enabledFramesOnly,"minimal"===a?(this.Class.hide(l),this.Class.show(d)):(this.Class.hide(d),this.Class.show(l)),this.cfg.enabledFramesOnly?(this.Class.hide(c),this.Class.show(u)):(this.Class.hide(u),this.Class.show(c)),s(this.Class.Constants.orderedArray(this.Class.Constants.DOMAIN_MODES),e,!0),this.cfg.wordlistsEnabled){this.Class.show(n);const e=document.getElementById("domainWordlistSelect");s(["Default"].concat(this.Class.Config._allWordlists,this.cfg.wordlists),e)}else this.Class.hide(n);this.populateDomain()}populateOptions(){this.populateSettings(),this.populateWordPage(),this.populateAllowlist(),this.populateWordlists(),this.populateDomainPage(),this.populateBookmarkletPage(),this.populateConfig(),this.populateStats(),this.populateTest()}populateSettings(){this.updateFilterOptions();const e=document.getElementById(`filter${this.Class.Constants.filterMethodName(this.cfg.filterMethod)}`),t=document.getElementById("useDeviceTheme"),s=document.getElementById("showContextMenu"),i=document.getElementById("showCounter"),o=document.getElementById("showSummary"),a=document.getElementById("showUpdateNotification"),r=document.getElementById("filterWordList");e.checked=!0,t.checked=null==this.cfg.darkMode,s.checked=this.cfg.contextMenu,i.checked=this.cfg.showCounter,o.checked=this.cfg.showSummary,a.checked=this.cfg.showUpdateNotification,r.checked=this.cfg.filterWordList;const n=document.getElementById("preserveFirst"),l=document.getElementById("preserveLast"),d=document.getElementById("censorCharacterSelect"),c=document.getElementById("censorFixedLengthSelect");n.checked=this.cfg.preserveFirst,l.checked=this.cfg.preserveLast,d.value=this.cfg.censorCharacter,c.selectedIndex=this.cfg.censorFixedLength;const h=document.getElementById("preserveCase"),m=document.getElementById("substitutionMark");h.checked=this.cfg.preserveCase,m.checked=this.cfg.substitutionMark;const g=document.getElementById("defaultWordMatchMethodSelect"),f=document.getElementById("defaultWordRepeat"),E=document.getElementById("defaultWordSeparators");f.checked=u(this.cfg.defaultWordRepeat),E.checked=u(this.cfg.defaultWordSeparators),document.getElementById("defaultWordSubstitutionText").value=this.cfg.defaultSubstitution,p(g);for(let e=0;e<3;e++){const t=document.createElement("option"),s=y(this.Class.Constants.matchMethodName(e));t.value=s,t.textContent=s,g.appendChild(t)}g.selectedIndex=this.cfg.defaultWordMatchMethod}async populateStats(){try{this.filter.buildWordlist(this.Class.Constants.ALL_WORDS_WORDLIST_ID,!0);const e=await this.getStatsFromStorage();let t=0;const s=this.filter.wordlists[this.Class.Constants.ALL_WORDS_WORDLIST_ID].list;for(const i of s)t+=this.populateStatsCompileWords(e,i);const i=s.sort().sort(((t,s)=>e.words[s].total-e.words[t].total)),o=document.querySelector("div#statsWordContainer").querySelector("table#statsWordTable"),a=document.createElement("tbody");for(const t of i)this.populateStatsWordRow(e,a,t);const r=o.tBodies[0];o.replaceChild(a,r),document.getElementById("collectStats").checked=this.cfg.collectStats,this.populateStatsSummary(e,t)}catch(e){W.warn("Failed to populate stats.",e),this.Class.showErrorModal(["Failed to populate stats.",`Error: ${e.message}`])}}populateStatsCompileWords(e,t){let s=0;const i=e.words[t];return i?(i.total=i.text,s+=i.text):e.words[t]={text:0,total:0},s}populateStatsSummary(e,t){document.querySelector("table#statsSummaryTable td#statsSummaryTotal").textContent=h(t),document.querySelector("table#statsSummaryTable td#statsSummarySince").textContent=e.startedAt?new Date(e.startedAt).toLocaleString():""}populateStatsWordRow(e,t,s){const i=e.words[s],o=t.insertRow(),a=o.insertCell(0);a.classList.add("w3-tooltip");const r=document.createElement("span");r.classList.add("statsTooltip","w3-tag","w3-text"),r.textContent=s;const n=document.createElement("span");return n.textContent=this.filter.replaceText(s,this.Class.Constants.ALL_WORDS_WORDLIST_ID,null),a.appendChild(r),a.appendChild(n),o.insertCell(1).textContent=h(i.text),o}populateTest(){const e=document.getElementById("testText"),t=document.getElementById("filteredTestText");""===e.value?t.textContent="Enter some text above to test the filter...":this.cfg.filterMethod===this.Class.Constants.FILTER_METHODS.OFF?t.textContent=e.value:t.textContent=this.filter.replaceText(e.value,this.filter.cfg.wordlistId,null)}populateAllowlist(){const e=RegExp(" [*]$"),t=this.filter.cfg.wordAllowlist.map((e=>e+" *")),s=[].concat(t,this.filter.cfg.iWordAllowlist).sort(),i=document.getElementById("allowlistSelect");p(i),s.unshift("Add, or update existing..."),s.forEach((t=>{const o=document.createElement("option");o.value=t===s[0]?"":t.replace(e,""),o.dataset.sensitive=e.test(t).toString(),o.textContent=t,i.appendChild(o)})),this.populateAllowlistWord()}populateAllowlistWord(){const e=document.getElementById("allowlistSelect"),t=document.getElementById("allowlistRemove"),s=document.getElementById("allowlistText"),i=e.selectedOptions[0];if(""==i.value)s.value="",this.Class.disableBtn(t),document.getElementById("allowlistInsensitive").checked=!0;else{s.value=i.value;const e="true"===i.dataset.sensitive?"allowlistSensitive":"allowlistInsensitive";document.getElementById(e).checked=!0,this.Class.enableBtn(t)}}populateWord(){const e=document.getElementById("wordList"),t=document.getElementById("wordText"),s=document.getElementById("wordMatchRepeated"),i=document.getElementById("wordMatchSeparators"),o=document.getElementById("substitutionText"),a=document.getElementById("substitutionCase"),r=document.getElementById("wordRemove"),n=e.value,l=document.getElementById("wordWordlistDiv"),d=document.querySelectorAll("div#wordlistSelections input");if(this.Class.hideInputError(t),this.Class.hideInputError(o),""==n)t.value="",this.Class.disableBtn(r),document.getElementById(`wordMatch${y(this.Class.Constants.matchMethodName(this.cfg.defaultWordMatchMethod))}`).checked=!0,s.checked=u(this.cfg.defaultWordRepeat),i.checked=u(this.cfg.defaultWordSeparators),o.value="",a.checked=!1,d.forEach(((e,t)=>{e.checked=this.newWordWordlistChecked(t)}));else{this.Class.enableBtn(r);const e=this.cfg.words[n];t.value=n,document.getElementById(`wordMatch${y(this.Class.Constants.matchMethodName(e.matchMethod))}`).checked=!0,s.checked=u(e.repeat),i.checked=u(void 0===e.separators?this.cfg.defaultWordSeparators:e.separators),o.value=e.sub,a.checked=u(e.case),d.forEach(((t,s)=>{t.checked=e.lists.includes(s+1)}))}this.cfg.wordlistsEnabled?this.Class.show(l):this.Class.hide(l)}populateWordlist(){const e=document.getElementById("wordlistSelect");document.getElementById("wordlistText").value=e.value}populateWordlists(e=0){const t=document.getElementById("wordlistsEnabled"),i=document.getElementById("wordlistContainer");if(t.checked=this.cfg.wordlistsEnabled,this.cfg.wordlistsEnabled){const t=document.getElementById("wordlistSelect"),o=document.getElementById("textWordlistSelect");s(this.cfg.wordlists,t),s(this.Class.Config._allWordlists.concat(this.cfg.wordlists),o),t.selectedIndex=e,o.selectedIndex=this.cfg.wordlistId,this.Class.show(i),this.populateWordlist()}else this.Class.hide(i)}populateWordPage(){let e=this.filter;const t=document.getElementById("wordlistSelections"),s=document.getElementById("wordList");p(s),this.filter.cfg.filterWordList&&2===this.filter.cfg.filterMethod&&(e=new this.Class.Filter,e.cfg=new this.Class.Config(Object.assign({},this.cfg,{filterMethod:0})),e.init());const i=Object.keys(this.cfg.words).sort();i.unshift("Add, or update existing..."),i.forEach((t=>{let o=t;t!=i[0]&&e.cfg.filterWordList&&(o=e.cfg.words[t].matchMethod===this.Class.Constants.MATCH_METHODS.REGEX?e.cfg.words[t].sub||e.cfg.defaultSubstitution:e.replaceText(t,this.Class.Constants.ALL_WORDS_WORDLIST_ID,null));const a=document.createElement("option");a.value=t===i[0]?"":t,a.dataset.filtered=o,a.textContent=o,s.appendChild(a)})),t.hasChildNodes()&&p(t),this.cfg.wordlists.forEach(((e,s)=>{const i=document.createElement("div"),o=document.createElement("label"),a=document.createElement("input"),r=document.createTextNode(e);a.type="checkbox",a.classList.add("w3-check"),a.name="wordlistSelection",a.value=s.toString(),o.appendChild(a),o.appendChild(r),i.appendChild(o),t.appendChild(i)})),this.populateWord()}async prepareLessUsedWords(){try{const e=await this.getStatsFromStorage(),t=document.getElementById("lessUsedWordsNumber"),s=parseInt(t.value);this.lessUsedWords={};const i=this.filter.wordlists[this.Class.Constants.ALL_WORDS_WORDLIST_ID].list;for(const t of i){const i=e.words[t],o=this.totalFilteredWordStat(i);o<s&&(this.lessUsedWords[t]=o)}}catch(e){return W.warn("Error while prepapring less-used words.",e),{}}}async removeAllWords(){this.cfg.words={},await this.cfg.save("words"),document.getElementById("wordList").selectedIndex=0,this.filter.rebuildWordlists(),this.populateOptions()}async removeDomain(){const e=document.getElementById("domainSelect");if(e.value){delete this.cfg.domains[e.value];try{await this.cfg.save("domains"),this.populateDomainPage()}catch(t){return W.warn(`Failed to remove domain '${e.value}'.`,t),this.Class.showErrorModal([`Failed to remove domain '${e.value}'.`,`Error: ${t.message}`]),!1}}}async removeLessUsedWords(){Object.keys(this.lessUsedWords).forEach((e=>{this.cfg.removeWord(e)})),await this.cfg.save("words"),this.populateOptions()}async removeAllowlist(){const e=document.getElementById("allowlistSelect").selectedOptions[0],t=e.value,s="sensitive"==("true"===e.dataset.sensitive?"sensitive":"insensitive")?"wordAllowlist":"iWordAllowlist";this.cfg[s]=g(this.cfg[s],t);try{await this.cfg.save(s),this.filter.init(),this.populateOptions()}catch(e){return W.warn(`Failed to remove '${t}' from allowlist.`,e),this.Class.showErrorModal([`Failed to remove '${t}' from allowlist.`,`Error: ${e.message}`]),!1}}async removeWord(e){if(e.classList.contains("disabled"))return!1;const t=document.getElementById("wordList"),s=t.value;if(this.cfg.removeWord(s))try{await this.cfg.save("words"),t.selectedIndex=0,this.filter.rebuildWordlists(),this.populateOptions()}catch(e){W.warn(`Failed to remove '${s}'.`,e),this.Class.showErrorModal([`Failed to remove '${s}'.`,`Error: ${e.message}`])}}async renameWordlist(){const e=document.getElementById("wordlistSelect"),t=document.getElementById("wordlistText"),s=t.value.trim(),i=e.selectedIndex;if(t.checkValidity()){if(this.cfg.wordlists.includes(s))return this.Class.showInputError(t,"Please enter a unique name."),!1;this.cfg.wordlists[i]=s;try{await this.cfg.save("wordlists"),this.populateWordlists(i),this.populateWordPage()}catch(e){this.Class.handleError("Failed to save wordlist name.",e)}}else this.Class.showInputError(t,"Please enter a valid name.")}async restoreDefaults(e=null,t=!1){try{return await this.cfg.resetPreserveStats(),t||this.Class.showStatusModal("Default settings restored."),await this.init(!0),!0}catch(e){return W.warn("Failed to restore defaults.",e),this.Class.showErrorModal(["Failed to restore defaults.",`Error: ${e.message}`]),!1}}async saveDomain(){const e=document.getElementById("domainText"),t=e.value.trim().toLowerCase();if(""==t)return this.Class.showInputError(e,"Please enter a value."),!1;if(!e.checkValidity())return this.Class.showInputError(e,"Valid domain example: google.com or www.google.com"),!1;{this.Class.hideInputError(e);const s=this.domainCfgFromPage();if(!s)return this.Class.showInputError("Failed to gather domain settings."),!1;try{const e=document.getElementById("domainSelect").value;e&&t!=e&&delete this.cfg.domains[e];const i=new this.Class.Domain(t,s),o=document.getElementById("domainModeSelect");i.updateFromModeIndex(o.selectedIndex),await i.save(this.cfg),this.populateDomainPage()}catch(e){return this.Class.showErrorModal(["Failed to save.",`Error: ${e.message}`]),!1}}}async saveOptions(){this.updateOptionsFromPage();try{return await this.cfg.save(),await this.init(),!0}catch(e){return W.warn("Settings not saved! Please try again.",e),this.Class.showErrorModal(["Settings not saved! Please try again.",`Error: ${e.message}`]),!1}}async saveAllowlist(){const e=document.getElementById("allowlistSelect").selectedOptions[0],t=document.querySelector('input[name="allowlistCase"]:checked'),s=document.getElementById("allowlistText"),i=[],o=t.value,a="sensitive"===o?s.value:s.value.toLowerCase(),r="sensitive"===o?"wordAllowlist":"iWordAllowlist";if(""===s.value)return this.Class.showInputError(s,"Please enter a valid word/phrase."),!1;if(this.cfg[r].indexOf(a)>-1)return this.Class.showInputError(s,"Already allowlisted."),!1;if(s.checkValidity()){if(""===e.value)this.cfg[r].push(a),i.push(r);else{const t=e.value,s="true"===e.dataset.sensitive?"sensitive":"insensitive",n="sensitive"===s?"wordAllowlist":"iWordAllowlist";t==a&&s==o||(this.cfg[n]=g(this.cfg[n],t),this.cfg[r].push(a),n===r?i.push(r):i.push(n,r))}if(i.length){i.forEach((e=>{this.cfg[e]=this.cfg[e].sort()}));try{await this.cfg.save(i),this.filter.init(),this.populateOptions()}catch(e){return W.warn("Failed to update allowlist.",e),this.Class.showErrorModal(["Failed to update allowlist.",`Error: ${e.message}`]),!1}}}else this.Class.showInputError(s,"Please enter a valid word/phrase.")}async saveWord(){const e=document.getElementById("wordList"),s=document.getElementById("wordText"),i=document.getElementById("wordMatchRepeated"),o=document.getElementById("wordMatchSeparators"),a=document.getElementById("substitutionText"),r=document.getElementById("substitutionCase"),n=document.querySelector('input[name="wordMatchMethod"]:checked'),l=document.querySelectorAll("div#wordlistSelections input");let d=!0,c=s.value.trim();const h=t(r.checked),m=u(h)?a.value.trim():a.value.trim().toLowerCase(),p=this.Class.Constants.MATCH_METHODS[n.value];if(p!==this.Class.Constants.MATCH_METHODS.REGEX&&(c=c.toLowerCase()),""==c)return this.Class.showInputError(s,"Please enter a valid word/phrase."),!1;if(c==m)return this.Class.showInputError(a,"Word and substitution must be different."),!1;if(s.checkValidity()){const r=[];l.forEach(((e,t)=>{e.checked&&r.push(t+1)}));const n={case:h,lists:r,matchMethod:p,repeat:t(i.checked),separators:t(o.checked),sub:m};if(n.matchMethod!=this.Class.Constants.MATCH_METHODS.REGEX){const e=new this.Class.Filter,t={};t[c]=n,e.cfg=new this.Class.Config(Object.assign({},this.cfg,{filterMethod:this.Class.Constants.FILTER_METHODS.SUBSTITUTE},{words:t})),e.init();const s=e.replaceTextResult(c,this.Class.Constants.ALL_WORDS_WORDLIST_ID,null),i=e.replaceTextResult(s.filtered,this.Class.Constants.ALL_WORDS_WORDLIST_ID,null);if(s.filtered!=i.filtered)return this.Class.showInputError(a,"Substitution can't contain word (causes an endless loop)."),!1}if(n.matchMethod===this.Class.Constants.MATCH_METHODS.REGEX){const e=new this.Class.Filter,t={};if(t[c]=n,e.cfg=new this.Class.Config(Object.assign({},this.cfg,{words:t})),e.init(),0===e.wordlists[e.wordlistId].regExps.length)return this.Class.showInputError(s,"Invalid Regex."),!1}if(""===e.value)W.info(`Adding new word: '${c}'.`,n),d=this.cfg.addWord(c,n);else{const t=e.value;t==c?(W.info(`Modifying existing word options for '${c}'.`,n),this.cfg.words[c]=n):(W.info(`Rename existing word '${t}' to '${c}'.`,n),d=this.cfg.addWord(c,n),d?delete this.cfg.words[t]:this.Class.showInputError(s,`'${c}' already in list.`))}if(d)try{await this.saveOptions(),this.filter.rebuildWordlists(),this.populateOptions()}catch(e){return W.warn(`Failed to update word '${c}'.`,e),this.Class.showErrorModal([`Failed to update word '${c}'.`,`Error: ${e.message}`]),this.cfg.removeWord(c),!1}else this.Class.showInputError(s,`'${c}' already in list.`)}else this.Class.showInputError(s,"Please enter a valid word/phrase.")}async selectFilterMethod(e){this.cfg.filterMethod=this.Class.Constants.FILTER_METHODS[e.value];try{await this.cfg.save("filterMethod"),this.filter.rebuildWordlists(),this.populateOptions()}catch(e){this.Class.handleError("Failed to set filter method.",e)}}async setDefaultWordlist(e){const t=this.wordlistTypeFromElement(e);this.cfg[t]=e.selectedIndex;try{await this.cfg.save(t),this.populateOptions()}catch(e){this.Class.showErrorModal("Failed to update defult wordlist.",e)}}setHelpVersion(){document.getElementById("helpVersion").textContent=this.Class.Config.BUILD.version}setThemeButton(e){e?(this.darkModeButton.classList.add("w3-hide"),this.lightModeButton.classList.remove("w3-hide")):(this.darkModeButton.classList.remove("w3-hide"),this.lightModeButton.classList.add("w3-hide"))}showBulkWordEditor(){const e="bulkWordEditorModal",t=document.querySelector(`#${e} h5.modalTitle`),s=document.querySelector(`#${e} div.tableContainer`),i=s.querySelector("table");t.textContent="Bulk Word Editor",0===i.tHead.rows.length&&i.tHead.appendChild(this.bulkWordEditorHeaderRow()),p(i.querySelector("tbody"));const o=Object.keys(this.cfg.words);0===o.length?this.bulkEditorAddRow():o.forEach((e=>{this.bulkEditorAddRow(e,this.cfg.words[e])})),s.querySelectorAll("th input.wordlistHeader").forEach((e=>{e.addEventListener("click",(e=>{this.bulkEditorWordlistCheckbox(e.target)}))})),this.Class.openModal(e)}async statsReset(){try{await this.Class.Config.removeLocalStorage("stats"),this.populateStats()}catch(e){W.warn("Failed to reset stats.",e),this.Class.showErrorModal(["Failed to reset stats.",`Error: ${e.message}`])}}switchPage(e){const t=document.querySelector(`#menu a.${this.Class.activeClass}`);t.classList.remove(this.Class.activeClass),e.classList.add(this.Class.activeClass);const s=document.getElementById(t.textContent.toLowerCase()+"Page"),i=document.getElementById(e.textContent.toLowerCase()+"Page");this.Class.hide(s),this.Class.show(i),"test"===e.textContent.toLowerCase()&&document.getElementById("testText").focus()}async toggleTheme(){null==this.cfg.darkMode?this.cfg.darkMode=!this.prefersDarkScheme:this.cfg.darkMode=!this.cfg.darkMode,document.getElementById("useDeviceTheme").checked=null==this.cfg.darkMode,await this.cfg.save("darkMode"),this.applyTheme()}totalFilteredWordStat(e){return e?e.text:0}async updateContextMenu(e){this.cfg.contextMenu=e.checked,await this.cfg.save("contextMenu");const t={destination:this.Class.Constants.MESSAGING.BACKGROUND,source:this.Class.Constants.MESSAGING.OPTION,updateContextMenus:this.cfg.contextMenu};chrome.runtime.sendMessage(t)}updateFilterOptions(){switch(this.cfg.filterMethod){case this.Class.Constants.FILTER_METHODS.CENSOR:this.Class.show(document.getElementById("censorSettings")),this.Class.hide(document.getElementById("substitutionSettings")),this.Class.hide(document.getElementById("wordSubstitution"));break;case this.Class.Constants.FILTER_METHODS.SUBSTITUTE:this.Class.hide(document.getElementById("censorSettings")),this.Class.show(document.getElementById("substitutionSettings")),this.Class.show(document.getElementById("wordSubstitution"));break;case this.Class.Constants.FILTER_METHODS.OFF:case this.Class.Constants.FILTER_METHODS.REMOVE:this.Class.hide(document.getElementById("censorSettings")),this.Class.hide(document.getElementById("substitutionSettings")),this.Class.hide(document.getElementById("wordSubstitution"))}}updateOptionsFromPage(){const e=document.getElementById("censorCharacterSelect"),s=document.getElementById("censorFixedLengthSelect"),i=document.getElementById("defaultWordMatchMethodSelect"),o=document.getElementById("defaultWordRepeat"),a=document.getElementById("defaultWordSeparators"),r=document.getElementById("preserveCase"),n=document.getElementById("preserveFirst"),l=document.getElementById("preserveLast"),d=document.getElementById("showCounter"),c=document.getElementById("showSummary"),u=document.getElementById("showUpdateNotification"),h=document.getElementById("substitutionMark"),m=document.getElementById("defaultWordSubstitutionText"),p=document.querySelector('input[name="domainMode"]:checked'),g=document.getElementById("domainFilterAllFrames"),f=document.getElementById("wordlistsEnabled"),y=document.getElementById("collectStats"),E=document.getElementById("configLoggingLevelSelect");this.cfg.censorCharacter=e.value,this.cfg.censorFixedLength=s.selectedIndex,this.cfg.defaultWordMatchMethod=i.selectedIndex,this.cfg.defaultWordRepeat=t(o.checked),this.cfg.defaultWordSeparators=t(a.checked),this.cfg.preserveCase=r.checked,this.cfg.preserveFirst=n.checked,this.cfg.preserveLast=l.checked,this.cfg.showCounter=d.checked,this.cfg.showSummary=c.checked,this.cfg.showUpdateNotification=u.checked,this.cfg.substitutionMark=h.checked,this.cfg.defaultSubstitution=m.value.trim().toLowerCase(),this.cfg.enabledDomainsOnly="minimal"===p.value,this.cfg.enabledFramesOnly=!g.checked,this.cfg.wordlistsEnabled=f.checked,this.cfg.collectStats=y.checked,this.cfg.loggingLevel=this.Class.Constants.LOGGING_LEVELS[E.value.toUpperCase()]}async updateUseSystemTheme(e){try{this.cfg.darkMode=e.checked?null:this.prefersDarkScheme,await this.cfg.save("darkMode"),this.applyTheme(!0)}catch(e){this.Class.handleError("Failed to update theme selection.",e)}}validateLessUsedWordsNumber(){const e=document.getElementById("lessUsedWordsNumber");let t=!1;return this.Class.hideInputError(e),e.value.match(/^\d+$/)&&parseInt(e.value)>0?t=!0:this.Class.showInputError(e,"Enter a positive whole number."),t}wordlistTypeFromElement(e){if("textWordlistSelect"===e.id)return"wordlistId"}}const F={disabledSites:[],sites:{}},P={disabledSites:["www.hidive.com","watch.sling.com"],sites:{"tv.apple.com":[{mode:"cue",videoCueLanguage:"en"}],"play.stan.com.au":[{mode:"cue",videoCueLanguage:"en"}]}},U={disabledSites:[],sites:{"tv.apple.com":[{mode:"cue",videoCueLanguage:"en"}],"play.stan.com.au":[{mode:"cue",videoCueLanguage:"en"}]}},H={"abc.com":[{className:"akamai-caption-text",mode:"element",tagName:"DIV"},{className:"amp-caption-area",displaySelector:"div.amp-caption-area",mode:"element",muteMethod:T.MUTE_METHODS.VIDEO_VOLUME,subtitleSelector:"div.amp-caption > p",tagName:"DIV"}],"iview.abc.net.au":[{mode:"element",subtitleSelector:"div.jw-text-track-cue",tagName:"div"}],"acorn.tv":[{iframe:!0,mode:"elementChild",parentSelector:"div.vjs-text-track-display",simpleUnmute:!0,subtitleSelector:":scope div > div",tagName:"DIV"}],"smile.amazon.com":[{displayHide:"none",displaySelector:"div.webPlayerContainer div.f35bt6a",displayShow:"",iframe:!1,mode:"watcher",parentSelector:"div.webPlayerContainer div span > span",videoSelector:"div.webPlayerElement video[src]"}],"www.amazon.co.uk":[{displayHide:"none",displaySelector:"div.webPlayerContainer div.f35bt6a",displayShow:"",iframe:!1,mode:"watcher",parentSelector:"div.webPlayerContainer div span > span",videoSelector:"div.webPlayerElement video[src]"}],"www.amazon.com":[{displayHide:"none",displaySelector:"div.webPlayerContainer div.f35bt6a",displayShow:"",iframe:!1,mode:"watcher",parentSelector:"div.webPlayerContainer div span > span",videoSelector:"div.webPlayerElement video[src]"}],"www.amc.com":[{className:"ttr-container",mode:"element",subtitleSelector:"span.ttr-cue",tagName:"DIV"},{mode:"cue",videoCueLanguage:"en",videoSelector:"video"}],"www.amcplus.com":[{mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"}],"tv.apple.com":[{apfCaptions:!0,apfCaptionsSelector:"div.video-container",displaySelector:"div.video-player div.video-container > div > div",mode:"elementChild",parentSelector:"div.video-player div.video-container",subtitleSelector:":scope div > div",tagName:"DIV",videoSelector:"div.video-player div.video-container video"}],"www.att.tv":[{mode:"cue",videoSelector:"video#quickplayPlayer"}],"www.attwatchtv.com":[{mode:"cue",videoSelector:"video#quickplayPlayer"}],"www.bbc.co.uk":[{displaySelector:"smp-toucan-player >>> smp-video-layout >>> smp-subtitles >>> div",iframe:!1,mode:"watcher",subtitleSelector:"smp-toucan-player >>> smp-video-layout >>> smp-subtitles >>> div[lang] p span span",videoSelector:"smp-toucan-player >>> smp-playback >>> video"}],"www.britbox.com":[{className:"bmpui-ui-subtitle-label",mode:"element",tagName:"SPAN"},{className:"bmpui-subtitle-region-container",mode:"element",subtitleSelector:"div.bmpui-container-wrapper > span.bmpui-ui-subtitle-label",tagName:"div"}],"gem.cbc.ca":[{className:"jw-text-track-container",mode:"element",subtitleSelector:"div.jw-text-track-cue",tagName:"DIV"}],"www.cbs.com":[{mode:"cue",videoCueLanguage:"en",videoCueRequireShowing:!1}],"www.channel4.com":[{displaySelector:"div.subtitles-container",mode:"elementChild",parentSelector:"div.subtitles-container",tagName:"SPAN"}],"www.crackle.com":[{ignoreMutations:!0,mode:"elementChild",parentSelector:"div.clpp-subtitles-container",simpleUnmute:!0,tagName:"#text"}],"www.criterionchannel.com":[{iframe:!0,mode:"cue",videoCueHideCues:!0,videoCueRequireShowing:!1}],"beta.crunchyroll.com":[{apfCaptions:!0,apfCaptionsSelector:"vilosVttJs",displaySelector:"canvas#velocity-canvas",externalSub:!0,externalSubTrackMode:"hidden",externalSubVar:"window.v1config.media.subtitles",iframe:!0,mode:"cue",videoCueLanguage:"en-US",videoCueRequireShowing:!1}],"www.crunchyroll.com":[{apfCaptions:!0,apfCaptionsSelector:"vilosVttJs",displaySelector:"canvas#velocity-canvas",externalSub:!0,externalSubTrackMode:"hidden",externalSubVar:"window.v1config.media.subtitles",iframe:!0,mode:"cue",videoCueLanguage:"en-US",videoCueRequireShowing:!1,videoSelector:"video#player0"}],"www.cwtv.com":[{className:"ttr-container",convertBreaks:!0,mode:"element",subtitleSelector:"span.ttr-cue",tagName:"DIV"},{className:"ttr-line",convertBreaks:!0,mode:"element",note:"[CC]",subtitleSelector:"span.ttr-cue",tagName:"DIV"}],"www.dailywire.com":[{mode:"cue"}],"www.discoveryplus.com":[{displaySelector:"div.cjRVXG",mode:"cue",videoCueKind:"captions",videoCueLanguage:"en"}],"www.dishanywhere.com":[{className:"bmpui-ui-subtitle-label",mode:"element",tagName:"SPAN"},{className:"bmpui-subtitle-region-container",mode:"element",subtitleSelector:"div.bmpui-container-wrapper > span.bmpui-ui-subtitle-label",tagName:"div"}],"www.apps.disneyplus.com":[{displayHide:"none",displaySelector:"div#video-container div.shaka-text-container",displayShow:"flex",iframe:!1,mode:"watcher",note:"South Africa",subtitleSelector:"div#video-container div.shaka-text-container > span",videoSelector:"div#video-container video"}],"www.disneyplus.com":[{className:"dss-subtitle-renderer-wrapper",mode:"element",subtitleSelector:"div.dss-subtitle-renderer-cue-window span.dss-subtitle-renderer-line",tagName:"DIV"}],"www.fox.com":[{className:"jw-text-track-container",mode:"element",subtitleSelector:"div.jw-text-track-cue",tagName:"DIV"}],"www.fubo.tv":[{displayHide:"none",displaySelector:"div.bmpui-ui-subtitle-overlay",iframe:!1,mode:"watcher",parentSelector:"div.bmpui-ui-subtitle-overlay",subtitleSelector:"div.bmpui-ui-subtitle-overlay span"}],"www.funimation.com":[{displaySelector:"div > div.vjs-text-track-cue",mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"},{iframe:!0,mode:"elementChild",note:"Embedded videos",parentSelector:"div.vjs-text-track-display",simpleUnmute:!0,subtitleSelector:":scope div > div",tagName:"DIV"}],"fxnow.fxnetworks.com":[{iframe:!0,mode:"cue",videoSelector:"video"}],"play.google.com":[{className:"lava-timed-text-window",mode:"element",subtitleSelector:"span.lava-timed-text-caption",tagName:"DIV"}],"play.hbomax.com":[{apfCaptions:!0,displaySelector:"div[data-testid='CueBoxContainer']",displaySelectorParents:1,ignoreMutations:!0,mode:"watcher",subtitleSelector:"div[data-testid='CueBoxContainer'] > div > div > div"}],"www.hidive.com":[{className:"rmp-cc-container",mode:"element",subtitleSelector:"div.rmp-cc-cue > span",tagName:"DIV"}],"www.hulu.com":[{className:"caption-text-box",displaySelector:"div.caption-text-box",mode:"element",subtitleSelector:"p",tagName:"DIV"},{displaySelector:"div.CaptionBox",mode:"elementChild",parentSelector:"div.CaptionBox",tagName:"P"}],"www.itv.com":[{mode:"cue",videoCueLanguage:"en"}],"mediasetinfinity.mediaset.it":[{ignoreMutations:!0,mode:"elementChild",parentSelector:"div#playerContainer > div > div > div > div > div",simpleUnmute:!0,tagName:"#text",videoSelector:"div#playerContainer video"},{ignoreMutations:!0,mode:"elementChild",parentSelector:"div#playerContainer > div > div > div > div > div > div > div > div > div > div",simpleUnmute:!0,tagName:"DIV",videoSelector:"div#playerContainer video"}],"moviesanywhere.com":[{mode:"cue"}],"www.nbc.com":[{className:"ttr-line",mode:"element",subtitleSelector:"span.ttr-cue",tagName:"DIV"},{mode:"cue",videoCueLanguage:"en"}],"www.netflix.com":[{className:"player-timedtext-text-container",mode:"element",note:"Fallback compatibility",subtitleSelector:"span > span",tagName:"DIV"},{className:"player-timedtext-text-container",mode:"element",subtitleSelector:"span",tagName:"DIV"}],"www.paramountplus.com":[{mode:"cue",videoCueHideCues:!0,videoCueLanguage:"en",videoCueRequireShowing:!1,videoSelector:"div[data-role=videoContainer] video"}],"www.pbs.org":[{iframe:!0,mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"}],"www.peacocktv.com":[{displaySelector:"div.video-player__subtitles",mode:"elementChild",parentSelector:"div.video-player__subtitles > span.video-player__subtitles__cue span.video-player__subtitles__line",simpleUnmute:!0,tagName:"#text"},{className:"video-player__subtitles",displaySelector:"div.video-player__subtitles",mode:"element",subtitleSelector:"span.video-player__subtitles__cue > span.video-player__subtitles__line",tagName:"DIV"}],"www.philo.com":[{mode:"cue"}],"app.plex.tv":[{dataPropPresent:"dialogueId",mode:"element",subtitleSelector:"span > span",tagName:"DIV"},{containsSelector:"div[data-dialogue-id]",mode:"element",subtitleSelector:"span > span",tagName:"DIV"}],"pluto.tv":[{mode:"cue",videoCueHideCues:!0,videoCueRequireShowing:!1}],"www.primevideo.com":[{displayHide:"none",displaySelector:"div.webPlayerContainer div.f35bt6a",displayShow:"",iframe:!1,mode:"watcher",parentSelector:"div.webPlayerContainer div span > span",videoSelector:"div.webPlayerElement video[src]"}],"www.raiplay.it":[{mode:"elementChild",parentSelector:"div.theoplayer-texttracks div.theoplayer-webvtt-region-default",subtitleSelector:"div span",tagName:"DIV"}],"www.redbox.com":[{mode:"elementChild",parentSelector:"div.rb-text-container",subtitleSelector:"SPAN",tagName:"DIV"}],"watch.redeemtv.com":[{convertBreaks:!0,displaySelector:"div.vp-captions",mode:"elementChild",parentSelector:"div.vp-captions",tagName:"SPAN"}],"therokuchannel.roku.com":[{mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"}],"row8.com":[{iframe:!1,mode:"watcher",parentSelector:"div.vjs-text-track-display div.vjs-text-track-cue",subtitleSelector:"div",videoSelector:"app-videojs-player video"}],"www.sbs.com.au":[{className:"bmpui-subtitle-region-container",mode:"element",subtitleSelector:"DIV.bmpui-container-wrapper > SPAN.bmpui-ui-subtitle-label > SPAN",tagName:"DIV"}],"www.showmax.com":[{ignoreMutations:!0,mode:"elementChild",parentSelector:"div.contentWrapper > div.subtitles--3EXhT",simpleUnmute:!0,tagName:"#text"}],"www.showtime.com":[{mode:"cue",videoCueHideCues:!0,videoCueLanguage:"en",videoCueRequireShowing:!1}],"www.shudder.com":[{mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"}],"watch.sling.com":[{className:"bmpui-subtitle-region-container",mode:"element",subtitleSelector:"DIV.bmpui-container-wrapper > SPAN.bmpui-ui-subtitle-label",tagName:"DIV"}],"play.stan.com.au":[{ignoreMutations:!0,mode:"elementChild",parentSelector:"div.clpp-text-container",simpleUnmute:!0,tagName:"DIV"}],"www.starz.com":[{mode:"elementChild",parentSelector:"starz-captions > div.cue-list",tagName:"SPAN"}],"www.syfy.com":[{className:"ttr-line",mode:"element",subtitleSelector:"span.ttr-cue",tagName:"DIV"}],"www.tntdrama.com":[{mode:"cue",videoCueLanguage:"en",videoSelector:"video.top-media-element"}],"tubitv.com":[{mode:"elementChild",parentSelector:"div[data-id='captionsComponent']",tagName:"SPAN"}],"www.universalkids.com":[{mode:"element",subtitleSelector:"div.gwt-HTML",tagName:"DIV"}],"www.usanetwork.com":[{className:"ttr-container",mode:"element",note:"movies 2022-12",subtitleSelector:"span.ttr-cue",tagName:"DIV",videoSelector:"video[src^=blob]"},{className:"ttr-line",mode:"element",note:"free clips 2022-12",subtitleSelector:"span",tagName:"DIV",videoSelector:"video[src^=blob]"}],"vimeo.com":[{mode:"element",tagName:"SPAN",note:"Only tested with single-line captions",className:"vp-captions-line",displaySelector:"div.vp-captions > span.vp-captions-window"}],"player.vimeo.com":[{mode:"element",tagName:"SPAN",note:"For embedded videos",className:"vp-captions-line",displaySelector:"div.vp-captions > span.vp-captions-window"}],"www.vudu.com":[{displaySelector:"div#subtitleContainer > div",iframe:!0,mode:"element",subtitleSelector:"span.subtitles",tagName:"DIV"}],"vrv.co":[{displaySelector:"div.libassjs-canvas-parent",externalSub:!0,externalSubVar:"window.vilos.content.captions",iframe:!0,mode:"cue",videoCueLanguage:"en-US",videoCueRequireShowing:!1},{displaySelector:"div.libassjs-canvas-parent",externalSub:!0,externalSubVar:"window.vilos.content.subtitles",iframe:!0,mode:"cue",videoCueLanguage:"en-US",videoCueRequireShowing:!1}],"www.xfinity.com":[{apfCaptions:!0,apfCaptionsSelector:"div#viper-player-container",displaySelector:"div#viper-player-container div#inner-cc-container",mode:"watcher",subtitleSelector:"div#viper-player-container div#inner-cc-container svg > text",videoSelector:"div#viper-player-container > video"}],"m.youtube.com":[{className:"caption-window",mode:"element",subtitleSelector:"span.ytp-caption-segment",tagName:"DIV"}],"tv.youtube.com":[{className:"caption-window",mode:"element",subtitleSelector:"span.ytp-caption-segment",tagName:"DIV"}],"www.youtube.com":[{className:"caption-window",mode:"element",subtitleSelector:"span.ytp-caption-segment",tagName:"DIV"}]},$=new S("WebAudio");class K{apfCaptionRuleIds;apfCaptionsEnabled;cueRuleIds;enabledRuleIds;fetching;fillerAudio;fillerAudioPauseHandler;fillerAudioPlayHandler;filter;lastFilteredNode;lastFilteredText;lastProcessedNode;lastProcessedText;muted;muteRuleId;rules;sites;siteKey;supportedPage;supportedCaptions;unmuteTimeout;volume;watcherRuleIds;wordlistId;youTube;youTubeAutoSubsMax;youTubeAutoSubsMin;youTubeAutoSubsRule;youTubeAutoSubsTimeout;youTubeAutoSubsUnmuteDelay;static brTagRegExp=new RegExp("<br>","i");static defaultVideoSelector="video";static fillerConfig={beep:{fileName:"audio/beep.mp3",volume:.2},crickets:{fileName:"audio/crickets.mp3",volume:.4},static:{fileName:"audio/static.mp3",volume:.3}};static textTrackRuleMappings={externalSubTrackLabel:"label",videoCueKind:"kind",videoCueLabel:"label",videoCueLanguage:"language"};static getBuildTargetConfig(){switch(A.BUILD.target){case T.BUILD_TARGET_IOS:return P;case T.BUILD_TARGET_SAFARI:return U;default:return F}}static removeUnsupportedSites(e){Object.keys(e).forEach((t=>{const s=e[t];Array.isArray(s)||(e[t]=[s]),e[t]=e[t].filter((e=>null==e.buildTarget||e.buildTarget==A.BUILD.target))})),Object.keys(e).forEach((t=>{0==e[t].length&&delete e[t]}))}static supportedSites(e=!0){const t=K.getBuildTargetConfig(),s=Object.assign({},H,t.sites);return t.disabledSites.forEach((e=>{delete s[e]})),e&&K.removeUnsupportedSites(s),s}static supportedAndCustomSites(e){const t=Object.assign({},K.supportedSites(!1),e);return K.removeUnsupportedSites(t),t}constructor(e){this.filter=e,$.setLevel(this.filter.cfg.loggingLevel),this.apfCaptionRuleIds=[],this.cueRuleIds=[],this.enabledRuleIds=[],this.watcherRuleIds=[],this.filter.extension&&(this.fillerAudio=this.initFillerAudio(this.filter.cfg.fillerAudio)),this.lastFilteredNode=null,this.lastFilteredText="",this.lastProcessedText="",this.muted=!1,e.cfg.customAudioSites&&"object"==typeof e.cfg.customAudioSites||(e.cfg.customAudioSites={}),this.sites=K.supportedAndCustomSites(e.cfg.customAudioSites),this.supportedCaptions=!1,this.volume=1,this.wordlistId=e.audioWordlistId,this.youTubeAutoSubsMax=1e3*e.cfg.youTubeAutoSubsMax,this.youTubeAutoSubsMin=e.cfg.youTubeAutoSubsMin,this.youTubeAutoSubsUnmuteDelay=0,this.siteKey=this.getSiteKey(),this.rules=this.sites[this.siteKey],this.rules&&(this.rules.forEach((e=>{this.initRule(e)})),this.enabledRuleIds.length>0&&(this.supportedPage=!0,this.initYouTube()),this.apfCaptionRuleIds.length&&(this.apfCaptionsEnabled=!0),this.cueRuleIds.length&&setInterval(this.watchForVideo,250,this))}apfCaptionContainer(e,t){let s;return e.apfCaptionsSelector&&(s=i(e.apfCaptionsSelector)),s||(t||(t=i(e.videoSelector)),t&&t.parentElement&&(s=t.parentElement)),s}apfCaptionLine(e,t){const s=document.createElement("span");return s.classList.add("APF-subtitle-line"),s.style.background="black",s.style.color="white",s.style.fontSize="3vw",s.style.paddingLeft="4px",s.style.paddingRight="4px",s.style.height="18px",s.textContent=t,s}apfCaptionLines(e,t){const s=document.createElement("div");return s.classList.add("APF-subtitles"),s.style.bottom="50px",s.style.position="absolute",s.style.textAlign="center",s.style.width="100%",t.forEach((e=>{s.appendChild(e),s.appendChild(document.createElement("br"))})),s}apfTextTrack(e,t){if(t){if(t.textTracks.length){const s=Array.from(t.textTracks).find((t=>t.label==e.apfCuesLabel));if(s)return s}return t.addTextTrack("captions",e.apfCuesLabel,e.apfCuesLabel)}}buildApfCaptions(e,t,s){if(t.length){const i=t.map((t=>e.filterSubtitles&&t.modified?t.filtered:t.original)).map((t=>this.apfCaptionLine(e,t))),o=this.apfCaptionLines(e,i);s.appendChild(o)}}clean(e,t=0){const s=this.rules[t];if("watcher"===s.mode)return;s.apfCaptions&&s.displaySelector&&this.hideSubtitles(s);let i=!1;const o=[];e.nodeName&&this.textContentTag(e.nodeName)&&e.parentElement&&(e=e.parentElement);const a=s.subtitleSelector&&e.querySelectorAll?e.querySelectorAll(s.subtitleSelector):[e];if(0===a.length)return;a.forEach((e=>{const t=this.textContentTag(e.nodeName)?"textContent":"innerText";!0!==s.convertBreaks||this.textContentTag(e.nodeName)||K.brTagRegExp.test(e[t])||!K.brTagRegExp.test(e.innerHTML)||("pre"!==e.style.whiteSpace&&(e.style.whiteSpace="pre"),e.textContent=e.innerHTML.replace(K.brTagRegExp,"\n"));const a=this.replaceTextResult(e[t]);if(a.modified&&(i=!0,this.mute(s),s.filterSubtitles&&!s.apfCaptions&&(s.preserveWhiteSpace&&"pre"!==e.style.whiteSpace&&(e.style.whiteSpace="pre"),s.ignoreMutations&&this.filter.stopObserving(),e[t]=a.filtered,s.ignoreMutations&&this.filter.startObserving()),this.lastFilteredNode=e,this.lastFilteredText=e[t]),s.apfCaptions)for(const e of this.splitReplaceTextResultsOnNewlines(a))o.push(e);i||this.lastFilteredNode!=e||this.lastFilteredText!=e[t]||(i=!0),this.lastProcessedNode=e})),i||this.lastFilteredNode&&document.body.contains(this.lastFilteredNode)&&this.lastFilteredNode.textContent===this.lastFilteredText&&(i=!0);const r=this.subtitlesShouldBeShown(s,i);s.apfCaptions?this.displayApfCaptions(s,o,r):r?this.showSubtitles(s,a):this.hideSubtitles(s,a)}cleanYouTubeAutoSubs(e){null!=this.youTubeAutoSubsTimeout&&(clearTimeout(this.youTubeAutoSubsTimeout),this.youTubeAutoSubsTimeout=null);const t=this.replaceTextResult(e.textContent);if(t.modified)this.youTubeAutoSubsRule.filterSubtitles&&(e.textContent=t.filtered),this.mute(this.youTubeAutoSubsRule),this.youTubeAutoSubsUnmuteDelay=null,this.filter.updateCounterBadge(),this.youTubeAutoSubsMax&&(this.youTubeAutoSubsTimeout=window.setTimeout(this.youTubeAutoSubsMuteTimeout,this.youTubeAutoSubsMax,this));else if(this.muted)if(this.youTubeAutoSubsMin>0){const e=document.getElementsByTagName(K.defaultVideoSelector)[0].currentTime;null==this.youTubeAutoSubsUnmuteDelay?this.youTubeAutoSubsUnmuteDelay=e:(e<this.youTubeAutoSubsUnmuteDelay&&(this.youTubeAutoSubsUnmuteDelay=0),e>this.youTubeAutoSubsUnmuteDelay+this.youTubeAutoSubsMin&&this.unmute(this.youTubeAutoSubsRule))}else this.unmute(this.youTubeAutoSubsRule);if(this.filter.cfg.showSubtitles!==T.SHOW_SUBTITLES.ALL){const e=document.querySelector("div.ytp-caption-window-rollup span.captions-text");"block"==e.style.display&&(e.style.display="none")}}clearUnmuteTimeout(e){e.unmuteDelay&&null!=this.unmuteTimeout&&(clearTimeout(this.unmuteTimeout),this.unmuteTimeout=null)}cuesIncludingText(e,t,s="text"){return e.filter((e=>t.includes(e[s])))}cuesInTimeRange(e,t,s,i=0){return e.filter((e=>e.startTime>=t-i&&e.endTime<=s+i))}delayedUnmute(e,t){e.unmute(t,null,!0),this.unmuteTimeout=null}displayApfCaptions(e,t,s){const i=this.apfCaptionContainer(e);i?(this.removeApfCaptions(e,i),s&&this.buildApfCaptions(e,t,i)):$.warn("Failed to find APF Captions container.")}fillerAudioHandlePause(){this.fillerAudio.pause()}fillerAudioHandlePlay(){this.muted&&this.fillerAudio.play()}getSiteKey(){return this.sites.hasOwnProperty(this.filter.hostname)?this.filter.hostname:this.filter.iframe&&this.filter.iframe.hostname&&this.sites.hasOwnProperty(this.filter.iframe.hostname)?this.filter.iframe.hostname:""}getVideoTextTrack(e,t,s){let i=0,o=0,a=!1,r=0;s&&t[s]&&(r+=1e3),t.videoCueLabel&&(r+=100),t.videoCueLanguage&&(r+=10),t.videoCueKind&&(r+=1);for(let n=0;n<e.length;n++){const l=e[n];if(!l.cues||0===l.cues.length)continue;if(t.videoCueRequireShowing&&"showing"!==l.mode)continue;let d=0;if(s&&t[s]&&this.textTrackKeyTest(l,K.textTrackRuleMappings[s],t[s])&&(d+=1e3),t.videoCueLabel&&this.textTrackKeyTest(l,K.textTrackRuleMappings.videoCueLabel,t.videoCueLabel)&&(d+=100),t.videoCueLanguage&&this.textTrackKeyTest(l,K.textTrackRuleMappings.videoCueLanguage,t.videoCueLanguage)&&(d+=10),t.videoCueKind?this.textTrackKeyTest(l,K.textTrackRuleMappings.videoCueKind,t.videoCueKind)&&(d+=1):(this.textTrackKeyTest(l,K.textTrackRuleMappings.videoCueKind,"captions")||this.textTrackKeyTest(l,K.textTrackRuleMappings.videoCueKind,"subtitles"))&&(d+=1),d===r)return l;(d>o||!a)&&(o=d,i=n,a=!0)}if(a)return e[i]}hideCue(e,t){t.text="",t.position=100,t.size=0}hideSubtitles(e,t){if(e.displayVisibility&&e._displayElement)e._displayElement.style.visibility="hidden";else if(e.displaySelector){const s=e.rootNode&&t&&t[0]?t[0].getRootNode():document;if(s){let t=i(e.displaySelector,s);t&&e.displaySelectorParents&&(t=r(t,e.displaySelectorParents)),t&&(""===e.displayShow&&""!==t.style.display&&t.style.display!==e.displayHide&&(e.displayShow=t.style.display),t.style.setProperty("display",e.displayHide))}}else t&&t.forEach((t=>{t.innerText="",e.removeSubtitleSpacing&&t.style&&(t.style.padding&&(t.style.padding=0),t.style.margin&&(t.style.margin=0))}))}initCueRule(e){!0===e.apfCaptions&&(e.videoCueHideCues=!0),void 0===e.videoCueRequireShowing&&(e.videoCueRequireShowing=this.filter.cfg.muteCueRequireShowing),e.externalSub&&(void 0===e.externalSubTrackMode&&(e.externalSubTrackMode="showing"),void 0===e.externalSubURLKey&&(e.externalSubURLKey="url"),void 0===e.externalSubFormatKey&&(e.externalSubFormatKey="format"),void 0===e.externalSubTrackLabel&&(e.externalSubTrackLabel="APF"))}initDisplaySelector(e){void 0!==e.displaySelector&&(void 0===e.displayHide&&(e.displayHide="none"),void 0===e.displayShow&&(e.displayShow=""))}initDynamicRule(e){e._dynamic=!0,null==e.dynamicTargetMode&&e.disabled}initElementChildRule(e){e.parentSelector||e.parentSelectorAll||(e.disabled=!0),e.apfCaptions&&void 0===e.displaySelector&&(e.disabled=!0)}initElementRule(e){e.apfCaptions&&void 0===e.displaySelector&&(e.disabled=!0)}initFillerAudio(e=""){const t=K.fillerConfig[e];if(t){const e=chrome.runtime.getURL(t.fileName),s=new Audio;return s.src=e,s.loop=!0,t.volume&&(s.volume=t.volume),t.loopAfter&&(s.ontimeupdate=()=>{s.currentTime>t.loopAfter&&(s.currentTime=0)}),this.fillerAudioPauseHandler=this.fillerAudioHandlePause.bind(this),this.fillerAudioPlayHandler=this.fillerAudioHandlePlay.bind(this),s}}initRule(e){if(e._id=this.rules.indexOf(e),(void 0===e.mode||("element"==e.mode||"elementChild"==e.mode)&&!e.tagName||!0===e.iframe&&null==this.filter.iframe||!1===e.iframe&&null!=this.filter.iframe)&&(e.disabled=!0),e.disabled)$.info("Audio rule disabled",e);else{switch(null==e.filterSubtitles&&(e.filterSubtitles=!0),0==this.filter.filterText&&(e.filterSubtitles=!1),void 0===e.videoSelector&&(e.videoSelector=K.defaultVideoSelector),this.initDisplaySelector(e),null==e.muteMethod&&(e.muteMethod=this.filter.cfg.muteMethod),null==e.showSubtitles&&(e.showSubtitles=this.filter.cfg.showSubtitles),null==e.tagName||this.textContentTag(e.tagName)||(e.tagName=e.tagName.toUpperCase()),e.mode){case"cue":this.initCueRule(e),e.disabled||this.cueRuleIds.push(e._id);break;case"dynamic":this.initDynamicRule(e);break;case"elementChild":this.initElementChildRule(e);break;case"element":this.initElementRule(e);break;case"text":this.initTextRule(e);break;case"watcher":this.initWatcherRule(e),e.disabled||this.watcherRuleIds.push(e._id);break;case"ytauto":e.disabled=!0}e.disabled?"ytauto"!=e.mode&&$.info("Audio rule disabled during initialization",e):(this.enabledRuleIds.push(e._id),e.apfCaptions&&this.apfCaptionRuleIds.push(e._id),"watcher"==e.mode&&(e.toCue?setInterval(this.watcherToCue,e.checkInterval,this,e._id):setInterval(this.watcher,e.checkInterval,this,e._id)))}}initTextRule(e){e.tagName="#text",void 0===e.simpleUnmute&&(e.simpleUnmute=!0)}initWatcherRule(e){void 0===e.apfCuesLabel&&(e.apfCuesLabel="APF-Cues"),void 0===e.checkInterval&&(e.checkInterval=20),void 0===e.ignoreMutations&&(e.ignoreMutations=!0),void 0===e.simpleUnmute&&(e.simpleUnmute=!0)}initYouTube(){if(["m.youtube.com","tv.youtube.com","www.youtube.com"].includes(this.siteKey)){if(this.youTube=!0,this.filter.cfg.youTubeAutoMatchCensored){const e="\\[\\s__\\s\\]",t={lists:this.wordlistId===T.ALL_WORDS_WORDLIST_ID?[]:[this.wordlistId],matchMethod:T.MATCH_METHODS.REGEX,repeat:T.FALSE,separators:T.FALSE,sub:"[ _ ]"};this.filter.cfg.addWord(e,t)}this.youTubeAutoSubsRule={mode:"ytauto"},this.initRule(this.youTubeAutoSubsRule)}}mute(e,t){if(!this.muted){switch(this.muted=!0,this.muteRuleId=e._id,this.filter.cfg.collectStats&&this.filter.stats.mutes++,e.muteMethod){case T.MUTE_METHODS.TAB:chrome.runtime.sendMessage(this.filter.buildMessage(T.MESSAGING.BACKGROUND,{mute:!0}));break;case T.MUTE_METHODS.VIDEO_MUTE:t||(t=i(e.videoSelector)),t&&!t.muted&&(t.muted=!0),this.fillerAudio&&this.playFillerAudio(t);break;case T.MUTE_METHODS.VIDEO_VOLUME:t||(t=i(e.videoSelector)),t&&null!=t.volume&&(this.volume=t.volume,t.volume=0),this.fillerAudio&&this.playFillerAudio(t)}$.debugTime("mute()")}e&&e.unmuteDelay&&this.unmuteTimeout&&this.clearUnmuteTimeout(e)}newCue(e,t,s,i={}){try{const o="string"==typeof e?l(e):e,a="string"==typeof t?l(t):t,r=new VTTCue(o,a,s);return i.align&&(r.align=i.align),i.line&&(r.line=this.parseLineAndPositionSetting(i.line)),i.position&&(r.position=this.parseLineAndPositionSetting(i.position)),r}catch(i){$.error(`Failed to add cue: ( start: ${e}, end: ${t}, text: ${s} )`,i)}}newTextTrack(e,t,s){if(t.textTracks){const i=t.addTextTrack("captions",e.externalSubTrackLabel,e.videoCueLanguage);i.mode=e.externalSubTrackMode;for(let e=0;e<s.length;e++)i.addCue(s[e]);return i}}parseLineAndPositionSetting(e){if("string"==typeof e&&""!=e)return"auto"==e?"auto":parseInt(e)}parseSRT(e){const t=e.trim().replace("\r\n","\n").split(/[\r\n]/).map((e=>e.trim())),s=[];let i=null,o=null,a=null;for(let e=0;e<t.length;e++)if(t[e].indexOf("--\x3e")>=0){const s=t[e].split(/[ \t]+-->[ \t]+/);if(2!=s.length)throw new Error(`Error when splitting "--\x3e": ${t[e]}.`);i=s[0],o=s[1]}else if(""==t[e]){if(i&&o){const e=this.newCue(i,o,a);s.push(e),i=null,o=null,a=null}}else i&&o&&(null==a?a=t[e]:a+="\n"+t[e]);if(i&&o){const e=this.newCue(i,o,a);s.push(e)}return s}parseSSA(e){const t=[];let s,i,o,a=!1;const r=e.split("\n");for(let e=0;e<r.length;e++)if(a){if(r[e].match(/^format:/i)){const t=r[e].trim().split(",");s=t.indexOf("End"),i=t.indexOf("Start"),o=t.indexOf("Text")}else if(r[e].match(/^dialogue:/i)){const a=r[e].trim().split(","),n=a[i],l=a[s],d=a.slice(o).join(",").replace(/\{\\\w.+?\}/g,"").split("\\N").reverse();for(let e=0;e<d.length;e++)t.push(this.newCue(n,l,d[e]))}}else r[e].match(/^\[Events\]/i)&&(a=!0);return t}parseVTT(e){const t=[],s=e.split("\n"),i=new RegExp("\\s--\x3e\\s");for(let e=0;e<s.length;e++){const a=s[e].trim();if(a.match(i)){const r=a.replace(i," ").split(" ");let[n,d,...c]=r;n=n.replace(",","."),d=d.replace(",",".");const u=c.map((e=>e.split(":"))).reduce(((e,t)=>(e[t[0]]=t[1],e)),{}),h=s[e-1].trim(),m=s[e+1].trim(),p=new RegExp(`^<[cs]\\.${h}>`),g=new RegExp("</[cs]>$");let f;if(f=m.match(p)?m.replace(p,"").replace(g,""):m,h&&!h.match(/_1$/)){const e=t[t.length-1];e.startTime!=l(n)&&e.endTime==l(d)&&(o=e.startTime,n=new Date(1e3*o).toISOString().slice(11,23))}const y=this.newCue(n,d,f,u);if(h&&!h.match(/_1$/)){const e=parseInt(h.match(/_([2-9])$/)[1]),s=t.length-e+1;t.splice(s,0,y)}else t.push(y);e++}}var o;return t}playFillerAudio(e){this.playing(e)&&(this.fillerAudio.play(),e.addEventListener("pause",this.fillerAudioPauseHandler),e.addEventListener("play",this.fillerAudioPlayHandler))}playing(e){return!!(e&&e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2)}processCues(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(i.hasOwnProperty("filtered"))continue;t.videoCueSync&&(i.startTime+=t.videoCueSync,i.endTime+=t.videoCueSync);const o=this.replaceTextResult(i.text);i.originalText=i.text,i.filteredText=o.filtered,o.modified?(i.filtered=!0,t.filterSubtitles&&!t.apfCaptions&&(i.text=o.filtered)):i.filtered=!1}}async processExternalSub(e,t){const s=this.getVideoTextTrack(e.textTracks,t,"externalSubTrackLabel");if(!this.fetching&&!s)try{let s;if(s=3==A.BUILD.manifestVersion?await function(e,t="context"){return new Promise(((s,i)=>{const o={destination:"background",globalVariable:e,source:t};chrome.runtime.sendMessage(o,(e=>{s(e)}))}))}(t.externalSubVar):function(e,t="APFData"){const s=document.createElement("script");s.id=t,s.textContent=`document.getElementById("${t}").textContent = JSON.stringify(${e})`,document.documentElement.appendChild(s);const i=document.querySelector(`script#${t}`).textContent;return s.remove(),JSON.parse(i)}(t.externalSubVar),!Array.isArray(s))throw new Error(`Failed to find subtitle variable: ${t.externalSubVar}.`);{const i=s.find((e=>e.language===t.videoCueLanguage));if(!i)throw new Error(`Failed to find subtitle for language: ${t.videoCueLanguage}.`);let o;if(this.fetching=!0,o="bookmarklet"==A.BUILD.target?await async function(e,t){return fetch?await async function(e,t="GET"){const s=await fetch(e,{method:t});return await s.text()}(e,t):await function(e,t){return new Promise(((s,i)=>{const o=new XMLHttpRequest;o.open(t,e),o.onload=function(){this.status>=200&&this.status<300?s(this.response):i({status:this.status,statusText:this.statusText})},o.onerror=function(){i({status:this.status,statusText:this.statusText})},o.send()}))}(e,t)}(i[t.externalSubURLKey],"GET"):await function(e,t,s="context"){return new Promise(((i,o)=>{const a={destination:"background",fetch:e,fetchMethod:t.toUpperCase(),source:s};chrome.runtime.sendMessage(a,(e=>{i(e)}))}))}(i[t.externalSubURLKey],"GET"),"string"!=typeof o||!o)throw new Error(`Failed to download external subtitles from '${i[t.externalSubURLKey]}'.`);{let s;switch(i[t.externalSubFormatKey]){case"ass":s=this.parseSSA(o);break;case"srt":s=this.parseSRT(o);break;case"vtt":s=this.parseVTT(o);break;default:throw new Error(`Unsupported subtitle type: ${i[t.externalSubFormatKey]}.`)}if(s){const i=this.newTextTrack(t,e,s).cues;if(this.processCues(i,t),this.fetching=!1,t.displaySelector){const e=document.querySelector(t.displaySelector);e&&(e.style.display="none")}}}}}catch(e){$.error(`Error using external subtitles for ${this.siteKey}.`,e)}}processWatcherCaptions(e,t,s){const i=s.initialCall;if(i){if(e._lastProcessedText&&e._lastProcessedText===t.textContent)return s.skipped=!0,!1;this.unmute(e),e._lastProcessedText="",this.lastProcessedText="",s.initialCall=!1}if(t.hasChildNodes())for(const i of t.childNodes)this.processWatcherCaptions(e,i,s);else{const i=t&&this.textContentTag(t.nodeName)?"textContent":"innerText";if(t[i]&&t[i].trim()){const o=this.replaceTextResult(t[i]);o.modified&&(this.mute(e),s.filtered=!0,e.filterSubtitles&&!e.apfCaptions&&(t[i]=o.filtered)),s.textResults.push(o)}}i&&(e._lastProcessedText=t.textContent,this.lastProcessedText=t.textContent)}processWatcherCaptionsArray(e,t,s){const i=t.map((e=>e.textContent)).join(" ");if(e._lastProcessedText&&e._lastProcessedText===i)return s.skipped=!0,!1;this.unmute(e),e._lastProcessedText="",this.lastProcessedText="",t.forEach((t=>{if(t.textContent&&t.textContent.trim()){const i=this.replaceTextResult(t.textContent);i.modified&&(this.mute(e),s.filtered=!0,e.filterSubtitles&&!e.apfCaptions&&(t.textContent=i.filtered)),s.textResults.push(i)}}));const o=t.map((e=>e.textContent)).join(" ");e._lastProcessedText=o,this.lastProcessedText=o}removeApfCaptions(e,t){if(t||(t=this.apfCaptionContainer(e)),t){const e=i("div.APF-subtitles",t);e&&e.remove()}}replaceTextResult(e,t=this.wordlistId,s=T.STATS_TYPE_AUDIO){return this.filter.replaceTextResult(e,t,s)}showSubtitles(e,t){if(e.displayVisibility&&e._displayElement)e._displayElement.style.visibility="visible";else if(e.displaySelector){const s=e.rootNode&&t&&t[0]?t[0].getRootNode():document;if(s){let t=i(e.displaySelector,s);t&&e.displaySelectorParents&&(t=r(t,e.displaySelectorParents)),t&&t.style.setProperty("display",e.displayShow)}}}splitReplaceTextResultsOnNewlines(e){const t=e.original.split("\n"),s=e.filtered.split("\n");if(1===t.length||t.length!==s.length)return[e];const i=[];for(let o=0;o<t.length;o++){const a=t[o],r=s[o],n=e.modified&&a!=r;i.push({filtered:r,modified:n,original:a})}return i}stopFillerAudio(){this.fillerAudio.pause(),this.fillerAudio.currentTime=0}subtitlesShouldBeShown(e,t=!1){switch(e.showSubtitles){case T.SHOW_SUBTITLES.ALL:return!0;case T.SHOW_SUBTITLES.FILTERED:return t;case T.SHOW_SUBTITLES.UNFILTERED:return!t;case T.SHOW_SUBTITLES.NONE:return!1}}supportedCaptionsFound(e=!0,t=!1){if(!this.filter.extension||!t&&e==this.supportedCaptions)return;const s={destination:T.MESSAGING.BACKGROUND,source:T.MESSAGING.CONTEXT,forceUpdate:t};this.supportedCaptions=e,e?(s.status=T.STATUS.CAPTIONS,chrome.runtime.sendMessage(s),$.info("Supported captions found")):(s.status=T.STATUS.MUTE_PAGE,chrome.runtime.sendMessage(s),$.info("Watching for supported captions"))}supportedDynamicNode(e,t){e.textContent===t.dynamicTextKey&&(t.mode=t.dynamicTargetMode,t.parentSelectorAll=`${e.tagName.toLowerCase()}.${Array.from(e.classList).join(".")} ${t.parentSelectorAll}`,this.initRule(t))}supportedElementNode(e,t){return!(e.nodeName!=t.tagName||!(!t.className||e.className&&e.classList.contains(t.className))||!(!t.dataPropPresent||e.dataset&&e.dataset.hasOwnProperty(t.dataPropPresent))||t.hasChildrenElements&&("number"!=typeof e.childElementCount||0==e.childElementCount)||t.subtitleSelector&&("function"!=typeof e.querySelector||!e.querySelector(t.subtitleSelector))||t.containsSelector&&("function"!=typeof e.querySelector||!e.querySelector(t.containsSelector)))}supportedElementChildNode(e,t){if(e.nodeName===t.tagName){const s=t.rootNode?e.getRootNode():document;if(s)if(t.parentSelector){const i=s.querySelector(t.parentSelector);if(i&&(i==e||i.contains(e)))return!0}else{const i=s.querySelectorAll(t.parentSelectorAll);for(let t=0;t<i.length;t++)if(i[t].contains(e))return!0}}return!1}supportedNode(e){for(let t=0;t<this.enabledRuleIds.length;t++){const s=this.enabledRuleIds[t],i=this.rules[s];let o=!1;switch(i.mode){case"element":o=this.supportedElementNode(e,i);break;case"elementChild":o=this.supportedElementChildNode(e,i);break;case"text":o=this.supportedTextNode(e,i);break;case"watcher":o=this.supportedWatcherNode(e,i);break;case"dynamic":this.supportedDynamicNode(e,i)}if(o)return this.supportedCaptionsFound(),s}return!1}supportedTextNode(e,t){if(e.nodeName===t.tagName){const s=document.querySelector(t.parentSelector);if(s&&s.contains(e))return!0}return!1}supportedWatcherNode(e,t){if(null!=t.subtitleSelector&&e.parentElement&&e.parentElement==i(t.subtitleSelector))return!0;if(null!=t.parentSelector){const s=i(t.parentSelector);if(s&&s.contains(e))return!0}return!1}textContentTag(e){return["#text","svg","text"].includes(e)}textTrackKeyTest(e,t,s){return e[t]&&s&&e[t]===s}unmute(e,t,s=!1){if(this.muted){if(e.strictUnmute&&this.muteRuleId!==e._id)return;if(!s&&e&&e.unmuteDelay>=0)return null==this.unmuteTimeout&&this.clearUnmuteTimeout(e),void(this.unmuteTimeout=window.setTimeout(this.delayedUnmute,e.unmuteDelay,this,e));switch(this.muted=!1,e.muteMethod){case T.MUTE_METHODS.TAB:chrome.runtime.sendMessage(this.filter.buildMessage(T.MESSAGING.BACKGROUND,{mute:!1}));break;case T.MUTE_METHODS.VIDEO_MUTE:this.fillerAudio&&this.stopFillerAudio(),t||(t=i(e.videoSelector)),t&&t.muted&&(t.muted=!1);break;case T.MUTE_METHODS.VIDEO_VOLUME:this.fillerAudio&&this.stopFillerAudio(),t||(t=i(e.videoSelector)),t&&null!=t.volume&&(t.volume=this.volume)}$.debugTime("unmute()")}}watcher(e,t=0){const s=e.rules[t],o=i(s.videoSelector);if(o&&e.playing(o)){s.ignoreMutations&&e.filter.stopObserving();const t={filtered:!1,initialCall:!0,textResults:[]};if(s.apfCaptions&&s.displaySelector&&e.hideSubtitles(s),s.parentSelector){const i=document.querySelector(s.parentSelector);i&&i.textContent&&i.textContent.trim()?e.processWatcherCaptions(s,i,t):e.watcherSimpleUnmute(s,o)}else if(s.subtitleSelector){const n=function(e,t=document){const s=t,i=e.split("&&&");let o=[];for(const e of i){const t=a(e,s);t&&t.length&&(o=o.concat(Array.from(t)))}return o}(s.subtitleSelector);n&&n.length?(!s.displayVisibility||s._displayElement&&document.body.contains(s._displayElement)||(s.displayElementLevels?s._displayElement=r(n[0],s.displayElementLevels):s._displayElement=i(s.displaySelector)),e.processWatcherCaptionsArray(s,n,t)):e.watcherSimpleUnmute(s,o)}if(t.skipped)return!1;e.supportedCaptionsFound();const n=e.subtitlesShouldBeShown(s,t.filtered);s.apfCaptions?e.displayApfCaptions(s,t.textResults,n):n?e.showSubtitles(s):e.hideSubtitles(s),t.filtered&&e.filter.updateCounterBadge()}else s.ignoreMutations&&e.filter.startObserving()}watchForVideo(e){for(let t=0;t<e.cueRuleIds.length;t++){const s=e.rules[t],o=i(s.videoSelector);if(o&&o.textTracks&&e.playing(o)){s.externalSub&&e.processExternalSub(o,s);const t=e.getVideoTextTrack(o.textTracks,s);if(t&&!t.oncuechange){s.videoCueHideCues||s.showSubtitles!==T.SHOW_SUBTITLES.NONE||(t.mode="hidden"),t.oncuechange=()=>{if(t.activeCues&&t.activeCues.length>0){const i=Array.from(t.activeCues),a=[];if(!i.some((e=>e.hasOwnProperty("filtered")))){const i=Array.from(t.cues);e.processCues(i,s)}const r=i.some((e=>e.filtered));r?e.mute(s,o):e.unmute(s,o);const n=e.subtitlesShouldBeShown(s,r);for(let t=0;t<i.length;t++){const o=i[t];!n&&s.videoCueHideCues&&e.hideCue(s,o),s.apfCaptions&&a.unshift({filtered:o.filteredText,original:o.originalText,modified:o.filtered})}s.apfCaptions&&e.displayApfCaptions(s,a,n),s.videoCueHideCues||(t.mode=n?"showing":"hidden"),s.displaySelector&&(s.apfCaptions||!n?e.hideSubtitles(s):e.showSubtitles(s))}else e.unmute(s,o),s.apfCaptions&&e.removeApfCaptions(s)};const i=Array.from(t.cues);e.processCues(i,s),e.supportedCaptionsFound(!0)}}}}watcherSimpleUnmute(e,t){this.unmute(e,t),e.showSubtitles>T.SHOW_SUBTITLES.ALL&&this.hideSubtitles(e)}watcherToCue(e,t=0){const s=e.rules[t],o=i(s.videoSelector);if(o&&e.playing(o)){s.ignoreMutations&&e.filter.stopObserving(),e.hideSubtitles(s);const t=e.apfTextTrack(s,o),i=o.currentTime,r={filtered:!1,initialCall:!0,textResults:[]};let n;if(s.subtitleSelector)if(n=Array.from(a(s.subtitleSelector)),n&&n.length){const a=n.map((e=>e.textContent)).join(" ");if(s._lastProcessedText&&s._lastProcessedText===a)return r.skipped=!0,!1;{e.unmute(s,o),s._lastProcessedText=a,e.lastProcessedText=a,t&&t.activeCues&&t.activeCues.length&&Array.from(t.activeCues).forEach((e=>e.endTime=i-.001));const l=o.duration;n.reverse(),n.forEach((a=>{if(a.textContent&&a.textContent.trim()){const n=e.replaceTextResult(a.textContent);r.textResults.push(n),n.modified&&(e.mute(s,o),r.filtered=!0);const d=s.filterSubtitles?n.filtered:n.original,c=e.newCue(i,l,d);c.filtered=r.filtered,c.originalText=n.original,t.addCue(c)}}));const d=e.subtitlesShouldBeShown(s,r.filtered);s.videoCueHideCues||(t.mode=d?"showing":"hidden")}}else{e.watcherSimpleUnmute(s,o),t&&t.activeCues&&t.activeCues.length&&Array.from(t.activeCues).forEach((e=>e.endTime=i-.001));const a=e.subtitlesShouldBeShown(s,r.filtered);s.videoCueHideCues||(t.mode=a?"showing":"hidden")}if(r.skipped)return!1;r.filtered&&e.filter.updateCounterBadge()}else s.ignoreMutations&&e.filter.startObserving()}youTubeAutoSubsCurrentRow(e){return!(e.parentElement.parentElement!=e.parentElement.parentElement.parentElement.lastChild)}youTubeAutoSubsMuteTimeout(e){const t=window.document.querySelector(K.defaultVideoSelector);t&&e.playing(t)&&e.unmute(e.youTubeAutoSubsRule),e.youTubeAutoSubsTimeout=null}youTubeAutoSubsNodeIsSubtitleText(e){const t=document.querySelector("div.caption-window");return!(!t||!t.contains(e))}youTubeAutoSubsPresent(){const e=!!document.querySelector("div.ytp-caption-window-rollup");return e&&this.supportedCaptionsFound(),e}youTubeAutoSubsSupportedNode(e){return"#text"==e.nodeName&&""!=e.textContent&&!!this.youTubeAutoSubsNodeIsSubtitleText(e)}}class q extends N{supportedAudioSites;static get DataMigration(){return I}static get Config(){return A}static get Domain(){return M}get Class(){return this.constructor}domainCfgFromPage(){const e=super.domainCfgFromPage();if(e){const t=document.getElementById("domainAudioWordlistSelect"),s=t.selectedIndex>0?t.selectedIndex-1:void 0;e.audioList=s}return e}async getStatsFromStorage(){const{stats:e}=await this.Class.Config.getLocalStorage({stats:{mutes:0,words:{}}});return e}async initializeCfg(){this.cfg=await this.Class.Config.load()}newWordWordlistChecked(e){let t=super.newWordWordlistChecked(e);return t||(t=this.cfg.muteAudio&&this.cfg.muteAudioOnly&&e==this.cfg.audioWordlistId-1),t}populateAudio(){const e=document.getElementById("muteAudio"),t=document.getElementById("fillerAudioSelect"),s=document.getElementById("muteAudioOnly"),i=document.getElementById("muteCueRequireShowing"),o=document.querySelector(`input[name=audioMuteMethod][value='${this.cfg.muteMethod}']`),a=document.querySelector(`input[name=audioShowSubtitles][value='${this.cfg.showSubtitles}']`),r=document.getElementById("muteAudioOptionsContainer"),n=document.getElementById("audioYouTubeAutoMatchCensored"),l=document.getElementById("audioYouTubeAutoSubsMin"),d=document.getElementById("audioYouTubeAutoSubsMax"),c=document.getElementById("customAudioSitesText");e.checked=this.cfg.muteAudio,t.value=this.cfg.fillerAudio,s.checked=this.cfg.muteAudioOnly,i.checked=this.cfg.muteCueRequireShowing,this.cfg.muteAudio?this.Class.show(r):this.Class.hide(r),o.checked=!0,a.checked=!0,n.checked=this.cfg.youTubeAutoMatchCensored,l.value=this.cfg.youTubeAutoSubsMin.toString(),d.value=this.cfg.youTubeAutoSubsMax.toString(),c.value=this.cfg.customAudioSites?JSON.stringify(this.cfg.customAudioSites,null,2):""}populateDomain(){const e=super.populateDomain(),t=document.getElementById("domainAudioWordlistSelect"),s=e.audioList>=0?e.audioList+1:0;return t.selectedIndex=s,e}populateDomainPage(){super.populateDomainPage();const e=document.getElementById("domainAudioWordlistContainer");if(this.cfg.wordlistsEnabled&&this.cfg.muteAudio){const t=document.getElementById("domainAudioWordlistSelect");this.Class.show(e),s(["Default"].concat(this.Class.Config._allWordlists,this.cfg.wordlists),t)}else this.Class.hide(e)}populateOptions(){super.populateOptions(),this.populateAudio()}populateStatsCompileWords(e,t){let s=super.populateStatsCompileWords(e,t);const i=e.words[t];return i.audio>0?(i.total+=i.audio,s+=i.audio):i.audio=0,s}populateStatsSummary(e,t){super.populateStatsSummary(e,t),document.querySelector("table#statsSummaryTable td#statsSummaryMutes").textContent=h(e.mutes)}populateStatsWordRow(e,t,s){const i=super.populateStatsWordRow(e,t,s);return i.insertCell(2).textContent=h(e.words[s].audio),i.insertCell(3).textContent=h(e.words[s].total),i}populateWordlists(e=0){super.populateWordlists(e);const t=document.getElementById("audioWordlistDiv"),i=document.getElementById("audioWordlistSelect");this.cfg.wordlistsEnabled&&this.cfg.muteAudio?(s(this.Class.Config._allWordlists.concat(this.cfg.wordlists),i),i.selectedIndex=this.cfg.audioWordlistId,this.Class.show(t)):this.Class.hide(t)}async saveCustomAudioSites(){const e=document.getElementById("customAudioSitesText");try{const t=e.value;this.cfg.customAudioSites=""==t?null:JSON.parse(t),await this.cfg.save("customAudioSites"),e.value=this.cfg.customAudioSites?JSON.stringify(this.cfg.customAudioSites,null,2):"",this.Class.showStatusModal("Custom Audio Sites saved.")}catch(e){this.Class.handleError("Failed to save custom audio sites. Please make sure it is valid JSON.",e)}}showSupportedAudioSiteConfig(){const e=document.querySelector("#supportedAudioSitesModal select#siteSelect"),t=document.querySelector("#supportedAudioSitesModal div#modalContentRight textarea"),s={};s[e.value]=this.supportedAudioSites[e.value],t.textContent=JSON.stringify(s,null,2)}showSupportedAudioSites(){document.querySelector("#supportedAudioSitesModal h5.modalTitle").textContent="Supported Audio Sites";const e=document.querySelector("#supportedAudioSitesModal div#modalContentLeft").querySelector("#siteSelect");p(e),this.supportedAudioSites=K.supportedSites(),this.Class.Domain.sortedKeys(this.supportedAudioSites).forEach((t=>{const s=document.createElement("option");s.value=t,s.textContent=t,e.appendChild(s)})),this.showSupportedAudioSiteConfig(),this.Class.openModal("supportedAudioSitesModal")}totalFilteredWordStat(e){let t=super.totalFilteredWordStat(e);return t+=e?e.audio:0,t}updateOptionsFromPage(){super.updateOptionsFromPage();const e=document.getElementById("muteAudio"),t=document.getElementById("fillerAudioSelect"),s=document.getElementById("muteAudioOnly"),i=document.getElementById("muteCueRequireShowing"),o=document.getElementById("audioYouTubeAutoMatchCensored"),a=document.querySelector('input[name="audioMuteMethod"]:checked'),r=document.querySelector('input[name="audioShowSubtitles"]:checked');this.cfg.muteAudio=e.checked,this.cfg.fillerAudio=t.value,this.cfg.muteAudioOnly=s.checked,this.cfg.muteCueRequireShowing=i.checked,this.cfg.youTubeAutoMatchCensored=o.checked,this.cfg.muteMethod=parseInt(a.value),this.cfg.showSubtitles=parseInt(r.value)}async updateYouTubeAutoLimits(e){const t=document.getElementById("audioYouTubeAutoSubsMax"),s=document.getElementById("audioYouTubeAutoSubsMin");if(this.Class.hideInputError(t),this.Class.hideInputError(s),e.checkValidity()){const i=parseFloat(t.value),o=parseFloat(s.value);if(0!=o&&0!=i&&o>i)this.Class.showInputError(e,"Min must be less than max.");else try{this.cfg.youTubeAutoSubsMax=i,this.cfg.youTubeAutoSubsMin=o,await this.cfg.save(["youTubeAutoSubsMax","youTubeAutoSubsMin"])}catch(e){this.Class.handleError("Failed to update YouTube muting min/max values.",e)}}else this.Class.showInputError(e,"Please enter a valid number of seconds.")}wordlistTypeFromElement(e){let t=super.wordlistTypeFromElement(e);return t||"audioWordlistSelect"!==e.id||(t="audioWordlistId"),t}}const V=new q;window.addEventListener("load",(e=>{V.init()})),document.querySelectorAll("#menu a").forEach((e=>{e.addEventListener("click",(e=>{V.switchPage(e.target)}))})),document.getElementById("submitPassword").addEventListener("click",(e=>{V.auth.authenticate(e.target)})),document.getElementById("confirmModalBackup").addEventListener("click",(e=>{V.confirmModalBackup()})),document.getElementById("confirmModalOK").addEventListener("click",(e=>{q.closeModal("confirmModal")})),document.getElementById("confirmModalCancel").addEventListener("click",(e=>{q.closeModal("confirmModal")})),document.getElementById("statusModalOK").addEventListener("click",(e=>{q.closeModal("statusModal")})),document.querySelector("#bulkWordEditorModal button.modalAddWord").addEventListener("click",(e=>{V.bulkEditorAddRow()})),document.querySelector("#bulkWordEditorModal button.modalBulkAddWords").addEventListener("click",(e=>{V.bulkEditorAddWords()})),document.querySelector("#bulkWordEditorModal button.modalCancel").addEventListener("click",(e=>{q.closeModal("bulkWordEditorModal")})),document.querySelector("#bulkWordEditorModal button.modalSave").addEventListener("click",(e=>{V.confirm("bulkEditorSave")})),document.querySelectorAll("#filterMethod input").forEach((e=>{e.addEventListener("click",(e=>{V.selectFilterMethod(e.target)}))})),document.getElementById("censorCharacterSelect").addEventListener("change",(e=>{V.saveOptions()})),document.getElementById("censorFixedLengthSelect").addEventListener("change",(e=>{V.saveOptions()})),document.getElementById("defaultWordMatchMethodSelect").addEventListener("change",(e=>{V.saveOptions()})),document.getElementById("defaultWordRepeat").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("defaultWordSeparators").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("preserveCase").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("preserveFirst").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("preserveLast").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("useDeviceTheme").addEventListener("click",(e=>{V.updateUseSystemTheme(e.target)})),document.getElementById("showContextMenu").addEventListener("click",(e=>{V.updateContextMenu(e.target)})),document.getElementById("showCounter").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("showSummary").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("showUpdateNotification").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("filterWordList").addEventListener("click",(e=>{V.filterWordListUpdate()})),document.getElementById("substitutionMark").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("defaultWordSubstitutionText").addEventListener("change",(e=>{V.saveOptions()})),document.getElementById("wordList").addEventListener("change",(e=>{V.populateWord()})),document.getElementById("wordText").addEventListener("input",(e=>{q.hideInputError(e.target)})),document.getElementById("substitutionText").addEventListener("input",(e=>{q.hideInputError(e.target)})),document.getElementById("wordSave").addEventListener("click",(e=>{V.saveWord()})),document.getElementById("wordRemove").addEventListener("click",(e=>{V.removeWord(e.target)})),document.getElementById("wordRemoveAll").addEventListener("click",(e=>{V.confirm("removeAllWords")})),document.getElementById("bulkWordEditorButton").addEventListener("click",(e=>{V.showBulkWordEditor()})),document.getElementById("allowlistSelect").addEventListener("change",(e=>{V.populateAllowlistWord()})),document.getElementById("allowlistText").addEventListener("input",(e=>{q.hideInputError(e.target)})),document.getElementById("allowlistSave").addEventListener("click",(e=>{V.saveAllowlist()})),document.getElementById("allowlistRemove").addEventListener("click",(e=>{V.removeAllowlist()})),document.getElementById("wordlistsEnabled").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("wordlistRename").addEventListener("click",(e=>{V.renameWordlist()})),document.getElementById("wordlistSelect").addEventListener("change",(e=>{V.populateWordlist()})),document.getElementById("wordlistText").addEventListener("input",(e=>{q.hideInputError(e.target)})),document.getElementById("textWordlistSelect").addEventListener("change",(e=>{V.setDefaultWordlist(e.target)})),document.querySelectorAll("#domainMode input").forEach((e=>{e.addEventListener("click",(e=>{V.saveOptions()}))})),document.getElementById("domainFilterAllFrames").addEventListener("change",(e=>{V.saveOptions()})),document.getElementById("domainSelect").addEventListener("change",(e=>{V.populateDomain()})),document.getElementById("domainText").addEventListener("input",(e=>{q.hideInputError(e.target)})),document.getElementById("domainSave").addEventListener("click",(e=>{V.saveDomain()})),document.getElementById("domainRemove").addEventListener("click",(e=>{V.removeDomain()})),document.querySelectorAll("#bookmarkletConfigInputs input").forEach((e=>{e.addEventListener("click",(e=>{V.populateBookmarkletPage()}))})),document.getElementById("configSyncLargeKeys").addEventListener("click",(e=>{V.confirm("convertStorageLocation")})),document.getElementById("configInlineInput").addEventListener("click",(e=>{V.configInlineToggle()})),document.getElementById("importFileInput").addEventListener("change",(e=>{V.importConfigFile(e.target.files)})),document.getElementById("configReset").addEventListener("click",(e=>{V.confirm("restoreDefaults")})),document.getElementById("configExport").addEventListener("click",(e=>{V.exportConfig()})),document.getElementById("configImport").addEventListener("click",(e=>{V.confirm("importConfig")})),document.getElementById("configLoggingLevelSelect").addEventListener("change",(e=>{V.saveOptions()})),document.getElementById("setPassword").addEventListener("input",(e=>{V.auth.setPasswordButton()})),document.getElementById("setPasswordBtn").addEventListener("click",(e=>{V.confirm("setPassword")})),document.getElementById("testText").addEventListener("input",(e=>{V.populateTest()})),document.getElementById("collectStats").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("statsReset").addEventListener("click",(e=>{V.confirm("statsReset")})),document.getElementById("lessUsedWordsNumber").addEventListener("input",(e=>{q.hideInputError(e.target)})),document.getElementById("removeLessUsedWords").addEventListener("click",(e=>{V.confirm("removeLessUsedWords")})),document.querySelectorAll("div#helpContainer a").forEach((e=>{e.setAttribute("target","_blank")})),document.getElementsByClassName("themes")[0].addEventListener("click",(e=>{V.toggleTheme()})),document.querySelector("#supportedAudioSitesModal #siteSelect").addEventListener("change",(e=>{V.showSupportedAudioSiteConfig()})),document.querySelector("#supportedAudioSitesModal button.modalOK").addEventListener("click",(e=>{q.closeModal("supportedAudioSitesModal")})),document.getElementById("audioWordlistSelect").addEventListener("change",(e=>{V.setDefaultWordlist(e.target)})),document.getElementById("muteAudio").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("supportedAudioSitesConfig").addEventListener("click",(e=>{V.showSupportedAudioSites()})),document.getElementById("fillerAudioSelect").addEventListener("change",(e=>{V.saveOptions()})),document.getElementById("muteAudioOnly").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("muteCueRequireShowing").addEventListener("click",(e=>{V.saveOptions()})),document.getElementById("audioYouTubeAutoMatchCensored").addEventListener("click",(e=>{V.saveOptions()})),document.querySelectorAll("#audioMuteMethod input").forEach((e=>{e.addEventListener("click",(e=>{V.saveOptions()}))})),document.querySelectorAll("#audioSubtitleSelection input").forEach((e=>{e.addEventListener("click",(e=>{V.saveOptions()}))})),document.querySelectorAll("input.audioYouTubeAutoSubs").forEach((e=>{e.addEventListener("change",(e=>{V.updateYouTubeAutoLimits(e.target)}))})),document.getElementById("customAudioSitesSave").addEventListener("click",(e=>{V.saveCustomAudioSites()}))})();