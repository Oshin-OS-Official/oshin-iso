(()=>{"use strict";class e{static ALL_WORDS_WORDLIST_ID=0;static BUILD_TARGET_BOOKMARKLET="bookmarklet";static BUILD_TARGET_CHROME="chrome";static BUILD_TARGET_FIREFOX="firefox";static DOMAIN_MODES={NORMAL:0,ADVANCED:1,DEEP:2};static FALSE=0;static FILTER_METHODS={CENSOR:0,SUBSTITUTE:1,REMOVE:2,OFF:3};static LOGGING_LEVELS={DEBUG:0,INFO:1,WARN:2,ERROR:3};static MATCH_METHODS={EXACT:0,PARTIAL:1,WHOLE:2,REGEX:3};static MESSAGING={BACKGROUND:"background",CONTEXT:"context",OPTION:"option",POPUP:"popup"};static STATS_TYPE_TEXT="text";static STATUS={DISABLED:0,NORMAL:1,ADVANCED:2,DEEP:3};static TAB_DISABLE_ONCE={NOT_SET:0,DISABLED:1,WILL_DISABLE:2};static TOP_WINDOW_FRAME_ID=0;static TRUE=1;static filterMethodName(e){return this.nameById(this.FILTER_METHODS,e)}static loggingLevelName(e){return this.nameByValue(this.LOGGING_LEVELS,e)}static matchMethodName(e){return this.nameById(this.MATCH_METHODS,e)}static nameById(e,t){return c(Object.entries(e).filter((e=>e[1]===t))[0][0])}static nameByValue(e,t){return Object.keys(e).find((s=>e[s]==t))}static orderedArray(t){const s=[];return Object.values(t).sort().forEach((i=>{s.push(e.nameById(t,i))})),s}}function t(e,t,s=!1,i){!function(e){if(e.hasChildNodes)for(;e.firstChild;)e.firstChild.remove()}(t),(void 0!==i?[i].concat(e):e).forEach((e=>{const a=document.createElement("option");a.value=i&&e===i?"":e,a.textContent=s?c(e):e,t.appendChild(a)}))}function s(e,t=document){return i(e,t,"querySelector")}function i(e,t=document,s="querySelector"){let i;const a=e.split(">>>");if(1==a.length)return t[s](e);for(;a.length;){if(!t)return null;{const e=a.shift().trim();if(0==a.length)return t[s](e);if(i=t.querySelector(e),!i)return null;t=i.shadowRoot}}}function a(e,t=document){return i(e,t,"querySelectorAll")}function o(e,t=1){return e?t>0?o(e.parentElement,t-1):e:null}function r(e,t=3){const[s="0",i="0",a="0"]=(e||"0:0:0").split(":"),o=parseInt(s,10)||0,r=parseInt(i,10)||0,n=parseFloat(a)||0;return parseFloat((3600*o+60*r+n).toFixed(t))}function n(e){return`[${e.toString().replace(/,/g,", ")}]`}function l(e,t){return"string"==typeof t?e.filter((e=>e!==t)):e.filter((e=>!t.includes(e)))}function d(e){return"string"==typeof e&&(e=[e]),e}function c(e,t=!0){let s=e.charAt(0).toUpperCase();return s+=t?e.toLowerCase().slice(1):e.slice(1),s}class u extends e{static AUDIO_RULE_MODES={CUE:"cue",DYNAMIC:"dynamic",ELEMENT_CHILD:"elementChild",ELEMENT:"element",TEXT:"text",WATCHER:"watcher",YTAUTO:"ytauto"};static BUILD_TARGET_IOS="ios";static BUILD_TARGET_MACOS="macos";static MANAGED={NONE:0,DEFAULTS:1,PARTIAL:2,ALL:3};static MUTE_METHODS={TAB:0,VIDEO_VOLUME:1,VIDEO_MUTE:2,NONE:9};static SHOW_SUBTITLES={ALL:0,FILTERED:1,UNFILTERED:2,NONE:3};static STATS_TYPE_AUDIO="audio";static STATUS={DISABLED:0,NORMAL:1,ADVANCED:2,DEEP:3,MUTE_PAGE:4,CAPTIONS:5}}class m{advanced;cfg;cfgKey;deep;disabled;enabled;framesOff;framesOn;hostname;tab;wordlistId;static get Constants(){return e}get Class(){return this.constructor}static _domainCfgDefaults={adv:void 0,deep:void 0,disabled:void 0,enabled:void 0,framesOff:void 0,framesOn:void 0,wordlist:void 0};static byHostname(e,t){const s=this.findDomainKey(e,t)||e,i=this.byKey(s,t);return i.hostname=e,i}static byKey(e,t){return new this(e,t[e])}static findDomainKey(e,t){return Object.keys(t).sort(((e,t)=>t.length-e.length)).find((t=>new RegExp(`(^|.)${t}$`).test(e)))}static getCurrentTab(){return new Promise(((e,t)=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{e(t[0])}))}))}static sortedKeys(e){return Object.keys(e).sort(((e,t)=>{const s=this.sortingKey(e),i=this.sortingKey(t);return s==i?e<t?-1:e>t?1:0:s<i?-1:s>i?1:0}))}static sortingKey(e){const t=e.split(".");switch(t.length){case 1:case 2:return t[0];case 3:return t[1];case 4:return t[1].match(/^\d+$/)?e:t[3].length?t[1]:t[2];default:return t[2]}}constructor(e,t){this.cfgKey=e,this.cfg={},t?this.cfg=t:Object.assign(this.cfg,this.Class._domainCfgDefaults),this.updateFromCfg()}getModeIndex(){return this.advanced?this.Class.Constants.DOMAIN_MODES.ADVANCED:this.deep?this.Class.Constants.DOMAIN_MODES.DEEP:this.Class.Constants.DOMAIN_MODES.NORMAL}async save(e){if(e.domains)return this.updateCfg(),"{}"===JSON.stringify(this.cfg)?delete e.domains[this.cfgKey]:e.domains[this.cfgKey]=this.cfg,await e.save("domains")}updateCfg(){this.cfg.adv=!0===this.advanced||void 0,this.cfg.deep=!0===this.deep||void 0,this.cfg.disabled=!0===this.disabled||void 0,this.cfg.enabled=!0===this.enabled||void 0,this.cfg.framesOff=!0===this.framesOff||void 0,this.cfg.framesOn=!0===this.framesOn||void 0,this.cfg.wordlist=this.wordlistId>=0?this.wordlistId:void 0}updateFromCfg(){this.advanced=this.cfg.adv,this.deep=this.cfg.deep,this.disabled=this.cfg.disabled,this.enabled=this.cfg.enabled,this.framesOff=this.cfg.framesOff,this.framesOn=this.cfg.framesOn,this.wordlistId=this.cfg.wordlist}updateFromModeIndex(e){switch(e){case this.Class.Constants.DOMAIN_MODES.NORMAL:this.advanced=!1,this.deep=!1;break;case this.Class.Constants.DOMAIN_MODES.ADVANCED:this.advanced=!0,this.deep=!1;break;case this.Class.Constants.DOMAIN_MODES.DEEP:this.advanced=!1,this.deep=!0}}}class p extends m{audioWordlistId;get Class(){return this.constructor}static _cfgDefaultAudioList=void 0;static byHostname(e,t){return super.byHostname(e,t)}constructor(e,t){super(e,t),this.cfg.hasOwnProperty("audioList")||(this.cfg.audioList=this.Class._cfgDefaultAudioList),this.audioWordlistId=this.cfg.audioList}updateCfg(){super.updateCfg(),this.cfg.audioList=this.audioWordlistId>=0?this.audioWordlistId:void 0}updateFromCfg(){super.updateFromCfg(),this.audioWordlistId=this.cfg.audioList}}class h{censorCharacter;censorFixedLength;defaultSubstitution;defaultWordMatchMethod;defaultWordRepeat;defaultWordSeparators;filterMethod;filterWordList;iWordAllowlist;loggingLevel;preserveCase;preserveFirst;preserveLast;showCounter;showSummary;substitutionMark;wordAllowlist;wordlistId;wordlists;wordlistsEnabled;words;wordSubSeparator;static initializeDefaults(...e){return Object.assign({},this._configDefaults,...e)}static _allWordlists=["All words"];static _configDefaults={censorCharacter:"*",censorFixedLength:0,defaultSubstitution:"censored",defaultWordMatchMethod:e.MATCH_METHODS.EXACT,defaultWordRepeat:e.FALSE,defaultWordSeparators:e.FALSE,filterMethod:e.FILTER_METHODS.SUBSTITUTE,filterWordList:!0,iWordAllowlist:[],loggingLevel:e.LOGGING_LEVELS.WARN,preserveCase:!0,preserveFirst:!0,preserveLast:!1,showCounter:!0,showSummary:!0,substitutionMark:!1,wordAllowlist:[],wordlistId:0,wordlists:["Wordlist 1","Wordlist 2","Wordlist 3","Wordlist 4","Wordlist 5","Wordlist 6"],wordlistsEnabled:!0,words:void 0,wordSubSeparator:";;"};static _defaultWords={ass:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"butt"},asses:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.FALSE,separators:e.FALSE,sub:"butts"},asshole:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"jerk"},badass:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.TRUE,sub:"cool"},bastard:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"idiot"},bitch:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"bench"},cocksucker:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.TRUE,sub:"suckup"},cunt:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"expletive"},dammit:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.FALSE,separators:e.TRUE,sub:"dangit"},damn:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.FALSE,separators:e.FALSE,sub:"dang"},dumbass:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"idiot"},fag:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"gay"},faggot:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"gay"},fags:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"gays"},fuck:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.TRUE,sub:"freak"},goddammit:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.TRUE,sub:"dangit"},hell:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.FALSE,separators:e.FALSE,sub:"heck"},jackass:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.TRUE,sub:"jerk"},nigga:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"bruh"},nigger:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"man"},niggers:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"people"},piss:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"pee"},pissed:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"ticked"},pussies:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"softies"},pussy:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"softie"},shit:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"crap"},slut:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"tramp"},tits:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"chest"},twat:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"dumbo"},twats:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"dumbos"},whore:{lists:[],matchMethod:e.MATCH_METHODS.PARTIAL,repeat:e.TRUE,separators:e.FALSE,sub:"tramp"},wtf:{lists:[],matchMethod:e.MATCH_METHODS.EXACT,repeat:e.TRUE,separators:e.FALSE,sub:"what"}};static _defaults=this.initializeDefaults(this._configDefaults);static _persistableKeys=Object.keys(this._defaults);constructor(e={}){Object.assign(this,h._defaults,e)}get _persistableKeys(){return this.constructor._persistableKeys}addWord(t,s=this.defaultWordOptions()){return t=t.trim(),(s=Object.assign({},this.defaultWordOptions(),s)).matchMethod!==e.MATCH_METHODS.REGEX&&(t=t.toLowerCase()),!Object.keys(this.words).includes(t)&&(s.sub=s.case==e.TRUE?s.sub.trim():s.sub.trim().toLowerCase(),this.words[t]=s,!0)}defaultWordOptions(){return{lists:[],matchMethod:this.defaultWordMatchMethod,repeat:this.defaultWordRepeat,separators:this.defaultWordSeparators,sub:""}}removeWord(e){const t=(e=e.trim()).toLowerCase();return Object.keys(this.words).includes(t)?(delete this.words[t],!0):!!this.words[e]&&(delete this.words[e],!0)}repeatForWord(t){return this.words[t].repeat===e.TRUE||this.words[t].repeat===e.FALSE?this.words[t].repeat:this.defaultWordRepeat}sanitizeWords(){const e={};Object.keys(this.words).sort().forEach((t=>{e[t.trim().toLowerCase()]=this.words[t]})),this.words=e}}class g{level;prefix;static app="APF";static debugLevel=e.LOGGING_LEVELS.DEBUG;static debugName=e.loggingLevelName(this.debugLevel).toLowerCase();static defaultLevel=e.LOGGING_LEVELS.WARN;static errorLevel=e.LOGGING_LEVELS.ERROR;static errorName=e.loggingLevelName(this.errorLevel).toLowerCase();static infoLevel=e.LOGGING_LEVELS.INFO;static infoName=e.loggingLevelName(this.infoLevel).toLowerCase();static warnLevel=e.LOGGING_LEVELS.WARN;static warnName=e.loggingLevelName(this.warnLevel).toLowerCase();static debug(e,...t){this.log(this.debugName,e,t)}static debugTime(e,t=[]){this.logTime(this.debugName,e,t)}static error(e,...t){this.log(this.errorName,e,t)}static errorTime(e,t=[]){this.logTime(this.errorName,e,t)}static info(e,...t){this.log(this.infoName,e,t)}static infoTime(e,t=[]){this.logTime(this.infoName,e,t)}static log(e,t,s=[]){t=`[${g.app}] ${t}`,s.length?console[e](t,s):console[e](t)}static logTime(e,t,s=[]){const i=new Date,a=i.toLocaleTimeString().replace(" ",`.${i.getMilliseconds().toString()} `);t=`[${g.app}] ${t}`,s.length?console[e](t,a,s):console[e](t,a)}static warn(e,...t){this.log(this.warnName,e,t)}static warnTime(e,t=[]){this.logTime(this.warnName,e,t)}constructor(e){this.level=g.defaultLevel,this.prefix="",e&&(this.prefix=`[${e}] `)}debug(e,...t){g.debugLevel>=this.level&&g.log(g.debugName,`${this.prefix}${e}`,t)}debugTime(e,...t){g.debugLevel>=this.level&&g.logTime(g.debugName,`${this.prefix}${e}`,t)}error(e,...t){g.errorLevel>=this.level&&g.log(g.errorName,`${this.prefix}${e}`,t)}errorTime(e,...t){g.errorLevel>=this.level&&g.logTime(g.errorName,`${this.prefix}${e}`,t)}info(e,...t){g.infoLevel>=this.level&&g.log(g.infoName,`${this.prefix}${e}`,t)}infoTime(e,...t){g.infoLevel>=this.level&&g.logTime(g.infoName,`${this.prefix}${e}`,t)}setLevel(e){this.level=e}warn(e,...t){g.warnLevel>=this.level&&g.log(g.warnName,`${this.prefix}${e}`,t)}warnTime(e,...t){g.warnLevel>=this.level&&g.logTime(g.warnName,`${this.prefix}${e}`,t)}}const S={config:{},manifestVersion:3,release:!0,target:"chrome",version:"1.0.0"},f=new g("WebConfig");class b extends h{_lastSplitKeys;collectStats;contextMenu;darkMode;domains;enabledDomainsOnly;enabledFramesOnly;password;showUpdateNotification;syncLargeKeys;get Class(){return this.constructor}static BUILD=void 0==={config:{},manifestVersion:3,release:!0,target:"chrome",version:"3.5.0"}?S:{config:{},manifestVersion:3,release:!0,target:"chrome",version:"3.5.0"};static _webDefaults={collectStats:!0,contextMenu:!0,darkMode:null,domains:{},enabledDomainsOnly:!1,enabledFramesOnly:!1,password:null,showUpdateNotification:!1,syncLargeKeys:!0};static _defaults=this.initializeDefaults({},this._configDefaults,this._webDefaults);static _persistableKeys=Object.keys(this._defaults);static _localConfigKeys=["domains","syncLargeKeys","words"];static _localOnlyKeys=["background","stats"];static _maxSplitKeys=64;static _largeKeys=["domains","words"];static get _maxBytes(){try{if(chrome.storage.sync.QUOTA_BYTES_PER_ITEM)return Math.round(.98*chrome.storage.sync.QUOTA_BYTES_PER_ITEM);throw"QUOTA_BYTES_PER_ITEM not defined, using default"}catch(e){return 8028}}static assignDefaultValue(e,t){t[e]="words"===e?this._defaultWords:this._defaults[e]}static chromeStorageAvailable(){return!!("object"==typeof chrome&&chrome.storage&&chrome.storage.sync&&chrome.storage.local)}static combineData(e,t){if(e[t]={},void 0!==e[`_${t}0`]){const s=this.getDataContainerKeys(e,t);return s.forEach((s=>{Object.assign(e[t],e[s]),delete e[s]})),s}}static getDataContainerKeys(e,t){const s=new RegExp(`^_${t}\\d+`);return Object.keys(e).filter((e=>s.test(e))).sort()}static getLocalStorage(e){return"string"==typeof e&&(e=[e]),new Promise(((t,s)=>{chrome.storage.local.get(e,(e=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(e)}))}))}static getMaxSplitKeyFromArray(e=[]){if(Array.isArray(e)){const t=e.sort()[e.length-1];if(t){const e=new RegExp("\\d+$"),s=t.match(e);if(s)return parseInt(s[0])}}}static getMaxSplitKeyFromData(e,t){const s=this.getDataContainerKeys(e,t);return this.getMaxSplitKeyFromArray(s)}static getSyncStorage(e){return"string"==typeof e&&(e=[e]),new Promise(((t,s)=>{chrome.storage.sync.get(e,(e=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(e)}))}))}static includesLargeKeys(e){return e.some((e=>this._largeKeys.includes(e)))}static keysToLoad(e=[]){return 0===(e=d(e)).length&&(e=e.concat(this._persistableKeys)),e}keysToSave(e=[]){return 0===(e=d(e)).length&&(e=e.concat(this._persistableKeys)),e}static async load(e=[],t={}){let s;e=this.keysToLoad(e);try{return s=this.includesLargeKeys(e)?await this.loadLargeKeysFromLocalStorage(e,t):this.requestedkeysForSyncStorage(e,"syncLargeKeys",t),await this.loadFromSyncStorage(s,t),new this(t)}catch(t){throw f.error("Failed to load items.",e,t),new Error(`Failed to load items: ${n(e)}. [${t.message}]`)}}static async loadLargeKeysFromLocalStorage(e,t){e.includes("syncLargeKeys")||e.push("syncLargeKeys");const s=this.requestedkeysForLocalStorage(e,t),i=await this.getLocalStorage(s);if(t.syncLargeKeys=!1===i.syncLargeKeys?i.syncLargeKeys:this._defaults.syncLargeKeys,!1===t.syncLargeKeys){for(const e of s)i.hasOwnProperty(e)?t[e]=i[e]:this.assignDefaultValue(e,t);return this.requestedkeysForSyncStorage(e,this._localConfigKeys,t)}return this.requestedkeysForSyncStorage(e,"syncLargeKeys",t)}static async loadFromSyncStorage(e,t={}){if(!e.length)return;let s=[].concat(e);this._largeKeys.forEach((t=>{e.includes(t)&&(s.splice(s.indexOf(t),1),s=s.concat(this.splitKeyNames(t)))}));const i=await this.getSyncStorage(s);t._lastSplitKeys={},e.forEach((e=>{if(this._largeKeys.includes(e)){const s=this.combineData(i,e);s?(t._lastSplitKeys[e]=this.getMaxSplitKeyFromArray(s),t[e]=i[e]):this.assignDefaultValue(e,t)}else void 0===i[e]?this.assignDefaultValue(e,t):t[e]=i[e]}))}static removeLocalStorage(e){return e=d(e),new Promise(((t,s)=>{chrome.storage.local.remove(e,(()=>{e.length||t(0),chrome.runtime.lastError?s(chrome.runtime.lastError):t(0)}))}))}static removeSyncStorage(e){return e=d(e),new Promise(((t,s)=>{e.length||t(0),chrome.storage.sync.remove(e,(()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(0)}))}))}static requestedkeysForLocalStorage(e,t){return this._localConfigKeys.filter((t=>e.includes(t)))}static requestedkeysForSyncStorage(e,t,s){return l(e,t)}static resetLocalStorage(){return new Promise(((e,t)=>{chrome.storage.local.clear((()=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(0)}))}))}static resetSyncStorage(){return new Promise(((e,t)=>{chrome.storage.sync.clear((()=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(0)}))}))}static saveLocalStorage(e){return new Promise(((t,s)=>{chrome.storage.local.set(e,(()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(0)}))}))}static saveSyncStorage(e){return new Promise(((t,s)=>{chrome.storage.sync.set(e,(()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(0)}))}))}static splitKeyNames(e,t=0){return Array(this._maxSplitKeys-t).fill(1).map(((s,i)=>"_"+e+(i+t)))}constructor(e){if(void 0===e)throw new Error("Cannot be called directly, call load() instead.");super(e),Object.assign(this,this.Class._webDefaults,e)}ordered(){return function(e,t=!0){return Object.keys(e).sort().reduce(((s,i)=>(t&&"_"==i[0]||(s[i]=e[i]),s)),{})}(this)}async prepareLocalDataForSave(e){}async prepareSyncDataForSave(e){}async remove(e){e=d(e);let t=[];const s=[];if(e.length>0){e.forEach((e=>{"syncLargeKeys"==e?s.push(e):this.Class._largeKeys.includes(e)?this.syncLargeKeys?t=t.concat(this.Class.splitKeyNames(e)):s.push(e):t.push(e)}));try{t.length&&await this.Class.removeSyncStorage(t),s.length&&await this.Class.removeLocalStorage(s),e.forEach((e=>{delete this[e]}))}catch(t){throw f.error("Failed to remove items.",e,t),new Error(`Failed to remove items: ${n(e)}. ${t.message}`)}}}async reset(){try{await this.Class.resetSyncStorage(),await this.Class.resetLocalStorage()}catch(e){throw f.error("Failed to clear storage.",e),new Error(`Failed to clear storage. ${e.message}`)}}async resetPreserveStats(){try{await this.Class.resetSyncStorage(),await this.Class.removeLocalStorage(this.Class._localConfigKeys)}catch(e){throw f.error("Failed to clear storage.",e),new Error(`Failed to clear storage. ${e.message}`)}}async save(e=[]){e=this.keysToSave(e);const t={},s={};let i=[];e.forEach((e=>{if("syncLargeKeys"==e)s[e]=this[e];else if(this.Class._largeKeys.includes(e))if(this.syncLargeKeys){if(Object.assign(t,this.splitData(e)),this._lastSplitKeys){const s=this.Class.getMaxSplitKeyFromData(t,e);this._lastSplitKeys[e]>s?i=i.concat(this.Class.splitKeyNames(e,s+1)):this._lastSplitKeys[e]<s&&(this._lastSplitKeys[e]=s)}}else s[e]=this[e];else t[e]=this[e]}));try{await this.prepareLocalDataForSave(s),await this.prepareSyncDataForSave(t),Object.keys(t).length&&await this.Class.saveSyncStorage(t),Object.keys(s).length&&await this.Class.saveLocalStorage(s),i.length&&await this.remove(i)}catch(t){throw f.error("Failed to save items.",e,t),new Error(`Failed to save items: ${n(e)}. [${t.message}]`)}}splitData(e){const t=new TextEncoder;let s=0,i=2;const a={};let o=`_${e}${s}`;return a[o]={},i+=t.encode(`{"${o}":{}}`).length,Object.keys(this[e]).sort().forEach((r=>{let n=t.encode(`",${r}":`).length;n+=t.encode(JSON.stringify(this[e][r])).length,i+n>=this.Class._maxBytes&&(s++,o=`_${e}${s}`,a[o]={},i=t.encode(`"${o}":{}`).length),i+=n,a[o][r]=this[e][r]})),a}}class y{xpathDocText;xpathNodeText;static disabledChromePages=["chrome.google.com","chromewebstore.google.com"];static disabledFirefoxPages=["addons.mozilla.org"];static disabledProtocols=new RegExp("(^chrome:|^about:|^[a-zA-Z]+-extension:)","i");static forbiddenNodeRegExp=new RegExp("^s*(<[a-z].+?/?>|{.+?:.+?;.*}|https?://[^s]+$)");static forbiddenTags=["SCRIPT","STYLE","INPUT","TEXTAREA","IFRAME","LINK"];static isForbiddenNode(e){return!!e.isContentEditable||!(!e.parentNode||!e.parentNode.isContentEditable&&!y.forbiddenTags.includes(e.parentNode.nodeName))||y.forbiddenTags.includes(e.nodeName)}}const v=new g("Popup");class C{cfg;disabledTab;domain;filterToggleProp;prefersDarkScheme;protected;status;summaries;tab;themeElements;url;webFilterActive;static get Config(){return b}static get Constants(){return e}static get Domain(){return m}static get Page(){return y}get Class(){return this.constructor}static _requiredConfig=["darkMode","domains","enabledDomainsOnly","filterMethod","loggingLevel","password","wordlistId","wordlists","wordlistsEnabled"];static disable(e){e.disabled=!0,e.classList.add("disabled")}static enable(e){e.disabled=!1,e.classList.remove("disabled")}static hide(e){e.classList.remove("w3-show"),e.classList.add("w3-hide")}static async load(e){e.cfg=await this.Config.load(this._requiredConfig),v.setLevel(e.cfg.loggingLevel),e.tab=await this.Domain.getCurrentTab(),e.tab.url?(e.url=new URL(e.tab.url),e.domain=this.Domain.byHostname(e.url.hostname,e.cfg.domains)):(e.url=null,e.domain=new this.Domain("")),e.filterToggleProp=e.cfg.enabledDomainsOnly?"enabled":"disabled";const t={source:this.Constants.MESSAGING.POPUP,destination:this.Constants.MESSAGING.BACKGROUND,getStatus:!0,tabId:e.tab.id};return chrome.runtime.sendMessage(t,(t=>{e.updateStatus(t.status)})),e}static show(e){e.classList.remove("w3-hide"),e.classList.add("w3-show")}constructor(){this.webFilterActive=!0,this.initializeMessaging(),this.disabledTab=!1,this.prefersDarkScheme=window.matchMedia("(prefers-color-scheme: dark)").matches,this.protected=!1,this.summaries={},this.themeElements=[document.body,document.querySelector("#footer")]}applyDarkTheme(){document.documentElement.style.setProperty("color-scheme","dark"),document.querySelector("#summary > table").classList.remove("w3-striped"),this.themeElements.forEach((e=>{e.classList.add("dark"),e.classList.remove("light")}))}applyLightTheme(){document.documentElement.style.setProperty("color-scheme","light"),document.querySelector("#summary > table").classList.add("w3-striped"),this.themeElements.forEach((e=>{e.classList.remove("dark"),e.classList.add("light")}))}applyTheme(){null==this.cfg.darkMode?this.prefersDarkScheme?this.applyDarkTheme():this.applyLightTheme():this.cfg.darkMode?this.applyDarkTheme():this.applyLightTheme()}disableDomainSwitch(){const e=document.getElementById("domainFilter"),t=document.getElementById("domainToggle");this.Class.disable(e),this.Class.disable(t)}get disabledReason(){return this.isRestrictedPage?"Popup disabled by browser":this.isPasswordProtected?"Popup disabled by password":this.disabledTab?"Popup disabled for tab":this.cfg.enabledDomainsOnly&&!this.domain.enabled?"Popup disabled by domain mode":this.domain.disabled?"Popup disabled for domain":this.isDisconnected?"Disconnected, please refresh page":""}disableOptions(){const e=document.getElementById("domainModeSelect"),t=document.getElementById("filterMethodSelect"),s=document.getElementById("wordlistSelect");this.Class.disable(e),this.Class.disable(t),this.Class.disable(s)}enableOptions(){const e=document.getElementById("domainModeSelect"),t=document.getElementById("filterMethodSelect"),s=document.getElementById("wordlistSelect");this.Class.enable(e),this.Class.enable(t),this.Class.enable(s)}async filterMethodSelect(){const e=document.getElementById("filterMethodSelect");this.cfg.filterMethod=e.selectedIndex;try{await this.cfg.save("filterMethod"),chrome.tabs.reload(),this.populateOptions()}catch(e){v.error("Failed to update selected filter method.",e)}}getBackgroundData(){return new Promise(((e,t)=>{const s={destination:this.Class.Constants.MESSAGING.BACKGROUND,source:this.Class.Constants.MESSAGING.POPUP,backgroundData:!0,tabId:this.tab.id};chrome.runtime.sendMessage(s,(t=>{t||(t={disabledTab:!1}),e(t)}))}))}handleDisabled(){this.setDomainSwitch(!1),this.disableOptions()}handleDisabledMessage(){const e=document.querySelector("#disabledMessage");e.textContent=this.disabledReason,this.isDisabled?this.Class.show(e):this.Class.hide(e)}handleEnabled(){this.setDomainSwitch(!0),this.enableOptions()}handlePasswordProtected(){this.protected=!0,this.disableDomainSwitch(),this.disableOptions()}handleRestrictedPage(){this.setDomainSwitch(!1),this.disableDomainSwitch(),this.disableOptions()}handleSummaryMessage(e,t){Object.keys(t).length&&(this.updateSummaries(e,t),this.populateSummary())}handleWordlistsEnabled(){const e=document.getElementById("wordListContainer"),s=document.getElementById("wordlistSelect"),i=["Default Wordlist"].concat(this.Class.Config._allWordlists,this.cfg.wordlists),a=this.domain.wordlistId>=0?this.domain.wordlistId+1:0;t(i,s),s.selectedIndex=a,this.Class.show(e)}initializeMessaging(){chrome.runtime.onMessage.addListener(((e,t,s)=>{if(e.destination!==this.Class.Constants.MESSAGING.POPUP)return!0;e.summary?chrome.tabs.query({active:!0,currentWindow:!0},(s=>{t.tab.id==s[0].id&&this.handleSummaryMessage(t.frameId,e.summary)})):e.status?this.updateStatus(e.status):v.error("Received unhandled message.",JSON.stringify(e)),s()}));const e={destination:this.Class.Constants.MESSAGING.CONTEXT,source:this.Class.Constants.MESSAGING.POPUP,summary:!0};chrome.tabs.query({active:!0,currentWindow:!0},(t=>{chrome.tabs.sendMessage(t[0].id,e,(()=>{chrome.runtime.lastError&&(this.webFilterActive=!1)}))}))}async initializePopup(){await this.Class.load(this),this.applyTheme(),this.populateOptions(!0)}get isDisconnected(){return!1}get isDisabled(){return this.domain.disabled||this.disabledTab||this.cfg.enabledDomainsOnly&&!this.domain.enabled||this.isRestrictedPage||this.isPasswordProtected||this.isDisconnected}get isPasswordProtected(){return this.cfg.password&&""!=this.cfg.password}get isRestrictedPage(){return!this.domain.hostname||this.Class.Page.disabledProtocols.test(this.url.protocol)||this.Class.Config.BUILD.target==this.Class.Constants.BUILD_TARGET_CHROME&&this.Class.Page.disabledChromePages.includes(this.domain.hostname)||this.Class.Config.BUILD.target==this.Class.Constants.BUILD_TARGET_FIREFOX&&this.Class.Page.disabledFirefoxPages.includes(this.domain.hostname)}async populateOptions(e=!1){const s=document.getElementById("domainModeSelect"),i=document.getElementById("filterMethodSelect");if(t(this.Class.Constants.orderedArray(this.Class.Constants.DOMAIN_MODES),s,!0),s.selectedIndex=this.domain.getModeIndex(),t(this.Class.Constants.orderedArray(this.Class.Constants.FILTER_METHODS),i,!0),i.selectedIndex=this.cfg.filterMethod,e){const e=await this.getBackgroundData();this.disabledTab=e.disabledTab}else this.updateStatus(null),this.summaries={},this.populateSummary();return this.wordlistsEnabled&&this.handleWordlistsEnabled(),this.handleDisabledMessage(),this.isRestrictedPage||this.isDisconnected?(this.handleRestrictedPage(),!1):this.isPasswordProtected?(this.handlePasswordProtected(),!1):void(this.isDisabled?this.handleDisabled():this.handleEnabled())}populateSummary(){const e=document.getElementById("summary"),t=e.querySelector("table"),s=t.tBodies[0],i=document.createElement("tbody"),a=this.summary,o=Object.keys(a).sort(((e,t)=>a[t].count-a[e].count));if(o.length){for(const e of o){const t=i.insertRow(),s=t.insertCell(0);s.classList.add("w3-tooltip");const o=document.createElement("span");o.classList.add("summaryTooltip","w3-tag","w3-text"),o.textContent=e;const r=document.createElement("span");r.textContent=a[e].filtered,s.appendChild(o),s.appendChild(r);const n=t.insertCell(1);n.classList.add("w3-right"),n.textContent=a[e].count.toString()}e.classList.remove("w3-hide")}else e.classList.add("w3-hide");t.replaceChild(i,s)}setDomainSwitch(e=!0){document.getElementById("domainFilter").checked=e}get summary(){const e={};for(const t of Object.keys(this.summaries)){const s=this.summaries[t];for(const t of Object.keys(s)){const i=s[t];e[t]||(e[t]={count:0,filtered:i.filtered}),e[t].count+=i.count}}return e}async toggle(e){if(!this.protected)try{if(this.disabledTab){const e={source:this.Class.Constants.MESSAGING.POPUP,destination:this.Class.Constants.MESSAGING.BACKGROUND,enableTab:!0,tabId:this.tab.id};this.disabledTab=await chrome.runtime.sendMessage(e)}else this.domain[e]=!this.domain[e],await this.domain.save(this.cfg);chrome.tabs.reload(),this.populateOptions()}catch(e){v.error(`Failed to toggle domain '${this.domain.hostname}'.`,e)}}async updateDomainMode(){if(!this.protected){const e=document.getElementById("domainModeSelect");this.domain.updateFromModeIndex(e.selectedIndex);try{await this.domain.save(this.cfg),chrome.tabs.reload(),this.populateOptions()}catch(e){v.error(`Failed to update mode for domain '${this.domain.hostname}'.`,e)}}}updateStatus(e){this.status=e;const t=document.getElementById("statusContainer"),s=document.getElementById("statusText");this.Class.hide(t),s.textContent=""}updateSummaries(e,t){this.summaries[e]=t}async wordlistSelect(e){const t=this.wordlistType(e);this.domain[t]=e.selectedIndex>0?e.selectedIndex-1:void 0;try{await this.domain.save(this.cfg),chrome.tabs.reload(),this.populateOptions()}catch(e){v.error(`Failed to select wordlist for domain ${this.domain.hostname}.`,e)}}get wordlistsEnabled(){return!!this.cfg.wordlistsEnabled}wordlistType(e){return"wordlistSelect"===e.id?"wordlistId":""}}class w extends b{_managed;_protectedKeys;audioWordlistId;customAudioSites;fillerAudio;muteAudio;muteAudioOnly;muteCueRequireShowing;muteMethod;showSubtitles;unmuteDelay;youTubeAutoMatchCensored;youTubeAutoSubsMax;youTubeAutoSubsMin;static get Constants(){return u}get Class(){return this.constructor}static _premiumDefaults={audioWordlistId:u.ALL_WORDS_WORDLIST_ID,customAudioSites:null,fillerAudio:"",muteAudio:!1,muteAudioOnly:!1,muteCueRequireShowing:!1,muteMethod:this.BUILD.config.muteMethod||this.Constants.MUTE_METHODS.TAB,showSubtitles:u.SHOW_SUBTITLES.ALL,unmuteDelay:0,youTubeAutoMatchCensored:!0,youTubeAutoSubsMax:0,youTubeAutoSubsMin:0};static _defaults=this.initializeDefaults({},this._configDefaults,this._webDefaults,this._premiumDefaults);static _persistableKeys=Object.keys(this._defaults);static assignDefaultValue(e,t){t._managed===u.MANAGED.NONE&&super.assignDefaultValue(e,t)}static getManagedStorage(e){return"string"==typeof e&&(e=[e]),new Promise(((t,s)=>{chrome.storage.managed.get(e,(e=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(e)}))}))}static get isSafariBuild(){return this.BUILD.target==this.Constants.BUILD_TARGET_IOS||this.BUILD.target==this.Constants.BUILD_TARGET_MACOS}static async load(e=[],t={}){return e=this.keysToLoad(e),t._managed=u.MANAGED.NONE,t._protectedKeys=[],this.managedStorageSupported&&await this.loadManagedStorage(e,t),super.load(e,t)}static async loadManagedStorage(e,t){try{e.includes("_managed")||e.push("_managed");const s=await this.getManagedStorage(e),i=Object.keys(s);for(const i of e)"words"!=i||s.hasOwnProperty(i)?t[i]=s.hasOwnProperty(i)?s[i]:this._defaults[i]:t[i]=this._defaultWords;if(t._managed!=u.MANAGED.ALL&&t._managed!=u.MANAGED.PARTIAL||(t._protectedKeys=i),t._managed==u.MANAGED.ALL)return new this(t)}catch(e){}e=l(e,"_managed")}static get managedStorageSupported(){return this.BUILD.target===u.BUILD_TARGET_CHROME&&3==this.BUILD.manifestVersion}static requestedkeysForLocalStorage(e,t){const s=l(e,t._protectedKeys);return super.requestedkeysForLocalStorage(s,t)}static requestedkeysForSyncStorage(e,t,s){return s._protectedKeys.length&&(t=d(t).concat(s._protectedKeys)),super.requestedkeysForSyncStorage(e,t,s)}constructor(e){super(e),Object.assign(this,this.Class._premiumDefaults,e),void 0===this._protectedKeys&&(this._protectedKeys=[])}keysToSave(e){return l(e=super.keysToSave(e),this._protectedKeys)}async prepareLocalDataForSave(e){if(this.Class.isSafariBuild){const t=this.removeNullConfig(e);t.length&&await this.Class.removeLocalStorage(t)}}async prepareSyncDataForSave(e){if(this.Class.isSafariBuild){const t=this.removeNullConfig(e);t.length&&await this.Class.removeLocalStorage(t)}}removeNullConfig(e){const t=Object.keys(e).filter((t=>null==e[t]));return t.forEach((t=>delete e[t])),t}}function T(e,t="APFData"){const s=document.createElement("script");s.id=t,s.textContent=`document.getElementById("${t}").textContent = JSON.stringify(${e})`,document.documentElement.appendChild(s);const i=document.querySelector(`script#${t}`).textContent;return s.remove(),JSON.parse(i)}function E(e,t="context"){return new Promise(((s,i)=>{const a={destination:"background",globalVariable:e,source:t};chrome.runtime.sendMessage(a,(e=>{s(e)}))}))}const A={disabledSites:[],sites:{}},L={disabledSites:["www.hidive.com","watch.sling.com"],sites:{"tv.apple.com":[{mode:"cue",videoCueLanguage:"en"}],"stream.directv.com":[{filterActiveCues:!0,mode:"cue",removeDuplicateCues:!0,videoCueKind:"subtitles",videoCueLanguage:"en",videoSelector:"video#quickplayPlayer"}],"play.stan.com.au":[{mode:"cue",videoCueLanguage:"en"}]}},x={disabledSites:[],sites:{"tv.apple.com":[{mode:"cue",videoCueLanguage:"en"}],"stream.directv.com":[{filterActiveCues:!0,mode:"cue",removeDuplicateCues:!0,videoCueKind:"subtitles",videoCueLanguage:"en",videoSelector:"video#quickplayPlayer"}],"play.stan.com.au":[{mode:"cue",videoCueLanguage:"en"}]}},D={"www.9now.com.au":[{mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"}],"abc.com":[{iframe:!0,mode:"cue",videoCueKind:"captions",videoSelector:"video.vjs-tech"}],"iview.abc.net.au":[{mode:"element",subtitleSelector:"div.jw-text-track-cue",tagName:"div"}],"acorn.tv":[{iframe:!0,mode:"elementChild",parentSelector:"div.vjs-text-track-display",simpleUnmute:!0,subtitleSelector:":scope div > div",tagName:"DIV"}],"www.amazon.co.uk":[{displayHide:"none",displaySelector:"div.webPlayerContainer div.f35bt6a",displayShow:"",iframe:!1,mode:"watcher",parentSelector:"div.webPlayerContainer div span > span",videoSelector:"div.webPlayerElement video[src]"}],"www.amazon.com":[{displayHide:"none",displaySelector:"div.webPlayerContainer div.f35bt6a",displayShow:"",iframe:!1,mode:"watcher",parentSelector:"div.webPlayerContainer div span > span",videoSelector:"div.webPlayerElement video[src]"}],"www.amc.com":[{className:"ttr-container",mode:"element",subtitleSelector:"span.ttr-cue",tagName:"DIV"},{mode:"cue",videoCueLanguage:"en",videoSelector:"video"}],"www.amcplus.com":[{mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"}],"tv.apple.com":[{apfCaptions:!0,apfCaptionsSelector:"div.video-container",captionControlStyle:!0,displaySelector:"div.video-player div.video-container > div > div",mode:"watcher",subtitleSelector:"div.video-player div.video-container > div > div > div > div",videoSelector:"div.video-player div.video-container video"}],"www.att.tv":[{mode:"cue",videoSelector:"video#quickplayPlayer"}],"www.attwatchtv.com":[{mode:"cue",videoSelector:"video#quickplayPlayer"}],"www.bbc.co.uk":[{displaySelector:"smp-toucan-player >>> smp-video-layout >>> smp-subtitles >>> div",iframe:!1,mode:"watcher",subtitleSelector:"smp-toucan-player >>> smp-video-layout >>> smp-subtitles >>> div[lang] p span span",videoSelector:"smp-toucan-player >>> smp-playback >>> video"}],"binge.com.au":[{displaySelector:"div[class^='video-screen__CaptionContainer'] p",findChildText:!0,idNamePart:"cue_TTML_",mode:"elementChild",parentSelector:"div[class^='video-screen__CaptionContainer']",tagName:"DIV",videoSelector:"video.streamotion-web-video"}],"www.britbox.com":[{className:"bmpui-ui-subtitle-label",mode:"element",tagName:"SPAN"},{className:"bmpui-subtitle-region-container",mode:"element",subtitleSelector:"div.bmpui-container-wrapper > span.bmpui-ui-subtitle-label",tagName:"div"}],"gem.cbc.ca":[{className:"jw-text-track-container",mode:"element",subtitleSelector:"div.jw-text-track-cue",tagName:"DIV"}],"www.cbs.com":[{mode:"cue",videoCueLanguage:"en",videoCueRequireShowing:!1}],"www.channel4.com":[{displaySelector:"div.subtitles-container",mode:"elementChild",parentSelector:"div.subtitles-container",tagName:"SPAN"}],"www.crackle.com":[{ignoreMutations:!0,mode:"elementChild",parentSelector:"div.clpp-subtitles-container",simpleUnmute:!0,tagName:"#text"}],"www.criterionchannel.com":[{iframe:!0,mode:"cue",videoCueHideCues:!0,videoCueRequireShowing:!1}],"www.crunchyroll.com":[{apfCaptions:!0,apfCaptionsSelector:"vilosVttJs",displaySelector:"canvas#velocity-canvas",externalSub:!0,externalSubTrackMode:"hidden",externalSubVar:"window.v1config.media.playService.subtitles;;window.v1config.media.subtitles",iframe:!0,mode:"cue",videoCueLanguage:"en-US",videoCueRequireShowing:!1,videoSelector:"video#player0"},{iframe:!0,mode:"elementChild",note:"Dubbed videos",parentSelector:"div#vilosVttJs",subtitleSelector:":scope div > div",tagName:"DIV"}],"www.cwtv.com":[{className:"ttr-container",convertBreaks:!0,mode:"element",subtitleSelector:"span.ttr-cue",tagName:"DIV"},{className:"ttr-line",convertBreaks:!0,mode:"element",note:"[CC]",subtitleSelector:"span.ttr-cue",tagName:"DIV"}],"www.dailywire.com":[{mode:"cue"}],"www.dailymotion.com":[{displaySelector:"div#player div.subtitles",iframe:!0,mode:"elementChild",parentSelector:"div#player div.subtitles div.subtitles-text",simpleUnmute:!0,tagName:"#text",videoSelector:"div#player video"}],"stream.directv.com":[{mode:"cue",videoCueKind:"subtitles",videoCueLanguage:"en",videoSelector:"video#quickplayPlayer"}],"www.discoveryplus.com":[{apfCaptions:!0,apfCaptionsSelector:"div#overlay-root",displaySelector:"div[data-testid=caption_renderer_overlay]",mode:"watcher",subtitleSelector:"div[data-testid=caption_renderer_overlay] div.sc-iMWBiJ div.sc-ihgnxF",videoSelector:"div[data-testid=video-container] video"}],"www.dishanywhere.com":[{className:"bmpui-ui-subtitle-label",mode:"element",tagName:"SPAN"},{className:"bmpui-subtitle-region-container",mode:"element",subtitleSelector:"div.bmpui-container-wrapper > span.bmpui-ui-subtitle-label",tagName:"div"}],"www.apps.disneyplus.com":[{displayHide:"none",displaySelector:"div#video-container div.shaka-text-container",displayShow:"flex",iframe:!1,mode:"watcher",note:"South Africa",subtitleSelector:"div#video-container div.shaka-text-container > span",videoSelector:"div#video-container video"}],"www.disneyplus.com":[{apfCaptions:!0,captionControlStyle:!0,displaySelector:"disney-web-player >>> div.dss-subtitle-renderer-wrapper div.dss-subtitle-renderer-cue-window",mode:"watcher",subtitleSelector:"disney-web-player >>> div.dss-subtitle-renderer-wrapper span.dss-subtitle-renderer-line",videoSelector:"disney-web-player >>> video"},{className:"dss-subtitle-renderer-wrapper",mode:"element",subtitleSelector:"div.dss-subtitle-renderer-cue-window span.dss-subtitle-renderer-line",tagName:"DIV"}],"www.fox.com":[{className:"jw-text-track-container",mode:"element",subtitleSelector:"div.jw-text-track-cue",tagName:"DIV"}],"watch.frndlytv.com":[{apfCaptions:!0,apfCaptionsBottom:"100px",captionControlStyle:!0,displaySelector:"div.jw-captions",mode:"watcher",subtitleSelector:"div.jw-captions div.jw-text-track-container div.jw-text-track-display > div",videoSelector:"video.jw-video"}],"www.fubo.tv":[{displayHide:"none",displaySelector:"div.bmpui-ui-subtitle-overlay",iframe:!1,mode:"watcher",parentSelector:"div.bmpui-ui-subtitle-overlay",subtitleSelector:"div.bmpui-ui-subtitle-overlay span"}],"www.funimation.com":[{displaySelector:"div > div.vjs-text-track-cue",mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"},{iframe:!0,mode:"elementChild",note:"Embedded videos",parentSelector:"div.vjs-text-track-display",simpleUnmute:!0,subtitleSelector:":scope div > div",tagName:"DIV"}],"fxnow.fxnetworks.com":[{iframe:!0,mode:"cue",videoSelector:"video"}],"play.google.com":[{className:"lava-timed-text-window",mode:"element",subtitleSelector:"span.lava-timed-text-caption",tagName:"DIV"}],"www.hidive.com":[{className:"ds-text-track__wrapper-container",displaySelector:"div.ds-text-track",mode:"element",subtitleSelector:"span.ds-text-track__text",tagName:"DIV"}],"play.history.com":[{className:"ttr-line",mode:"element",subtitleSelector:"SPAN.ttr-cue",tagName:"DIV",videoSelector:"video[src^=blob]"}],"www.hmnow.com":[{className:"amp-caption-area",mode:"element",note:"Hallmark Movies Now",subtitleSelector:"div.amp-caption > p",tagName:"DIV"}],"www.hoopladigital.com":[{className:"clpp-text-wrapper",displaySelector:"div.clpp-container",mode:"element",subtitleSelector:"div.clpp-text-cue",tagName:"DIV"}],"www.hulu.com":[{displaySelector:"div.ClosedCaption",iframe:!1,mode:"watcher",note:"Hulu update 24-02",parentSelector:"div.ClosedCaption div.CaptionBox"},{className:"caption-text-box",displaySelector:"div.caption-text-box",mode:"element",subtitleSelector:"p",tagName:"DIV"},{displaySelector:"div.CaptionBox",mode:"elementChild",parentSelector:"div.CaptionBox",tagName:"P"}],"www.itv.com":[{mode:"cue",videoCueLanguage:"en"}],"www.kanopy.com":[{className:"vjs-text-track-display",mode:"elementChild",parentSelector:"div.vjs-text-track-display",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"}],"play.max.com":[{classNamePart:"TextCue-Beam-Web",displaySelector:'div[class^="CaptionWindow-Beam-Web"]',mode:"element",tagName:"DIV"},{classNamePart:"CaptionWindow-Beam-Web",subtitleSelector:'div[class^="TextCue-Beam-Web"]',mode:"element",tagName:"DIV"},{classNamePart:"RowContainer-Beam-Web",subtitleSelector:'div[class^="CaptionWindow-Beam-Web"] div[class^="TextCue-Beam-Web"]',mode:"element",tagName:"DIV"}],"mediasetinfinity.mediaset.it":[{ignoreMutations:!0,mode:"elementChild",parentSelector:"div#playerContainer > div > div > div > div > div",simpleUnmute:!0,tagName:"#text",videoSelector:"div#playerContainer video"},{ignoreMutations:!0,mode:"elementChild",parentSelector:"div#playerContainer > div > div > div > div > div > div > div > div > div > div",simpleUnmute:!0,tagName:"DIV",videoSelector:"div#playerContainer video"}],"www.mgmplus.com":[{className:"bmpui-subtitle-region-container",displaySelector:"div.bmpui-subtitle-region-container",mode:"element",subtitleSelector:"span.bmpui-ui-subtitle-label > span",tagName:"DIV",videoSelector:"video#bitmovinplayer-video-player-container"}],"moviesanywhere.com":[{mode:"cue"}],"www.nationalgeographic.com":[{mode:"cue",videoCueKind:"captions",videoCueLanguage:"eng",videoSelector:"video.vjs-tech"}],"www.nbc.com":[{className:"ttr-line",mode:"element",subtitleSelector:"span.ttr-cue",tagName:"DIV"},{mode:"cue",videoCueLanguage:"en"}],"www.netflix.com":[{className:"player-timedtext-text-container",mode:"element",note:"Fallback compatibility",subtitleSelector:"span > span",tagName:"DIV"},{className:"player-timedtext-text-container",mode:"element",subtitleSelector:"span",tagName:"DIV"}],"app.nlziet.nl":[{className:"VTn6M",displaySelector:"section.VTn6M",mode:"element",subtitleSelector:"span",tagName:"SECTION",videoSelector:"div.bitmovinplayer-container video"},{displaySelector:"section.VTn6M",mode:"elementChild",parentSelector:"section.VTn6M",tagName:"SPAN",videoSelector:"div.bitmovinplayer-container video"}],"www.nowtv.com":[{displaySelector:"div[data-test-id='video-player-component'] div.subtitles",displayShow:"flex",mode:"watcher",subtitleSelector:"div[data-test-id='video-player-component'] span.subtitles__cue span.subtitles__line",videoSelector:"div[data-test-id='video-player-component'] video"}],"www.paramountplus.com":[{mode:"cue",videoCueHideCues:!0,videoCueLanguage:"en",videoCueRequireShowing:!1,videoSelector:"div[data-role=videoContainer] video"}],"www.pbs.org":[{iframe:!0,mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"}],"www.peacocktv.com":[{apfCaptions:!0,captionControlStyle:!0,displaySelector:"div.video-player__subtitles",mode:"watcher",subtitleSelector:"div.video-player__subtitles > span.video-player__subtitles__cue span.video-player__subtitles__line"}],"www.philo.com":[{mode:"cue"}],"app.plex.tv":[{dataPropPresent:"dialogueId",mode:"element",subtitleSelector:"span > span",tagName:"DIV"},{containsSelector:"div[data-dialogue-id]",mode:"element",subtitleSelector:"span > span",tagName:"DIV"}],"pluto.tv":[{mode:"cue",videoCueHideCues:!0,videoCueRequireShowing:!1}],"www.primevideo.com":[{displayHide:"none",displaySelector:"div.webPlayerContainer div.f35bt6a",displayShow:"",iframe:!1,mode:"watcher",parentSelector:"div.webPlayerContainer div span > span",videoSelector:"div.webPlayerElement video[src]"}],"app.pureflix.com":[{mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"div",videoSelector:"video-js > video"}],"www.raiplay.it":[{mode:"elementChild",parentSelector:"div.theoplayer-texttracks div.theoplayer-webvtt-region-default",subtitleSelector:"div span",tagName:"DIV"}],"www.redbox.com":[{displaySelector:"div.rb-text-container",findChildText:!0,mode:"elementChild",note:"on demand",parentSelector:"div.rb-text-container",tagName:"DIV"},{className:"cc-text-container",mode:"element",note:"free live tv",subtitleSelector:"div.hlsjs-cue-container p.hsljs-cue",tagName:"DIV"}],"watch.redeemtv.com":[{convertBreaks:!0,displaySelector:"div.vp-captions",mode:"elementChild",parentSelector:"div.vp-captions",tagName:"SPAN"}],"therokuchannel.roku.com":[{mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"}],"roosterteeth.com":[{mode:"elementChild",parentSelector:"div.vjs-text-track-display",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"}],"row8.com":[{iframe:!1,mode:"watcher",parentSelector:"div.vjs-text-track-display div.vjs-text-track-cue",subtitleSelector:"div",videoSelector:"app-videojs-player video"}],"www.sbs.com.au":[{className:"bmpui-subtitle-region-container",mode:"element",subtitleSelector:"DIV.bmpui-container-wrapper > SPAN.bmpui-ui-subtitle-label > SPAN",tagName:"DIV"}],"www.showmax.com":[{ignoreMutations:!0,mode:"elementChild",parentSelector:"div.contentWrapper > div.subtitles--3EXhT",simpleUnmute:!0,tagName:"#text"}],"www.showtime.com":[{mode:"cue",videoCueHideCues:!0,videoCueLanguage:"en",videoCueRequireShowing:!1}],"www.shudder.com":[{mode:"element",subtitleSelector:"div.vjs-text-track-cue > div",tagName:"DIV"}],"www.skyshowtime.com":[{mode:"element",className:"video-player__subtitles",tagName:"DIV",subtitleSelector:"span.video-player__subtitles__cue span.video-player__subtitles__line"}],"watch.sling.com":[{className:"bmpui-subtitle-region-container",mode:"element",subtitleSelector:"DIV.bmpui-container-wrapper > SPAN.bmpui-ui-subtitle-label",tagName:"DIV"}],"play.stan.com.au":[{ignoreMutations:!0,mode:"elementChild",parentSelector:"div.clpp-text-container",simpleUnmute:!0,tagName:"DIV"}],"www.starz.com":[{mode:"elementChild",parentSelector:"starz-captions > div.cue-list",tagName:"SPAN"}],"web.strem.io":[{mode:"elementChild",parentSelector:"div.video-tkpQm > div:not(.vsc-controller)",displaySelector:"div.video-tkpQm > div:not(.vsc-controller)",tagName:"DIV"}],"web.stremio.com":[{mode:"elementChild",parentSelector:"div.video-tkpQm > div:not(.vsc-controller)",displaySelector:"div.video-tkpQm > div:not(.vsc-controller)",tagName:"DIV"}],"www.syfy.com":[{className:"ttr-line",mode:"element",subtitleSelector:"span.ttr-cue",tagName:"DIV"}],"www.tntdrama.com":[{mode:"cue",videoCueLanguage:"en",videoSelector:"video.top-media-element"}],"tubitv.com":[{mode:"elementChild",parentSelector:"div[data-id='captionsComponent']",tagName:"SPAN"}],"www.universalkids.com":[{mode:"element",subtitleSelector:"div.gwt-HTML",tagName:"DIV"}],"www.usanetwork.com":[{className:"ttr-container",mode:"element",note:"movies 2022-12",subtitleSelector:"span.ttr-cue",tagName:"DIV",videoSelector:"video[src^=blob]"},{className:"ttr-line",mode:"element",note:"free clips 2022-12",subtitleSelector:"span",tagName:"DIV",videoSelector:"video[src^=blob]"}],"v2.videoland.com":[{className:"shaka-text-region",displaySelector:"div.shaka-text-container",mode:"element",subtitleSelector:":scope span > span > span",tagName:"SPAN"},{displaySelector:"div.shaka-text-container",mode:"elementChild",parentSelector:"div.shaka-text-container",subtitleSelector:"span.shaka-text-wrapper span.shaka-text-region > span > span > span",tagName:"DIV"}],"vimeo.com":[{displaySelector:"div.vp-captions",mode:"watcher",subtitleSelector:"div.vp-captions span.vp-captions-line"}],"player.vimeo.com":[{displaySelector:"div.vp-captions",mode:"watcher",subtitleSelector:"div.vp-captions span.vp-captions-line"}],"www.vudu.com":[{displaySelector:"div#subtitleContainer > div",iframe:!0,mode:"element",subtitleSelector:"span.subtitles",tagName:"DIV"}],"www.xfinity.com":[{apfCaptions:!0,apfCaptionsSelector:"div#viper-player-container",displaySelector:"div#viper-player-container div#inner-cc-container",mode:"watcher",subtitleSelector:"div#viper-player-container div#inner-cc-container svg > text",videoSelector:"div#viper-player-container > video"}],"m.youtube.com":[{className:"caption-window",mode:"element",subtitleSelector:"span.ytp-caption-segment",tagName:"DIV"}],"tv.youtube.com":[{className:"caption-window",mode:"element",subtitleSelector:"span.ytp-caption-segment",tagName:"DIV"}],"www.youtube.com":[{className:"caption-window",mode:"element",subtitleSelector:"span.ytp-caption-segment",tagName:"DIV"}]},M=new g("WebAudio");class N{apfCaptionRuleIds;apfCaptionsEnabled;cueRuleIds;enabledRuleIds;fetching;fillerAudio;fillerAudioPauseHandler;fillerAudioPlayHandler;filter;lastFilteredNode;lastFilteredText;lastProcessedNode;lastProcessedText;muted;muteRuleId;rules;siteKey;sites;supportedCaptions;supportedPage;unmuteDelay;unmuteTimeout;volume;watcherRuleIds;wordlistId;youTube;youTubeAutoSubsMax;youTubeAutoSubsMin;youTubeAutoSubsRule;youTubeAutoSubsTimeout;youTubeAutoSubsUnmuteDelay;static brTagRegExp=new RegExp("<br>","i");static defaultVideoSelector="video";static fillerConfig={beep:{fileName:"audio/beep.mp3",volume:.2},crickets:{fileName:"audio/crickets.mp3",volume:.4},static:{fileName:"audio/static.mp3",volume:.3}};static textTrackRuleMappings={externalSubTrackLabel:"label",videoCueKind:"kind",videoCueLabel:"label",videoCueLanguage:"language"};static getBuildTargetConfig(){switch(w.BUILD.target){case u.BUILD_TARGET_IOS:return L;case u.BUILD_TARGET_MACOS:return x;default:return A}}static removeUnsupportedSites(e){Object.keys(e).forEach((t=>{const s=e[t];Array.isArray(s)||(e[t]=[s]),e[t]=e[t].filter((e=>null==e.buildTarget||e.buildTarget==w.BUILD.target))})),Object.keys(e).forEach((t=>{0==e[t].length&&delete e[t]}))}static supportedSites(e=!0){const t=N.getBuildTargetConfig(),s=Object.assign({},D,t.sites);return t.disabledSites.forEach((e=>{delete s[e]})),e&&N.removeUnsupportedSites(s),s}static supportedAndCustomSites(e){const t=Object.assign({},N.supportedSites(!1),e);return N.removeUnsupportedSites(t),t}constructor(e){this.filter=e,M.setLevel(this.filter.cfg.loggingLevel),this.apfCaptionRuleIds=[],this.cueRuleIds=[],this.enabledRuleIds=[],this.watcherRuleIds=[],this.filter.extension&&(this.fillerAudio=this.initFillerAudio(this.filter.cfg.fillerAudio)),this.lastFilteredNode=null,this.lastFilteredText="",this.lastProcessedText="",this.muted=!1,e.cfg.customAudioSites&&"object"==typeof e.cfg.customAudioSites||(e.cfg.customAudioSites={}),this.sites=N.supportedAndCustomSites(e.cfg.customAudioSites),this.supportedCaptions=!1,this.unmuteDelay=1e3*e.cfg.unmuteDelay,this.volume=1,this.wordlistId=e.audioWordlistId,this.youTubeAutoSubsMax=1e3*e.cfg.youTubeAutoSubsMax,this.youTubeAutoSubsMin=e.cfg.youTubeAutoSubsMin,this.youTubeAutoSubsUnmuteDelay=0,this.siteKey=this.getSiteKey(),this.rules=this.sites[this.siteKey],this.rules&&(this.rules.forEach((e=>{this.initRule(e)})),this.enabledRuleIds.length>0&&(this.supportedPage=!0,this.initYouTube()),this.apfCaptionRuleIds.length&&(this.apfCaptionsEnabled=!0),this.cueRuleIds.length&&setInterval(this.watchForVideo,250,this))}apfCaptionContainer(e,t){let i;return e.apfCaptionsSelector&&(i=s(e.apfCaptionsSelector)),i||(t||(t=s(e.videoSelector)),t&&t.parentElement&&(i=t.parentElement)),i}apfCaptionLine(e,t){const s=document.createElement("span");return s.classList.add("APF-subtitle-line"),s.style.background=e.apfCaptionsBackground,s.style.boxSizing="border-box",s.style.color=e.apfCaptionsColor,s.style.display=e.apfCaptionsDisplay,s.style.fontSize=e.apfCaptionsFontSize,s.style.lineHeight=e.apfCaptionsLineHeight,s.style.margin=e.apfCaptionsMargin,s.style.padding=e.apfCaptionsPadding,s.style.textShadow=e.apfCaptionsTextShadow,s.textContent=t,s}apfCaptionLines(e,t){const s=document.createElement("div");return s.classList.add("APF-subtitles"),s.style.bottom=e.apfCaptionsBottom,s.style.position="absolute",s.style.textAlign="center",s.style.width="100%",t.forEach((e=>{s.appendChild(e),s.appendChild(document.createElement("br"))})),s}apfTextTrack(e,t){if(t){if(t.textTracks.length){const s=Array.from(t.textTracks).find((t=>t.label==e.apfCuesLabel));if(s)return s}return t.addTextTrack("captions",e.apfCuesLabel,e.apfCuesLabel)}}buildApfCaptions(e,t,s){if(t.length){const i=t.flatMap((t=>(e.filterSubtitles&&t.modified?t.filtered:t.original).split("\n"))).map((t=>this.apfCaptionLine(e,t))),a=this.apfCaptionLines(e,i);s.appendChild(a)}}captionControlStyle(e,t){let i;if(e.captionControlSelector&&(i=s(e.captionControlSelector)),i||(t||(t=s(e.videoSelector)),t&&t.parentElement&&(i=t.parentElement)),i){let t=i.querySelector(`style#${e.captionControlStyleId}`);if(t)return t;const s=e.displaySelector.split(">>>").pop();return t=document.createElement("style"),t.id=e.captionControlStyleId,t.textContent=`${s} { visibility: hidden; }`,i.appendChild(t),t}M.warn("Failed to find captions container.")}captionControlStyleHide(e){const t=this.captionControlStyle(e);t&&(t.textContent=t.textContent.replace(": visible;",": hidden;"))}captionControlStyleShow(e){const t=this.captionControlStyle(e);t&&(t.textContent=t.textContent.replace(": hidden;",": visible;"))}clean(e,t=0){const s=this.rules[t];if(s.mode===u.AUDIO_RULE_MODES.WATCHER)return;s.apfCaptions&&s.displaySelector&&this.hideSubtitles(s);let i=!1;const a=[],o=this.subtitlesToClean(e,s);if(0===o.length)return;o.forEach((e=>{const t=this.textContentTag(e.nodeName)?"textContent":"innerText";!0!==s.convertBreaks||this.textContentTag(e.nodeName)||N.brTagRegExp.test(e[t])||!N.brTagRegExp.test(e.innerHTML)||("pre"!==e.style.whiteSpace&&(e.style.whiteSpace="pre"),e.textContent=e.innerHTML.replace(N.brTagRegExp,"\n"));const o=this.replaceTextResult(e[t]);if(o.modified&&(i=!0,this.mute(s),s.filterSubtitles&&!s.apfCaptions&&(s.preserveWhiteSpace&&"pre"!==e.style.whiteSpace&&(e.style.whiteSpace="pre"),s.ignoreMutations&&this.filter.stopObserving(),e[t]=o.filtered,s.ignoreMutations&&this.filter.startObserving()),this.lastFilteredNode=e,this.lastFilteredText=e[t]),s.apfCaptions)for(const e of this.splitReplaceTextResultsOnNewlines(o))a.push(e);i||this.lastFilteredNode!=e||this.lastFilteredText!=e[t]||(i=!0),this.lastProcessedNode=e})),i||this.lastFilteredNode&&document.body.contains(this.lastFilteredNode)&&this.lastFilteredNode.textContent===this.lastFilteredText&&(i=!0);const r=this.subtitlesShouldBeShown(s,i);s.apfCaptions?this.displayApfCaptions(s,a,r):r?this.showSubtitles(s,o):this.hideSubtitles(s,o)}cleanYouTubeAutoSubs(e){null!=this.youTubeAutoSubsTimeout&&(clearTimeout(this.youTubeAutoSubsTimeout),this.youTubeAutoSubsTimeout=null);const t=this.replaceTextResult(e.textContent);if(t.modified)this.youTubeAutoSubsRule.filterSubtitles&&(e.textContent=t.filtered),this.mute(this.youTubeAutoSubsRule),this.youTubeAutoSubsUnmuteDelay=null,this.filter.updateCounterBadge(),this.youTubeAutoSubsMax&&(this.youTubeAutoSubsTimeout=window.setTimeout(this.youTubeAutoSubsMuteTimeout,this.youTubeAutoSubsMax,this));else if(this.muted)if(this.youTubeAutoSubsMin>0){const e=document.getElementsByTagName(N.defaultVideoSelector)[0].currentTime;null==this.youTubeAutoSubsUnmuteDelay?this.youTubeAutoSubsUnmuteDelay=e:(e<this.youTubeAutoSubsUnmuteDelay&&(this.youTubeAutoSubsUnmuteDelay=0),e>this.youTubeAutoSubsUnmuteDelay+this.youTubeAutoSubsMin&&this.unmute(this.youTubeAutoSubsRule))}else this.unmute(this.youTubeAutoSubsRule);if(this.filter.cfg.showSubtitles!==u.SHOW_SUBTITLES.ALL){const e=document.querySelector("div.ytp-caption-window-rollup span.captions-text");"block"==e.style.display&&(e.style.display="none")}}clearUnmuteTimeout(e){e.unmuteDelay&&null!=this.unmuteTimeout&&(clearTimeout(this.unmuteTimeout),this.unmuteTimeout=null)}cuesIncludingText(e,t,s="text"){return e.filter((e=>t.includes(e[s])))}cuesInTimeRange(e,t,s,i=0){return e.filter((e=>e.startTime>=t-i&&e.endTime<=s+i))}delayedUnmute(e,t){e.unmute(t,null,!0),this.unmuteTimeout=null}displayApfCaptions(e,t,s){const i=this.apfCaptionContainer(e);i?(this.removeApfCaptions(e,i),s&&this.buildApfCaptions(e,t,i)):M.warn("Failed to find APF Captions container.")}fillerAudioHandlePause(){this.fillerAudio.pause()}fillerAudioHandlePlay(){this.muted&&this.fillerAudio.play()}findChildTextNodes(e,t,s=[]){if(t.hasChildNodes())for(const i of t.childNodes)this.findChildTextNodes(e,i,s);else s.push(t);return s}async getExternalSubtitleDetails(e){let t;for(const s of e._externalSubVars)try{if(t=3==w.BUILD.manifestVersion?await E(s):T(s),t)return t}catch(t){M.debug(`Failed to find subtitle variable: ${e.externalSubVar}.`)}}getSiteKey(){return this.sites.hasOwnProperty(this.filter.hostname)?this.filter.hostname:this.filter.iframe&&this.filter.iframe.hostname&&this.sites.hasOwnProperty(this.filter.iframe.hostname)?this.filter.iframe.hostname:""}getVideoTextTrack(e,t,s){let i=0,a=0,o=!1,r=0;s&&t[s]&&(r+=1e3),t.videoCueLabel&&(r+=100),t.videoCueLanguage&&(r+=10),t.videoCueKind&&(r+=1);for(let n=0;n<e.length;n++){const l=e[n];if(!l.cues||0===l.cues.length)continue;if(t.videoCueRequireShowing&&"showing"!==l.mode)continue;let d=0;if(s&&t[s]&&this.textTrackKeyTest(l,N.textTrackRuleMappings[s],t[s])&&(d+=1e3),t.videoCueLabel&&this.textTrackKeyTest(l,N.textTrackRuleMappings.videoCueLabel,t.videoCueLabel)&&(d+=100),t.videoCueLanguage&&this.textTrackKeyTest(l,N.textTrackRuleMappings.videoCueLanguage,t.videoCueLanguage)&&(d+=10),t.videoCueKind?this.textTrackKeyTest(l,N.textTrackRuleMappings.videoCueKind,t.videoCueKind)&&(d+=1):(this.textTrackKeyTest(l,N.textTrackRuleMappings.videoCueKind,"captions")||this.textTrackKeyTest(l,N.textTrackRuleMappings.videoCueKind,"subtitles"))&&(d+=1),d===r)return l;(d>a||!o)&&(a=d,i=n,o=!0)}if(o)return e[i]}hideCue(e,t){t.text="",t.position=100,t.size=0}hideSubtitles(e,t){if(e.captionControlStyle)this.captionControlStyleHide(e);else if(e.displayVisibility&&e._displayElement)e._displayElement.style.visibility="hidden";else if(e.displaySelector){const i=e.rootNode&&t&&t[0]?t[0].getRootNode():document;if(i){let t=s(e.displaySelector,i);t&&e.displaySelectorParents&&(t=o(t,e.displaySelectorParents)),t&&(""===e.displayShow&&""!==t.style.display&&t.style.display!==e.displayHide&&(e.displayShow=t.style.display),t.style.setProperty("display",e.displayHide))}}else t&&t.forEach((t=>{t.innerText="",e.removeSubtitleSpacing&&t.style&&(t.style.padding&&(t.style.padding=0),t.style.margin&&(t.style.margin=0))}))}initApfCaptions(e){void 0===e.apfCaptionsBackground&&(e.apfCaptionsBackground="rgba(0, 0, 0, 0.8)"),void 0===e.apfCaptionsBottom&&(e.apfCaptionsBottom="50px"),void 0===e.apfCaptionsColor&&(e.apfCaptionsColor="white"),void 0===e.apfCaptionsDisplay&&(e.apfCaptionsDisplay="inline-block"),void 0===e.apfCaptionsFontSize&&(e.apfCaptionsFontSize="clamp(12px, 1.5vw, 24px)"),void 0===e.apfCaptionsLineHeight&&(e.apfCaptionsLineHeight="1.2"),void 0===e.apfCaptionsMargin&&(e.apfCaptionsMargin="0.2vw auto"),void 0===e.apfCaptionsPadding&&(e.apfCaptionsPadding="0.5vw 1vw"),void 0===e.apfCaptionsTextShadow&&(e.apfCaptionsTextShadow="1px 1px 2px black")}initCommonRulesPostSetup(e){e.apfCaptions&&this.initApfCaptions(e)}initCueRule(e){!0===e.apfCaptions&&(e.videoCueHideCues=!0),void 0===e.videoCueRequireShowing&&(e.videoCueRequireShowing=this.filter.cfg.muteCueRequireShowing),!1===e.filterSubtitles&&(e.filterActiveCues=!1),e.externalSub&&(void 0===e.externalSubTrackMode&&(e.externalSubTrackMode="showing"),void 0===e.externalSubURLKey&&(e.externalSubURLKey="url"),e.externalSubVar&&(e._externalSubVars=e.externalSubVar.split(";;")),void 0===e.externalSubFormatKey&&(e.externalSubFormatKey="format"),void 0===e.externalSubTrackLabel&&(e.externalSubTrackLabel="APF"))}initDisplaySelector(e){void 0!==e.displaySelector&&(void 0===e.displayHide&&(e.displayHide="none"),void 0===e.displayShow&&(e.displayShow=""))}initDynamicRule(e){e._dynamic=!0,null==e.dynamicTargetMode&&e.disabled}initElementChildRule(e){e.parentSelector||e.parentSelectorAll||(e.disabled=!0),!0!==e.requireChildren&&(e.requireChildren=!1),e.apfCaptions&&void 0===e.displaySelector&&(e.disabled=!0)}initElementRule(e){e.apfCaptions&&void 0===e.displaySelector&&(e.disabled=!0)}initFillerAudio(e=""){const t=N.fillerConfig[e];if(t){const e=chrome.runtime.getURL(t.fileName),s=new Audio;return s.src=e,s.loop=!0,t.volume&&(s.volume=t.volume),t.loopAfter&&(s.ontimeupdate=()=>{s.currentTime>t.loopAfter&&(s.currentTime=0)}),this.fillerAudioPauseHandler=this.fillerAudioHandlePause.bind(this),this.fillerAudioPlayHandler=this.fillerAudioHandlePlay.bind(this),s}}initRule(e){if(e._id=this.rules.indexOf(e),(void 0===e.mode||(e.mode==u.AUDIO_RULE_MODES.ELEMENT||e.mode==u.AUDIO_RULE_MODES.ELEMENT_CHILD)&&!e.tagName||!0===e.iframe&&null==this.filter.iframe||!1===e.iframe&&null!=this.filter.iframe)&&(e.disabled=!0),e.disabled)M.info("Audio rule disabled",e);else{switch(null==e.filterSubtitles&&(e.filterSubtitles=!0),0==this.filter.filterText&&(e.filterSubtitles=!1),void 0===e.videoSelector&&(e.videoSelector=N.defaultVideoSelector),e._subtitleSelectors=[],this.initDisplaySelector(e),null==e.muteMethod&&(e.muteMethod=this.filter.cfg.muteMethod),null==e.showSubtitles&&(e.showSubtitles=this.filter.cfg.showSubtitles),null==e.unmuteDelay&&this.filter.cfg.unmuteDelay&&(e.unmuteDelay=this.unmuteDelay),null==e.tagName||this.textContentTag(e.tagName)||(e.tagName=e.tagName.toUpperCase()),e.subtitleSelector&&(e._subtitleSelectors.push(e.subtitleSelector),e.subtitleSelector2&&e._subtitleSelectors.push(e.subtitleSelector2),e.subtitleSelector3&&e._subtitleSelectors.push(e.subtitleSelector3)),e.mode){case u.AUDIO_RULE_MODES.CUE:this.initCueRule(e),e.disabled||this.cueRuleIds.push(e._id);break;case u.AUDIO_RULE_MODES.DYNAMIC:this.initDynamicRule(e);break;case u.AUDIO_RULE_MODES.ELEMENT_CHILD:this.initElementChildRule(e);break;case u.AUDIO_RULE_MODES.ELEMENT:this.initElementRule(e);break;case u.AUDIO_RULE_MODES.TEXT:this.initTextRule(e);break;case u.AUDIO_RULE_MODES.WATCHER:this.initWatcherRule(e),e.disabled||this.watcherRuleIds.push(e._id);break;case u.AUDIO_RULE_MODES.YTAUTO:e.disabled=!0}e.disabled?e.mode!=u.AUDIO_RULE_MODES.YTAUTO&&M.info("Audio rule disabled during initialization",e):(this.initCommonRulesPostSetup(e),this.enabledRuleIds.push(e._id),e.apfCaptions&&this.apfCaptionRuleIds.push(e._id),e.mode==u.AUDIO_RULE_MODES.WATCHER&&(e.toCue?setInterval(this.watcherToCue,e.checkInterval,this,e._id):setInterval(this.watcher,e.checkInterval,this,e._id)))}}initTextRule(e){e.tagName="#text",void 0===e.simpleUnmute&&(e.simpleUnmute=!0)}initWatcherRule(e){e.captionControlStyle&&void 0===e.displaySelector?e.disabled=!0:(void 0===e.apfCuesLabel&&(e.apfCuesLabel="APF-Cues"),void 0===e.captionControlStyleId&&(e.captionControlStyleId="APF-caption-control"),void 0===e.checkInterval&&(e.checkInterval=20),void 0===e.ignoreMutations&&(e.ignoreMutations=!0),void 0===e.simpleUnmute&&(e.simpleUnmute=!0))}initYouTube(){if(["m.youtube.com","tv.youtube.com","www.youtube.com"].includes(this.siteKey)){if(this.youTube=!0,this.filter.cfg.youTubeAutoMatchCensored){const e="\\[\\s__\\s\\]",t={lists:this.wordlistId===u.ALL_WORDS_WORDLIST_ID?[]:[this.wordlistId],matchMethod:u.MATCH_METHODS.REGEX,repeat:u.FALSE,separators:u.FALSE,sub:"[ _ ]"};this.filter.cfg.addWord(e,t)}this.youTubeAutoSubsRule={mode:u.AUDIO_RULE_MODES.YTAUTO},this.initRule(this.youTubeAutoSubsRule)}}mute(e,t){if(!this.muted){switch(this.muted=!0,this.muteRuleId=e._id,this.filter.cfg.collectStats&&this.filter.stats.mutes++,e.muteMethod){case u.MUTE_METHODS.TAB:chrome.runtime.sendMessage(this.filter.buildMessage(u.MESSAGING.BACKGROUND,{mute:!0}));break;case u.MUTE_METHODS.VIDEO_MUTE:t||(t=s(e.videoSelector)),t&&!t.muted&&(t.muted=!0),this.fillerAudio&&this.playFillerAudio(t);break;case u.MUTE_METHODS.VIDEO_VOLUME:t||(t=s(e.videoSelector)),t&&null!=t.volume&&(this.volume=t.volume,t.volume=0),this.fillerAudio&&this.playFillerAudio(t)}M.debugTime(`mute() - ruleId: ${e._id}`)}e&&e.unmuteDelay&&this.unmuteTimeout&&this.clearUnmuteTimeout(e)}newCue(e,t,s,i={}){try{const a="string"==typeof e?r(e):e,o="string"==typeof t?r(t):t,n=new VTTCue(a,o,s);return i.align&&(n.align=i.align),i.line&&(n.line=this.parseLineAndPositionSetting(i.line)),i.position&&(n.position=this.parseLineAndPositionSetting(i.position)),n}catch(i){M.error(`Failed to add cue: ( start: ${e}, end: ${t}, text: ${s} )`,i)}}newTextTrack(e,t,s){if(t.textTracks){const i=t.addTextTrack("captions",e.externalSubTrackLabel,e.videoCueLanguage);i.mode=e.externalSubTrackMode;for(let e=0;e<s.length;e++)i.addCue(s[e]);return i}}parseLineAndPositionSetting(e){if("string"==typeof e&&""!=e)return"auto"==e?"auto":parseInt(e)}parseSRT(e){const t=e.trim().replace(/\r\n/g,"\n").split("\n").map((e=>e.trim())),s=[];let i=null,a=null,o=null;for(let e=0;e<t.length;e++){const r=t[e];if(r.includes("--\x3e")){const e=r.split(/[ \t]+-->[ \t]+/);if(2!=e.length)throw new Error(`Error when splitting "--\x3e": ${r}.`);i=e[0].replace(",","."),a=e[1].replace(",",".")}else if(""==r){if(i&&a){const e=this.newCue(i,a,o);s.push(e),i=null,a=null,o=null}}else i&&a&&(null==o?o=r:o+="\n"+r)}if(i&&a){const e=this.newCue(i,a,o);s.push(e)}return s}parseSSA(e){const t=[];let s,i,a,o=!1;const r=e.split("\n");for(let e=0;e<r.length;e++)if(o){if(r[e].match(/^format:/i)){const t=r[e].trim().split(",");s=t.indexOf("End"),i=t.indexOf("Start"),a=t.indexOf("Text")}else if(r[e].match(/^dialogue:/i)){const o=r[e].trim().split(","),n=o[i],l=o[s],d=o.slice(a).join(",").replace(/\{\\\w.+?\}/g,"").split("\\N").reverse();for(let e=0;e<d.length;e++)t.push(this.newCue(n,l,d[e]))}}else r[e].match(/^\[Events\]/i)&&(o=!0);return t}parseVTT(e){const t=[],s=e.split("\n"),i=new RegExp("\\s--\x3e\\s");for(let e=0;e<s.length;e++){const o=s[e].trim();if(o.match(i)){const n=o.replace(i," ").split(" ");let[l,d,...c]=n;l=l.replace(",","."),d=d.replace(",",".");const u=c.map((e=>e.split(":"))).reduce(((e,t)=>(e[t[0]]=t[1],e)),{}),m=s[e-1].trim(),p=s[e+1].trim(),h=new RegExp(`^<[cs]\\.${m}>`),g=new RegExp("</[cs]>$");let S;if(S=p.match(h)?p.replace(h,"").replace(g,""):p,m&&!m.match(/_1$/)){const e=t[t.length-1];e.startTime!=r(l)&&e.endTime==r(d)&&(a=e.startTime,l=new Date(1e3*a).toISOString().slice(11,23))}const f=this.newCue(l,d,S,u);if(m&&!m.match(/_1$/)){const e=parseInt(m.match(/_([2-9])$/)[1]),s=t.length-e+1;t.splice(s,0,f)}else t.push(f);e++}}var a;return t}playFillerAudio(e){this.playing(e)&&(this.fillerAudio.play(),e.addEventListener("pause",this.fillerAudioPauseHandler),e.addEventListener("play",this.fillerAudioPlayHandler))}playing(e){return!!(e&&e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2)}processCues(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(i.hasOwnProperty("filtered"))continue;t.videoCueSync&&(i.startTime+=t.videoCueSync,i.endTime+=t.videoCueSync);const a=this.replaceTextResult(i.text);i.originalText=i.text,i.filteredText=a.filtered,a.modified?(i.filtered=!0,t.filterSubtitles&&!t.apfCaptions&&(i.text=a.filtered)):i.filtered=!1}}async processExternalSub(e,t){const s=this.getVideoTextTrack(e.textTracks,t,"externalSubTrackLabel");if(!this.fetching&&!s)try{const s=await this.getExternalSubtitleDetails(t);if(!s)throw new Error(`Failed to find subtitle variable: ${t.externalSubVar}.`);let i,a;if(Array.isArray(s)?i=s.find((e=>e.language===t.videoCueLanguage)):s[t.videoCueLanguage]?i=s[t.videoCueLanguage]:M.debug("Unsupported external variable format/type.",s),!i)throw new Error(`Failed to find subtitle for language: ${t.videoCueLanguage}.`);if(this.fetching=!0,a="bookmarklet"==w.BUILD.target?await async function(e,t){return fetch?await async function(e,t="GET"){const s=await fetch(e,{method:t});return await s.text()}(e,t):await function(e,t){return new Promise(((s,i)=>{const a=new XMLHttpRequest;a.open(t,e),a.onload=function(){this.status>=200&&this.status<300?s(this.response):i({status:this.status,statusText:this.statusText})},a.onerror=function(){i({status:this.status,statusText:this.statusText})},a.send()}))}(e,t)}(i[t.externalSubURLKey],"GET"):await function(e,t,s="context"){return new Promise(((i,a)=>{const o={destination:"background",fetch:e,fetchMethod:t.toUpperCase(),source:s};chrome.runtime.sendMessage(o,(e=>{i(e)}))}))}(i[t.externalSubURLKey],"GET"),"string"!=typeof a||!a)throw new Error(`Failed to download external subtitles from '${i[t.externalSubURLKey]}'.`);{let s;switch(i[t.externalSubFormatKey]){case"ass":s=this.parseSSA(a);break;case"srt":s=this.parseSRT(a);break;case"vtt":s=this.parseVTT(a);break;default:throw new Error(`Unsupported subtitle type: ${i[t.externalSubFormatKey]}.`)}if(s){const i=this.newTextTrack(t,e,s).cues;if(this.processCues(i,t),this.fetching=!1,t.displaySelector){const e=document.querySelector(t.displaySelector);e&&(e.style.display="none")}}}}catch(e){M.error(`Error using external subtitles for ${this.siteKey}.`,e)}}processWatcherCaptions(e,t,s){const i=s.initialCall;if(i){if(e._lastProcessedText&&e._lastProcessedText===t.textContent)return s.skipped=!0,!1;this.unmute(e),e._lastProcessedText="",this.lastProcessedText="",s.initialCall=!1}if(t.hasChildNodes())for(const i of t.childNodes)this.processWatcherCaptions(e,i,s);else{const i=t&&this.textContentTag(t.nodeName)?"textContent":"innerText";if(t[i]&&t[i].trim()){const a=this.replaceTextResult(t[i]);a.modified&&(this.mute(e),s.filtered=!0,e.filterSubtitles&&!e.apfCaptions&&(t[i]=a.filtered)),s.textResults.push(a)}}i&&(e._lastProcessedText=t.textContent,this.lastProcessedText=t.textContent)}processWatcherCaptionsArray(e,t,s){const i=t.map((e=>e.textContent)).join(" ");if(e._lastProcessedText&&e._lastProcessedText===i)return s.skipped=!0,!1;this.unmute(e),e._lastProcessedText="",this.lastProcessedText="",t.forEach((t=>{if(t.textContent&&t.textContent.trim()){const i=this.replaceTextResult(t.textContent);i.modified&&(this.mute(e),s.filtered=!0,e.filterSubtitles&&!e.apfCaptions&&(t.textContent=i.filtered)),s.textResults.push(i)}}));const a=t.map((e=>e.textContent)).join(" ");e._lastProcessedText=a,this.lastProcessedText=a}removeApfCaptions(e,t){if(t||(t=this.apfCaptionContainer(e)),t){const e=s("div.APF-subtitles",t);e&&e.remove()}}removeDuplicateCues(e,t){for(let s=0;s<e.length;s++){const i=e[s],a=e[s+1];!a||i.startTime!==a.startTime||i.endTime!==a.endTime||i.originalText!==a.originalText&&i.originalText!==a.text&&i.text!==a.originalText&&i.text!==a.text||(t.removeCue(i),e.splice(s,1),s--)}}replaceTextResult(e,t=this.wordlistId,s=u.STATS_TYPE_AUDIO){return this.filter.replaceTextResult(e,t,s)}showSubtitles(e,t){if(e.captionControlStyle)this.captionControlStyleShow(e);else if(e.displayVisibility&&e._displayElement)e._displayElement.style.visibility="visible";else if(e.displaySelector){const i=e.rootNode&&t&&t[0]?t[0].getRootNode():document;if(i){let t=s(e.displaySelector,i);t&&e.displaySelectorParents&&(t=o(t,e.displaySelectorParents)),t&&t.style.setProperty("display",e.displayShow)}}}splitReplaceTextResultsOnNewlines(e){const t=e.original.split("\n"),s=e.filtered.split("\n");if(1===t.length||t.length!==s.length)return[e];const i=[];for(let a=0;a<t.length;a++){const o=t[a],r=s[a],n=e.modified&&o!=r;i.push({filtered:r,modified:n,original:o})}return i}stopFillerAudio(){this.fillerAudio.pause(),this.fillerAudio.currentTime=0}subtitlesShouldBeShown(e,t=!1){switch(e.showSubtitles){case u.SHOW_SUBTITLES.ALL:return!0;case u.SHOW_SUBTITLES.FILTERED:return t;case u.SHOW_SUBTITLES.UNFILTERED:return!t;case u.SHOW_SUBTITLES.NONE:return!1}}subtitlesToClean(e,t){if(t.mode===u.AUDIO_RULE_MODES.ELEMENT_CHILD&&t.findChildText){const s=(t.rootNode?e.getRootNode():document).querySelector(t.parentSelector);if(s)return this.findChildTextNodes(t,s)}let s;if(e.nodeName&&this.textContentTag(e.nodeName)&&e.parentElement&&(e=e.parentElement),t.subtitleSelector&&e.querySelectorAll)for(const i of t._subtitleSelectors){const t=e.querySelectorAll(i);if(t.length){s=t;break}}return s&&s.length||(s=[e]),s}supportedCaptionsFound(e=!0,t=!1){if(!this.filter.extension||!t&&e==this.supportedCaptions)return;const s={destination:u.MESSAGING.BACKGROUND,source:u.MESSAGING.CONTEXT,forceUpdate:t};this.supportedCaptions=e,e?(s.status=u.STATUS.CAPTIONS,chrome.runtime.sendMessage(s),M.info("Supported captions found")):(s.status=u.STATUS.MUTE_PAGE,chrome.runtime.sendMessage(s),M.info("Watching for supported captions"))}supportedDynamicNode(e,t){e.textContent===t.dynamicTextKey&&(t.mode=t.dynamicTargetMode,t.parentSelectorAll=`${e.tagName.toLowerCase()}.${Array.from(e.classList).join(".")} ${t.parentSelectorAll}`,this.initRule(t))}supportedElementNode(e,t){return!(e.nodeName!=t.tagName||!(!t.className||e.className&&e.classList.contains(t.className))||t.idName&&(!e.id||e.id!==t.idName)||!(!t.classNamePart||e.className&&e.className.includes(t.classNamePart))||!(!t.idNamePart||e.id&&e.id.includes(t.idNamePart))||!(!t.dataPropPresent||e.dataset&&e.dataset.hasOwnProperty(t.dataPropPresent))||t.hasChildrenElements&&("number"!=typeof e.childElementCount||0==e.childElementCount)||t.subtitleSelector&&("function"!=typeof e.querySelector||!e.querySelector(t.subtitleSelector))||t.containsSelector&&("function"!=typeof e.querySelector||!e.querySelector(t.containsSelector)))}supportedElementChildNode(e,t){if(e.nodeName===t.tagName){if(t.className&&(!e.className||!e.classList.contains(t.className)))return!1;if(t.classNamePart&&(!e.className||!e.className.includes(t.classNamePart)))return!1;if(t.dataPropPresent&&(!e.dataset||!e.dataset.hasOwnProperty(t.dataPropPresent)))return!1;if(t.idName&&(!e.id||e.id!==t.idName))return!1;if(t.idNamePart&&(!e.id||!e.id.includes(t.idNamePart)))return!1;const s=t.rootNode?e.getRootNode():document;if(s)if(t.parentSelector){const i=s.querySelector(t.parentSelector);if(i&&(i==e||i.contains(e)))return t.findChildText||!t.requireChildren||!!i.querySelector(t.subtitleSelector)}else{const i=s.querySelectorAll(t.parentSelectorAll);for(let t=0;t<i.length;t++)if(i[t].contains(e))return!0}}return!1}supportedNode(e){for(let t=0;t<this.enabledRuleIds.length;t++){const s=this.enabledRuleIds[t],i=this.rules[s];let a=!1;switch(i.mode){case u.AUDIO_RULE_MODES.ELEMENT:a=this.supportedElementNode(e,i);break;case u.AUDIO_RULE_MODES.ELEMENT_CHILD:a=this.supportedElementChildNode(e,i);break;case u.AUDIO_RULE_MODES.TEXT:a=this.supportedTextNode(e,i);break;case u.AUDIO_RULE_MODES.WATCHER:a=this.supportedWatcherNode(e,i);break;case u.AUDIO_RULE_MODES.DYNAMIC:this.supportedDynamicNode(e,i)}if(a)return this.supportedCaptionsFound(),s}return!1}supportedTextNode(e,t){if(e.nodeName===t.tagName){const s=document.querySelector(t.parentSelector);if(s&&s.contains(e))return!0}return!1}supportedWatcherNode(e,t){if(null!=t.subtitleSelector&&e.parentElement&&e.parentElement==s(t.subtitleSelector))return!0;if(null!=t.parentSelector){const i=s(t.parentSelector);if(i&&i.contains(e))return!0}return!1}textContentTag(e){return["#text","svg","text"].includes(e)}textTrackKeyTest(e,t,s){return e[t]&&s&&e[t]===s}unmute(e,t,i=!1){if(this.muted){if(e.strictUnmute&&this.muteRuleId!==e._id)return;if(!i&&e&&e.unmuteDelay>=0)return null==this.unmuteTimeout&&this.clearUnmuteTimeout(e),void(this.unmuteTimeout=window.setTimeout(this.delayedUnmute,e.unmuteDelay,this,e));switch(this.muted=!1,e.muteMethod){case u.MUTE_METHODS.TAB:chrome.runtime.sendMessage(this.filter.buildMessage(u.MESSAGING.BACKGROUND,{mute:!1}));break;case u.MUTE_METHODS.VIDEO_MUTE:this.fillerAudio&&this.stopFillerAudio(),t||(t=s(e.videoSelector)),t&&t.muted&&(t.muted=!1);break;case u.MUTE_METHODS.VIDEO_VOLUME:this.fillerAudio&&this.stopFillerAudio(),t||(t=s(e.videoSelector)),t&&null!=t.volume&&(t.volume=this.volume)}M.debugTime(`unmute() - ruleId: ${e._id}`)}}watcher(e,t=0){const i=e.rules[t],r=s(i.videoSelector);if(r&&e.playing(r)){i.ignoreMutations&&e.filter.stopObserving();const t={filtered:!1,initialCall:!0,textResults:[]};if(i.apfCaptions&&i.displaySelector&&e.hideSubtitles(i),i.parentSelector){const s=document.querySelector(i.parentSelector);s&&s.textContent&&s.textContent.trim()?e.processWatcherCaptions(i,s,t):e.watcherSimpleUnmute(i,r)}else if(i.subtitleSelector){const n=function(e,t=document){const s=e.split("&&&");let i=[];for(const e of s){const s=a(e,t);s&&s.length&&(i=i.concat(Array.from(s)))}return i}(i.subtitleSelector);n&&n.length?(!i.displayVisibility||i._displayElement&&document.body.contains(i._displayElement)||(i.displayElementLevels?i._displayElement=o(n[0],i.displayElementLevels):i._displayElement=s(i.displaySelector)),e.processWatcherCaptionsArray(i,n,t)):e.watcherSimpleUnmute(i,r)}if(t.skipped)return!1;e.supportedCaptionsFound();const n=e.subtitlesShouldBeShown(i,t.filtered);i.apfCaptions?e.displayApfCaptions(i,t.textResults,n):n?e.showSubtitles(i):e.hideSubtitles(i),t.filtered&&e.filter.updateCounterBadge()}else i.ignoreMutations&&e.filter.startObserving()}watchForVideo(e){for(let t=0;t<e.cueRuleIds.length;t++){const i=e.rules[t],a=s(i.videoSelector);if(a&&a.textTracks&&e.playing(a)){i.externalSub&&e.processExternalSub(a,i);const t=e.getVideoTextTrack(a.textTracks,i);if(t&&!t.oncuechange){i.videoCueHideCues||i.showSubtitles!==u.SHOW_SUBTITLES.NONE||(t.mode="hidden"),t.oncuechange=()=>{if(t.activeCues&&t.activeCues.length>0){const s=Array.from(t.activeCues),o=[];if(i.removeDuplicateCues&&e.removeDuplicateCues(s,t),!s.every((e=>e.hasOwnProperty("filtered")))){const s=Array.from(t.cues);e.processCues(s,i)}if(i.filterActiveCues)for(const e of s)e.filtered&&e.text!==e.filteredText&&(e.text=e.filteredText);const r=s.some((e=>e.filtered));r?e.mute(i,a):e.unmute(i,a);const n=e.subtitlesShouldBeShown(i,r);for(let t=0;t<s.length;t++){const a=s[t];!n&&i.videoCueHideCues&&e.hideCue(i,a),i.apfCaptions&&o.unshift({filtered:a.filteredText,original:a.originalText,modified:a.filtered})}i.apfCaptions&&e.displayApfCaptions(i,o,n),i.videoCueHideCues||(t.mode=n?"showing":"hidden"),i.displaySelector&&(i.apfCaptions||!n?e.hideSubtitles(i):e.showSubtitles(i))}else e.unmute(i,a),i.apfCaptions&&e.removeApfCaptions(i)};const s=Array.from(t.cues);e.processCues(s,i),e.supportedCaptionsFound(!0)}}}}watcherSimpleUnmute(e,t){this.unmute(e,t),e.showSubtitles>u.SHOW_SUBTITLES.ALL&&this.hideSubtitles(e)}watcherToCue(e,t=0){const i=e.rules[t],o=s(i.videoSelector);if(o&&e.playing(o)){i.ignoreMutations&&e.filter.stopObserving(),e.hideSubtitles(i);const t=e.apfTextTrack(i,o),s=o.currentTime,r={filtered:!1,initialCall:!0,textResults:[]};let n;if(i.subtitleSelector)if(n=Array.from(a(i.subtitleSelector)),n&&n.length){const a=n.map((e=>e.textContent)).join(" ");if(i._lastProcessedText&&i._lastProcessedText===a)return r.skipped=!0,!1;{e.unmute(i,o),i._lastProcessedText=a,e.lastProcessedText=a,t&&t.activeCues&&t.activeCues.length&&Array.from(t.activeCues).forEach((e=>e.endTime=s-.001));const l=o.duration;n.reverse(),n.forEach((a=>{if(a.textContent&&a.textContent.trim()){const n=e.replaceTextResult(a.textContent);r.textResults.push(n),n.modified&&(e.mute(i,o),r.filtered=!0);const d=i.filterSubtitles?n.filtered:n.original,c=e.newCue(s,l,d);c.filtered=r.filtered,c.originalText=n.original,t.addCue(c)}}));const d=e.subtitlesShouldBeShown(i,r.filtered);i.videoCueHideCues||(t.mode=d?"showing":"hidden")}}else{e.watcherSimpleUnmute(i,o),t&&t.activeCues&&t.activeCues.length&&Array.from(t.activeCues).forEach((e=>e.endTime=s-.001));const a=e.subtitlesShouldBeShown(i,r.filtered);i.videoCueHideCues||(t.mode=a?"showing":"hidden")}if(r.skipped)return!1;r.filtered&&e.filter.updateCounterBadge()}else i.ignoreMutations&&e.filter.startObserving()}youTubeAutoSubsCurrentRow(e){return!(e.parentElement.parentElement!=e.parentElement.parentElement.parentElement.lastChild)}youTubeAutoSubsMuteTimeout(e){const t=window.document.querySelector(N.defaultVideoSelector);t&&e.playing(t)&&e.unmute(e.youTubeAutoSubsRule),e.youTubeAutoSubsTimeout=null}youTubeAutoSubsNodeIsSubtitleText(e){const t=document.querySelector("div.caption-window");return!(!t||!t.contains(e))}youTubeAutoSubsPresent(){const e=!!document.querySelector("div.ytp-caption-window-rollup");return e&&this.supportedCaptionsFound(),e}youTubeAutoSubsSupportedNode(e){return"#text"==e.nodeName&&""!=e.textContent&&!!this.youTubeAutoSubsNodeIsSubtitleText(e)}}class _ extends C{audioPage;audioSiteKeys;static get Config(){return w}static get Constants(){return u}static get Domain(){return p}get Class(){return this.constructor}static _requiredPremiumPopupConfig=["audioWordlistId","customAudioSites","muteAudio","muteAudioOnly"];static _requiredConfig=super._requiredConfig.concat(this._requiredPremiumPopupConfig);constructor(){super(),this.audioPage=!1}get disabledReason(){return super.isRestrictedPage?super.disabledReason:this.cfg.muteAudio&&this.cfg.muteAudioOnly&&!this.audioPage?"Popup disabled by only mute audio":super.disabledReason}disableOptions(){super.disableOptions();const e=document.getElementById("audioWordlistSelect");this.Class.disable(e)}async populateOptions(e=!1){return this.cfg.muteAudio&&(this.audioSiteKeys=Object.keys(N.supportedAndCustomSites(this.cfg.customAudioSites)),this.audioSiteKeys.includes(this.domain.cfgKey)&&(this.audioPage=!0)),await super.populateOptions(e)}handleWordlistsEnabled(){if(this.audioPage){const e=document.getElementById("audioWordlistContainer"),s=document.getElementById("audioWordlistSelect"),i=["Default Wordlist"].concat(this.Class.Config._allWordlists,this.cfg.wordlists),a=this.domain.audioWordlistId>=0?this.domain.audioWordlistId+1:0;t(i,s),s.selectedIndex=a,this.Class.show(e)}super.handleWordlistsEnabled()}get isDisconnected(){return!1}get isRestrictedPage(){return super.isRestrictedPage||this.cfg.muteAudio&&this.cfg.muteAudioOnly&&!this.audioPage}updateStatus(e){this.status=e;const t=document.getElementById("statusContainer"),s=document.getElementById("statusText");this.status==this.Class.Constants.STATUS.MUTE_PAGE?(this.Class.show(t),s.textContent="Watching for captions",s.classList.remove("active"),s.classList.add("available")):this.status==this.Class.Constants.STATUS.CAPTIONS?(s.textContent="Muting active",this.Class.show(t),s.classList.add("active"),s.classList.remove("available")):(this.Class.hide(t),s.textContent="")}wordlistType(e){const t=super.wordlistType(e);return""===t?"audioWordlistId":t}}const I=new _;document.getElementById("gettingStarted").href=chrome.runtime.getURL("optionPage.html#/help"),window.addEventListener("load",(e=>{I.initializePopup()})),document.getElementById("domainFilter").addEventListener("change",(e=>{I.toggle(I.filterToggleProp)})),document.getElementById("domainModeSelect").addEventListener("change",(e=>{I.updateDomainMode()})),document.getElementById("filterMethodSelect").addEventListener("change",(e=>{I.filterMethodSelect()})),document.getElementById("wordlistSelect").addEventListener("change",(e=>{I.wordlistSelect(e.target)})),document.getElementById("options").addEventListener("click",(e=>{chrome.runtime.openOptionsPage()})),document.getElementById("audioWordlistSelect").addEventListener("change",(e=>{I.wordlistSelect(e.target)}))})();