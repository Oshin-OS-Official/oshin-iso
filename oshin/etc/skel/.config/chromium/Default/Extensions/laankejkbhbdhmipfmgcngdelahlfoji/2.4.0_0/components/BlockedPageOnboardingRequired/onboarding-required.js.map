{"version":3,"file":"onboarding-required.js","sources":["../../../src/components/BlockedPageOnboardingRequired/onboarding-required.tpl.html?raw","../../../src/components/BlockedPageOnboardingRequired/View.js","../../../src/components/BlockedPageOnboardingRequired/Controller.js","../../../src/components/BlockedPageOnboardingRequired/main.js"],"sourcesContent":["export default \"<!-- Container -->\\n<div class=\\\"p-4\\\">\\n    <!-- Modal -->\\n    <div class=\\\"dialog flex flex-col bg-base-100 rounded-lg overflow-hidden\\\">\\n        <!-- Header -->\\n        <div class=\\\"header flex p-2 justify-between items-center\\\">\\n            <img class=\\\"logo-sf\\\" src=\\\"/common/img/logo.svg\\\" />\\n            <div class=\\\"btn btn-ghost btn-circle\\\" id=\\\"btnDismiss\\\">\\n                <svg class=\\\"Bz112c Bz112c-r9oPif\\\" xmlns=\\\"https://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 24 24\\\" width=\\\"24\\\" height=\\\"24\\\" fill=\\\"#5f6368\\\"><path d=\\\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\\\"></path><path fill=\\\"none\\\" d=\\\"M0 0h24v24H0z\\\"></path></svg>\\n            </div>\\n        </div>\\n\\n        <!-- Content -->\\n        <div class=\\\"flex flex-col gap-4 p-4\\\">\\n            <h1 data-i18n=\\\"required\\\" class=\\\"text-lg font-bold\\\"></h1>\\n            <p id=\\\"tosMessage\\\" data-i18n=\\\"tosHaveChanged\\\" class=\\\"text-base\\\"></p>\\n            <p id=\\\"privacyPolicyMessage\\\" data-i18n=\\\"onboardingConfirmMessage\\\" class=\\\"text-base\\\"></p>\\n            <button id=\\\"btnOpenSettings\\\" class=\\\"btn btn-primary\\\" data-i18n=\\\"openSettings\\\" target=\\\"_blank\\\"></button>\\n        </div>\\n    </div>\\n</div>\\n\"","import API from '~/core/CoreAPI'\nimport Brightline from 'brightline.js'\nimport PubSub from 'dropletjs.pubsub'\nimport blockedPageOnboardingRequiredTemplate from './onboarding-required.tpl.html?raw'\n\nvar log = API.Utils.createScopedLog('BlockedPageOnboardingRequiredView')\n\nexport default class BlockedPageOnboardingRequiredView {\n  constructor() {\n    log('constructor', 'Constructing view', null, 'DEBUG')\n  }\n\n  init() {\n    log('init', 'Initializing view', null, 'DEBUG')\n\n    var template = new Brightline(blockedPageOnboardingRequiredTemplate)\n    document.body.innerHTML = template.render()\n\n    const hasAcceptedToS = API.Settings.get('hasAcceptedToS')\n    this.setVisible('tosMessage', !hasAcceptedToS)\n    this.setVisible('privacyPolicyMessage', hasAcceptedToS)\n\n    API.StayFocusd.localizeHTML(document)\n\n    this.bindUIHandlers()\n  }\n\n  setVisible(id, isVisible) {\n    const element = document.getElementById(id)\n    if (!element) return\n\n    if (isVisible) element.classList.remove('hidden')\n    else element.classList.add('hidden')\n  }\n\n  /**\n   * Adds event listeners and publishes events for the controller to listen to.\n   */\n  bindUIHandlers() {\n    log('bindUIHandlers', 'Binding UI handlers', null, 'TRACE')\n\n    document.querySelectorAll('.btn').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        PubSub.publish('BlockedPageOnboardingRequired.button.clicked', {\n          id: btn.id,\n        })\n      })\n    })\n\n    API.Analytics.bindHtmlEvents()\n  }\n}\n","import API from '~/core/CoreAPI'\nimport PubSub from 'dropletjs.pubsub'\nimport { MINUTE } from '~/core/Time'\nimport View from './View'\nimport Browser from 'webextension-polyfill'\n\nvar log = API.Utils.createScopedLog('BlockedPageOnboardingRequiredController')\n\nexport default class BlockedPageOnboardingRequiredController {\n  view = null\n\n  constructor() {\n    log('constructor', 'Constructing controller', null, 'DEBUG')\n\n    this.view = new View()\n  }\n\n  async init() {\n    log('init', 'Initializing controller', null, 'DEBUG')\n\n    await Promise.all([API.Settings.initAsync(), API.Requirements.init()])\n\n    this.addListeners()\n    this.view.init()\n  }\n\n  addListeners() {\n    log('addListeners', 'Adding listeners', null, 'TRACE')\n\n    PubSub.listen(\n      'BlockedPageOnboardingRequired.button.clicked',\n      async (_, { id }) => {\n        switch (id) {\n          case 'btnDismiss':\n            API.Analytics.event('CLICK_BLOCKED_PAGE_ACTION_REQUIRED_DISMISS')\n            await this.dismiss()\n            break\n          case 'btnOpenSettings':\n            API.Analytics.event(\n              'CLICK_BLOCKED_PAGE_ACTION_REQUIRED_OPEN_SETTINGS',\n            )\n            await API.Chrome.Tab.create({\n              url: Browser.runtime.getURL('/options.html'),\n              active: true,\n            })\n            await this.dismiss()\n            break\n        }\n      },\n    )\n  }\n\n  /**\n   * Send a message to the iframe's parent window telling it to dismiss and hide the UI.\n   */\n  async dismiss() {\n    await API.Requirements.setPromptAgainAt(Date.now() + 5 * MINUTE)\n    window.parent.postMessage('BlockedPageOnboardingRequired.dismiss', '*')\n  }\n}\n","import API from '~/core/CoreAPI'\nimport $ from 'jquery'\nimport Controller from './Controller'\n\nPromise.all([\n  API.Bugsnag.init('blocked-page-onboarding-required'),\n  API.Settings.initAsync(),\n  API.RemoteConfig.init(),\n  API.Analytics.init(),\n]).then(() => {\n  var controller = new Controller()\n\n  $(document).ready(function () {\n    controller.init()\n  })\n})\n"],"names":["blockedPageOnboardingRequiredTemplate","log","API","BlockedPageOnboardingRequiredView","template","Brightline","hasAcceptedToS","id","isVisible","element","btn","PubSub","BlockedPageOnboardingRequiredController","__publicField","View","_","Browser","MINUTE","controller","Controller","$"],"mappings":"+UAAA,MAAeA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECKf,IAAIC,EAAMC,EAAI,MAAM,gBAAgB,mCAAmC,EAExD,MAAMC,CAAkC,CACrD,aAAc,CACZF,EAAI,cAAe,oBAAqB,KAAM,OAAO,CACtD,CAED,MAAO,CACLA,EAAI,OAAQ,oBAAqB,KAAM,OAAO,EAE9C,IAAIG,EAAW,IAAIC,EAAWL,CAAqC,EACnE,SAAS,KAAK,UAAYI,EAAS,OAAQ,EAE3C,MAAME,EAAiBJ,EAAI,SAAS,IAAI,gBAAgB,EACxD,KAAK,WAAW,aAAc,CAACI,CAAc,EAC7C,KAAK,WAAW,uBAAwBA,CAAc,EAEtDJ,EAAI,WAAW,aAAa,QAAQ,EAEpC,KAAK,eAAgB,CACtB,CAED,WAAWK,EAAIC,EAAW,CACxB,MAAMC,EAAU,SAAS,eAAeF,CAAE,EACrCE,IAEDD,EAAWC,EAAQ,UAAU,OAAO,QAAQ,EAC3CA,EAAQ,UAAU,IAAI,QAAQ,EACpC,CAKD,gBAAiB,CACfR,EAAI,iBAAkB,sBAAuB,KAAM,OAAO,EAE1D,SAAS,iBAAiB,MAAM,EAAE,QAASS,GAAQ,CACjDA,EAAI,iBAAiB,QAAS,IAAM,CAClCC,EAAO,QAAQ,+CAAgD,CAC7D,GAAID,EAAI,EAClB,CAAS,CACT,CAAO,CACP,CAAK,EAEDR,EAAI,UAAU,eAAgB,CAC/B,CACH,CC7CA,IAAID,EAAMC,EAAI,MAAM,gBAAgB,yCAAyC,EAE9D,MAAMU,CAAwC,CAG3D,aAAc,CAFdC,EAAA,YAAO,MAGLZ,EAAI,cAAe,0BAA2B,KAAM,OAAO,EAE3D,KAAK,KAAO,IAAIa,CACjB,CAED,MAAM,MAAO,CACXb,EAAI,OAAQ,0BAA2B,KAAM,OAAO,EAEpD,MAAM,QAAQ,IAAI,CAACC,EAAI,SAAS,UAAW,EAAEA,EAAI,aAAa,KAAI,CAAE,CAAC,EAErE,KAAK,aAAc,EACnB,KAAK,KAAK,KAAM,CACjB,CAED,cAAe,CACbD,EAAI,eAAgB,mBAAoB,KAAM,OAAO,EAErDU,EAAO,OACL,+CACA,MAAOI,EAAG,CAAE,GAAAR,KAAS,CACnB,OAAQA,EAAE,CACR,IAAK,aACHL,EAAI,UAAU,MAAM,4CAA4C,EAChE,MAAM,KAAK,QAAS,EACpB,MACF,IAAK,kBACHA,EAAI,UAAU,MACZ,kDACD,EACD,MAAMA,EAAI,OAAO,IAAI,OAAO,CAC1B,IAAKc,EAAQ,QAAQ,OAAO,eAAe,EAC3C,OAAQ,EACtB,CAAa,EACD,MAAM,KAAK,QAAS,EACpB,KACH,CACF,CACF,CACF,CAKD,MAAM,SAAU,CACd,MAAMd,EAAI,aAAa,iBAAiB,KAAK,IAAK,EAAG,EAAIe,CAAM,EAC/D,OAAO,OAAO,YAAY,wCAAyC,GAAG,CACvE,CACH,CCvDA,QAAQ,IAAI,CACVf,EAAI,QAAQ,KAAK,kCAAkC,EACnDA,EAAI,SAAS,UAAW,EACxBA,EAAI,aAAa,KAAM,EACvBA,EAAI,UAAU,KAAM,CACtB,CAAC,EAAE,KAAK,IAAM,CACZ,IAAIgB,EAAa,IAAIC,EAErBC,EAAE,QAAQ,EAAE,MAAM,UAAY,CAC5BF,EAAW,KAAM,CACrB,CAAG,CACH,CAAC"}