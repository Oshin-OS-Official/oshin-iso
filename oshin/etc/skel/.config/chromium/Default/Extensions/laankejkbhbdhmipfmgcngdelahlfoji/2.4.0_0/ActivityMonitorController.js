var a=Object.defineProperty;var m=(r,i,t)=>i in r?a(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t;var l=(r,i,t)=>(m(r,typeof i!="symbol"?i+"":i,t),t);import{L as c}from"./Logger.js";import{A as e}from"./CoreAPI.js";var s=function(r,i,t,n,o){c.log(r+"."+i,t,n,o)};class v{constructor(){l(this,"view",null);l(this,"model",null);l(this,"timer",null)}init(){s(this.originator,"init","Initializing controller",null,"DEBUG"),this.model.init(),this.addListeners(),e.PubSub.publish("ActivityMonitor.component.initialized"),this.view.bindActivityDetectors()}activate(){s(this.originator,"activate","Activating ActivityMonitor"),this.view.bindActivityDetectors(),this.startTimer()}addListeners(){s(this.originator,"addListeners","Adding listeners",null,"DEBUG");var i=this;e.PubSub.listen("ActivityMonitor.overlay.shown",function(){i.stopTimer()}),e.PubSub.listen("ActivityMonitor.overlay.hidden",function(){i.resetTimer(),i.startTimer()}),e.PubSub.listen("ActivityMonitor.activity.detected",function(){i.resetTimer()}),e.PubSub.listen("*.tab.selected",function(t,n){i.onTabSelected(n.tab,n.blockable)}),e.PubSub.listen("*.tab.activity",function(t,n){var o;i.model.blockable&&((o=n.tab)!=null&&o.audible)&&i.resetTimer()}),e.PubSub.listen("*.page.killed",function(t,n){i.killPage(n.redirectURL)})}onTabSelected(i,t){s(this.originator,"onTabSelected","New tab selected",{selectedTab:i,blockable:t},"TRACE"),this.model.currentTabID!==null&&this.stopTimer(),this.model.currentTabID=i.id,this.model.currentURL=i.url,this.model.blockable=t,this.resetTimer(),this.view.hide(),t&&!this.model.isDisabled()&&this.startTimer()}startTimer(){s(this.originator,"startTimer","Starting timer with "+this.model.interval+"-second interval"),clearInterval(this.timer),this.timer=setInterval(this.tick.bind(this),this.model.interval*1e3)}stopTimer(){s(this.originator,"stopTimer","Stopping timer"),clearInterval(this.timer),this.timer=null}resetTimer(){s(this.originator,"resetTimer","Resetting timer",null,"TRACE"),this.model.elapsedTime=0}killPage(i){e.Analytics.event("BLOCK_PAGE",{isNuclear:e.NuclearOption.isActive(),hostname:window.location.hostname}),s(this.originator,"killPage","Killing page",i,"INFO"),top.location.href=i+"?content&customMsg="+e.Settings.get("customStayFocusdMsg")}tick(){this.model.elapsedTime+=this.model.interval,s(this.originator,"tick","Elapsed time: "+this.model.elapsedTime+" secs",null,"DEBUG"),this.model.isMaxInactiveTimeExceeded()&&(s(this.originator,"tick","Max inactive time exceeded: ",this.model.maxInactiveTime,"INFO"),this.view.show())}}export{v as default};
//# sourceMappingURL=ActivityMonitorController.js.map
