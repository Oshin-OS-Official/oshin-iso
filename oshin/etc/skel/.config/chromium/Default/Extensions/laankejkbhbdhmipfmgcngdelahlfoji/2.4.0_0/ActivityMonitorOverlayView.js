var b=Object.defineProperty;var g=(n,e,t)=>e in n?b(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e,t)=>(g(n,typeof e!="symbol"?e+"":e,t),t);import{g as x,B as f,L as C}from"./Logger.js";import{B as E}from"./Brightline.min.js";import{A as r}from"./CoreAPI.js";import{$ as F}from"./jquery.js";const D=`<div id="StayFocusd-still-there" class="flex flex-col items-center justify-center prose">
    <div class="md:w-[70%] flex flex-col items-center text-center">
        <img src="{{extensionURL}}common/img/logo.svg" title="StayFocusd" alt="StayFocusd" class="w-64" />

        <h1 id="StayFocusd-overlayHeader">{{activityMonitorOverlayHeader}}</h1>
        <p id="StayFocusd-overlayBody">{{activityMonitorOverlayBody}}</p>
        <p class="label justify-start gap-3">
            <b>{{activityMonitorOverlayLink1}} <a href="#" id="StayFocusd-unblock-link" title="{{activityMonitorOverlayLink4}}">{{activityMonitorOverlayLink2}}</a> {{activityMonitorOverlayLink3}}</b>
        </p>
    </div>
</div>
`;var w=/^[a-z](?:[\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-(?:[\x2D\.0-9_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,S=function(n){return w.test(n)},M=S;const O=x(M);var A=(n,e,t)=>new Promise((o,a)=>{var m=s=>{try{d(t.next(s))}catch(c){a(c)}},y=s=>{try{d(t.throw(s))}catch(c){a(c)}},d=s=>s.done?o(s.value):Promise.resolve(s.value).then(m,y);d((t=t.apply(n,e)).next())});function k(n){return A(this,null,function*(){const{name:e,mode:t="closed",css:o,isolateEvents:a=!1}=n;if(!O(e))throw Error(`"${e}" is not a valid custom element name. It must be two words and kebab-case, with a few exceptions. See spec for more details: https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name`);const m=document.createElement(e),y=m.attachShadow({mode:t}),d=document.createElement("html"),s=document.createElement("body"),c=document.createElement("head");if(o){const v=document.createElement("style");"url"in o?v.textContent=yield fetch(o.url).then(h=>h.text()):v.textContent=o.textContent,c.appendChild(v)}return d.appendChild(c),d.appendChild(s),y.appendChild(d),a&&(Array.isArray(a)?a:["keydown","keyup","keypress"]).forEach(h=>{s.addEventListener(h,p=>p.stopPropagation())}),{parentElement:m,shadow:y,isolatedElement:s}})}let i=F;var l=function(n,e,t,o,a){C.log(n+"."+e,t,o,a)};class H{constructor(){u(this,"model",null);u(this,"isOverlayActive",!1);u(this,"isOverlayHTMLInjected",!1);u(this,"customElement",null)}render(){l(this.originator,"render","Rendering view",null,"DEBUG");var e=new E(D);e.set("extensionURL",f.runtime.getURL("/")),e.set("activityMonitorOverlayHeader",r.Chrome.Translation.get("activityMonitorOverlayHeader")),e.set("activityMonitorOverlayBody",r.Chrome.Translation.get("activityMonitorOverlayBody"));for(var t=1;t<=4;t++)e.set("activityMonitorOverlayLink"+t,r.Chrome.Translation.get("activityMonitorOverlayLink"+t));return e.render()}async inject(e){l(this.originator,"inject","Injecting ActivityMonitor overlay");let t=await fetch(f.runtime.getURL("style.css")).then(o=>o.text());t=t.replace(/:root/g,"html"),this.customElement=await k({name:"stayfocusd-still-there",css:{textContent:t},mode:"open"}),document.body.appendChild(this.customElement.parentElement),i(this.customElement.isolatedElement).addClass("fixed flex flex-col items-center justify-center top-0 bottom-0 right-0 left-0 bg-neutral hidden").css("z-index","999999999").append(this.render()),this.isOverlayHTMLInjected=!0,this.bindUIHandlers(),typeof e=="function"&&e()}bindUIHandlers(){l(this.originator,"bindUIHandlers","Binding UI handlers",null,"TRACE");var e=this;i(this.customElement.isolatedElement).on("click","#StayFocusd-unblock-link",function(){e.isOverlayActive===!0&&e.hide()}),i("body").keydown(function(){e.isOverlayActive===!0&&e.hide()})}show(){var e=this;if(!this.isOverlayHTMLInjected)return this.inject(function(){e.show()}),null;l(this.originator,"show","Showing ActivityMonitor overlay"),i("embed").addClass("StayFocusd-hidden"),i("object").addClass("StayFocusd-hidden"),i("applet").addClass("StayFocusd-hidden"),i(this.customElement.isolatedElement).removeClass("hidden"),this.isOverlayActive=!0,r.PubSub.publish("ActivityMonitor.overlay.shown")}hide(){this.isOverlayActive&&(l(this.originator,"hide","Hiding ActivityMonitor overlay"),i(this.customElement.isolatedElement).addClass("hidden"),i("embed").removeClass("StayFocusd-hidden"),i("object").removeClass("StayFocusd-hidden"),i("applet").removeClass("StayFocusd-hidden"),this.isOverlayActive=!1,r.PubSub.publish("ActivityMonitor.overlay.hidden"))}bindActivityDetectors(){l(this.originator,"bindActivityDetectors","Binding activity detectors",null,"DEBUG"),this.bindTimerReset("body");var e=this;i("iframe").each(function(){var t=i(this).attr("src");if(typeof t<"u"){var o=r.Domain.extractFullDomain(t),a=r.Domain.extractFullDomain(top.location.href);o===a&&e.bindTimerReset(i(this).contents().find("body"))}})}bindTimerReset(e){l(this.originator,"bindTimerReset","Binding timer reset",e,"TRACE");var t="ActivityMonitor.activity.detected";e&&(i(e).mousedown(function(){r.PubSub.publish(t)}),i(e).mousemove(function(){r.PubSub.publish(t)}),i(e).keypress(function(){r.PubSub.publish(t)}))}setJQuery(e){i=e||F,l(this.originator,"setJQuery","Setting jQuery")}}export{H as default};
//# sourceMappingURL=ActivityMonitorOverlayView.js.map
