var zm=Object.defineProperty;var Zm=(Qt,It,tt)=>It in Qt?zm(Qt,It,{enumerable:!0,configurable:!0,writable:!0,value:tt}):Qt[It]=tt;var _n=(Qt,It,tt)=>(Zm(Qt,typeof It!="symbol"?It+"":It,tt),tt);(function(){var fn;"use strict";var Qt=Object.defineProperty,It=(e,t,n)=>t in e?Qt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tt=(e,t,n)=>(It(e,typeof t!="symbol"?t+"":t,n),n);const uc='"use strict";(()=>{var Pe=Object.create;var Ht=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var Oe=Object.getOwnPropertyNames;var Fe=Object.getPrototypeOf,Ue=Object.prototype.hasOwnProperty;var Le=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var De=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Oe(t))!Ue.call(e,s)&&s!==r&&Ht(e,s,{get:()=>t[s],enumerable:!(o=Me(t,s))||o.enumerable});return e};var Vt=(e,t,r)=>(r=e!=null?Pe(Fe(e)):{},De(t||!e||!e.__esModule?Ht(r,"default",{value:e,enumerable:!0}):r,e));var vt=Le((Bt,Wt)=>{"use strict";(function(e){if(typeof Bt=="object")Wt.exports=e();else if(typeof define=="function"&&define.amd)define(e);else{var t;try{t=window}catch{t=self}t.SparkMD5=e()}})(function(e){"use strict";var t=function(d,l){return d+l&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function o(d,l,i,n,c,a){return l=t(t(l,d),t(n,a)),t(l<<c|l>>>32-c,i)}function s(d,l){var i=d[0],n=d[1],c=d[2],a=d[3];i+=(n&c|~n&a)+l[0]-680876936|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[1]-389564586|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[2]+606105819|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[3]-1044525330|0,n=(n<<22|n>>>10)+c|0,i+=(n&c|~n&a)+l[4]-176418897|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[5]+1200080426|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[6]-1473231341|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[7]-45705983|0,n=(n<<22|n>>>10)+c|0,i+=(n&c|~n&a)+l[8]+1770035416|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[9]-1958414417|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[10]-42063|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[11]-1990404162|0,n=(n<<22|n>>>10)+c|0,i+=(n&c|~n&a)+l[12]+1804603682|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[13]-40341101|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[14]-1502002290|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[15]+1236535329|0,n=(n<<22|n>>>10)+c|0,i+=(n&a|c&~a)+l[1]-165796510|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[6]-1069501632|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[11]+643717713|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[0]-373897302|0,n=(n<<20|n>>>12)+c|0,i+=(n&a|c&~a)+l[5]-701558691|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[10]+38016083|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[15]-660478335|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[4]-405537848|0,n=(n<<20|n>>>12)+c|0,i+=(n&a|c&~a)+l[9]+568446438|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[14]-1019803690|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[3]-187363961|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[8]+1163531501|0,n=(n<<20|n>>>12)+c|0,i+=(n&a|c&~a)+l[13]-1444681467|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[2]-51403784|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[7]+1735328473|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[12]-1926607734|0,n=(n<<20|n>>>12)+c|0,i+=(n^c^a)+l[5]-378558|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[8]-2022574463|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[11]+1839030562|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[14]-35309556|0,n=(n<<23|n>>>9)+c|0,i+=(n^c^a)+l[1]-1530992060|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[4]+1272893353|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[7]-155497632|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[10]-1094730640|0,n=(n<<23|n>>>9)+c|0,i+=(n^c^a)+l[13]+681279174|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[0]-358537222|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[3]-722521979|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[6]+76029189|0,n=(n<<23|n>>>9)+c|0,i+=(n^c^a)+l[9]-640364487|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[12]-421815835|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[15]+530742520|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[2]-995338651|0,n=(n<<23|n>>>9)+c|0,i+=(c^(n|~a))+l[0]-198630844|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[7]+1126891415|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[14]-1416354905|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[5]-57434055|0,n=(n<<21|n>>>11)+c|0,i+=(c^(n|~a))+l[12]+1700485571|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[3]-1894986606|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[10]-1051523|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[1]-2054922799|0,n=(n<<21|n>>>11)+c|0,i+=(c^(n|~a))+l[8]+1873313359|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[15]-30611744|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[6]-1560198380|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[13]+1309151649|0,n=(n<<21|n>>>11)+c|0,i+=(c^(n|~a))+l[4]-145523070|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[11]-1120210379|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[2]+718787259|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[9]-343485551|0,n=(n<<21|n>>>11)+c|0,d[0]=i+d[0]|0,d[1]=n+d[1]|0,d[2]=c+d[2]|0,d[3]=a+d[3]|0}function u(d){var l=[],i;for(i=0;i<64;i+=4)l[i>>2]=d.charCodeAt(i)+(d.charCodeAt(i+1)<<8)+(d.charCodeAt(i+2)<<16)+(d.charCodeAt(i+3)<<24);return l}function h(d){var l=[],i;for(i=0;i<64;i+=4)l[i>>2]=d[i]+(d[i+1]<<8)+(d[i+2]<<16)+(d[i+3]<<24);return l}function f(d){var l=d.length,i=[1732584193,-271733879,-1732584194,271733878],n,c,a,x,O,L;for(n=64;n<=l;n+=64)s(i,u(d.substring(n-64,n)));for(d=d.substring(n-64),c=d.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<c;n+=1)a[n>>2]|=d.charCodeAt(n)<<(n%4<<3);if(a[n>>2]|=128<<(n%4<<3),n>55)for(s(i,a),n=0;n<16;n+=1)a[n]=0;return x=l*8,x=x.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(x[2],16),L=parseInt(x[1],16)||0,a[14]=O,a[15]=L,s(i,a),i}function p(d){var l=d.length,i=[1732584193,-271733879,-1732584194,271733878],n,c,a,x,O,L;for(n=64;n<=l;n+=64)s(i,h(d.subarray(n-64,n)));for(d=n-64<l?d.subarray(n-64):new Uint8Array(0),c=d.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<c;n+=1)a[n>>2]|=d[n]<<(n%4<<3);if(a[n>>2]|=128<<(n%4<<3),n>55)for(s(i,a),n=0;n<16;n+=1)a[n]=0;return x=l*8,x=x.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(x[2],16),L=parseInt(x[1],16)||0,a[14]=O,a[15]=L,s(i,a),i}function m(d){var l="",i;for(i=0;i<4;i+=1)l+=r[d>>i*8+4&15]+r[d>>i*8&15];return l}function g(d){var l;for(l=0;l<d.length;l+=1)d[l]=m(d[l]);return d.join("")}g(f("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(t=function(d,l){var i=(d&65535)+(l&65535),n=(d>>16)+(l>>16)+(i>>16);return n<<16|i&65535}),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function d(l,i){return l=l|0||0,l<0?Math.max(l+i,0):Math.min(l,i)}ArrayBuffer.prototype.slice=function(l,i){var n=this.byteLength,c=d(l,n),a=n,x,O,L,Dt;return i!==e&&(a=d(i,n)),c>a?new ArrayBuffer(0):(x=a-c,O=new ArrayBuffer(x),L=new Uint8Array(O),Dt=new Uint8Array(this,c,x),L.set(Dt),O)}}();function w(d){return/[\\u0080-\\uFFFF]/.test(d)&&(d=unescape(encodeURIComponent(d))),d}function v(d,l){var i=d.length,n=new ArrayBuffer(i),c=new Uint8Array(n),a;for(a=0;a<i;a+=1)c[a]=d.charCodeAt(a);return l?c:n}function R(d){return String.fromCharCode.apply(null,new Uint8Array(d))}function b(d,l,i){var n=new Uint8Array(d.byteLength+l.byteLength);return n.set(new Uint8Array(d)),n.set(new Uint8Array(l),d.byteLength),i?n:n.buffer}function q(d){var l=[],i=d.length,n;for(n=0;n<i-1;n+=2)l.push(parseInt(d.substr(n,2),16));return String.fromCharCode.apply(String,l)}function A(){this.reset()}return A.prototype.append=function(d){return this.appendBinary(w(d)),this},A.prototype.appendBinary=function(d){this._buff+=d,this._length+=d.length;var l=this._buff.length,i;for(i=64;i<=l;i+=64)s(this._hash,u(this._buff.substring(i-64,i)));return this._buff=this._buff.substring(i-64),this},A.prototype.end=function(d){var l=this._buff,i=l.length,n,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a;for(n=0;n<i;n+=1)c[n>>2]|=l.charCodeAt(n)<<(n%4<<3);return this._finish(c,i),a=g(this._hash),d&&(a=q(a)),this.reset(),a},A.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},A.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},A.prototype.setState=function(d){return this._buff=d.buff,this._length=d.length,this._hash=d.hash,this},A.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},A.prototype._finish=function(d,l){var i=l,n,c,a;if(d[i>>2]|=128<<(i%4<<3),i>55)for(s(this._hash,d),i=0;i<16;i+=1)d[i]=0;n=this._length*8,n=n.toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(n[2],16),a=parseInt(n[1],16)||0,d[14]=c,d[15]=a,s(this._hash,d)},A.hash=function(d,l){return A.hashBinary(w(d),l)},A.hashBinary=function(d,l){var i=f(d),n=g(i);return l?q(n):n},A.ArrayBuffer=function(){this.reset()},A.ArrayBuffer.prototype.append=function(d){var l=b(this._buff.buffer,d,!0),i=l.length,n;for(this._length+=d.byteLength,n=64;n<=i;n+=64)s(this._hash,h(l.subarray(n-64,n)));return this._buff=n-64<i?new Uint8Array(l.buffer.slice(n-64)):new Uint8Array(0),this},A.ArrayBuffer.prototype.end=function(d){var l=this._buff,i=l.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c,a;for(c=0;c<i;c+=1)n[c>>2]|=l[c]<<(c%4<<3);return this._finish(n,i),a=g(this._hash),d&&(a=q(a)),this.reset(),a},A.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},A.ArrayBuffer.prototype.getState=function(){var d=A.prototype.getState.call(this);return d.buff=R(d.buff),d},A.ArrayBuffer.prototype.setState=function(d){return d.buff=v(d.buff,!0),A.prototype.setState.call(this,d)},A.ArrayBuffer.prototype.destroy=A.prototype.destroy,A.ArrayBuffer.prototype._finish=A.prototype._finish,A.ArrayBuffer.hash=function(d,l){var i=p(new Uint8Array(d)),n=g(i);return l?q(n):n},A})});var T=class e{constructor(t,r){this.operation=t;this.data=r}static NONCE="z3ZCw_12v";nonce=e.NONCE;static fromObject(t){return!t||t.nonce!==e.NONCE?null:new e(t.operation,t.data)}validate(){return this.nonce===e.NONCE}};var X=class{crawlId;installId;zys;dateCrawlStarted;dateCrawled;crawlUrl;fragmentIndex;youTubeChannelId;youTubeChannelName;youTubeVideoId;constructor(t,r,o,s,u,h,f,p){this.crawlId=t,this.installId=r,this.zys=o,this.dateCrawlStarted=s,this.dateCrawled=u,this.crawlUrl=h,this.fragmentIndex=f,Object.assign(this,p)}get ads(){return this.zys}set ads(t){this.zys=t}};var ct=Vt(vt(),1);var _=class{x;y;width;height;text;sourceUrls;hash;hashOverride;type;typeOverride;canvases;svgs;depth;adRuleId;dedupeKey;duration;language;youTubeId;netflixData;twitterData;vastData;outerHtml;static minWidth=120;static minHeight=28;static minimumVideoToAdAreaRatio=.5;static minimumImageToAdAreaRatio=.05;constructor(t){this.x=t.x??0,this.y=t.y??0,this.width=t.width,this.height=t.height,this.text=t.text??"",this.sourceUrls=t.sourceUrls??[],this.hash=t.hash??"",this.type=t.type,this.canvases=[],this.svgs=[],this.depth=0,this.adRuleId=t.adRuleId,this.duration=t.duration,this.language=t.language,this.youTubeId=t.youTubeId,this.netflixData=t.netflixData,this.twitterData=t.twitterData,this.vastData=t.vastData}};var y=class e{u;t;h;d;width;height;constructor(t){this.u=e.qualifyURL(t.url,t.doc),this.t=t.urlType,this.d=t.depth,this.width=t.width,this.height=t.height}get url(){return this.u}set url(t){this.u=t}get urlType(){return this.t}set urlType(t){this.t=t}get depth(){return this.d}set depth(t){this.d=t}get hash(){return this.h}set hash(t){this.h=t}static SourceUrlTags=new Set(["A","DIV","IFRAME","IMG","LINK","SCRIPT","SPAN","VIDEO"]);static qualifyURL(t,r){if(!t||new RegExp("^(?:\\\\w+-extension)|(?:about)|(?:blob)|(?:javascript):").test(t))return"";r=r||document;let o=r.createElement("a");return o.href=t,o.href}};async function Q(e,t){if(!e)return[];let r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,u=>y.SourceUrlTags.has(u.nodeName)||u?.shadowRoot?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP),o=[],s=r.currentNode;for(;s;){o.push(...await He(s,t));let u=s?.shadowRoot;u&&o.push(...await Q(u?.firstElementChild,t)),s=r.nextNode()}return o.filter(u=>u.url)}async function He(e,t){if(!e||!y.SourceUrlTags.has(e.nodeName))return[];if(e.nodeName=="IMG")return[await qt(e,t)];if(e.nodeName=="DIV"||e.nodeName=="SPAN"){let s=/url\\([\'"]?([^\'"]+)[\'"]?\\)/gi,u=getComputedStyle(e).getPropertyValue("background-image");return Promise.all(Array.from(u.matchAll(s)).filter(h=>h).map(h=>h[1]).map(async h=>{try{let f=new Image;return f.src=h,await f.decode(),qt(f,t)}catch{return new y({url:h,urlType:7,depth:t,doc:e?.ownerDocument})}}))}if(e.nodeName==="VIDEO"){if(e=e.hasAttribute("src")?e:e.querySelector("source"),!e)return[];let s=e.getBoundingClientRect(),u=Math.round(s.width),h=Math.round(s.height);return[new y({url:e.getAttribute("src"),urlType:4,depth:t,width:u,height:h,doc:e.ownerDocument})]}if(e.nodeName==="IFRAME")return[new y({url:e.getAttribute("src"),urlType:1,depth:t,width:e.offsetWidth,height:e.offsetHeight,doc:e.ownerDocument})];let r=null,o=0;switch(e.nodeName){case"SCRIPT":r=e.getAttribute("src"),o=6;break;case"LINK":r=e.getAttribute("href"),o=6;break;case"A":r=e.getAttribute("href"),o=8;break}return[new y({url:r,urlType:o,depth:t,doc:e.ownerDocument})]}async function qt(e,t){let r=e.getAttribute("src"),o=e.getBoundingClientRect(),s=Math.round(e.naturalWidth||o.width),u=Math.round(e.naturalHeight||o.height);if(!(s||u)&&r)try{let f=new Image;f.src=r,await f.decode(),s=f.naturalWidth,u=f.naturalHeight}catch{}let h=0;return(o.width||s)<2&&(o.height||u)<2||s===43&&u===22||o.y+window.scrollY<5&&(o.width||s)<85&&(o.height||u)<=20?h=7:h=3,new y({url:r,urlType:h,depth:t,width:o.width||s,height:o.height||u,doc:e.ownerDocument})}async function ut(e,t){e.sourceUrls=lt(e.sourceUrls,h=>h.u);let r=e.sourceUrls.filter(h=>h.t===3||h.t===4),s=r.filter(h=>h.t===3).sort((h,f)=>(h.width||0)*(h.height||0)-(f.width||0)*(f.height||0)).pop(),u=r.filter(h=>h.t===4);if(e.type=e.typeOverride??(r.length===1&&(r[0].width||0)>=e.width-2&&(r[0].height||0)>=e.height-2?r[0].t===3?1:3:u.length===1&&(u[0].width||0)*(u[0].height||0)>=e.width*e.height*_.minimumVideoToAdAreaRatio?3:7),e.hashOverride)return e.hash=e.hashOverride;if(e.type===7&&!u.length&&(s?.width||0)*(s?.height||0)<e.width*e.height*_.minimumImageToAdAreaRatio)return e.hash="";for(let h of r)h.h=await j(h.u||"",t);if(e.hash=r.filter(h=>h.h).reduce((h,f)=>z(h,f.h),"")||"",e.type===3&&!e.hash&&(e.hash=k(r[0].u??"",!0)),e.type===7&&e.text){let h=k(e.text.toLowerCase(),!0);e.hash=z(e.hash,h)}if(e.hash||(e.canvases?.length&&(e.hash=e.canvases.reduce((h,f)=>z(k(f),h),e.hash)),e.svgs?.length&&(e.hash=e.svgs.reduce((h,f)=>z(k(f),h),e.hash))),e.type===7&&e.hash){let h=k(Be(kt(Math.round(e.height)),kt(Math.round(e.width))),!0);e.hash=z(e.hash,h)}r.forEach(h=>{h.h&&(h.h=btoa(h.h))}),e.hash=btoa(e.hash)}async function j(e,t){try{return k(await t(e))}catch(r){return S(r),""}}function k(e,t){if(Ve(e)==="arraybuffer"){let r=e;return r.byteLength===0?"":ct.default.ArrayBuffer.hash(r,!0)}else{let r=e;return t?ct.default.hash(r,!0):ct.default.hashBinary(r,!0)}}function Ve(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}function z(e,t){if(!t)return e||"";if(!e)return t;if(e.length<t.length){let u=e;e=t,t=u}let r=e.length,o=t.length,s="";for(let u=0;u<o;u++)s+=String.fromCharCode(e.charCodeAt(u)^t.charCodeAt(u));for(let u=o;u<r;u++)s+=String.fromCharCode(e.charCodeAt(u));return s}function kt(e){let t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e,!0),t}function Be(e,t){let r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}var V=3e3;var Et="pc",Ct="ca",et=72e5,Z=null;function S(...e){Z&&(e=e||[],e=e.map(t=>t?.stack&&t.message?{error:t.message,stack:t.stack}:t),e=e.map(t=>typeof t!="object"||t instanceof String?t:JSON.stringify(t)),e.length==1?Z(e[0]):Z(e))}function Jt(e){Z=e||Z}var ht=class{constructor(t,r,o,s){let u=Xt(t);u==="object"?(this.left=0,Object.assign(this,t)):u==="number"&&(this.left=Math.round(Math.max(t||0,0))||0,this.top=Math.round(Math.max(r||0,0))||0,this.width=Math.round(Math.max(o||0,0))||0,this.height=Math.round(Math.max(s||0,0))||0)}get bottom(){return this.top+this.height}get right(){return this.left+this.width}toString(){return`${this.width}x${this.height}@${this.left},${this.top}`}};function We(){return([1e7]+-1e3+-1e3+-1e3+-1e11).replace(/[01]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function Xt(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}function qe(e,t){let r={},o=Object.keys(t);for(let s=0,u=o.length;s<u;s++){let h=o[s];if(t.hasOwnProperty(h)){let f=t[h];if(f==null||f===""&&e[h]||f instanceof Array&&!f.length&&e[h]?.length||(h==="top"||h==="left"||h==="X"||h==="Y")&&e[h]>0)continue;r[h]=t[h]}}return Object.assign(e,t)}function E(e){try{return e()}catch{return null}}var $r=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789").map(e=>e.charCodeAt(0));function zt(e){return e.tagName?.toUpperCase?.()||E(()=>e.outerHTML.substr(1,e.outerHTML.indexOf(" ")-1).toUpperCase())||""}function jt(e){let t=0,r="",o={" ":1,"\\f":1,"\\n":1,"\\r":1,"	":1,"\\v":1,"\\xA0":1,"\\u2028":1,"\\u2029":1};for(let s=0,u=e.length;s<u;s++)o[e.charAt(s)]?(t||(r+=" "),t=1):(t=0,r+=e.charAt(s));return r.trim()}function F(){return ke(C.location.hostname)}function ke(e){return e.split(".").slice(e.endsWith(".uk")||e.endsWith(".jp")?-3:-2).join(".")}function pt(){let e=new Set(["aarp.org","abc.com","aol.com","attn.com","atttvnow.com","brainly.com","bravotv.com","cartoonnetwork.com","cbs.com","cbssports.com","chron.com","citationmachine.net","cnet.com","cnn.com","crunchyroll.com","dailymail.co.uk","delish.com","discoveryplus.com","easybib.com","espn.com","fandom.com","foxbusiness.com","foxnews.com","fubo.tv","genius.com","go.cnn.com","go.com","goodhousekeeping.com","happykids.tv","hulu.com","imdb.com","investigationdiscovery.com","linkedin.com","locast.org","mlb.com","msn.com","music.amazon.com","music.apple.com","music.youtube.com","mytuner-radio.com","nexusmods.com","nfl.com","nhl.com","nypost.com","nytimes.com","paramountplus.com","pch.com","philo.com","playstation.com","pluto.tv","rawstory.com","realtor.com","refinery29.com","seattlepi.com","sfgate.com","sling.com","spanishdict.com","sporcle.com","steampowered.com","tablotv.com","therokuchannel.roku.com","try.frndlytv.com","tubitv.com","tv.apple.com","tv.youtube.com","twitch.tv","uproxx.com","usatoday.com","vudu.com","washingtonpost.com","watch.hgtv.com","watch.spectrum.net","weather.com","www3.nhk.or.jp","xbox.com","xfinity.com","yahoo.com","yelp.com","youtubekids.com"]);return I&&(e.has(C.location.hostname)||e.has(F()))}function U(e){e.documentElement&&(e=e.documentElement);let t=zt(e);if(e.offsetParent===null&&t!=="BODY"&&t!=="HTML"&&t!=="FRAME")return new ht;let o=(e.ownerDocument||document).defaultView||C,s=e.getBoundingClientRect();return new ht(s.left+o.scrollX,s.top+o.scrollY,s.width,s.height)}var Gt=["background-image","display","visibility","z-index","border-top-width","border-left-width","border-bottom-width","border-right-width","padding-top","padding-left","padding-bottom","padding-right","position","width","height","top","bottom","left","right","font-size"];function je(e){if(e._pm_st)return e.style&&(e._pm_st=qe(e._pm_st,JSON.parse(JSON.stringify(e.style,Gt)))),e._pm_st;let t=e.ownerDocument?.defaultView;typeof window<"u"&&(!t||!t.opener)&&(t=window);let r=JSON.parse(JSON.stringify(t.getComputedStyle(e),Gt));return e._pm_st=r,r}function Kt(e,t){let r=e.nodeName,o=je(e),s=U(e);if(o?.display!=="none"&&s&&s.width>20&&s.height>20)if(r==="CANVAS"&&!e.matches(".__pm_marker"))try{t.canvases.push(e.toDataURL("image/jpeg",.2))}catch{}else r==="SVG"&&t.svgs.push(e.outerHTML)}function mt(e){if(!e)return"";let t=e?.ownerDocument||document,r=t.defaultView.NodeFilter;if(Xt(e)==="htmldocument"&&e.body&&(e=e.body),!e)return"";let o={SCRIPT:1,NOSCRIPT:1,STYLE:1},s=zt(e);if(s==="HTML"&&(e=e.querySelector("body")),!e)return"";let u=function(m){try{return m.nodeType===3?r.FILTER_ACCEPT:!m.tagName||o[m.tagName]||m.offsetParent===null?r.FILTER_REJECT:r.FILTER_ACCEPT}catch{return r.FILTER_REJECT}};if(e.nodeType!==3&&(!s||o[s]))return"";let h=t.createTreeWalker(e,r.SHOW_ELEMENT|r.SHOW_TEXT,{acceptNode:u},!0),f={"LEARN MORE":1,REPLAY:1},p=[];for(;e;){if(e.nodeType===3){let m=jt(e.nodeValue||"");!f[m.toUpperCase()]&&!p.includes(m)&&p.push(m)}e=h.nextNode()}return p.length?jt(p.join(" ")):""}function P(e,t){return C.requestIdleCallback?{id:C.requestIdleCallback(e,{timeout:t}),isIdleCallback:!0}:{id:setTimeout(e,t),isIdleCallback:!1}}var tt=null;function G(e){tt=e||tt}function It(){tt=null}function Yt(){if(typeof window>"u")return;let e=function(f,p,m,g){P(()=>{!tt||!f||tt(f,p,m,g)},1e4)},t=f=>new TextDecoder("utf-8").decode(new Uint8Array(f)),r=function(f,p){try{if(p=f.currentTarget||p,p=p._datadog_xhr||p,p.readyState===4&&p.status>=200&&p.status<=210){let m=E(()=>p.responseXML),g=E(()=>p.responseText)||E(()=>t(p.response))||E(()=>m.documentElement.outerHTML);(g||m)&&e(g,m,p.reponseType==="json",p.responseURL)}}catch{}},o=XMLHttpRequest.prototype.send;function s(){let f=this.onreadystatechange,p=arguments;this.onreadystatechange=function(m){return r(m,this),f?.apply?.(this,arguments)},o.apply(this,p)}XMLHttpRequest.prototype.send=s;let u=C.fetch,h=function(){return u.apply(this,arguments).then(f=>{let p=f.headers.get("Content-Type");if(p&&(p.includes("text")||p.includes("json")||p.includes("xml")||p.includes("javascript"))){let m=f.clone();P(()=>{m.text().then(g=>e(g,null,p.includes("json"),f.url))},5e3)}return f})};C.fetch=h}function Tt(e){if(!e)return null;let t=null;return e=(e+"").trim(),e=="start"?t=0:e.indexOf(":")>=0?t=E(()=>Math.round(e.split(":").reduce((r,o,s,u)=>r+parseFloat(o)*Math.pow(60,u.length-s-1),0)))||t:isNaN(e)||(t=Math.round(parseFloat(e))),t}var Qt,$,Zt,St,H,dt,ft;function te(e){H[e.dedupeKey]?.depth>e.depth||H[e.dedupeKey]?.depth===e.depth&&H[e.dedupeKey].adRuleId<e.adRuleId||(H[e.dedupeKey]=e)}function Ge(){let e=C.location;return e.href.indexOf("youtube.com/watch")===-1?e.origin+e.pathname:e.href}async function $e(e){await Promise.all(e.map(t=>ut(t,M)))}async function Je(){let e=Object.values(H),t=Object.values(dt);return H={},dt={},await $e(e),new X(Qt,gt,e.concat(t).filter(r=>r.hash),$-(D?.TimeOffset||0),Date.now()-(D?.TimeOffset||0),St,Zt++,ft)}function N(e,t){if(!I){W(top,new T(Et,[e,t]));return}e.forEach(r=>dt[r.hash]=r),ft=t||ft,B()}var $t=0;async function B(){let e=Date.now();if(e-$t>V){$t=e;let t=await Je();Nt?.(JSON.stringify(t))}}function ee(){if(!I)return;Qt=We(),$=Date.now(),Zt=0;let e=D?.ParsedSiteConfigs[F()];if(e){let t=new RegExp(e).exec(location.href);St=t?t.slice(1).join(""):location.protocol+"://"+location.hostname}else St=Ge();H={},dt={},ft=void 0}function Xe(e,t){return e.reduce(function(r,o){return(r[t(o)]=r[t(o)]||[]).push(o),r},{})}function lt(e,t){return Object.values(Xe(e,t)).map(r=>r[0])}function W(e,t){e.postMessage(t,"*")}var re=null;function ne(){let e=document.querySelector("video.ad-video-player,video#ad-video-player"),t=document.querySelector(".AdUnitView a"),r=e&&e.src;if(e&&t&&r&&re!==r&&r.endsWith(".mp4")&&r.indexOf("bumper")===-1&&(r.indexOf("ads")>=0||r.indexOf("Ads")>=0)){if(!e.duration||isNaN(e.duration))return;re=r,P(()=>{j(r,M).then(o=>N([new _({width:1920,height:1080,sourceUrls:[new y({url:r,urlType:4}),new y({url:t.href,urlType:8})],hash:btoa(o),type:3,duration:Math.round(e.duration)})]))});return}}var yt={},ie=!1;function oe(){if(S("NETFLIX AD CAPTURE"),!(typeof window>"u")){if(!ie){let e=Object.defineProperty;Object.defineProperty=function(r,o,s){return Date.now()-$<et&&P(()=>{if(Object.hasOwn(r,"isAd")&&r.isAd){let u=ze(r);u&&(yt[u.hash]=u)}}),e(r,o,s)},ie=!0}N(Object.values(yt)),yt={}}}function ze(e){let t=e.movieId;if(!t||yt[t])return;let r=e.video_tracks[0].streams[0],o=r.res_w,s=r.res_h,u=e.audio_tracks[0].streams[0];return new _({hash:("n+++"+t).padEnd(t.length+4+(t.length+4)*6%8/2,"=").replace("===","A=="),type:3,sourceUrls:[new y({url:r.urls[0].url,urlType:4,width:o,height:s}),new y({url:u.urls[0].url,urlType:9})],width:o,height:s,duration:e.duration,language:u.language,netflixData:{id:t}})}var rt=[];async function Rt(){S("TWITTER AD CAPTURE"),G((e,t,r,o)=>{try{if(!o||!o.includes("HomeTimeline")&&!(o.includes("/conversation/")&&o.includes("/"+/\\d+$/.exec(window.location.pathname)[0]+".json")))return;let s=Ke(e);rt=rt.concat(s)}catch{}}),await Ye()}function Ke(e){let t=JSON.parse(e);return([].concat.apply([],t?.data?.home?.home_timeline_urt?.instructions?.filter?.(s=>s?.type=="TimelineAddEntries")?.map?.(s=>s.entries))||[]).map(s=>s.content?.itemContent).filter(s=>s?.promotedMetadata).map(s=>{let u=s.tweet_results?.result?.card?.legacy?.binding_values?.filter?.(f=>f?.key=="unified_card")?.map?.(f=>JSON.parse(f.value?.string_value))?.[0],h=u?.destination_objects?.browser_1?.data?.url_data?.url||u?.destination_objects?.browser_with_docked_media_1?.url_data?.url;return{id_str:s?.tweet_results?.result?.rest_id,screen_name:s?.tweet_results?.result?.core?.user_results?.result?.legacy?.screen_name,cardDestination:h,advertiserId:s?.promotedMetadata?.advertiser_results?.result?.rest_id,user_id_str:s?.tweet_results?.result?.legacy?.user_id_str}}).filter(s=>s.id_str&&s.screen_name)}async function Ye(){if(!nt)return;let e=await Qe(document,rt),t=e.map(r=>r.twitterData.tid);rt=rt.filter(r=>!t.includes(r.id_str)),N(e)}async function Qe(e,t){let r="div.tweet.promoted-tweet",o=Array.from(e.querySelectorAll(r));o.length||(o=Array.from(e.querySelectorAll("article div>svg")).map(u=>u.parentElement.querySelector("span")).filter(u=>u?.textContent&&u.textContent.length<50).map(u=>u.closest("article"))),o.length||(o=Array.from(document.querySelectorAll("span")).filter(u=>u.textContent==="Ad").map(u=>u.closest("article")));let s=[];for(let u=0;u<o.length;u++){let h=o[u],f=Array.from(h.querySelectorAll("div>span,a span")).map(b=>b.textContent).filter(b=>b?.startsWith("@"))[0];f=f.startsWith("@")?f.substring(1):f;let p=null,m=null;for(m of t)if(m.screen_name==f&&(p=m.id_str,p))break;if(!p)continue;let g=mt(h);g&&(g=g.replace(new RegExp("# (\\\\w)","gi"),"#$1"));let w=U(h),v=new _({x:w.left,y:w.top,width:w.width,height:w.height,text:g,sourceUrls:(await Q(h.querySelector(".tweet-details-fixer")||h)).concat([new y({url:m.cardDestination,urlType:8})]).filter(b=>b.url&&!b.url.includes("/profile_images/")&&!b.url.includes(p+"/retweets")&&!b.url.includes(p+"/likes")&&!b.url.includes("/using-twitter/how-to")),hash:("t+++"+p).padEnd(p.length+4+(p.length+4)*6%8/2,"=").replace("===","A=="),type:h.querySelector("video")||h.querySelector(".PlayableMedia")?105:Array.from(h.querySelectorAll("img")).filter(b=>b.naturalWidth>200&&b.naturalHeight>40).length?104:h.querySelector("iframe")?102:103,twitterData:{taid:m.advertiserId||m.user_id_str||0,tid:p,tsn:f}}),R=(v.sourceUrls||[]).filter(b=>b?.url);v.sourceUrls=lt(R,b=>b.url),s.push(v)}return s}function Pt(){S("VAST AD CAPTURE"),G((e,t,r)=>{try{let o=e.substring(0,500),s=o.indexOf(\'"ad_id":\')>=0||o.indexOf(\'"ad_type"\')>=0,u=[];if(r||s)Ze(e,u);else if(o.indexOf("<VAST ")>=0||o.indexOf("<vmap:AdBreak ")>=0){let h=E(()=>t?.documentElement||e&&new DOMParser().parseFromString(e,"application/xml").documentElement);tr(h,u)}else return;Promise.allSettled(u).then(h=>{S("Ads found.",h.map(f=>f.value)),N(h.map(f=>f.value).filter(f=>f))})}catch(o){S(o)}})}function Ze(e,t){let r=E,o=r(()=>e&&JSON.parse(e)),s=r(()=>o.items);s?.length&&Array.from(s).forEach(u=>{let h=r(()=>u.media.streamurl);if(!h)return;let f=r(()=>u.clickthrough),p=r(()=>u.media.duration),m=r(()=>u.ad_id||u.ad_video_id),g=r(()=>u.title);m&&F()==="peacocktv.com"&&(m=m.split(".")[0]);let w=r(()=>u.system);t.push(j(h,M).then(v=>new _({width:1920,height:1080,sourceUrls:[new y({url:h,urlType:4}),new y({url:f,urlType:8}),new y({url:"http://"+w,urlType:1})].filter(b=>b.url),hash:btoa(v)||m,type:3,duration:Math.round(p),vastData:{Id:m,Title:g,System:w}})))})}function tr(e,t){let r=E,o=r(()=>e?.querySelectorAll("VAST Ad"));o&&Array.from(o).forEach(s=>{let u=s.querySelector("Creatives Creative");if(!u)return;let h=u.querySelector("MediaFiles");if(!h)return;let f=r(()=>u.querySelector("VideoClicks ClickThrough").textContent.trim())||r(()=>document.querySelector(".AdUnitView a").href.trim()),p=r(()=>Tt(u.querySelector("Duration").textContent)),m=r(()=>h.querySelector("MediaFile[type=\'video/mp4\'],MediaFile[type=\'application/dash+xml\'],MediaFile[type=\'video/mpd\']").textContent.trim());if(!m){let l=u.querySelector("AdParameters"),i={},n,c=new RegExp("<(\\\\w+)>([^<]+)</\\\\1>","gi");for(;(n=c.exec(l.textContent))!==null;)i[n[1]]=n[2];p=r(()=>Tt(i.adDuration)),f=r(()=>i.clickUrl);let a=i.JsParameters;if(!a)return;let x=JSON.parse(a);m=r(()=>x.videos[0].url),m&&(p=p||x.duration,f=f||x.clickThruUrl||x.clickThroughUrl)}if(!m)return;let g=u.getAttribute("AdID")||u.getAttribute("AdId")||u.getAttribute("adid")||s.getAttribute("id");if(!g)return;F()==="peacocktv.com"&&(g=g.split(".")[0]);let w=r(()=>s.querySelector("AdTitle").textContent.trim()),v=r(()=>s.querySelector("AdSystem").textContent.trim()),R=s.querySelector("Extension"),b=r(()=>R.querySelector("CreativeParameter[name=\'_fw_advertiser_name\']").textContent.trim())||r(()=>R.querySelector("CreativeParameter[name=\'fw_advertiser_name\']").textContent.trim())||r(()=>R.querySelector("CreativeParameter[name=\'fw_advertiser\']").textContent.trim()),q=r(()=>R.querySelector("CreativeParameter[name=\'fw_brand\']").textContent.trim()),A=r(()=>R.querySelector("CreativeParameter[name=\'industry\']").textContent.trim()),d=r(()=>R.querySelector("CreativeParameter[name=\'ccr_measurement\']").textContent.trim());t.push(j(m,M).then(l=>new _({width:1920,height:1080,sourceUrls:[new y({url:m,urlType:4}),new y({url:f,urlType:8}),new y({url:d,urlType:0})].filter(i=>i.url),hash:btoa(l)||g,type:3,duration:Math.round(p),vastData:{Id:g,Adv:b,Brand:q,Cat:A,Title:w,System:v}})))})}var ae=Vt(vt(),1);function er(e){return e?new URL(e).searchParams.get("v"):null}var Mt;function wt(){return Mt||(Mt=document.querySelector("#movie_player")),Mt}function rr(){return E(()=>{let e=JSON.parse(wt().getDebugText());return e.ad_debug_videoId||e.addebug_videoId||e.ad_videoId})}function nr(){return E(()=>{let e=document.querySelector("#upload-info a.yt-simple-endpoint"),t=e.href.split("/");return{youTubeChannelId:t[t.length-1],youTubeChannelName:e.textContent.trim(),youTubeVideoId:E(()=>er(window.location.href))}})}function ir(){let e=E(()=>document.querySelector(".ytp-ad-player-overlay-instream-info .ytp-ad-button-text").textContent);if(e&&ar.test(e)){let t=e.indexOf("http://")===0||e.indexOf("https://")===0?e:"https://"+e.toLowerCase();return new y({url:t,urlType:8})}return null}function or(e){return e?btoa(ae.default.hash("YouTube+"+e,!0)):null}function sr(){return E(()=>wt().getAdState()>0||JSON.parse(wt().getDebugText()).addebug_videoId)}var ar=new RegExp("^(?:https?://)?[a-z0-9.-]+(\\\\.[a-z]+)+(?:$|/)"),ce={};function se(e){[e?.playerAds??[],e?.adPlacements??[]].flat().map(t=>(t.adPlacementRenderer?.renderer?.linearAdSequenceRenderer?.linearAds?.map(r=>r?.instreamVideoAdRenderer)??[]).concat([t.adPlacementRenderer?.renderer?.instreamVideoAdRenderer])).flat().filter(t=>t).map(function(t){let r=t?.playerOverlay?.instreamAdPlayerOverlayRenderer?.visitAdvertiserRenderer?.buttonRenderer?.navigationEndpoint?.urlEndpoint?.url;return r?{videoId:t.externalVideoId,lp:r}:null}).filter(t=>t).reduce((t,r)=>Object.assign(t,{[r.videoId]:new y({url:r.lp,urlType:8})}),ce)}function ue(){try{if(G((p,m,g,w)=>{try{if(!w||!w.includes("/ad_break?")&&!w.includes("/player?"))return;se(JSON.parse(p))}catch(v){S(v)}}),!sr())return B();se(window.ytInitialPlayerResponse);let e=0,t=640,r=360,o=0,s=0,u=wt(),h=u.querySelector("a.ytp-title-link"),f=u.querySelector("video");if(f){e=f.duration||0;let p=U(f);t=p?.width||t,r=p?.height||r,o=p?.left||o,s=p?.top||s}P(()=>{let p=rr()||void 0,m=ce[p]??ir(),g=nr(),w=m?[m]:[],v=new _({x:o,y:s,width:t,height:r,text:h?.textContent,sourceUrls:w,hash:or(p),type:3,duration:Math.round(e),youTubeId:p});N([v],g)})}catch(e){S(e)}}var it=class{constructor(t=null){this.log=t,this.#t.log=t??(()=>{})}simplifyTree(t){let r;for(;;){if(r=this.#t[t.r],!r)throw new Error(`Rule ${t.r} not implemented.`);if(r!==this.#t.PassOn||!t.c||!t.c.length)break;t=t.c[0]}return t.c&&t.c.length&&(t.c=t.c.map(o=>this.simplifyTree(o))),t}debugPrintParseTree(t,r=0){this.log(`${" ".repeat(r*2)}${t.r}: ${this.#t.GetText(t)}`),t.c&&t.c.length&&t.c.forEach(o=>this.debugPrintParseTree(o,r+1))}isValidRuleName(t){return t.indexOf("TerminalNode")===0||!!this.#t[t]}evaluate(t,r){return this.#t.evaluate(t,r)}#t=class{static#s=0;static evaluate(t,r,o){try{if(!this[t.r])throw new Error(t.r+" is not a parser rule function.");return this[t.r](t,r,o)}catch(s){this.log("Error "+t.r+\' at "\'+this.GetText(t)+\'": \'+s)}}static#i=new RegExp(`(?:^[\'"])|(?:[\'"]$)`,"g");static#o=new RegExp("\\\\s+","g");static#a=this;static PassOn(t,r){return this.evaluate(t.c[0],r)}static NoOp(t){this.log(`Unimplemented rule: ${t.r} at "${this.GetText(t.t)}".`)}static ExpStmt=this.PassOn;static ExpSequence=this.PassOn;static LitExp=this.PassOn;static Literal=this.PassOn;static ArrayLitExp=this.PassOn;static ArrayLit=this.PassOn;static ArrowFuncBody=this.PassOn;static ObjectLitExp=this.PassOn;static IdName=this.PassOn;static MultOperator=this.NoOp;static AdditionOperator=this.NoOp;static RelationalOperator=this.NoOp;static EqualityOperator=this.NoOp;static ReservedWord=this.NoOp;static AssignExp=this.NoOp;static VarModifier=this.NoOp;static FormalParameterList=this.NoOp;static FormalParameterArg=this.NoOp;static PropAssign=this.NoOp;static Exp=this.NoOp;static Assignable=this.NoOp;static AnonFunc=this.NoOp;static ArrowFuncParameters=this.NoOp;static PropName(t){return t.c?t.c[0].t:this.#r(t.t)}static ObjectLit(t,r){let o={};return t.c.forEach(s=>this.PropExpAssign(s,r,o)),o}static PropExpAssign(t,r,o){let s=this.evaluate(t.c[0],r),u=this.evaluate(t.c[1],r);o[s]=u}static#r(t){return t?.replaceAll(this.#i,"")}static StrLit(t){return this.#r(t?.t)}static NumLit(t){return Number.parseFloat(t?.t)}static IntLit(t){return Number.parseInt(t?.t)}static BoolLit(t){return t.t&&t.t=="true"}static NullLit(){return null}static IdExp(t,r){return this.evaluate(t.c[0],r)}static Id(t,r){return r[t.t]}static FuncExp(t,r){return this.evaluate(t.c[0],r)}static ArrowFunc(t,r){let o=t.c[0]?.c?.map(u=>this.#e(u)).flat(),s=this;return function(...u){o.forEach((f,p)=>{r[f]=u[p]});let h=s.evaluate(t.c[1],r);return o.forEach(f=>{delete r[f]}),h}}static AnonFuncDecl(t,r){let o=t.c[0]?.c?.map(u=>this.#e(u)).flat(),s=this;return function(...u){o.forEach((f,p)=>{r[f]=u[p]});let h=s.evaluate(t.c[1],r);return o.forEach(f=>{delete r[f]}),h}}static#e(t,r=null){return r=r??[],t.c?.forEach(o=>this.#e(o,r)),t.t&&r.push(t.t),r}static#c(t,r=0){this.log(`${"  ".repeat(r)}${t.r}: ${this.GetText(t)}`)}static GetText(t){return this.#e(t).join(" ")}static ElementList(t,r){return t.c.map(o=>this.evaluate(o,r))}static ArrayElem=this.PassOn;static ArgsExp(t,r){let o=t.c[0],s=this.evaluate(t.c[1],r),u=this.evaluate(o,r,s);return typeof u=="function"&&(u=u.apply(o._this??null,s)),delete o._this,u}static Args(t,r){return t.c.map(o=>this.evaluate(o,r))}static Arg(t,r){return this.evaluate(t.c[0],r)}static MemberDotExp(t,r,o){return this.#n(t,r,o,!0)}static MemberIndexExp(t,r,o){return this.#n(t,r,o)}static#n(t,r,o,s){let u=this.evaluate(t.c[0],r),h=s?t.c[1].t:this.evaluate(t.c[1],r);return this["_x_"+h]?this["_x_"+h](u,...o??[]):(t._this=u,u[h])}static ErrorNodeImpl(t){this.log(`Error parsing ${t.r} at ${t.t} (unexpected token?)`)}static AdditiveExp(t,r){switch(t.c[1].t){case"+":return this.evaluate(t.c[0],r)+this.evaluate(t.c[2],r);case"-":return this.evaluate(t.c[0],r)-this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static MultiplicativeExp(t,r){switch(t.c[1].t){case"*":return this.evaluate(t.c[0],r)*this.evaluate(t.c[2],r);case"/":return this.evaluate(t.c[0],r)/this.evaluate(t.c[2],r);case"%":return this.evaluate(t.c[0],r)%this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static RelationalExp(t,r){switch(t.c[1].t){case">":return this.evaluate(t.c[0],r)>this.evaluate(t.c[2],r);case"<":return this.evaluate(t.c[0],r)<this.evaluate(t.c[2],r);case">=":return this.evaluate(t.c[0],r)>=this.evaluate(t.c[2],r);case"<=":return this.evaluate(t.c[0],r)<=this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static EqualityExp(t,r){switch(t.c[1].t){case"==":return this.evaluate(t.c[0],r)==this.evaluate(t.c[2],r);case"!=":return this.evaluate(t.c[0],r)!=this.evaluate(t.c[2],r);case"===":return this.evaluate(t.c[0],r)===this.evaluate(t.c[2],r);case"!==":return this.evaluate(t.c[0],r)!==this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static TernaryExp(t,r){return this.evaluate(t.c[0],r)?this.evaluate(t.c[1],r):this.evaluate(t.c[2],r)}static CoalesceExp(t,r){return this.evaluate(t.c[0],r)??this.evaluate(t.c[1],r)}static InstanceofExp(t,r){return this.evaluate(t.c[0],r)instanceof this.evaluate(t.c[1],r)}static LogicalAndExp(t,r){return this.evaluate(t.c[0],r)&&this.evaluate(t.c[1],r)}static LogicalOrExp(t,r){return this.evaluate(t.c[0],r)||this.evaluate(t.c[1],r)}static UnaryPlusExp(t,r){return+this.evaluate(t.c[0],r)}static UnaryMinusExp(t,r){return-this.evaluate(t.c[0],r)}static BitNotExp(t,r){return~this.evaluate(t.c[0],r)}static NotExp(t,r){return!this.evaluate(t.c[0],r)}static ParenthesizedExp(t,r){return this.evaluate(t.c[0],r)}static Eos(){return null}static _x_query(t,r){return Array.from(t?.querySelectorAll(r)??[])}static _x_where(t,r){return t?.filter(r)}static _x_select(t,...r){let o=r.length;if(!r||o===0)throw new Error("Method \'select\' expects on or more arrow functions.");return t?.map((s,u)=>{if(o>1){let h=[];for(let f=0;f<o-1;f++)h[f]=r[f](s,...f==0?[u]:h);return r[o-1](s,...h)}else return r[0](s,u)})}static _x_width(t){return t?.offsetWidth}static _x_height(t){return t?.offsetHeight}static _x_text(t){return t?.textContent?.trim()?.replaceAll(this.#o," ")}static _x_parent(t){return t?.parentNode}static _x_matchRegExp(t,r,o){return t.match(new RegExp(r,o))}}};function Ot(e){if(e.checkVisibility&&!e.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}))return!1;let t=e.ownerDocument,r=t.defaultView,o=r?.getComputedStyle(e);if(o&&(o.opacity==="0"||o.visibility==="hidden"))return!1;let s=e.getBoundingClientRect();if(!s||s.width<=0||s.height<=0)return!1;let{top:u,left:h,right:f,bottom:p}=s;if(f<0||p<0)return!1;let m=r?.innerWidth||t.documentElement.clientWidth,g=r?.innerHeight||t.documentElement.clientHeight;if(u>g||h>m)return!1;let w=e.parentNode;if(w&&w instanceof Element&&getComputedStyle(w).overflow==="hidden"){let v=w.getBoundingClientRect();if(p<v.top||u>v.bottom||f<v.left||h>v.right)return!1}return!0}function le(e,t){return r=>new Promise(o=>{let s=e+"-response",u=Math.random(),h=p=>{let{type:m,payload:g,nonce:w}=p.data??{};m!==s||w!==u||(o(g),f())},f=()=>{window.removeEventListener("message",h)};window.addEventListener("message",h),s==="getFrameId-response"?r.postMessage(new T("getFrameId",u),"*"):window.postMessage({type:e,nonce:u,payload:r},"*"),t&&setTimeout(o,t)})}var de,fe,pe,J,_t=new Set,bt=new Set,Ft=new Set,at=!1,Ut=[],me=[],Nt,M,D,gt,nt,C=typeof window>"u"?{location:{hostname:""}}:window,I=C.top===C.self,cr=(Math.random()+1).toString(36).substring(2),ur=2e3,ge=7e3,lr=5*ge,hr=2e3;function st(e,t,...r){let o=setTimeout(e,t,...r);return _t.add(o),o}function ot(e,t,...r){let o=setInterval(e,t,...r);return bt.add(o),o}function Lt(e,t){let r=P(e,t);return r.isIdleCallback?Ft.add(r.id):_t.add(r.id),r}var dr={"hulu.com":[ne],"netflix.com":[oe],"twitter.com":[Rt],"x.com":[Rt],"youtube.com":[ue]};at||(typeof F<"u"&&(J=F()),typeof pt<"u"&&(pt()||ye())&&Yt());function ye(){return dr[J]}function fr(){if(!I||!nt)return;if(pt()){Pt();let s=new Set,u=()=>{let h=Array.from(C.frames).concat(Array.from(document.querySelectorAll("frame,iframe")).map(f=>E(f.contentWindow)).filter(f=>f));for(let f=0;f<h.length;f++)try{let p=h[f];if(!p||s.has(p))continue;W(p,new T(Ct,et-(Date.now()-$))),s.add(p)}catch(p){S(p)}};u(),ot(u,5e3)}let e=Date.now(),t=ye(),r=function(s){e=Date.now(),Lt(async()=>{for(let u=0,h=t?.length;t&&u<h;u++)await t[u].call();I&&(t||s)&&B()},V-500)},o=ot(r,V);r(!0),ot(()=>{Date.now()-e>V*5&&(clearInterval(o),bt.delete(o),o=ot(r,V),r(!0))},V)}function we(){I&&(J=F(),_t=new Set,bt=new Set,Ft=new Set,ee(),B())}function pr(){if(!I)return;let e=D.AdRules.filter(o=>!o.Hostnames||o.Hostnames.startsWith("^")&&!o.Hostnames.includes(J)),t=D.AdRules.filter(o=>o.Hostnames&&!o.Hostnames.startsWith("^")&&o.Hostnames.includes(J)),r=e.concat(t);st(()=>{Pr();let o=ot(()=>{he(r)},ge);he(r),st(()=>{t.length?r=t:clearInterval(o)},lr)},ur)}var mr=new Set(["facebook.com","hulu.com","netflix.com","twitter.com","x.com"]);function Ae(){fr(),mr.has(J)||pr(),st(wr,et)}function gr(e){if(!I)return;let t=C.location.href.split("#")[0];setInterval(()=>{let r=C.location.href.split("#")[0];r!==t&&(t=r,e())},1e3)}function _e(){_t.forEach(e=>clearTimeout(e)),bt.forEach(e=>clearInterval(e)),Ft.forEach(e=>cancelIdleCallback(e))}function yr(){_e(),we(),Ae()}function wr(){It(),_e()}function Ar(e){at?ut(e,M).then(()=>window.dispatchEvent(new CustomEvent("displayAdFound",{detail:e}))):te(e)}async function _r(e){try{let t=T.fromObject(e.data);if(!t)return;let r=t.data;switch(t.operation){case Ct:r>0&&(Pt(),st(It,r));break;case Et:N(r[0],r[1]);break;case"extractDisplayAd":I||await At(document.documentElement,r);break;case"displayAdFound":I&&Ar(r);break;case"getFrameId":W(e.source,{type:"getFrameId-response",payload:cr,nonce:r});break}}catch(t){S(t);return}}function br(){function e(){C.addEventListener("message",_r,!0)}e();let t=setInterval(e,200);setTimeout(clearInterval,1e4,t)}function xr(e){fe=e.getInstallId,at=e.isRuleEditor,Nt=e.sendData,M=e.fetchHttpResponse,de=e.getExternalConfiguration?t=>e.getExternalConfiguration(t):null,Jt(e.pm_log)}function be(e){pe=le("getFrameId",1e3),M=e.fetchHttpResponse,br(),I&&(xr(e),fe().then(t=>gt=t).then(t=>de()).then(t=>D=t||{EnabledPct:0}).then(t=>{nt=Array.from(gt).map(r=>r.charCodeAt(0)).reduce((r,o)=>r+o,0)%100<D.EnabledPct,nt&&(we(),Ae(),gr(yr))}))}async function vr(e,t){at||(I||(t.dedupeKey=await pe(e.ownerDocument.defaultView)),t.dedupeKey??=`${t.width}x${t.height} @ ${t.x},${t.y}`),W(top,new T("displayAdFound",t))}async function Sr(e,t){if(e){let r=U(e);(t.isFromIFrame||e.nodeName!=="IFRAME")&&(t.x+=r.left,t.y+=r.top),t.sourceUrls.push(...await Q(e,t.depth)),t.text+=mt(e)+" ";let o=Array.from(e.querySelectorAll("canvas, svg"));o.length&&o.forEach(s=>Kt(s,t))}}async function At(e,t){if(await Sr(e,t),e.nodeName==="IFRAME"){t.depth++,t.outerHtml=e.outerHTML;try{await At(e.contentWindow.document.documentElement,t)}catch{W(e.contentWindow,new T("extractDisplayAd",t));try{var r=e.contentWindow.frames;for(let s=0,u=r.length;s<u;s++)try{W(r[s],new T("extractDisplayAd",t))}catch(h){S(h)}}catch(s){S(s)}}}else{e.nodeName==="HTML"&&(t.outerHtml+=`<!-- IFRAME Content -->${e.outerHTML}`);let o;if(t.isFromIFrame){if(e.scrollWidth<=t.width-5||e.scrollHeight<=t.height-5)return;o=Array.from(e.querySelectorAll("iframe")).filter(s=>(s.scrollWidth>=t.width||s.scrollHeight>=t.height)&&s.scrollWidth>=_.minWidth&&s.scrollHeight>=_.minHeight&&Ot(s))}else o=Array.from(e.querySelectorAll("iframe")).filter(s=>Ot(s)).sort((s,u)=>s.scrollWidth*s.scrollHeight-u.scrollWidth*u.scrollHeight).slice(0,1);o?.length?await Promise.allSettled(o.map(s=>{let u={...t,width:Math.min(t.width,s.offsetWidth),height:Math.min(t.height,s.offsetHeight),sourceUrls:t.sourceUrls.map(h=>h)};return At(s,u)})):(t.text=t.textOverride??t.text.trim(),vr(e,t))}}function Er(e,t,r){try{let o=new it,s=o.evaluate(t,{doc:document});Ut.forEach(u=>s.push(...o.evaluate(t,{doc:u}))),me.forEach(u=>{u.doc.defaultView&&s.push(...o.evaluate(t,{doc:u.doc}).map(h=>xe(h)?(h.x??=u.x,h.y??=u.y,h.depth??=u.depth,h):{element:h,x:u.x,y:u.y,depth:u.depth}))}),s&&s.forEach(async u=>await Ir(e,u,r))}catch{}}function Cr(e){e.forEach(t=>Er(t.Id,t.ParseTree))}async function Ir(e,t,r){let o={};xe(t)&&(o=t,t=t.element,delete o.element);let s=new _({width:t.offsetWidth,height:t.offsetHeight,adRuleId:e});s.isFromIFrame=t.nodeName==="IFRAME",at&&(s.adRuleName=r,s.tabUrl=location.href),Object.assign(s,o),await At(t,s)}function he(e){I&&Lt(t=>{t.didTimeout||(Cr(e),st(B,hr))},4e3)}function Tr(e){let t=Date.now(),r=null;for(;r=e[0];){for(var o=null;o=r.nextNode();)if(o.shadowRoot&&(e.push(document.createTreeWalker(o.shadowRoot,NodeFilter.SHOW_ELEMENT)),Ut.push(o.shadowRoot)),Date.now()-t>50)return!1;e.shift()}return!0}function Nr(){Ut=[];let e=[];try{e.push(document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT))}catch{}let t=!1,r=0;for(;!t&&r++<100;)Lt(()=>t||=Tr(e))}function Rr(){me=Array.from(document.querySelectorAll("iframe")).filter(e=>e.src&&new URL(e.src).origin==top.location.origin&&e.offsetWidth>=_.minWidth&&e.offsetHeight>=_.minHeight).map(e=>{try{let t=e.contentWindow,r=U(e),o=r.left,s=r.top,u=1;for(;t?.parent&&t.parent!==top;)t=t.parent,r=U(t.frameElement),o+=r.left,s+=r.top,u++;return{doc:e.contentDocument,x:o,y:s,depth:u}}catch{return null}}).filter(e=>e)}function Pr(){Nr(),Rr()}function xe(e){return!(e instanceof Node)&&e.element}function ve(...e){console.log("[injected-script]",...Array.isArray(e)?e:[e])}function xt(e,t){return r=>new Promise(o=>{let s=t+"-response",u=Math.random(),h=p=>{let{type:m,payload:g,nonce:w}=p.data??{};m!==s||w!==u||(e?.("Got response:",{name:t,payload:r,response:g}),o(g),f())},f=()=>{window.removeEventListener("message",h)};window.addEventListener("message",h),e?.("Sending message:",{name:t,payload:r}),window.postMessage({type:t,payload:r,nonce:u},"*")})}function Se(e,t){return r=>{e?.("Sending message:",{type:t,payload:r}),window.postMessage({type:t,payload:r},"*")}}var Ee="ads#INIT",Ce="ads#SEND_DATA",Ie="ads#GET_INSTALL_ID",Te="ads#GET_EXTERNAL_CONFIG",Ne="ads#FETCH_HTTP_RESPONSE";function Re(e){let t=e.enableLogs?ve:void 0;t?.("Recieved init event",{config:e});let r=Se(t,Ce),o=xt(t,Ie),s=xt(t,Te),u=xt(t,Ne);be({getInstallId:o,fetchHttpResponse:u,sendData:r,pm_log:t,getExternalConfiguration:s})}function Mr(){window.addEventListener("message",({data:e})=>{e?.type===Ee&&Re(e.payload)})}Mr();})();\n';var ji=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Fi={exports:{}};(function(e,t){(function(n,r){r(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ji,function(n){var r,s;if(!((s=(r=globalThis.chrome)==null?void 0:r.runtime)!=null&&s.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const i="The message port closed before a response was received.",a=l=>{const o={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(o).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class c extends WeakMap{constructor(_,O=void 0){super(O),this.createItem=_}get(_){return this.has(_)||this.set(_,this.createItem(_)),super.get(_)}}const u=y=>y&&typeof y=="object"&&typeof y.then=="function",h=(y,_)=>(...O)=>{l.runtime.lastError?y.reject(new Error(l.runtime.lastError.message)):_.singleCallbackArg||O.length<=1&&_.singleCallbackArg!==!1?y.resolve(O[0]):y.resolve(O)},d=y=>y==1?"argument":"arguments",f=(y,_)=>function(O,...R){if(R.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${d(_.minArgs)} for ${y}(), got ${R.length}`);if(R.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${d(_.maxArgs)} for ${y}(), got ${R.length}`);return new Promise((V,x)=>{if(_.fallbackToNoCallback)try{O[y](...R,h({resolve:V,reject:x},_))}catch(P){console.warn(`${y} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,P),O[y](...R),_.fallbackToNoCallback=!1,_.noCallback=!0,V()}else _.noCallback?(O[y](...R),V()):O[y](...R,h({resolve:V,reject:x},_))})},g=(y,_,O)=>new Proxy(_,{apply(R,V,x){return O.call(V,y,...x)}});let m=Function.call.bind(Object.prototype.hasOwnProperty);const A=(y,_={},O={})=>{let R=Object.create(null),V={has(P,p){return p in y||p in R},get(P,p,I){if(p in R)return R[p];if(!(p in y))return;let M=y[p];if(typeof M=="function")if(typeof _[p]=="function")M=g(y,y[p],_[p]);else if(m(O,p)){let j=f(p,O[p]);M=g(y,y[p],j)}else M=M.bind(y);else if(typeof M=="object"&&M!==null&&(m(_,p)||m(O,p)))M=A(M,_[p],O[p]);else if(m(O,"*"))M=A(M,_[p],O["*"]);else return Object.defineProperty(R,p,{configurable:!0,enumerable:!0,get(){return y[p]},set(j){y[p]=j}}),M;return R[p]=M,M},set(P,p,I,M){return p in R?R[p]=I:y[p]=I,!0},defineProperty(P,p,I){return Reflect.defineProperty(R,p,I)},deleteProperty(P,p){return Reflect.deleteProperty(R,p)}},x=Object.create(y);return new Proxy(x,V)},S=y=>({addListener(_,O,...R){_.addListener(y.get(O),...R)},hasListener(_,O){return _.hasListener(y.get(O))},removeListener(_,O){_.removeListener(y.get(O))}}),C=new c(y=>typeof y!="function"?y:function(_){const O=A(_,{},{getContent:{minArgs:0,maxArgs:0}});y(O)}),v=new c(y=>typeof y!="function"?y:function(_,O,R){let V=!1,x,P=new Promise(j=>{x=function(U){V=!0,j(U)}}),p;try{p=y(_,O,x)}catch(j){p=Promise.reject(j)}const I=p!==!0&&u(p);return p!==!0&&!I&&!V?!1:((j=>{j.then(U=>{R(U)},U=>{let H;U&&(U instanceof Error||typeof U.message=="string")?H=U.message:H="An unexpected error occurred",R({__mozWebExtensionPolyfillReject__:!0,message:H})}).catch(U=>{console.error("Failed to send onMessage rejected reply",U)})})(I?p:P),!0)}),w=({reject:y,resolve:_},O)=>{l.runtime.lastError?l.runtime.lastError.message===i?_():y(new Error(l.runtime.lastError.message)):O&&O.__mozWebExtensionPolyfillReject__?y(new Error(O.message)):_(O)},k=(y,_,O,...R)=>{if(R.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${d(_.minArgs)} for ${y}(), got ${R.length}`);if(R.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${d(_.maxArgs)} for ${y}(), got ${R.length}`);return new Promise((V,x)=>{const P=w.bind(null,{resolve:V,reject:x});R.push(P),O.sendMessage(...R)})},E={devtools:{network:{onRequestFinished:S(C)}},runtime:{onMessage:S(v),onMessageExternal:S(v),sendMessage:k.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:k.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},D={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return o.privacy={network:{"*":D},services:{"*":D},websites:{"*":D}},A(l,E,o)};n.exports=a(chrome)}else n.exports=globalThis.browser})})(Fi);var dc=Fi.exports;const xn=Rs(dc);var Ls={exports:{}};Ls.exports,function(e){var t=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={};function a(o,c){if(!i[o]){i[o]={};for(var u=0;u<o.length;u++)i[o][o.charAt(u)]=u}return i[o][c]}var l={compressToBase64:function(o){if(o==null)return"";var c=l._compress(o,6,function(u){return r.charAt(u)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(o){return o==null?"":o==""?null:l._decompress(o.length,32,function(c){return a(r,o.charAt(c))})},compressToUTF16:function(o){return o==null?"":l._compress(o,15,function(c){return n(c+32)})+" "},decompressFromUTF16:function(o){return o==null?"":o==""?null:l._decompress(o.length,16384,function(c){return o.charCodeAt(c)-32})},compressToUint8Array:function(o){for(var c=l.compress(o),u=new Uint8Array(c.length*2),h=0,d=c.length;h<d;h++){var f=c.charCodeAt(h);u[h*2]=f>>>8,u[h*2+1]=f%256}return u},decompressFromUint8Array:function(o){if(o==null)return l.decompress(o);for(var c=new Array(o.length/2),u=0,h=c.length;u<h;u++)c[u]=o[u*2]*256+o[u*2+1];var d=[];return c.forEach(function(f){d.push(n(f))}),l.decompress(d.join(""))},compressToEncodedURIComponent:function(o){return o==null?"":l._compress(o,6,function(c){return s.charAt(c)})},decompressFromEncodedURIComponent:function(o){return o==null?"":o==""?null:(o=o.replace(/ /g,"+"),l._decompress(o.length,32,function(c){return a(s,o.charAt(c))}))},compress:function(o){return l._compress(o,16,function(c){return n(c)})},_compress:function(o,c,u){if(o==null)return"";var h,d,f={},g={},m="",A="",S="",C=2,v=3,w=2,k=[],E=0,D=0,y;for(y=0;y<o.length;y+=1)if(m=o.charAt(y),Object.prototype.hasOwnProperty.call(f,m)||(f[m]=v++,g[m]=!0),A=S+m,Object.prototype.hasOwnProperty.call(f,A))S=A;else{if(Object.prototype.hasOwnProperty.call(g,S)){if(S.charCodeAt(0)<256){for(h=0;h<w;h++)E=E<<1,D==c-1?(D=0,k.push(u(E)),E=0):D++;for(d=S.charCodeAt(0),h=0;h<8;h++)E=E<<1|d&1,D==c-1?(D=0,k.push(u(E)),E=0):D++,d=d>>1}else{for(d=1,h=0;h<w;h++)E=E<<1|d,D==c-1?(D=0,k.push(u(E)),E=0):D++,d=0;for(d=S.charCodeAt(0),h=0;h<16;h++)E=E<<1|d&1,D==c-1?(D=0,k.push(u(E)),E=0):D++,d=d>>1}C--,C==0&&(C=Math.pow(2,w),w++),delete g[S]}else for(d=f[S],h=0;h<w;h++)E=E<<1|d&1,D==c-1?(D=0,k.push(u(E)),E=0):D++,d=d>>1;C--,C==0&&(C=Math.pow(2,w),w++),f[A]=v++,S=String(m)}if(S!==""){if(Object.prototype.hasOwnProperty.call(g,S)){if(S.charCodeAt(0)<256){for(h=0;h<w;h++)E=E<<1,D==c-1?(D=0,k.push(u(E)),E=0):D++;for(d=S.charCodeAt(0),h=0;h<8;h++)E=E<<1|d&1,D==c-1?(D=0,k.push(u(E)),E=0):D++,d=d>>1}else{for(d=1,h=0;h<w;h++)E=E<<1|d,D==c-1?(D=0,k.push(u(E)),E=0):D++,d=0;for(d=S.charCodeAt(0),h=0;h<16;h++)E=E<<1|d&1,D==c-1?(D=0,k.push(u(E)),E=0):D++,d=d>>1}C--,C==0&&(C=Math.pow(2,w),w++),delete g[S]}else for(d=f[S],h=0;h<w;h++)E=E<<1|d&1,D==c-1?(D=0,k.push(u(E)),E=0):D++,d=d>>1;C--,C==0&&(C=Math.pow(2,w),w++)}for(d=2,h=0;h<w;h++)E=E<<1|d&1,D==c-1?(D=0,k.push(u(E)),E=0):D++,d=d>>1;for(;;)if(E=E<<1,D==c-1){k.push(u(E));break}else D++;return k.join("")},decompress:function(o){return o==null?"":o==""?null:l._decompress(o.length,32768,function(c){return o.charCodeAt(c)})},_decompress:function(o,c,u){var h=[],d=4,f=4,g=3,m="",A=[],S,C,v,w,k,E,D,y={val:u(0),position:c,index:1};for(S=0;S<3;S+=1)h[S]=S;for(v=0,k=Math.pow(2,2),E=1;E!=k;)w=y.val&y.position,y.position>>=1,y.position==0&&(y.position=c,y.val=u(y.index++)),v|=(w>0?1:0)*E,E<<=1;switch(v){case 0:for(v=0,k=Math.pow(2,8),E=1;E!=k;)w=y.val&y.position,y.position>>=1,y.position==0&&(y.position=c,y.val=u(y.index++)),v|=(w>0?1:0)*E,E<<=1;D=n(v);break;case 1:for(v=0,k=Math.pow(2,16),E=1;E!=k;)w=y.val&y.position,y.position>>=1,y.position==0&&(y.position=c,y.val=u(y.index++)),v|=(w>0?1:0)*E,E<<=1;D=n(v);break;case 2:return""}for(h[3]=D,C=D,A.push(D);;){if(y.index>o)return"";for(v=0,k=Math.pow(2,g),E=1;E!=k;)w=y.val&y.position,y.position>>=1,y.position==0&&(y.position=c,y.val=u(y.index++)),v|=(w>0?1:0)*E,E<<=1;switch(D=v){case 0:for(v=0,k=Math.pow(2,8),E=1;E!=k;)w=y.val&y.position,y.position>>=1,y.position==0&&(y.position=c,y.val=u(y.index++)),v|=(w>0?1:0)*E,E<<=1;h[f++]=n(v),D=f-1,d--;break;case 1:for(v=0,k=Math.pow(2,16),E=1;E!=k;)w=y.val&y.position,y.position>>=1,y.position==0&&(y.position=c,y.val=u(y.index++)),v|=(w>0?1:0)*E,E<<=1;h[f++]=n(v),D=f-1,d--;break;case 2:return A.join("")}if(d==0&&(d=Math.pow(2,g),g++),h[D])m=h[D];else if(D===f)m=C+C.charAt(0);else return null;A.push(m),h[f++]=C+m.charAt(0),d--,C=m,d==0&&(d=Math.pow(2,g),g++)}}};return l}();e!=null&&(e.exports=t)}(Ls);var hc=Ls.exports;const Us=Rs(hc);function gc(e){const t=Us.decompressFromUint8Array(new Uint8Array(e));if(t==null)throw Error("Failed to convert string to ArrayBuffer");return t}async function $i(e){if(!e.byteLength)return"";const t=new Blob([e]),n=await new Promise((r,s)=>{const i=new FileReader;i.onload=()=>{typeof i.result=="string"&&r(i.result),s(Error("Failed to read buffer as string, got "+typeof i.result))},i.onerror=()=>s(i.error),i.onabort=()=>s("FileReader aborted"),i.readAsDataURL(t)});return(n==null?void 0:n.split(",").pop())||""}function fc(e){if(!e)return Promise.resolve(new ArrayBuffer(0));try{const t="data:application/octet-binary;base64,"+e;return fetch(t).then(n=>n.arrayBuffer(),()=>new ArrayBuffer(0))}catch{return Promise.resolve(new ArrayBuffer(0))}}var Xt=(e=>(e.UPLOAD_CRAWL="ads#CRAWL",e.GET_PM_EXTERNAL_CONFIG="ads#GET_EXTERNAL_CONFIGURATION",e.FETCH_HTTP_RESPONSE="ads#FETCH_HTTP_RESPONSE",e))(Xt||{});function Dr(e){try{return JSON.parse(e)}catch{return}}async function pc(e){return(await xn.storage.local.get(e))[e]}async function Wi(e,t){const n={};n[e]=t,await xn.storage.local.set(n)}async function Vi(e,t,n){let r=await(n?null:pc(e));return r==null&&(r=await t(),await Wi(e,r)),r}function Gi(e){return e.split(".").slice(e.endsWith(".uk")||e.endsWith(".jp")?-3:-2).join(".")}async function Hi(e){const t=await Vi("configTs",Date.now),n=Date.now()-t>18e5;return Vi("config",async()=>{const r=await e({type:Xt.GET_PM_EXTERNAL_CONFIG,payload:void 0}),s=Dr(r);if(s!=null)return s.TimeOffset=s.Now&&Date.now()-s.Now||0,mc(s),yc(s),bc(s),Wi("configTs",Date.now()),s},n)}function mc(e){var t;(t=e.AdRules)==null||t.filter(n=>{const r=Us.decompressFromUTF16(n.ParseTreeString||"")??"";return n.ParseTree=Dr(r),n.ParseTree==null?!1:(delete n.ParseTreeString,!0)})}function yc(e){var t;e.ParsedSiteConfigs=(t=e.SiteConfigs)==null?void 0:t.reduce((n,r)=>(n[r.d]=r.r,n),{}),delete e.SiteConfigs}function bc(e){var t;e.ParsedUrlBlackList=(t=e.UrlBlackList)==null?void 0:t.filter(n=>n.BlockAllAds).reduce((n,r)=>{var s;return(n[s=Gi(r.Hostname)]??(n[s]=[])).push(r.UrlRegex),n},{}),delete e.UrlBlackList}function qi(){return window.self===window.top}class vc{constructor(t){this.config=t}async inject(t){return new Promise((n,r)=>{const s=this.defineOnCspError(r),i=()=>{var a,l;try{document.addEventListener("securitypolicyviolation",s);const o=document.createElement(t),c=()=>{var d,f;this.config.keepInDom||o.remove(),(f=(d=this.config).onInjected)==null||f.call(d)},u=this.getManifestVersion();u===3?o.onload=c:setTimeout(c),this.setSrc(o,u),(a=this.config.logger)==null||a.log(o);const h=(l=document.documentElement)==null?void 0:l.firstElementChild;h==null||h.insertBefore(o,h.firstChild),document.removeEventListener("securitypolicyviolation",s),n()}catch(o){r(o)}finally{document.removeEventListener("DOMContentLoaded",i)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i()})}defineOnCspError(t){return n=>{t==null||t(Error("Blocked by CSP: "+JSON.stringify({host:window.location.hostname,blockedUri:n.blockedURI,violatedDirective:n.violatedDirective,originalPolicy:n.originalPolicy})))}}getManifestVersion(){return 3}setSrc(t,n){if(n===3){if(!this.config.mv3Path)throw Error("mv3Path config must be passed for Manifest V3 extensions");t.src=xn.runtime.getURL(this.config.mv3Path)}else if(n===2){if(!this.config.mv2Content)throw Error("mv2Content config must be passed for Manifest V2 extensions");t.innerHTML=this.config.mv2Content}else throw Error(`Unsupported manifest version ${n}`)}}class wc{constructor(t){this.config=t}sendMessage(t,n,r,s){const i={type:t,payload:n,nonce:s};window.postMessage(i,"*",r)}onMessage(t,n){window.addEventListener("message",async r=>{var s,i;const{type:a,payload:l,nonce:o}=r.data??{};if(a!==t)return;(s=this.config.logger)==null||s.debug("[ad-finder-custom-event] Recieved message:",{type:a,payload:l});const c=await n(l);if(c===void 0)return;const{response:u,transferables:h}=c;(i=this.config.logger)==null||i.debug("[ad-finder-custom-event] Sending response:",{name:a,payload:l,response:u}),this.sendMessage(a+this.config.responseSuffix,u,h,o)})}}const Ac="ads#INIT",_c="ads#SEND_DATA",xc="ads#GET_INSTALL_ID",Sc="ads#GET_EXTERNAL_CONFIG",Tc="ads#FETCH_HTTP_RESPONSE",Mr=class Ns{constructor(t){tt(this,"injector"),tt(this,"messenger"),this.config=t,this.injector=new vc({logger:t.logger,keepInDom:t.keepPathmaticsInDom,mv2Content:uc,mv3Path:t.mv3PathmaticsPath,onInjected:this.initPathmaticsScript.bind(this)}),this.messenger=new wc({logger:t.logger,responseSuffix:Ns.MESSENGER_SUFFIX})}async isSupportedSite(){var t,n;const r=Gi(location.hostname);if(!qi())return!(location.hostname===Ns.GOOGLE_AUTH_HOSTNAME||Ns.SUBFRAME_DOMAIN_BLOCKLIST.has(r));const s=await Hi(this.config.sendMessageToBackground);return s!=null?!((n=(t=s.ParsedUrlBlackList)==null?void 0:t[r])!=null&&n.some(i=>new RegExp(i).test(location.href))):!1}async start(){var t,n,r,s,i,a;if(!document.documentElement){(t=this.config.logger)==null||t.log("Page is blank, stopping pathmatics",window.location.hostname);return}const l=await this.isSupportedSite();if((n=this.config.logger)==null||n.log("Is supported site?",l),!l){(r=this.config.logger)==null||r.log("Not supported site, stopping pathmatics",window.location.hostname);return}try{(s=this.config.logger)==null||s.log("Starting Pathmatics ad-finder...",{url:window.location.href}),this.setupMessageListeners(),await this.injector.inject("script"),(i=this.config.logger)==null||i.log("Pathmatics ad-finder injected!")}catch(o){(a=this.config.logger)==null||a.error("Failed to start Pathmatics ad-finder",o)}}setupMessageListeners(){if(xn.storage==null)throw Error("The storage permission is required for pathmatics' ad-finder");this.messenger.onMessage(Tc,async t=>{const n=await this.config.sendMessageToBackground({type:Xt.FETCH_HTTP_RESPONSE,payload:t}),r=await fc(n);return{response:r,transferables:[r]}}),qi()&&(this.messenger.onMessage(xc,async()=>({response:await this.config.getInstallId()})),this.messenger.onMessage(_c,async t=>{var n,r,s,i,a;const l=Dr(t);if(l==null)return;const o=l.crawlId;let c=l.zys??[];if(typeof c=="string"&&(c=Dr(c)),c==null)return;const u=Date.now();for(const h of c){const d={id:`${o}-${h.hash}`,type:"pathmatics",timestamp:u,details:h};(n=this.config.logger)==null||n.log("Ad detected",d);try{await((s=(r=this.config).onAdDetected)==null?void 0:s.call(r,d))}catch(f){(i=this.config.logger)==null||i.error("onAdDetected failed",{err:f})}}await this.config.sendMessageToBackground({type:Xt.UPLOAD_CRAWL,payload:l}).catch((a=this.config.logger)==null?void 0:a.error)}),this.messenger.onMessage(Sc,async()=>({response:await Hi(this.config.sendMessageToBackground)})))}initPathmaticsScript(){var t;(t=this.config.logger)==null||t.log("Initializing script");const n={enableLogs:this.config.enablePathmaticsLogs??!1};this.messenger.sendMessage(Ac,n)}};tt(Mr,"MESSENGER_SUFFIX","-response"),tt(Mr,"SUBFRAME_DOMAIN_BLOCKLIST",new Set(["google.com","okta.com","amazon.com"])),tt(Mr,"GOOGLE_AUTH_HOSTNAME","accounts.youtube.com");let Ec=Mr;const Hn=1e3,Nr={setItem(e,t){try{if(t==null){sessionStorage.removeItem(e);return}sessionStorage.setItem(e,JSON.stringify(t))}catch{return}},getItem(e,t){try{const n=sessionStorage.getItem(e);return n==null?t:JSON.parse(n)}catch{return t}}};function Bs(e){const t=window.location.href;if(!t.includes(e.url))return;const n="ad-finder-captured-urls",r=Nr.getItem(n,[]);if(r.includes(t))return;r.push(t),Nr.setItem(n,r);const s=[],i=e.website+"-session-order";setInterval(()=>{let a=e.finder(document.body,t,e.onAdFound,e.instacartSelectors);a=a.filter(o=>!s.includes(o.title));let l=Nr.getItem(i,0);a.forEach(o=>{o.session_order=++l}),Nr.setItem(i,l),Cc(e,a),a.forEach(o=>{s.push(o.title)})},e.loadDelay||3*Hn)}function Cc(e,t){const n={appId:e.appId,installId:e.installId,website:e.website,ads:t};t.length>0&&e.api.uploadRetailAds(n)}function zi(e){return{...e,logger:e.logger===void 0?console:e.logger??void 0}}function Oc(e,t,n,r){if(!r)return[];const s=Rr(e,r.companyName),i=Dc(e,r.searchTerm);let a=Ic(e,r);a.length===0&&(a=Pc(e,r));const l=[],o=Math.round(Date.now()/Hn);return a.forEach(c=>{const u=Mc(c,5);if(u){const h=Rr(u,r.productTitle),d=Rr(u,r.productSize),f=Rr(u,r.productPrice),g={title:h,size:d,price:f,timestamp:o,store:s,search_url:t,search_term:i};g.title&&(l.push(g),n==null||n(g,u))}}),l}function Rr(e,t){var n;for(const r of t){const s=e.querySelector(r);if(s){const i=(n=s.textContent)==null?void 0:n.trim();if(i)return i}}return""}function Ic(e,t){const n=t.sponsoredRegex.map(s=>{const i=s.slice(s.lastIndexOf("/")+1),a=s.slice(1,s.lastIndexOf("/"));return new RegExp(a,i)}),r=e.querySelectorAll(t.productSelector.join(", "));return Array.from(r).filter(s=>{const i=s.innerHTML,a=s.textContent;return i&&a?n.some(l=>l.test(i)||l.test(a)):!1})}function Pc(e,t){var n;const r=e.querySelectorAll(t.productSelector.join(", ")),s=[];if(r)for(const i of r){const a=(n=i.lastElementChild)==null?void 0:n.previousElementSibling;if(a){const l=a.querySelector("div");l&&kc(l)&&s.push(a)}}return s}function kc(e){if(e.shadowRoot)return!1;try{return e.attachShadow({mode:"open"}),!1}catch{return!0}}function Dc(e,t){for(const n of t){const r=e.querySelector(n);if(r)return r.value||""}return""}function Mc(e,t){let n=e;if(n.getAttribute("aria-label")==="Product")return n;for(let r=0;r<t&&n;r++){const s=n.parentElement;if(s&&s.getAttribute("aria-label")==="Product")return s;n=s}return null}function Nc(e,t,n){const r=e.querySelector('[data-test="@web/Search/SearchInput"]'),s=[],i=Math.round(Date.now()/Hn);return e.querySelectorAll('[data-test="sponsoredText"]').forEach(a=>{if(a){const l=a.closest('[data-test="product-details"]'),o=l==null?void 0:l.querySelector('[data-test="product-title"]'),c=l==null?void 0:l.querySelector('[data-test="current-price"]'),u={title:(o==null?void 0:o.textContent)||"",size:"",price:(c==null?void 0:c.textContent)||"",timestamp:i,store:"",search_url:t,search_term:(r==null?void 0:r.value)||""};u.title&&(s.push(u),n==null||n(u,l))}}),s}function Rc(e,t,n){const r=e.querySelector('input[name="q"]'),s=[],i=Math.round(Date.now()/Hn),a=["current price ","Now ","Was "];return e.querySelectorAll("div[data-item-id]").forEach(l=>{var o,c,u;if(l&&(o=l.textContent)!=null&&o.includes("Sponsored")){const h=l.querySelector('span[data-automation-id="product-title"]'),d=l.querySelector('div[data-automation-id="product-price"]'),f=d==null?void 0:d.querySelector("div:last-child"),g=d==null?void 0:d.querySelectorAll("span");let m=(u=(c=g==null?void 0:g[g.length-1])==null?void 0:c.textContent)==null?void 0:u.trim();for(const S of a)m!=null&&m.startsWith(S)&&(m=m.replace(S,""));const A={title:(h==null?void 0:h.textContent)||"",size:(f==null?void 0:f.textContent)||"",price:m,timestamp:i,store:"",search_url:t,search_term:r.value||""};A.title&&(s.push(A),n==null||n(A,l))}}),s}function Lc(e,t){var n;const r=zi(e);new Ec(r).start().catch((n=r.logger)==null?void 0:n.error),Bs({...t,url:"https://www.walmart.com",website:"walmart",finder:Rc}),Bs({...t,url:"https://www.target.com",website:"target",finder:Nc}),Bs({...t,url:"https://www.instacart.com",website:"instacart",finder:Oc,loadDelay:5*Hn})}var Zi={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(ji,function(){var n=function(i,a){if(a=a||{},typeof i!="function")throw new s("fetch must be a function");if(typeof a!="object")throw new s("defaults must be an object");if(a.retries!==void 0&&!r(a.retries))throw new s("retries must be a positive integer");if(a.retryDelay!==void 0&&!r(a.retryDelay)&&typeof a.retryDelay!="function")throw new s("retryDelay must be a positive integer or a function returning a positive integer");if(a.retryOn!==void 0&&!Array.isArray(a.retryOn)&&typeof a.retryOn!="function")throw new s("retryOn property expects an array or function");var l={retries:3,retryDelay:1e3,retryOn:[]};return a=Object.assign(l,a),function(o,c){var u=a.retries,h=a.retryDelay,d=a.retryOn;if(c&&c.retries!==void 0)if(r(c.retries))u=c.retries;else throw new s("retries must be a positive integer");if(c&&c.retryDelay!==void 0)if(r(c.retryDelay)||typeof c.retryDelay=="function")h=c.retryDelay;else throw new s("retryDelay must be a positive integer or a function returning a positive integer");if(c&&c.retryOn)if(Array.isArray(c.retryOn)||typeof c.retryOn=="function")d=c.retryOn;else throw new s("retryOn property expects an array or function");return new Promise(function(f,g){var m=function(S){var C=typeof Request<"u"&&o instanceof Request?o.clone():o;i(C,c).then(function(v){if(Array.isArray(d)&&d.indexOf(v.status)===-1)f(v);else if(typeof d=="function")try{return Promise.resolve(d(S,null,v)).then(function(w){w?A(S,null,v):f(v)}).catch(g)}catch(w){g(w)}else S<u?A(S,null,v):f(v)}).catch(function(v){if(typeof d=="function")try{Promise.resolve(d(S,v,null)).then(function(w){w?A(S,v,null):g(v)}).catch(function(w){g(w)})}catch(w){g(w)}else S<u?A(S,v,null):g(v)})};function A(S,C,v){var w=typeof h=="function"?h(S,C,v):h;setTimeout(function(){m(++S)},w)}m(0)})}};function r(i){return Number.isInteger(i)&&i>=0}function s(i){this.name="ArgumentError",this.message=i}return n})})(Zi);var Uc=Zi.exports;const Bc=Rs(Uc);function jc(e){return Math.random()*e+e/2}function Fc(e){return Bc(fetch,{retryOn(t,n,r){var s;if(n!==null||r.status>=500)return(s=e.logger)==null||s.log(`retrying, attempt number ${t+1}`),!0},retries:5,retryDelay(t){const n=Math.pow(2,t)*500;return jc(n)}})}let $c=class{constructor(t){tt(this,"fetch"),this.config=t,this.fetch=Fc(t)}async upload(t){var n,r,s;if(!await this.config.isEnabled())return;const i=this.prepareData(t);(n=this.config.logger)==null||n.log("Uploading data:",i);const a=await this.fetch(this.config.crawlUploadUrl,{method:"POST",body:Us.compressToUint8Array(JSON.stringify(i)),headers:{"Content-Type":"application/octet-stream"}}).then(l=>{var o;return(o=this.config.logger)==null?void 0:o.log({status:l.status})}).catch((r=this.config.logger)==null?void 0:r.error);(s=this.config.logger)==null||s.log("Response:",a)}prepareData(t){return{...t,PartnerVersion:xn.runtime.getManifest().version,ExtensionId:xn.runtime.id,ExtensionVersion:this.config.extensionVersion,UserAgent:navigator.userAgent,BrowserLanguage:navigator.language,BlankZys:null,PanelPartnerId:this.config.panelPartnerId}}};async function Wc(e){const t=await fetch(e).then(n=>n.arrayBuffer());return gc(t)}function Vc(e){const t=zi(e),n=new $c(t);return{async processAdFinderMessage(r){const s=i=>{var a;throw(a=t.logger)==null||a.error("Error handling message from ad-finder: "+JSON.stringify(r),i),i};switch(r.type){case Xt.UPLOAD_CRAWL:return n.upload(r.payload).catch(s);case Xt.GET_PM_EXTERNAL_CONFIG:return Wc(`${e.pmExternalConfigUrl}?installId=${await e.getInstallId()}`).catch(s);case Xt.FETCH_HTTP_RESPONSE:return fetch(r.payload).then(i=>{const a=parseInt(i.headers.get("Content-Length")??"");return!isNaN(a)&&a>1<<25?new ArrayBuffer(0):i.arrayBuffer()}).then(i=>i.byteLength>1<<25?$i(new ArrayBuffer(0)):$i(i))}}}}const Pt={initAPI(e){return e.mixin("Object",this)},merge:function(e,t,n=!1){return n?Object.assign(!0,e,t):Object.assign(e,t)},lookup:function(e,t){const n=e.split("."),r=n.pop(),s=n.length;let i=1,a=n[0];for(;(t=t[a])&&i<s;)a=n[i],i+=1;if(t)return t[r]},isObjLiteral:function(e){return typeof e=="object"&&e!==null&&typeof e.length>"u"},isArray:function(e){return typeof e=="object"&&e!==null&&typeof e.length<"u"},isJSON:function(e){try{JSON.parse(e)}catch{return!1}return!0},sort:function(e){const t=[],n={};for(const r in e)e.hasOwnProperty(r)&&t.push(r);t.sort();for(let r=0;r<t.length;r++){const s=t[r];n[s]=e[s]}return n}};var Ki=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Yi={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(self,()=>(()=>{var n={11:a=>{class l{constructor(c,u,h,d=new Date){this.type=h,this.message=c,this.metadata=u,this.timestamp=d}toJSON(){return{type:this.type,name:this.message,timestamp:this.timestamp,metaData:this.metadata}}}a.exports=l},953:(a,l,o)=>{const c=o(510),u=o(750),h=o(11),d=o(743),f=o(964),g=o(566),m=o(58),A=o(611),S=o(929),C=o(795),v=o(698),w=o(987),k=o(100),E=o(377),{add:D,clear:y,merge:_}=o(908),O=()=>{};class R{constructor(p,I=c.schema,M=[],j){this._notifier=j,this._config={},this._schema=I,this._delivery={sendSession:O,sendEvent:O},this._logger={debug:O,info:O,warn:O,error:O},this._plugins={},this._breadcrumbs=[],this._session=null,this._metadata={},this._featuresIndex={},this._features=[],this._context=void 0,this._user={},this._cbs={e:[],s:[],sp:[],b:[]},this.Client=R,this.Event=u,this.Breadcrumb=h,this.Session=d,this._config=this._configure(p,M),f(M.concat(this._config.plugins),q=>{q&&this._loadPlugin(q)}),this._depth=1;const U=this,H=this.notify;this.notify=function(){return H.apply(U,arguments)}}addMetadata(p,I,M){return w.add(this._metadata,p,I,M)}getMetadata(p,I){return w.get(this._metadata,p,I)}clearMetadata(p,I){return w.clear(this._metadata,p,I)}addFeatureFlag(p,I=null){D(this._features,this._featuresIndex,p,I)}addFeatureFlags(p){_(this._features,p,this._featuresIndex)}clearFeatureFlag(p){y(this._features,this._featuresIndex,p)}clearFeatureFlags(){this._features=[],this._featuresIndex={}}getContext(){return this._context}setContext(p){this._context=p}_configure(p,I){const M=A(I,(H,q)=>q&&q.configSchema?C({},H,q.configSchema):H,this._schema),{errors:j,config:U}=A(S(M),(H,q)=>{const xe=M[q].defaultValue(p[q]);return p[q]!==void 0?M[q].validate(p[q])?M[q].allowPartialObject?H.config[q]=C(xe,p[q]):H.config[q]=p[q]:(H.errors[q]=M[q].message,H.config[q]=xe):H.config[q]=xe,H},{errors:{},config:{}});if(M.apiKey){if(!U.apiKey)throw new Error("No Bugsnag API Key set");/^[0-9a-f]{32}$/i.test(U.apiKey)||(j.apiKey="should be a string of 32 hexadecimal characters")}return this._metadata=C({},U.metadata),_(this._features,U.featureFlags,this._featuresIndex),this._user=C({},U.user),this._context=U.context,U.logger&&(this._logger=U.logger),U.onError&&(this._cbs.e=this._cbs.e.concat(U.onError)),U.onBreadcrumb&&(this._cbs.b=this._cbs.b.concat(U.onBreadcrumb)),U.onSession&&(this._cbs.s=this._cbs.s.concat(U.onSession)),S(j).length&&this._logger.warn(V(j,p)),U}getUser(){return this._user}setUser(p,I,M){this._user={id:p,email:I,name:M}}_loadPlugin(p){const I=p.load(this);return p.name&&(this._plugins[`~${p.name}~`]=I),this}getPlugin(p){return this._plugins[`~${p}~`]}_setDelivery(p){this._delivery=p(this)}startSession(){const p=new d;return p.app.releaseStage=this._config.releaseStage,p.app.version=this._config.appVersion,p.app.type=this._config.appType,p._user=C({},this._user),k(this._cbs.s,p,"onSession",this._logger)?(this._logger.debug("Session not started due to onSession callback"),this):this._sessionDelegate.startSession(this,p)}addOnError(p,I=!1){this._cbs.e[I?"unshift":"push"](p)}removeOnError(p){this._cbs.e=m(this._cbs.e,I=>I!==p)}_addOnSessionPayload(p){this._cbs.sp.push(p)}addOnSession(p){this._cbs.s.push(p)}removeOnSession(p){this._cbs.s=m(this._cbs.s,I=>I!==p)}addOnBreadcrumb(p,I=!1){this._cbs.b[I?"unshift":"push"](p)}removeOnBreadcrumb(p){this._cbs.b=m(this._cbs.b,I=>I!==p)}pauseSession(){return this._sessionDelegate.pauseSession(this)}resumeSession(){return this._sessionDelegate.resumeSession(this)}leaveBreadcrumb(p,I,M){if(p=typeof p=="string"?p:"",M=typeof M=="string"&&g(E,M)?M:"manual",I=typeof I=="object"&&I!==null?I:{},!p)return;const j=new h(p,I,M);if(k(this._cbs.b,j,"onBreadcrumb",this._logger)){this._logger.debug("Breadcrumb not attached due to onBreadcrumb callback");return}this._breadcrumbs.push(j),this._breadcrumbs.length>this._config.maxBreadcrumbs&&(this._breadcrumbs=this._breadcrumbs.slice(this._breadcrumbs.length-this._config.maxBreadcrumbs))}_isBreadcrumbTypeEnabled(p){const I=this._config.enabledBreadcrumbTypes;return I===null||g(I,p)}notify(p,I,M=O){const j=u.create(p,!0,void 0,"notify()",this._depth+1,this._logger);this._notify(j,I,M)}_notify(p,I,M=O){if(p.app=C({},p.app,{releaseStage:this._config.releaseStage,version:this._config.appVersion,type:this._config.appType}),p.context=p.context||this._context,p._metadata=C({},p._metadata,this._metadata),p._user=C({},p._user,this._user),p.breadcrumbs=this._breadcrumbs.slice(),_(p._features,this._features,p._featuresIndex),this._config.enabledReleaseStages!==null&&!g(this._config.enabledReleaseStages,this._config.releaseStage))return this._logger.warn("Event not sent due to releaseStage/enabledReleaseStages configuration"),M(null,p);const j=p.severity,U=q=>{this._logger.error("Error occurred in onError callback, continuing anyway"),this._logger.error(q)},H=[].concat(this._cbs.e).concat(I);v(H,p,U,(q,xe)=>{if(q&&U(q),!xe)return this._logger.debug("Event not sent due to onError callback"),M(null,p);this._isBreadcrumbTypeEnabled("error")&&R.prototype.leaveBreadcrumb.call(this,p.errors[0].errorClass,{errorClass:p.errors[0].errorClass,errorMessage:p.errors[0].errorMessage,severity:p.severity},"error"),j!==p.severity&&(p._handledState.severityReason={type:"userCallbackSetSeverity"}),p.unhandled!==p._handledState.unhandled&&(p._handledState.severityReason.unhandledOverridden=!0,p._handledState.unhandled=p.unhandled),this._session&&(this._session._track(p),p._session=this._session),this._delivery.sendEvent({apiKey:p.apiKey||this._config.apiKey,notifier:this._notifier,events:[p]},bt=>M(bt,p))})}}const V=(P,p)=>new Error(`Invalid configuration
${f(S(P),M=>`  - ${M} ${P[M]}, got ${x(p[M])}`).join(`

`)}`),x=P=>{switch(typeof P){case"string":case"number":case"object":return JSON.stringify(P);default:return String(P)}};a.exports=R},510:(a,l,o)=>{const c=o(58),u=o(611),h=o(929),d=o(37),f=o(566),g=o(849),m=o(937),A=o(90),S=o(377),C=()=>({unhandledExceptions:!0,unhandledRejections:!0});a.exports.schema={apiKey:{defaultValue:()=>null,message:"is required",validate:m},appVersion:{defaultValue:()=>{},message:"should be a string",validate:v=>v===void 0||m(v)},appType:{defaultValue:()=>{},message:"should be a string",validate:v=>v===void 0||m(v)},autoDetectErrors:{defaultValue:()=>!0,message:"should be true|false",validate:v=>v===!0||v===!1},enabledErrorTypes:{defaultValue:()=>C(),message:"should be an object containing the flags { unhandledExceptions:true|false, unhandledRejections:true|false }",allowPartialObject:!0,validate:v=>{if(typeof v!="object"||!v)return!1;const w=h(v),k=h(C());return!(c(w,E=>f(k,E)).length<w.length||c(h(v),E=>typeof v[E]!="boolean").length>0)}},onError:{defaultValue:()=>[],message:"should be a function or array of functions",validate:A},onSession:{defaultValue:()=>[],message:"should be a function or array of functions",validate:A},onBreadcrumb:{defaultValue:()=>[],message:"should be a function or array of functions",validate:A},endpoints:{defaultValue:()=>({notify:"https://notify.bugsnag.com",sessions:"https://sessions.bugsnag.com"}),message:"should be an object containing endpoint URLs { notify, sessions }",validate:v=>v&&typeof v=="object"&&m(v.notify)&&m(v.sessions)&&c(h(v),w=>!f(["notify","sessions"],w)).length===0},autoTrackSessions:{defaultValue:v=>!0,message:"should be true|false",validate:v=>v===!0||v===!1},enabledReleaseStages:{defaultValue:()=>null,message:"should be an array of strings",validate:v=>v===null||d(v)&&c(v,w=>typeof w=="string").length===v.length},releaseStage:{defaultValue:()=>"production",message:"should be a string",validate:v=>typeof v=="string"&&v.length},maxBreadcrumbs:{defaultValue:()=>25,message:"should be a number 100",validate:v=>g(0,100)(v)},enabledBreadcrumbTypes:{defaultValue:()=>S,message:`should be null or a list of available breadcrumb types (${S.join(",")})`,validate:v=>v===null||d(v)&&u(v,(w,k)=>w===!1?w:f(S,k),!0)},context:{defaultValue:()=>{},message:"should be a string",validate:v=>v===void 0||typeof v=="string"},user:{defaultValue:()=>({}),message:"should be an object with { id, email, name } properties",validate:v=>v===null||v&&u(h(v),(w,k)=>w&&f(["id","email","name"],k),!0)},metadata:{defaultValue:()=>({}),message:"should be an object",validate:v=>typeof v=="object"&&v!==null},logger:{defaultValue:()=>{},message:"should be null or an object with methods { debug, info, warn, error }",validate:v=>!v||v&&u(["debug","info","warn","error"],(w,k)=>w&&typeof v[k]=="function",!0)},redactedKeys:{defaultValue:()=>["password"],message:"should be an array of strings|regexes",validate:v=>d(v)&&v.length===c(v,w=>typeof w=="string"||w&&typeof w.test=="function").length},plugins:{defaultValue:()=>[],message:"should be an array of plugin objects",validate:v=>d(v)&&v.length===c(v,w=>w&&typeof w=="object"&&typeof w.load=="function").length},featureFlags:{defaultValue:()=>[],message:'should be an array of objects that have a "name" property',validate:v=>d(v)&&v.length===c(v,w=>w&&typeof w=="object"&&typeof w.name=="string").length}}},750:(a,l,o)=>{const c=o(866),u=o(346),h=o(391),d=o(964),f=o(611),g=o(58),m=o(795),A=o(987),S=o(908),C=o(473);class v{constructor(P,p,I=[],M=E(),j){this.apiKey=void 0,this.context=void 0,this.groupingHash=void 0,this.originalError=j,this._handledState=M,this.severity=this._handledState.severity,this.unhandled=this._handledState.unhandled,this.app={},this.device={},this.request={},this.breadcrumbs=[],this.threads=[],this._metadata={},this._features=[],this._featuresIndex={},this._user={},this._session=void 0,this.errors=[y(P,p,v.__type,I)]}addMetadata(P,p,I){return A.add(this._metadata,P,p,I)}getMetadata(P,p){return A.get(this._metadata,P,p)}clearMetadata(P,p){return A.clear(this._metadata,P,p)}addFeatureFlag(P,p=null){S.add(this._features,this._featuresIndex,P,p)}addFeatureFlags(P){S.merge(this._features,P,this._featuresIndex)}getFeatureFlags(){return S.toEventApi(this._features)}clearFeatureFlag(P){S.clear(this._features,this._featuresIndex,P)}clearFeatureFlags(){this._features=[],this._featuresIndex={}}getUser(){return this._user}setUser(P,p,I){this._user={id:P,email:p,name:I}}toJSON(){return{payloadVersion:"4",exceptions:d(this.errors,P=>m({},P,{message:P.errorMessage})),severity:this.severity,unhandled:this._handledState.unhandled,severityReason:this._handledState.severityReason,app:this.app,device:this.device,request:this.request,breadcrumbs:this.breadcrumbs,context:this.context,groupingHash:this.groupingHash,metaData:this._metadata,user:this._user,session:this._session,featureFlags:this.getFeatureFlags()}}}const w=x=>{const P={file:x.fileName,method:k(x.functionName),lineNumber:x.lineNumber,columnNumber:x.columnNumber,code:void 0,inProject:void 0};return P.lineNumber>-1&&!P.file&&!P.method&&(P.file="global code"),P},k=x=>/^global code$/i.test(x)?"global code":x,E=()=>({unhandled:!1,severity:"warning",severityReason:{type:"handledException"}}),D=x=>typeof x=="string"?x:"";function y(x,P,p,I){return{errorClass:D(x),errorMessage:D(P),type:p,stacktrace:f(I,(M,j)=>{const U=w(j);try{return JSON.stringify(U)==="{}"?M:M.concat(U)}catch{return M}},[])}}function _(x){return x.cause?[x,..._(x.cause)]:[x]}v.getStacktrace=function(x,P,p){if(h(x))return c.parse(x).slice(P);try{return g(u.backtrace(),I=>(I.functionName||"").indexOf("StackGenerator$$")===-1).slice(1+p)}catch{return[]}},v.create=function(x,P,p,I,M=0,j){const[U,H]=R(x,P,I,j);let q;try{const xe=v.getStacktrace(U,H>0?1+H+M:0,1+M);q=new v(U.name,U.message,xe,p,x)}catch{q=new v(U.name,U.message,[],p,x)}if(U.name==="InvalidError"&&q.addMetadata(`${I}`,"non-error parameter",O(x)),U.cause){const xe=_(U).slice(1),bt=d(xe,Ct=>{const ie=C(Ct)&&h(Ct)?c.parse(Ct):[],[Ot]=R(Ct,!0,"error cause");return Ot.name==="InvalidError"&&q.addMetadata("error cause",O(Ct)),y(Ot.name,Ot.message,v.__type,ie)});q.errors.push(...bt)}return q};const O=x=>x===null?"null":x===void 0?"undefined":x,R=(x,P,p,I)=>{let M,j=0;const U=H=>{const q=p==="error cause"?"was":"received";I&&I.warn(`${p} ${q} a non-error: "${H}"`);const xe=new Error(`${p} ${q} a non-error. See "${p}" tab for more detail.`);return xe.name="InvalidError",xe};if(!P)C(x)?M=x:(M=U(typeof x),j+=2);else switch(typeof x){case"string":case"number":case"boolean":M=new Error(String(x)),j+=1;break;case"function":M=U("function"),j+=2;break;case"object":x!==null&&C(x)?M=x:x!==null&&V(x)?(M=new Error(x.message||x.errorMessage),M.name=x.name||x.errorClass,j+=1):(M=U(x===null?"null":"unsupported object"),j+=2);break;default:M=U("nothing"),j+=2}if(!h(M))try{throw M}catch(H){h(H)&&(M=H,j=1)}return[M,j]};v.__type="browserjs";const V=x=>(typeof x.name=="string"||typeof x.errorClass=="string")&&(typeof x.message=="string"||typeof x.errorMessage=="string");a.exports=v},994:a=>{a.exports=(l,o,c)=>{let u=0;const h=()=>{if(u>=l.length)return c(null,!0);o(l[u],(d,f)=>{if(d)return c(d);if(f===!1)return c(null,!1);u++,h()})};h()}},377:a=>{a.exports=["navigation","request","process","log","user","state","error","manual"]},698:(a,l,o)=>{const c=o(994);a.exports=(u,h,d,f)=>{c(u,(m,A)=>{if(typeof m!="function")return A(null);try{if(m.length!==2){const S=m(h);return S&&typeof S.then=="function"?S.then(C=>setTimeout(()=>A(null,C)),C=>{setTimeout(()=>(d(C),A(null,!0)))}):A(null,S)}m(h,(S,C)=>{if(S)return d(S),A(null);A(null,C)})}catch(S){d(S),A(null)}},f)}},866:(a,l,o)=>{a.exports=o(247)},795:a=>{a.exports=function(l){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var u in c)Object.prototype.hasOwnProperty.call(c,u)&&(l[u]=c[u])}return l}},58:(a,l,o)=>{const c=o(611);a.exports=(u,h)=>c(u,(d,f,g,m)=>h(f,g,m)?d.concat(f):d,[])},566:(a,l,o)=>{const c=o(611);a.exports=(u,h)=>c(u,(d,f,g,m)=>d===!0||f===h,!1)},37:a=>{a.exports=l=>Object.prototype.toString.call(l)==="[object Array]"},929:a=>{const l=!{toString:null}.propertyIsEnumerable("toString"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];a.exports=c=>{const u=[];let h;for(h in c)Object.prototype.hasOwnProperty.call(c,h)&&u.push(h);if(!l)return u;for(let d=0,f=o.length;d<f;d++)Object.prototype.hasOwnProperty.call(c,o[d])&&u.push(o[d]);return u}},964:(a,l,o)=>{const c=o(611);a.exports=(u,h)=>c(u,(d,f,g,m)=>d.concat(h(f,g,m)),[])},611:a=>{a.exports=(l,o,c)=>{let u=c;for(let h=0,d=l.length;h<d;h++)u=o(u,l[h],h,l);return u}},908:(a,l,o)=>{const c=o(964),u=o(58),h=o(37),d=o(575);function f(S,C,v,w){if(typeof v!="string")return;w===void 0?w=null:w!==null&&typeof w!="string"&&(w=d(w));const k=C[v];if(typeof k=="number"){S[k]={name:v,variant:w};return}S.push({name:v,variant:w}),C[v]=S.length-1}function g(S,C,v){if(h(C)){for(let w=0;w<C.length;++w){const k=C[w];k===null||typeof k!="object"||f(S,v,k.name,k.variant)}return S}}function m(S){return c(u(S,Boolean),({name:C,variant:v})=>{const w={featureFlag:C};return typeof v=="string"&&(w.variant=v),w})}function A(S,C,v){const w=C[v];typeof w=="number"&&(S[w]=null,delete C[v])}a.exports={add:f,clear:A,merge:g,toEventApi:m}},391:a=>{a.exports=l=>!!l&&(!!l.stack||!!l.stacktrace||!!l["opera#sourceloc"])&&typeof(l.stack||l.stacktrace||l["opera#sourceloc"])=="string"&&l.stack!==`${l.name}: ${l.message}`},473:(a,l,o)=>{a.exports=o(232)},599:(a,l,o)=>{const c=o(575),u=["events.[].metaData","events.[].breadcrumbs.[].metaData","events.[].request"];a.exports.event=(h,d)=>{let f=c(h,null,null,{redactedPaths:u,redactedKeys:d});return f.length>1e6&&(h.events[0]._metadata={notifier:`WARNING!
Serialized payload was ${f.length/1e6}MB (limit = 1MB)
metadata was removed`},f=c(h,null,null,{redactedPaths:u,redactedKeys:d})),f},a.exports.session=(h,d)=>c(h,null,null)},987:(a,l,o)=>{const c=o(795),u=(f,g,m,A)=>{if(!g)return;let S;if(m===null)return d(f,g);typeof m=="object"&&(S=m),typeof m=="string"&&(S={[m]:A}),S&&(g==="__proto__"||g==="constructor"||g==="prototype"||(f[g]||(f[g]={}),f[g]=c({},f[g],S)))},h=(f,g,m)=>{if(typeof g=="string"){if(!m)return f[g];if(f[g])return f[g][m]}},d=(f,g,m)=>{if(typeof g=="string"){if(!m){delete f[g];return}g==="__proto__"||g==="constructor"||g==="prototype"||f[g]&&delete f[g][m]}};a.exports={add:u,get:h,clear:d}},100:a=>{a.exports=(l,o,c,u)=>{let h=!1;const d=l.slice();for(;!h&&d.length;)try{h=d.pop()(o)===!1}catch(f){u.error(`Error occurred in ${c} callback, continuing anyway`),u.error(f)}return h}},849:a=>{a.exports=(l=1,o=1/0)=>c=>typeof c=="number"&&parseInt(""+c,10)===c&&c>=l&&c<=o},90:(a,l,o)=>{const c=o(58),u=o(37);a.exports=h=>typeof h=="function"||u(h)&&c(h,d=>typeof d=="function").length===h.length},937:a=>{a.exports=l=>typeof l=="string"&&!!l.length},277:(a,l,o)=>{var c=o(42),u=o(408),h=0,d=4,f=36,g=Math.pow(f,d);function m(){return u((Math.random()*g<<0).toString(f),d)}function A(){return h=h<g?h:0,h++,h-1}function S(){var C="c",v=new Date().getTime().toString(f),w=u(A().toString(f),d),k=c(),E=m()+m();return C+v+w+k+E}S.fingerprint=c,a.exports=S},42:(a,l,o)=>{var c=o(408),u=typeof window=="object"?window:self,h=0;for(var d in u)Object.hasOwnProperty.call(u,d)&&h++;var f=navigator.mimeTypes?navigator.mimeTypes.length:0,g=c((f+navigator.userAgent.length).toString(36)+h.toString(36),4);a.exports=function(){return g}},408:a=>{a.exports=function(o,c){var u="000000000"+o;return u.substr(u.length-c)}},575:a=>{a.exports=function(v,w,k,E){var D=E&&E.redactedKeys?E.redactedKeys:[],y=E&&E.redactedPaths?E.redactedPaths:[];return JSON.stringify(C(v,D,y),w,k)};var l=20,o=25e3,c=8,u="...";function h(v){return v instanceof Error||/^\[object (Error|(Dom)?Exception)\]$/.test(Object.prototype.toString.call(v))}function d(v){return"[Throws: "+(v?v.message:"?")+"]"}function f(v,w){for(var k=0,E=v.length;k<E;k++)if(v[k]===w)return!0;return!1}function g(v,w){for(var k=0,E=v.length;k<E;k++)if(w.indexOf(v[k])===0)return!0;return!1}function m(v,w){for(var k=0,E=v.length;k<E;k++)if(typeof v[k]=="string"&&v[k].toLowerCase()===w.toLowerCase()||v[k]&&typeof v[k].test=="function"&&v[k].test(w))return!0;return!1}function A(v){return Object.prototype.toString.call(v)==="[object Array]"}function S(v,w){try{return v[w]}catch(k){return d(k)}}function C(v,w,k){var E=[],D=0;function y(_,O){function R(){return O.length>c&&D>o}if(D++,O.length>l||R())return u;if(_===null||typeof _!="object")return _;if(f(E,_))return"[Circular]";if(E.push(_),typeof _.toJSON=="function")try{D--;var V=y(_.toJSON(),O);return E.pop(),V}catch(H){return d(H)}var x=h(_);if(x){D--;var P=y({name:_.name,message:_.message},O);return E.pop(),P}if(A(_)){for(var p=[],I=0,M=_.length;I<M;I++){if(R()){p.push(u);break}p.push(y(_[I],O.concat("[]")))}return E.pop(),p}var j={};try{for(var U in _)if(Object.prototype.hasOwnProperty.call(_,U)){if(g(k,O.join("."))&&m(w,U)){j[U]="[REDACTED]";continue}if(R()){j[U]=u;break}j[U]=y(S(_,U),O.concat(U))}}catch{}return E.pop(),j}return y(v,[])}},247:function(a,l,o){var c,u,h;(function(d,f){u=[o(998)],c=f,h=typeof c=="function"?c.apply(l,u):c,h!==void 0&&(a.exports=h)})(this,function(f){var g=/(^|@)\S+\:\d+/,m=/^\s*at .*(\S+\:\d+|\(native\))/m,A=/^(eval@)?(\[native code\])?$/;return{parse:function(C){if(typeof C.stacktrace<"u"||typeof C["opera#sourceloc"]<"u")return this.parseOpera(C);if(C.stack&&C.stack.match(m))return this.parseV8OrIE(C);if(C.stack)return this.parseFFOrSafari(C);throw new Error("Cannot parse given Error object")},extractLocation:function(C){if(C.indexOf(":")===-1)return[C];var v=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/,w=v.exec(C.replace(/[\(\)]/g,""));return[w[1],w[2]||void 0,w[3]||void 0]},parseV8OrIE:function(C){var v=C.stack.split(`
`).filter(function(w){return!!w.match(m)},this);return v.map(function(w){w.indexOf("(eval ")>-1&&(w=w.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var k=w.replace(/^\s+/,"").replace(/\(eval code/g,"("),E=k.match(/ (\((.+):(\d+):(\d+)\)$)/);k=E?k.replace(E[0],""):k;var D=k.split(/\s+/).slice(1),y=this.extractLocation(E?E[1]:D.pop()),_=D.join(" ")||void 0,O=["eval","<anonymous>"].indexOf(y[0])>-1?void 0:y[0];return new f({functionName:_,fileName:O,lineNumber:y[1],columnNumber:y[2],source:w})},this)},parseFFOrSafari:function(C){var v=C.stack.split(`
`).filter(function(w){return!w.match(A)},this);return v.map(function(w){if(w.indexOf(" > eval")>-1&&(w=w.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),w.indexOf("@")===-1&&w.indexOf(":")===-1)return new f({functionName:w});var k=/((.*".+"[^@]*)?[^@]*)(?:@)/,E=w.match(k),D=E&&E[1]?E[1]:void 0,y=this.extractLocation(w.replace(k,""));return new f({functionName:D,fileName:y[0],lineNumber:y[1],columnNumber:y[2],source:w})},this)},parseOpera:function(C){return!C.stacktrace||C.message.indexOf(`
`)>-1&&C.message.split(`
`).length>C.stacktrace.split(`
`).length?this.parseOpera9(C):C.stack?this.parseOpera11(C):this.parseOpera10(C)},parseOpera9:function(C){for(var v=/Line (\d+).*script (?:in )?(\S+)/i,w=C.message.split(`
`),k=[],E=2,D=w.length;E<D;E+=2){var y=v.exec(w[E]);y&&k.push(new f({fileName:y[2],lineNumber:y[1],source:w[E]}))}return k},parseOpera10:function(C){for(var v=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,w=C.stacktrace.split(`
`),k=[],E=0,D=w.length;E<D;E+=2){var y=v.exec(w[E]);y&&k.push(new f({functionName:y[3]||void 0,fileName:y[2],lineNumber:y[1],source:w[E]}))}return k},parseOpera11:function(C){var v=C.stack.split(`
`).filter(function(w){return!!w.match(g)&&!w.match(/^Error created at/)},this);return v.map(function(w){var k=w.split("@"),E=this.extractLocation(k.pop()),D=k.shift()||"",y=D.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0,_;D.match(/\(([^\)]*)\)/)&&(_=D.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var O=_===void 0||_==="[arguments not available]"?void 0:_.split(",");return new f({functionName:y,args:O,fileName:E[0],lineNumber:E[1],columnNumber:E[2],source:w})},this)}}})},232:a=>{a.exports=l;function l(o){switch(Object.prototype.toString.call(o)){case"[object Error]":return!0;case"[object Exception]":return!0;case"[object DOMException]":return!0;default:return o instanceof Error}}},346:function(a,l,o){var c,u,h;(function(d,f){u=[o(998)],c=f,h=typeof c=="function"?c.apply(l,u):c,h!==void 0&&(a.exports=h)})(this,function(d){return{backtrace:function(g){var m=[],A=10;typeof g=="object"&&typeof g.maxStackSize=="number"&&(A=g.maxStackSize);for(var S=arguments.callee;S&&m.length<A&&S.arguments;){for(var C=new Array(S.arguments.length),v=0;v<C.length;++v)C[v]=S.arguments[v];/function(?:\s+([\w$]+))+\s*\(/.test(S.toString())?m.push(new d({functionName:RegExp.$1||void 0,args:C})):m.push(new d({args:C}));try{S=S.caller}catch{break}}return m}}})},998:function(a,l){var o,c,u;(function(h,d){c=[],o=d,u=typeof o=="function"?o.apply(l,c):o,u!==void 0&&(a.exports=u)})(this,function(){function h(D){return!isNaN(parseFloat(D))&&isFinite(D)}function d(D){return D.charAt(0).toUpperCase()+D.substring(1)}function f(D){return function(){return this[D]}}var g=["isConstructor","isEval","isNative","isToplevel"],m=["columnNumber","lineNumber"],A=["fileName","functionName","source"],S=["args"],C=g.concat(m,A,S);function v(D){if(D instanceof Object)for(var y=0;y<C.length;y++)D.hasOwnProperty(C[y])&&D[C[y]]!==void 0&&this["set"+d(C[y])](D[C[y]])}v.prototype={getArgs:function(){return this.args},setArgs:function(D){if(Object.prototype.toString.call(D)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=D},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(D){if(D instanceof v)this.evalOrigin=D;else if(D instanceof Object)this.evalOrigin=new v(D);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var D=this.getFunctionName()||"{anonymous}",y="("+(this.getArgs()||[]).join(",")+")",_=this.getFileName()?"@"+this.getFileName():"",O=h(this.getLineNumber())?":"+this.getLineNumber():"",R=h(this.getColumnNumber())?":"+this.getColumnNumber():"";return D+y+_+O+R}};for(var w=0;w<g.length;w++)v.prototype["get"+d(g[w])]=f(g[w]),v.prototype["set"+d(g[w])]=function(D){return function(y){this[D]=!!y}}(g[w]);for(var k=0;k<m.length;k++)v.prototype["get"+d(m[k])]=f(m[k]),v.prototype["set"+d(m[k])]=function(D){return function(y){if(!h(y))throw new TypeError(D+" must be a Number");this[D]=Number(y)}}(m[k]);for(var E=0;E<A.length;E++)v.prototype["get"+d(A[E])]=f(A[E]),v.prototype["set"+d(A[E])]=function(D){return function(y){this[D]=String(y)}}(A[E]);return v})},743:(a,l,o)=>{const c=o(277);class u{constructor(){this.id=c(),this.startedAt=new Date,this._handled=0,this._unhandled=0,this._user={},this.app={},this.device={}}getUser(){return this._user}setUser(d,f,g){this._user={id:d,email:f,name:g}}toJSON(){return{id:this.id,startedAt:this.startedAt,events:{handled:this._handled,unhandled:this._unhandled}}}_track(d){this[d._handledState.unhandled?"_unhandled":"_handled"]+=1}}a.exports=u},798:(a,l,o)=>{const c=o(795),u="bugsnag-anonymous-id",h=f=>{try{const g=f.localStorage;let m=g.getItem(u);return m&&/^c[a-z0-9]{20,32}$/.test(m)||(m=o(79)(),g.setItem(u,m)),m}catch{}};a.exports=(f=navigator,g=window)=>({load:m=>{const A={locale:f.browserLanguage||f.systemLanguage||f.userLanguage||f.language,userAgent:f.userAgent};g&&g.screen&&g.screen.orientation&&g.screen.orientation.type?A.orientation=g.screen.orientation.type:g&&g.document&&(A.orientation=g.document.documentElement.clientWidth>g.document.documentElement.clientHeight?"landscape":"portrait"),m._config.generateAnonymousId&&(A.id=h(g)),m.addOnSession(S=>{S.device=c({},S.device,A),m._config.collectUserIp||d(S)}),m.addOnError(S=>{S.device=c({},S.device,A,{time:new Date}),m._config.collectUserIp||d(S)},!0)},configSchema:{generateAnonymousId:{validate:m=>m===!0||m===!1,defaultValue:()=>!0,message:"should be true|false"}}});const d=f=>{const g=f.getUser();(!g||!g.id)&&f.setUser(f.device.id)}},79:(a,l,o)=>{var c=o(963),u=o(879),h=0,d=4,f=36,g=Math.pow(f,d);function m(){return u((Math.random()*g<<0).toString(f),d)}function A(){return h=h<g?h:0,h++,h-1}function S(){var C="c",v=new Date().getTime().toString(f),w=u(A().toString(f),d),k=c(),E=m()+m();return C+v+w+k+E}S.fingerprint=c,a.exports=S},963:(a,l,o)=>{var c=o(879),u=typeof window=="object"?window:self,h=0;for(var d in u)Object.hasOwnProperty.call(u,d)&&h++;var f=navigator.mimeTypes?navigator.mimeTypes.length:0,g=c((f+navigator.userAgent.length).toString(36)+h.toString(36),4);a.exports=function(){return g}},879:a=>{a.exports=function(o,c){var u="000000000"+o;return u.substr(u.length-c)}},223:(a,l,o)=>{const c=o(566);a.exports={load:h=>{h._sessionDelegate=u}};const u={startSession:(h,d)=>{const f=h;return f._session=d,f._pausedSession=null,f._config.enabledReleaseStages!==null&&!c(f._config.enabledReleaseStages,f._config.releaseStage)?(f._logger.warn("Session not sent due to releaseStage/enabledReleaseStages configuration"),f):(f._delivery.sendSession({notifier:f._notifier,device:d.device,app:d.app,sessions:[{id:d.id,startedAt:d.startedAt,user:d._user}]}),f)},resumeSession:h=>h._session?h:h._pausedSession?(h._session=h._pausedSession,h._pausedSession=null,h):h.startSession(),pauseSession:h=>{h._pausedSession=h._session,h._session=null}}},155:(a,l,o)=>{const c=o(795);a.exports={load:u=>{u._config.collectUserIp||u.addOnError(h=>{h._user&&typeof h._user.id>"u"&&delete h._user.id,h._user=c({id:"[REDACTED]"},h._user),h.request=c({clientIp:"[REDACTED]"},h.request)})},configSchema:{collectUserIp:{defaultValue:()=>!0,message:"should be true|false",validate:u=>u===!0||u===!1}}}},584:a=>{a.exports=(c=window,u="window onerror")=>({load:h=>{if(!h._config.autoDetectErrors||!h._config.enabledErrorTypes.unhandledExceptions)return;function d(g,m,A,S,C){if(A===0&&/Script error\.?/.test(g))h._logger.warn("Ignoring cross-domain or eval script error. See docs: https://tinyurl.com/yy3rn63z");else{const v={severity:"error",unhandled:!0,severityReason:{type:"unhandledException"}};let w;if(C)w=h.Event.create(C,!0,v,u,1),l(w.errors[0].stacktrace,m,A,S);else if(typeof g=="object"&&g!==null&&(!m||typeof m!="string")&&!A&&!S&&!C){const k=g.type?`Event: ${g.type}`:"Error",E=g.message||g.detail||"";w=h.Event.create({name:k,message:E},!0,v,u,1),w.originalError=g,w.addMetadata(u,{event:g,extraParameters:m})}else w=h.Event.create(g,!0,v,u,1),l(w.errors[0].stacktrace,m,A,S);h._notify(w)}typeof f=="function"&&f.apply(this,arguments)}const f=c.onerror;c.onerror=d}});const l=(c,u,h,d)=>{c[0]||c.push({});const f=c[0];!f.file&&typeof u=="string"&&(f.file=u),!f.lineNumber&&o(h)&&(f.lineNumber=h),f.columnNumber||(o(d)?f.columnNumber=d:window.event&&o(window.event.errorCharacter)&&(f.columnNumber=window.event.errorCharacter))},o=c=>typeof c=="number"&&String.call(c)!=="NaN"},536:(a,l,o)=>{const c=o(964),u=o(473);a.exports=(d=window)=>({load:g=>{if(!g._config.autoDetectErrors||!g._config.enabledErrorTypes.unhandledRejections)return;const m=A=>{let S=A.reason,C=!1;try{A.detail&&A.detail.reason&&(S=A.detail.reason,C=!0)}catch{}const v=g.Event.create(S,!1,{severity:"error",unhandled:!0,severityReason:{type:"unhandledPromiseRejection"}},"unhandledrejection handler",1,g._logger);C&&c(v.errors[0].stacktrace,h(S)),g._notify(v,w=>{u(w.originalError)&&!w.originalError.stack&&w.addMetadata("unhandledRejection handler",{[Object.prototype.toString.call(w.originalError)]:{name:w.originalError.name,message:w.originalError.message,code:w.originalError.code}})})};"addEventListener"in d?d.addEventListener("unhandledrejection",m):d.onunhandledrejection=(A,S)=>{m({detail:{reason:A,promise:S}})}}});const h=d=>f=>{f.file!==d.toString()&&f.method&&(f.method=f.method.replace(/^\s+/,""))}},182:(a,l,o)=>{const{schema:c}=o(510),u=o(964),h=o(795);a.exports={appType:{...c.appType,defaultValue:()=>"workerjs"},logger:h({},c.logger,{defaultValue:()=>typeof console<"u"&&typeof console.debug=="function"?d():void 0}),autoTrackSessions:{...c.autoTrackSessions,defaultValue:()=>!1},autoDetectErrors:{...c.autoTrackSessions,defaultValue:()=>!1}};const d=()=>{const f={},g=console.log;return u(["debug","info","warn","error"],m=>{const A=console[m];f[m]=typeof A=="function"?A.bind(console,"[bugsnag]"):g.bind(console,"[bugsnag]")}),f}},230:a=>{const l=/^(chrome|moz|safari|safari-web)-extension:/;a.exports={name:"preventDiscard",load:o=>{o.addOnError(c=>{c.errors.forEach(({stacktrace:u})=>{u.forEach(function(h){h.file=h.file.replace(l,"$1_extension:")})})},!0)}}}},r={};function s(a){var l=r[a];if(l!==void 0)return l.exports;var o=r[a]={exports:{}};return n[a].call(o.exports,o,o.exports,s),o.exports}s.n=a=>{var l=a&&a.__esModule?()=>a.default:()=>a;return s.d(l,{a:l}),l},s.d=(a,l)=>{for(var o in l)s.o(l,o)&&!s.o(a,o)&&Object.defineProperty(a,o,{enumerable:!0,get:l[o]})},s.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),s.o=(a,l)=>Object.prototype.hasOwnProperty.call(a,l);var i={};return(()=>{s.d(i,{default:()=>p});var a=s(953),l=s.n(a),o=s(510),c=s(599);const h=(I,M=s.g.fetch)=>({sendEvent:(j,U=()=>{})=>{const H=I._config.endpoints.notify;M(H,{method:"POST",headers:{"Content-Type":"application/json","Bugsnag-Api-Key":j.apiKey||I._config.apiKey,"Bugsnag-Payload-Version":"4","Bugsnag-Sent-At":new Date().toISOString()},body:c.event(j,I._config.redactedKeys)}).then(()=>{U(null)}).catch(q=>{I._logger.error(q),U(q)})},sendSession:(j,U=()=>{})=>{const H=I._config.endpoints.sessions;M(H,{method:"POST",headers:{"Content-Type":"application/json","Bugsnag-Api-Key":I._config.apiKey,"Bugsnag-Payload-Version":"1","Bugsnag-Sent-At":new Date().toISOString()},body:c.session(j,I._config.redactedKeys)}).then(()=>{U(null)}).catch(q=>{I._logger.error(q),U(q)})}});var d=s(155),f=s.n(d),g=s(584),m=s.n(g),A=s(536),S=s.n(A),C=s(182),v=s.n(C),w=s(798),k=s.n(w),E=s(223),D=s.n(E),y=s(230),_=s.n(y);const O="Bugsnag Web Worker",R="https://github.com/bugsnag/bugsnag-js",V="7.22.7",x={...o.schema,...v()},P={createClient:I=>{typeof I=="string"&&(I={apiKey:I}),I||(I={});const M=[k()(navigator,null),D(),f(),_(),m()(self,"worker onerror"),S()(self)],j=new(l())(I,x,M,{name:O,version:V,url:R});return j._setDelivery(h),j._logger.debug("Loaded!"),j._config.autoTrackSessions?j.startSession():j},start:I=>P._client?(P._client._logger.warn("Bugsnag.start() was called more than once. Ignoring."),P._client):(P._client=P.createClient(I),P._client),isStarted:()=>P._client!=null};Object.getOwnPropertyNames(l().prototype).forEach(I=>{/^_/.test(I)||I==="constructor"||(P[I]=function(){if(!P._client)return console.log(`Bugsnag.${I}() was called before Bugsnag.start()`);P._client._depth+=1;const M=P._client[I].apply(P._client,arguments);return P._client._depth-=1,M})});const p=P})(),i=i.default,i})())})(Yi);var Gc=Yi.exports;const Hc=Lr(Gc);function Ur(e){return e==null?e:e instanceof Error?{errorClass:e.name,errorMessage:e.message}:typeof e=="function"?"[Function]":Array.isArray(e)?e.map(Ur):typeof e=="object"?Object.entries(e).reduce((t,[n,r])=>(t[n]=Ur(r),t),{}):e}var Ji={exports:{}};(function(e,t){(function(n,r){r(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Ki,function(n){var r,s;if(!((s=(r=globalThis.chrome)==null?void 0:r.runtime)!=null&&s.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const i="The message port closed before a response was received.",a=l=>{const o={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(o).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class c extends WeakMap{constructor(_,O=void 0){super(O),this.createItem=_}get(_){return this.has(_)||this.set(_,this.createItem(_)),super.get(_)}}const u=y=>y&&typeof y=="object"&&typeof y.then=="function",h=(y,_)=>(...O)=>{l.runtime.lastError?y.reject(new Error(l.runtime.lastError.message)):_.singleCallbackArg||O.length<=1&&_.singleCallbackArg!==!1?y.resolve(O[0]):y.resolve(O)},d=y=>y==1?"argument":"arguments",f=(y,_)=>function(R,...V){if(V.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${d(_.minArgs)} for ${y}(), got ${V.length}`);if(V.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${d(_.maxArgs)} for ${y}(), got ${V.length}`);return new Promise((x,P)=>{if(_.fallbackToNoCallback)try{R[y](...V,h({resolve:x,reject:P},_))}catch(p){console.warn(`${y} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,p),R[y](...V),_.fallbackToNoCallback=!1,_.noCallback=!0,x()}else _.noCallback?(R[y](...V),x()):R[y](...V,h({resolve:x,reject:P},_))})},g=(y,_,O)=>new Proxy(_,{apply(R,V,x){return O.call(V,y,...x)}});let m=Function.call.bind(Object.prototype.hasOwnProperty);const A=(y,_={},O={})=>{let R=Object.create(null),V={has(P,p){return p in y||p in R},get(P,p,I){if(p in R)return R[p];if(!(p in y))return;let M=y[p];if(typeof M=="function")if(typeof _[p]=="function")M=g(y,y[p],_[p]);else if(m(O,p)){let j=f(p,O[p]);M=g(y,y[p],j)}else M=M.bind(y);else if(typeof M=="object"&&M!==null&&(m(_,p)||m(O,p)))M=A(M,_[p],O[p]);else if(m(O,"*"))M=A(M,_[p],O["*"]);else return Object.defineProperty(R,p,{configurable:!0,enumerable:!0,get(){return y[p]},set(j){y[p]=j}}),M;return R[p]=M,M},set(P,p,I,M){return p in R?R[p]=I:y[p]=I,!0},defineProperty(P,p,I){return Reflect.defineProperty(R,p,I)},deleteProperty(P,p){return Reflect.deleteProperty(R,p)}},x=Object.create(y);return new Proxy(x,V)},S=y=>({addListener(_,O,...R){_.addListener(y.get(O),...R)},hasListener(_,O){return _.hasListener(y.get(O))},removeListener(_,O){_.removeListener(y.get(O))}}),C=new c(y=>typeof y!="function"?y:function(O){const R=A(O,{},{getContent:{minArgs:0,maxArgs:0}});y(R)}),v=new c(y=>typeof y!="function"?y:function(O,R,V){let x=!1,P,p=new Promise(U=>{P=function(H){x=!0,U(H)}}),I;try{I=y(O,R,P)}catch(U){I=Promise.reject(U)}const M=I!==!0&&u(I);if(I!==!0&&!M&&!x)return!1;const j=U=>{U.then(H=>{V(H)},H=>{let q;H&&(H instanceof Error||typeof H.message=="string")?q=H.message:q="An unexpected error occurred",V({__mozWebExtensionPolyfillReject__:!0,message:q})}).catch(H=>{console.error("Failed to send onMessage rejected reply",H)})};return j(M?I:p),!0}),w=({reject:y,resolve:_},O)=>{l.runtime.lastError?l.runtime.lastError.message===i?_():y(new Error(l.runtime.lastError.message)):O&&O.__mozWebExtensionPolyfillReject__?y(new Error(O.message)):_(O)},k=(y,_,O,...R)=>{if(R.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${d(_.minArgs)} for ${y}(), got ${R.length}`);if(R.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${d(_.maxArgs)} for ${y}(), got ${R.length}`);return new Promise((V,x)=>{const P=w.bind(null,{resolve:V,reject:x});R.push(P),O.sendMessage(...R)})},E={devtools:{network:{onRequestFinished:S(C)}},runtime:{onMessage:S(v),onMessageExternal:S(v),sendMessage:k.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:k.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},D={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return o.privacy={network:{"*":D},services:{"*":D},websites:{"*":D}},A(l,E,o)};n.exports=a(chrome)}else n.exports=globalThis.browser})})(Ji);var qc=Ji.exports;const Ft=Lr(qc);let Ye;function zc(){const[,e,t]=/(.*?):\/\/(.*)/.exec(Ft.runtime.getURL("/"))??["","",""];return`${e.replace(/-/g,"_")}://${t}`}function Zc(e){return typeof e=="string"||typeof e=="boolean"||typeof e=="number"}function Kc(e){var t;return!!((t=e==null?void 0:e.stacktrace)!=null&&t.find(n=>n.file.startsWith(ea)))}function Yc(e,t){return!!t.find(n=>e.errorMessage.match(n))}function Jc(e){e.errors.forEach(t=>{t.stacktrace=t.stacktrace.map(n=>(n.file=n.file.replace(/chrome-extension:/g,"chrome_extension:"),n.file=n.file.replace(/moz-extension:/g,"moz_extension:"),n.file=n.file.replace(/safari-extension:/g,"safari_extension:"),n.file=n.file.replace(/safari-web-extension:/g,"safari_web_extension:"),n))})}function Qi(...e){return e.find(t=>t instanceof Error)??Qc(e)}function Qc(...e){return e.map(t=>Zc(t)?String(t):JSON.stringify(Ur(t))).join(" ")}function Xi(e){return t=>{t.errors.forEach(n=>{const r=1+n.stacktrace.findIndex(s=>s.method===e.name);n.stacktrace=n.stacktrace.slice(r)})}}let ea="";const en={bugsnagClient:null,apiKey:"14be373dfe46ae64888094a22d25ce46",sampleGroup:0,initAPI(e){return Ye=e,Ye.mixin("Bugsnag",{init:this.init.bind(this)})},async init(e){if(ea=zc(),this.bugsnagClient!=null)return;await Promise.all([Ye.Requirements.init()]);const t=await Ye.Storage.get("install-id"),n=Ye.Settings.get("hasAcceptedPrivacyPolicy"),r=await Ye.Requirements.isOnboardingCompleted(),s=Ye.Settings.get("isNewUser");this.bugsnagClient=Hc.start({apiKey:this.apiKey,appType:"Web Extension",collectUserIp:!1,appVersion:Ye.Chrome.Extension.getVersion(),enabledReleaseStages:["production"],releaseStage:"production",context:e??"unknown",logger:null,generateAnonymousId:!1,onError:[Jc,this.isValidError.bind(this)],onSession:[this.isValidSession.bind(this)]}),this.bugsnagClient.setUser(t),this.bugsnagClient.addMetadata("user properties",{hasAcceptedPrivacyPolicy:n,hasCompletedOnboarding:r,isNewUser:s}),this.sampleGroup=await Ye.Storage.getOrSet("bugsnagSamplingGroup",100*Math.random())},notifyError(...e){var t;(t=this.bugsnagClient)==null||t.notify(Qi(e),n=>{Xi(this.notifyError)(n),n.severity="error"})},notifyWarning(...e){var t;(t=this.bugsnagClient)==null||t.notify(Qi(e),n=>{Xi(this.notifyWarning)(n),n.severity="warning"})},logBreadcrumb(...e){var t;(t=this.bugsnagClient)==null||t.leaveBreadcrumb(typeof e[0]=="string"?e[0]:"(no message)",{args:Ur(e)},"log")},disabled(){return!this.isReady()||!this.canUploadData()},async isValidError(e){if(this.disabled()||!this.isSampled())return!1;const t=Ye.RemoteConfig.get("bugsnagIgnoreMatches");return e.errors?!!e.errors.find(n=>Kc(n)&&!Yc(n,t)):!1},isValidSession(){if(this.disabled())return!1},canUploadData(){return Ye.Settings.get("hasAcceptedPrivacyPolicy")??!1},isReady(){return Ye.Settings.isInitialized()},isSampled(){const e=Ye.RemoteConfig.get("bugsnagSampling");return this.sampleGroup<e}};function Xc(){return{log:function(...t){const[n,r,s,i]=t,a=i??"INFO";a==="ERROR"?en.notifyError(...t):a==="WARN"?(en.logBreadcrumb(...t),en.notifyWarning(...t)):a==="INFO"?en.logBreadcrumb(...t):en.logBreadcrumb(...t)}}}const qn=Xc(),Ie={firstToLower:function(e){return typeof e=="string"?e.toLowerCase()[0]+e.slice(1):e},firstToUpper:function(e){return typeof e=="string"?e.toUpperCase()[0]+e.slice(1):e},isEmpty:function(e){return e===null||e===""||typeof e>"u"||Object.keys(e).length===0},sanitizeMSWordChars:function(e){let t=e;return t=t.replace(/[\u2018\u2019\u201A]/g,"'"),t=t.replace(/[\u201C\u201D\u201E]/g,'"'),t=t.replace(/\u2026/g,"..."),t=t.replace(/[\u2013\u2014]/g,"--"),t=t.replace(/\u02C6/g,"^"),t=t.replace(/\u2039/g,"<"),t=t.replace(/\u203A/g,">"),t=t.replace(/[\u02DC\u00A0]/g," "),t},getDecoupledPromise(){let e,t;const n=new Promise((r,s)=>{e=r,t=s});return{resolve:e,reject:t,promise:n}},createScopedLog(e){return(t,n,r=void 0,s="INFO")=>{qn.log(`${e}.${t}`,n,r,s)}},isTopFrame(){return window.self===window.top},initAPI(e){return e.mixin("Utils",{firstToLower:this.firstToLower.bind(this),firstToUpper:this.firstToUpper.bind(this),isEmpty:this.isEmpty.bind(this),sanitizeMSWordChars:this.sanitizeMSWordChars.bind(this),getDecoupledPromise:this.getDecoupledPromise.bind(this),createScopedLog:this.createScopedLog.bind(this),isTopFrame:this.isTopFrame.bind(this)})}},el=Ie.createScopedLog("API"),z=(()=>(()=>{let t={},n=null;const r=function(...s){let i="",a=null;if(s.length===0)throw new TypeError("Mixin has no arguments");if(el("mixin","Adding mixin to API",s,"DEBUG"),s.length===2&&typeof s[0]=="string"){if(i=s[0],typeof s[1]=="object"&&s[1]!==null?a=s[1]:typeof s[1]=="function"&&(a=s[1]()),a)if(i.indexOf(".")>-1){const l=i.split("."),o=l.pop(),c={};n||(n=Pt.lookup(i,t)),c[o]=n?Pt.merge(n,a,!0):a,r(l.join("."),c)}else{const l=i;i in t?t[l]=Pt.merge(t[l],a):t[l]=a,n=null}}else s.length===1&&typeof s[0]=="object"&&s[0]!==null?t=Pt.merge(t,s[0]):s.length===1&&typeof s[0]=="function"&&(a=s[0](),typeof a=="object"&&a!==null&&(t=Pt.merge(t,a)))};return r({mixin:r}),t})())();function Br(e){"@babel/helpers - typeof";return Br=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Br(e)}function tn(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function $e(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function At(e){$e(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||Br(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function tl(e,t){$e(2,arguments);var n=At(e).getTime(),r=tn(t);return new Date(n+r)}var nl={};function jr(){return nl}function rl(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function sl(e){return $e(1,arguments),e instanceof Date||Br(e)==="object"&&Object.prototype.toString.call(e)==="[object Date]"}function il(e){if($e(1,arguments),!sl(e)&&typeof e!="number")return!1;var t=At(e);return!isNaN(Number(t))}function al(e,t){$e(2,arguments);var n=tn(t);return tl(e,-n)}var ol=864e5;function cl(e){$e(1,arguments);var t=At(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=t.getTime(),s=n-r;return Math.floor(s/ol)+1}function Fr(e){$e(1,arguments);var t=1,n=At(e),r=n.getUTCDay(),s=(r<t?7:0)+r-t;return n.setUTCDate(n.getUTCDate()-s),n.setUTCHours(0,0,0,0),n}function ta(e){$e(1,arguments);var t=At(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var s=Fr(r),i=new Date(0);i.setUTCFullYear(n,0,4),i.setUTCHours(0,0,0,0);var a=Fr(i);return t.getTime()>=s.getTime()?n+1:t.getTime()>=a.getTime()?n:n-1}function ll(e){$e(1,arguments);var t=ta(e),n=new Date(0);n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0);var r=Fr(n);return r}var ul=6048e5;function dl(e){$e(1,arguments);var t=At(e),n=Fr(t).getTime()-ll(t).getTime();return Math.round(n/ul)+1}function $r(e,t){var n,r,s,i,a,l,o,c;$e(1,arguments);var u=jr(),h=tn((n=(r=(s=(i=t==null?void 0:t.weekStartsOn)!==null&&i!==void 0?i:t==null||(a=t.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&s!==void 0?s:u.weekStartsOn)!==null&&r!==void 0?r:(o=u.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&n!==void 0?n:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var d=At(e),f=d.getUTCDay(),g=(f<h?7:0)+f-h;return d.setUTCDate(d.getUTCDate()-g),d.setUTCHours(0,0,0,0),d}function na(e,t){var n,r,s,i,a,l,o,c;$e(1,arguments);var u=At(e),h=u.getUTCFullYear(),d=jr(),f=tn((n=(r=(s=(i=t==null?void 0:t.firstWeekContainsDate)!==null&&i!==void 0?i:t==null||(a=t.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:d.firstWeekContainsDate)!==null&&r!==void 0?r:(o=d.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&n!==void 0?n:1);if(!(f>=1&&f<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var g=new Date(0);g.setUTCFullYear(h+1,0,f),g.setUTCHours(0,0,0,0);var m=$r(g,t),A=new Date(0);A.setUTCFullYear(h,0,f),A.setUTCHours(0,0,0,0);var S=$r(A,t);return u.getTime()>=m.getTime()?h+1:u.getTime()>=S.getTime()?h:h-1}function hl(e,t){var n,r,s,i,a,l,o,c;$e(1,arguments);var u=jr(),h=tn((n=(r=(s=(i=t==null?void 0:t.firstWeekContainsDate)!==null&&i!==void 0?i:t==null||(a=t.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&s!==void 0?s:u.firstWeekContainsDate)!==null&&r!==void 0?r:(o=u.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&n!==void 0?n:1),d=na(e,t),f=new Date(0);f.setUTCFullYear(d,0,h),f.setUTCHours(0,0,0,0);var g=$r(f,t);return g}var gl=6048e5;function fl(e,t){$e(1,arguments);var n=At(e),r=$r(n,t).getTime()-hl(n,t).getTime();return Math.round(r/gl)+1}function ce(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}var pl={y:function(t,n){var r=t.getUTCFullYear(),s=r>0?r:1-r;return ce(n==="yy"?s%100:s,n.length)},M:function(t,n){var r=t.getUTCMonth();return n==="M"?String(r+1):ce(r+1,2)},d:function(t,n){return ce(t.getUTCDate(),n.length)},a:function(t,n){var r=t.getUTCHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h:function(t,n){return ce(t.getUTCHours()%12||12,n.length)},H:function(t,n){return ce(t.getUTCHours(),n.length)},m:function(t,n){return ce(t.getUTCMinutes(),n.length)},s:function(t,n){return ce(t.getUTCSeconds(),n.length)},S:function(t,n){var r=n.length,s=t.getUTCMilliseconds(),i=Math.floor(s*Math.pow(10,r-3));return ce(i,n.length)}};const $t=pl;var Sn={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ml={G:function(t,n,r){var s=t.getUTCFullYear()>0?1:0;switch(n){case"G":case"GG":case"GGG":return r.era(s,{width:"abbreviated"});case"GGGGG":return r.era(s,{width:"narrow"});case"GGGG":default:return r.era(s,{width:"wide"})}},y:function(t,n,r){if(n==="yo"){var s=t.getUTCFullYear(),i=s>0?s:1-s;return r.ordinalNumber(i,{unit:"year"})}return $t.y(t,n)},Y:function(t,n,r,s){var i=na(t,s),a=i>0?i:1-i;if(n==="YY"){var l=a%100;return ce(l,2)}return n==="Yo"?r.ordinalNumber(a,{unit:"year"}):ce(a,n.length)},R:function(t,n){var r=ta(t);return ce(r,n.length)},u:function(t,n){var r=t.getUTCFullYear();return ce(r,n.length)},Q:function(t,n,r){var s=Math.ceil((t.getUTCMonth()+1)/3);switch(n){case"Q":return String(s);case"QQ":return ce(s,2);case"Qo":return r.ordinalNumber(s,{unit:"quarter"});case"QQQ":return r.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(s,{width:"wide",context:"formatting"})}},q:function(t,n,r){var s=Math.ceil((t.getUTCMonth()+1)/3);switch(n){case"q":return String(s);case"qq":return ce(s,2);case"qo":return r.ordinalNumber(s,{unit:"quarter"});case"qqq":return r.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(s,{width:"wide",context:"standalone"})}},M:function(t,n,r){var s=t.getUTCMonth();switch(n){case"M":case"MM":return $t.M(t,n);case"Mo":return r.ordinalNumber(s+1,{unit:"month"});case"MMM":return r.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(s,{width:"wide",context:"formatting"})}},L:function(t,n,r){var s=t.getUTCMonth();switch(n){case"L":return String(s+1);case"LL":return ce(s+1,2);case"Lo":return r.ordinalNumber(s+1,{unit:"month"});case"LLL":return r.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(s,{width:"wide",context:"standalone"})}},w:function(t,n,r,s){var i=fl(t,s);return n==="wo"?r.ordinalNumber(i,{unit:"week"}):ce(i,n.length)},I:function(t,n,r){var s=dl(t);return n==="Io"?r.ordinalNumber(s,{unit:"week"}):ce(s,n.length)},d:function(t,n,r){return n==="do"?r.ordinalNumber(t.getUTCDate(),{unit:"date"}):$t.d(t,n)},D:function(t,n,r){var s=cl(t);return n==="Do"?r.ordinalNumber(s,{unit:"dayOfYear"}):ce(s,n.length)},E:function(t,n,r){var s=t.getUTCDay();switch(n){case"E":case"EE":case"EEE":return r.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(s,{width:"short",context:"formatting"});case"EEEE":default:return r.day(s,{width:"wide",context:"formatting"})}},e:function(t,n,r,s){var i=t.getUTCDay(),a=(i-s.weekStartsOn+8)%7||7;switch(n){case"e":return String(a);case"ee":return ce(a,2);case"eo":return r.ordinalNumber(a,{unit:"day"});case"eee":return r.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(i,{width:"short",context:"formatting"});case"eeee":default:return r.day(i,{width:"wide",context:"formatting"})}},c:function(t,n,r,s){var i=t.getUTCDay(),a=(i-s.weekStartsOn+8)%7||7;switch(n){case"c":return String(a);case"cc":return ce(a,n.length);case"co":return r.ordinalNumber(a,{unit:"day"});case"ccc":return r.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(i,{width:"narrow",context:"standalone"});case"cccccc":return r.day(i,{width:"short",context:"standalone"});case"cccc":default:return r.day(i,{width:"wide",context:"standalone"})}},i:function(t,n,r){var s=t.getUTCDay(),i=s===0?7:s;switch(n){case"i":return String(i);case"ii":return ce(i,n.length);case"io":return r.ordinalNumber(i,{unit:"day"});case"iii":return r.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(s,{width:"short",context:"formatting"});case"iiii":default:return r.day(s,{width:"wide",context:"formatting"})}},a:function(t,n,r){var s=t.getUTCHours(),i=s/12>=1?"pm":"am";switch(n){case"a":case"aa":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(t,n,r){var s=t.getUTCHours(),i;switch(s===12?i=Sn.noon:s===0?i=Sn.midnight:i=s/12>=1?"pm":"am",n){case"b":case"bb":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(t,n,r){var s=t.getUTCHours(),i;switch(s>=17?i=Sn.evening:s>=12?i=Sn.afternoon:s>=4?i=Sn.morning:i=Sn.night,n){case"B":case"BB":case"BBB":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(t,n,r){if(n==="ho"){var s=t.getUTCHours()%12;return s===0&&(s=12),r.ordinalNumber(s,{unit:"hour"})}return $t.h(t,n)},H:function(t,n,r){return n==="Ho"?r.ordinalNumber(t.getUTCHours(),{unit:"hour"}):$t.H(t,n)},K:function(t,n,r){var s=t.getUTCHours()%12;return n==="Ko"?r.ordinalNumber(s,{unit:"hour"}):ce(s,n.length)},k:function(t,n,r){var s=t.getUTCHours();return s===0&&(s=24),n==="ko"?r.ordinalNumber(s,{unit:"hour"}):ce(s,n.length)},m:function(t,n,r){return n==="mo"?r.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):$t.m(t,n)},s:function(t,n,r){return n==="so"?r.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):$t.s(t,n)},S:function(t,n){return $t.S(t,n)},X:function(t,n,r,s){var i=s._originalDate||t,a=i.getTimezoneOffset();if(a===0)return"Z";switch(n){case"X":return sa(a);case"XXXX":case"XX":return nn(a);case"XXXXX":case"XXX":default:return nn(a,":")}},x:function(t,n,r,s){var i=s._originalDate||t,a=i.getTimezoneOffset();switch(n){case"x":return sa(a);case"xxxx":case"xx":return nn(a);case"xxxxx":case"xxx":default:return nn(a,":")}},O:function(t,n,r,s){var i=s._originalDate||t,a=i.getTimezoneOffset();switch(n){case"O":case"OO":case"OOO":return"GMT"+ra(a,":");case"OOOO":default:return"GMT"+nn(a,":")}},z:function(t,n,r,s){var i=s._originalDate||t,a=i.getTimezoneOffset();switch(n){case"z":case"zz":case"zzz":return"GMT"+ra(a,":");case"zzzz":default:return"GMT"+nn(a,":")}},t:function(t,n,r,s){var i=s._originalDate||t,a=Math.floor(i.getTime()/1e3);return ce(a,n.length)},T:function(t,n,r,s){var i=s._originalDate||t,a=i.getTime();return ce(a,n.length)}};function ra(e,t){var n=e>0?"-":"+",r=Math.abs(e),s=Math.floor(r/60),i=r%60;if(i===0)return n+String(s);var a=t||"";return n+String(s)+a+ce(i,2)}function sa(e,t){if(e%60===0){var n=e>0?"-":"+";return n+ce(Math.abs(e)/60,2)}return nn(e,t)}function nn(e,t){var n=t||"",r=e>0?"-":"+",s=Math.abs(e),i=ce(Math.floor(s/60),2),a=ce(s%60,2);return r+i+n+a}const yl=ml;var ia=function(t,n){switch(t){case"P":return n.date({width:"short"});case"PP":return n.date({width:"medium"});case"PPP":return n.date({width:"long"});case"PPPP":default:return n.date({width:"full"})}},aa=function(t,n){switch(t){case"p":return n.time({width:"short"});case"pp":return n.time({width:"medium"});case"ppp":return n.time({width:"long"});case"pppp":default:return n.time({width:"full"})}},bl=function(t,n){var r=t.match(/(P+)(p+)?/)||[],s=r[1],i=r[2];if(!i)return ia(t,n);var a;switch(s){case"P":a=n.dateTime({width:"short"});break;case"PP":a=n.dateTime({width:"medium"});break;case"PPP":a=n.dateTime({width:"long"});break;case"PPPP":default:a=n.dateTime({width:"full"});break}return a.replace("{{date}}",ia(s,n)).replace("{{time}}",aa(i,n))},vl={p:aa,P:bl};const wl=vl;var Al=["D","DD"],_l=["YY","YYYY"];function xl(e){return Al.indexOf(e)!==-1}function Sl(e){return _l.indexOf(e)!==-1}function oa(e,t,n){if(e==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var Tl={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},El=function(t,n,r){var s,i=Tl[t];return typeof i=="string"?s=i:n===1?s=i.one:s=i.other.replace("{{count}}",n.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+s:s+" ago":s};const Cl=El;function js(e){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth,r=e.formats[n]||e.formats[e.defaultWidth];return r}}var Ol={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Il={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Pl={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},kl={date:js({formats:Ol,defaultWidth:"full"}),time:js({formats:Il,defaultWidth:"full"}),dateTime:js({formats:Pl,defaultWidth:"full"})};const Dl=kl;var Ml={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Nl=function(t,n,r,s){return Ml[t]};const Rl=Nl;function zn(e){return function(t,n){var r=n!=null&&n.context?String(n.context):"standalone",s;if(r==="formatting"&&e.formattingValues){var i=e.defaultFormattingWidth||e.defaultWidth,a=n!=null&&n.width?String(n.width):i;s=e.formattingValues[a]||e.formattingValues[i]}else{var l=e.defaultWidth,o=n!=null&&n.width?String(n.width):e.defaultWidth;s=e.values[o]||e.values[l]}var c=e.argumentCallback?e.argumentCallback(t):t;return s[c]}}var Ll={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Ul={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Bl={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},jl={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Fl={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},$l={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Wl=function(t,n){var r=Number(t),s=r%100;if(s>20||s<10)switch(s%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},Vl={ordinalNumber:Wl,era:zn({values:Ll,defaultWidth:"wide"}),quarter:zn({values:Ul,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:zn({values:Bl,defaultWidth:"wide"}),day:zn({values:jl,defaultWidth:"wide"}),dayPeriod:zn({values:Fl,defaultWidth:"wide",formattingValues:$l,defaultFormattingWidth:"wide"})};const Gl=Vl;function Zn(e){return function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.width,s=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],i=t.match(s);if(!i)return null;var a=i[0],l=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],o=Array.isArray(l)?ql(l,function(h){return h.test(a)}):Hl(l,function(h){return h.test(a)}),c;c=e.valueCallback?e.valueCallback(o):o,c=n.valueCallback?n.valueCallback(c):c;var u=t.slice(a.length);return{value:c,rest:u}}}function Hl(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}function ql(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}function zl(e){return function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.match(e.matchPattern);if(!r)return null;var s=r[0],i=t.match(e.parsePattern);if(!i)return null;var a=e.valueCallback?e.valueCallback(i[0]):i[0];a=n.valueCallback?n.valueCallback(a):a;var l=t.slice(s.length);return{value:a,rest:l}}}var Zl=/^(\d+)(th|st|nd|rd)?/i,Kl=/\d+/i,Yl={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Jl={any:[/^b/i,/^(a|c)/i]},Ql={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Xl={any:[/1/i,/2/i,/3/i,/4/i]},eu={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},tu={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},nu={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},ru={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},su={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},iu={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},au={ordinalNumber:zl({matchPattern:Zl,parsePattern:Kl,valueCallback:function(t){return parseInt(t,10)}}),era:Zn({matchPatterns:Yl,defaultMatchWidth:"wide",parsePatterns:Jl,defaultParseWidth:"any"}),quarter:Zn({matchPatterns:Ql,defaultMatchWidth:"wide",parsePatterns:Xl,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:Zn({matchPatterns:eu,defaultMatchWidth:"wide",parsePatterns:tu,defaultParseWidth:"any"}),day:Zn({matchPatterns:nu,defaultMatchWidth:"wide",parsePatterns:ru,defaultParseWidth:"any"}),dayPeriod:Zn({matchPatterns:su,defaultMatchWidth:"any",parsePatterns:iu,defaultParseWidth:"any"})},ou={code:"en-US",formatDistance:Cl,formatLong:Dl,formatRelative:Rl,localize:Gl,match:au,options:{weekStartsOn:0,firstWeekContainsDate:1}};const cu=ou;var lu=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,uu=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,du=/^'([^]*?)'?$/,hu=/''/g,gu=/[a-zA-Z]/;function fu(e,t,n){var r,s,i,a,l,o,c,u,h,d,f,g,m,A,S,C,v,w;$e(2,arguments);var k=String(t),E=jr(),D=(r=(s=n==null?void 0:n.locale)!==null&&s!==void 0?s:E.locale)!==null&&r!==void 0?r:cu,y=tn((i=(a=(l=(o=n==null?void 0:n.firstWeekContainsDate)!==null&&o!==void 0?o:n==null||(c=n.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&l!==void 0?l:E.firstWeekContainsDate)!==null&&a!==void 0?a:(h=E.locale)===null||h===void 0||(d=h.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&i!==void 0?i:1);if(!(y>=1&&y<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var _=tn((f=(g=(m=(A=n==null?void 0:n.weekStartsOn)!==null&&A!==void 0?A:n==null||(S=n.locale)===null||S===void 0||(C=S.options)===null||C===void 0?void 0:C.weekStartsOn)!==null&&m!==void 0?m:E.weekStartsOn)!==null&&g!==void 0?g:(v=E.locale)===null||v===void 0||(w=v.options)===null||w===void 0?void 0:w.weekStartsOn)!==null&&f!==void 0?f:0);if(!(_>=0&&_<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!D.localize)throw new RangeError("locale must contain localize property");if(!D.formatLong)throw new RangeError("locale must contain formatLong property");var O=At(e);if(!il(O))throw new RangeError("Invalid time value");var R=rl(O),V=al(O,R),x={firstWeekContainsDate:y,weekStartsOn:_,locale:D,_originalDate:O},P=k.match(uu).map(function(p){var I=p[0];if(I==="p"||I==="P"){var M=wl[I];return M(p,D.formatLong)}return p}).join("").match(lu).map(function(p){if(p==="''")return"'";var I=p[0];if(I==="'")return pu(p);var M=yl[I];if(M)return!(n!=null&&n.useAdditionalWeekYearTokens)&&Sl(p)&&oa(p,t,String(e)),!(n!=null&&n.useAdditionalDayOfYearTokens)&&xl(p)&&oa(p,t,String(e)),M(V,p,D.localize,x);if(I.match(gu))throw new RangeError("Format string contains an unescaped latin alphabet character `"+I+"`");return p}).join("");return P}function pu(e){var t=e.match(du);return t?t[1].replace(hu,"'"):e}function Kn(){return fu(new Date,"OOOO")}function Wr(){let e=/^.+?(-|_)(.+?)($|-|_)/,t=[...typeof navigator<"u"?navigator.languages:[],Intl.DateTimeFormat().resolvedOptions().locale].map(n=>{var r;return(r=n.match(e))==null?void 0:r[2]}).find(n=>!!n);return t==null?void 0:t.toUpperCase()}var mu=13,ca="abcdefghijklmnopqrstuvwxyz0123456789",yu=ca.length;function bu(){let e="";for(let t=0;t<mu;t++)e+=ca.charAt(Math.floor(Math.random()*yu));return e}function vu(e,t){if(typeof e=="string"&&(e=wu(e.trim())),!e)return;let n=(t==null?void 0:t.removeGenericPrefixes)??!0,r=e.hostname;return n&&(r=r.replace(/^(m|mobile|amp|www|www1|www2|www3|tab|item|checkout|secure|user|account|accounts|web|app|open|i|v|preview|cdn|l|id|nid|user|sso|signin|login|auth0|play|api|click|detail|dashboard|console|manage|support|help)\./,"").replace(/.*\.zoom\.us/,"zoom.us").replace(/.*\.slack\.com/,"slack.com").replace(/.*\.wikipedia\.org/,"wikipedia.org").replace(/.*\.amazonaws\.com/,"amazonaws.com").replace(/.*\.netsuite\.com/,"netsuite.com").replace(/.*\.tumblr\.com/,"tumblr.com").replace(/.*\.deviantart\.com/,"deviantart.com")),{hostname:r,path:Au(e.pathname)}}function wu(e){if(!e)return;let t=n=>{let r=new URL(n);if(!/^https?:/.test(r.protocol))throw Error("Invalid URL, ignored protocol found");if(!r.hostname)throw Error("Invalid URL, no hostname");if(r.hostname.lastIndexOf(".")>=r.hostname.length-2)throw Error("Invalid URL, bad domain ending");return r};try{return t(e)}catch{}if(!e.includes("://"))try{return t("https://"+e)}catch{}}function Au(e){return e.endsWith("/")?e.substring(0,Math.max(1,e.length-1)):e}var Fs={exports:{}};(function(e,t){(function(n,r){var s="1.0.37",i="",a="?",l="function",o="undefined",c="object",u="string",h="major",d="model",f="name",g="type",m="vendor",A="version",S="architecture",C="console",v="mobile",w="tablet",k="smarttv",E="wearable",D="embedded",y=500,_="Amazon",O="Apple",R="ASUS",V="BlackBerry",x="Browser",P="Chrome",p="Edge",I="Firefox",M="Google",j="Huawei",U="LG",H="Microsoft",q="Motorola",xe="Opera",bt="Samsung",Ct="Sharp",ie="Sony",Ot="Xiaomi",_r="Zebra",ct="Facebook",xr="Chromium OS",Sr="Mac OS",Ts=function(te,ae){var Y={};for(var oe in te)ae[oe]&&ae[oe].length%2===0?Y[oe]=ae[oe].concat(te[oe]):Y[oe]=te[oe];return Y},qt=function(te){for(var ae={},Y=0;Y<te.length;Y++)ae[te[Y].toUpperCase()]=te[Y];return ae},Tr=function(te,ae){return typeof te===u?zt(ae).indexOf(zt(te))!==-1:!1},zt=function(te){return te.toLowerCase()},ki=function(te){return typeof te===u?te.replace(/[^\d\.]/g,i).split(".")[0]:r},Er=function(te,ae){if(typeof te===u)return te=te.replace(/^\s\s*/,i),typeof ae===o?te:te.substring(0,y)},pn=function(te,ae){for(var Y=0,oe,vt,ve,se,K,lt;Y<ae.length&&!K;){var Vn=ae[Y],mn=ae[Y+1];for(oe=vt=0;oe<Vn.length&&!K&&Vn[oe];)if(K=Vn[oe++].exec(te),K)for(ve=0;ve<mn.length;ve++)lt=K[++vt],se=mn[ve],typeof se===c&&se.length>0?se.length===2?typeof se[1]==l?this[se[0]]=se[1].call(this,lt):this[se[0]]=se[1]:se.length===3?typeof se[1]===l&&!(se[1].exec&&se[1].test)?this[se[0]]=lt?se[1].call(this,lt,se[2]):r:this[se[0]]=lt?lt.replace(se[1],se[2]):r:se.length===4&&(this[se[0]]=lt?se[3].call(this,lt.replace(se[1],se[2])):r):this[se]=lt||r;Y+=2}},Cr=function(te,ae){for(var Y in ae)if(typeof ae[Y]===c&&ae[Y].length>0){for(var oe=0;oe<ae[Y].length;oe++)if(Tr(ae[Y][oe],te))return Y===a?r:Y}else if(Tr(ae[Y],te))return Y===a?r:Y;return te},Di={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Es={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Cs={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[A,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[A,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,A],[/opios[\/ ]+([\w\.]+)/i],[A,[f,xe+" Mini"]],[/\bopr\/([\w\.]+)/i],[A,[f,xe]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[A,[f,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[f,A],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[A,[f,"UC"+x]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[A,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[A,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[A,[f,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[A,[f,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[A,[f,"Smart Lenovo "+x]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+x],A],[/\bfocus\/([\w\.]+)/i],[A,[f,I+" Focus"]],[/\bopt\/([\w\.]+)/i],[A,[f,xe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[A,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[A,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[A,[f,xe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[A,[f,"MIUI "+x]],[/fxios\/([-\w\.]+)/i],[A,[f,I]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 "+x]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 "+x],A],[/samsungbrowser\/([\w\.]+)/i],[A,[f,bt+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],A],[/metasr[\/ ]?([\d\.]+)/i],[A,[f,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[f,"Sogou Mobile"],A],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[f,A],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,ct],A],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[f,A],[/\bgsa\/([\w\.]+) .*safari\//i],[A,[f,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[A,[f,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[A,[f,P+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,P+" WebView"],A],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[A,[f,"Android "+x]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,A],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[A,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[A,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[A,Cr,Di]],[/(webkit|khtml)\/([\w\.]+)/i],[f,A],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],A],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[A,[f,I+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,A],[/(cobalt)\/([\w\.]+)/i],[f,[A,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[S,"amd64"]],[/(ia32(?=;))/i],[[S,zt]],[/((?:i[346]|x)86)[;\)]/i],[[S,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[S,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[S,"armhf"]],[/windows (ce|mobile); ppc;/i],[[S,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[S,/ower/,i,zt]],[/(sun4\w)[;\)]/i],[[S,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[S,zt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[m,bt],[g,w]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[m,bt],[g,v]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[m,O],[g,v]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[m,O],[g,w]],[/(macintosh);/i],[d,[m,O]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[m,Ct],[g,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[m,j],[g,w]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[m,j],[g,v]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[m,Ot],[g,v]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[m,Ot],[g,w]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[m,"OPPO"],[g,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[m,"Vivo"],[g,v]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[m,"Realme"],[g,v]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[m,q],[g,v]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[m,q],[g,w]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[m,U],[g,w]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[m,U],[g,v]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[m,"Lenovo"],[g,w]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[m,"Nokia"],[g,v]],[/(pixel c)\b/i],[d,[m,M],[g,w]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[m,M],[g,v]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[m,ie],[g,v]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[m,ie],[g,w]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[m,"OnePlus"],[g,v]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[m,_],[g,w]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[m,_],[g,v]],[/(playbook);[-\w\),; ]+(rim)/i],[d,m,[g,w]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[m,V],[g,v]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[m,R],[g,w]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[m,R],[g,v]],[/(nexus 9)/i],[d,[m,"HTC"],[g,w]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[d,/_/g," "],[g,v]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[m,"Acer"],[g,w]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[m,"Meizu"],[g,v]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[m,"Ulefone"],[g,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,d,[g,v]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,d,[g,w]],[/(surface duo)/i],[d,[m,H],[g,w]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[m,"Fairphone"],[g,v]],[/(u304aa)/i],[d,[m,"AT&T"],[g,v]],[/\bsie-(\w*)/i],[d,[m,"Siemens"],[g,v]],[/\b(rct\w+) b/i],[d,[m,"RCA"],[g,w]],[/\b(venue[\d ]{2,7}) b/i],[d,[m,"Dell"],[g,w]],[/\b(q(?:mv|ta)\w+) b/i],[d,[m,"Verizon"],[g,w]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[m,"Barnes & Noble"],[g,w]],[/\b(tm\d{3}\w+) b/i],[d,[m,"NuVision"],[g,w]],[/\b(k88) b/i],[d,[m,"ZTE"],[g,w]],[/\b(nx\d{3}j) b/i],[d,[m,"ZTE"],[g,v]],[/\b(gen\d{3}) b.+49h/i],[d,[m,"Swiss"],[g,v]],[/\b(zur\d{3}) b/i],[d,[m,"Swiss"],[g,w]],[/\b((zeki)?tb.*\b) b/i],[d,[m,"Zeki"],[g,w]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],d,[g,w]],[/\b(ns-?\w{0,9}) b/i],[d,[m,"Insignia"],[g,w]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[m,"NextBook"],[g,w]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],d,[g,v]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],d,[g,v]],[/\b(ph-1) /i],[d,[m,"Essential"],[g,v]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[m,"Envizen"],[g,w]],[/\b(trio[-\w\. ]+) b/i],[d,[m,"MachSpeed"],[g,w]],[/\btu_(1491) b/i],[d,[m,"Rotor"],[g,w]],[/(shield[\w ]+) b/i],[d,[m,"Nvidia"],[g,w]],[/(sprint) (\w+)/i],[m,d,[g,v]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[m,H],[g,v]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[m,_r],[g,w]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[m,_r],[g,v]],[/smart-tv.+(samsung)/i],[m,[g,k]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[m,bt],[g,k]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,U],[g,k]],[/(apple) ?tv/i],[m,[d,O+" TV"],[g,k]],[/crkey/i],[[d,P+"cast"],[m,M],[g,k]],[/droid.+aft(\w+)( bui|\))/i],[d,[m,_],[g,k]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[m,Ct],[g,k]],[/(bravia[\w ]+)( bui|\))/i],[d,[m,ie],[g,k]],[/(mitv-\w{5}) bui/i],[d,[m,Ot],[g,k]],[/Hbbtv.*(technisat) (.*);/i],[m,d,[g,k]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,Er],[d,Er],[g,k]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,k]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,d,[g,C]],[/droid.+; (shield) bui/i],[d,[m,"Nvidia"],[g,C]],[/(playstation [345portablevi]+)/i],[d,[m,ie],[g,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[m,H],[g,C]],[/((pebble))app/i],[m,d,[g,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[m,O],[g,E]],[/droid.+; (glass) \d/i],[d,[m,M],[g,E]],[/droid.+; (wt63?0{2,3})\)/i],[d,[m,_r],[g,E]],[/(quest( 2| pro)?)/i],[d,[m,ct],[g,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[g,D]],[/(aeobc)\b/i],[d,[m,_],[g,D]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[g,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[g,w]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,w]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,v]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[A,[f,p+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[A,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[f,A],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[A,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,A],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[f,[A,Cr,Es]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[A,Cr,Es],[f,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[A,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,Sr],[A,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[A,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,A],[/\(bb(10);/i],[A,[f,V]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[A,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[A,[f,I+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[A,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[A,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[A,[f,P+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,xr],A],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,A],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],A],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[f,A]]},Xe=function(te,ae){if(typeof te===c&&(ae=te,te=r),!(this instanceof Xe))return new Xe(te,ae).getResult();var Y=typeof n!==o&&n.navigator?n.navigator:r,oe=te||(Y&&Y.userAgent?Y.userAgent:i),vt=Y&&Y.userAgentData?Y.userAgentData:r,ve=ae?Ts(Cs,ae):Cs,se=Y&&Y.userAgent==oe;return this.getBrowser=function(){var K={};return K[f]=r,K[A]=r,pn.call(K,oe,ve.browser),K[h]=ki(K[A]),se&&Y&&Y.brave&&typeof Y.brave.isBrave==l&&(K[f]="Brave"),K},this.getCPU=function(){var K={};return K[S]=r,pn.call(K,oe,ve.cpu),K},this.getDevice=function(){var K={};return K[m]=r,K[d]=r,K[g]=r,pn.call(K,oe,ve.device),se&&!K[g]&&vt&&vt.mobile&&(K[g]=v),se&&K[d]=="Macintosh"&&Y&&typeof Y.standalone!==o&&Y.maxTouchPoints&&Y.maxTouchPoints>2&&(K[d]="iPad",K[g]=w),K},this.getEngine=function(){var K={};return K[f]=r,K[A]=r,pn.call(K,oe,ve.engine),K},this.getOS=function(){var K={};return K[f]=r,K[A]=r,pn.call(K,oe,ve.os),se&&!K[f]&&vt&&vt.platform!="Unknown"&&(K[f]=vt.platform.replace(/chrome os/i,xr).replace(/macos/i,Sr)),K},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return oe},this.setUA=function(K){return oe=typeof K===u&&K.length>y?Er(K,y):K,this},this.setUA(oe),this};Xe.VERSION=s,Xe.BROWSER=qt([f,A,h]),Xe.CPU=qt([S]),Xe.DEVICE=qt([d,m,g,C,v,k,w,E,D]),Xe.ENGINE=Xe.OS=qt([f,A]),e.exports&&(t=e.exports=Xe),t.UAParser=Xe;var Zt=typeof n!==o&&(n.jQuery||n.Zepto);if(Zt&&!Zt.ua){var Wn=new Xe;Zt.ua=Wn.getResult(),Zt.ua.get=function(){return Wn.getUA()},Zt.ua.set=function(te){Wn.setUA(te);var ae=Wn.getResult();for(var Y in ae)Zt.ua[Y]=ae[Y]}}})(typeof window=="object"?window:Ki)})(Fs,Fs.exports);var _u=Fs.exports;const $s=Lr(_u),We=Ie.createScopedLog("Amplitude");let Pe;const la={installIdKey:"install-id",initialized:null,installId:null,browser:null,os:null,version:null,sessionId:null,sampleGroup:null,enabled:null,initAPI(e){return Pe=e,Pe.mixin("Analytics",{init:this.init.bind(this),event:this.event.bind(this),bindHtmlEvents:this.bindHtmlEvents.bind(this)})},async init(){if(this.initialized!=null)We==null||We("init","Amplitude already initialized",{sessionId:this.sessionId},"DEBUG");else{const{promise:e,resolve:t}=Pe.Utils.getDecoupledPromise();this.initialized=e;const n=new $s(navigator.userAgent);this.sessionId=Date.now(),this.os=n.getOS(),this.browser=n.getBrowser(),this.version=Pe.Chrome.Extension.getVersion(),this.sampleGroup=await Pe.Storage.getOrSet("analyticsSamplingGroup",100*Math.random());const r=Pe.Settings.get("hasAcceptedPrivacyPolicy")??!0,s=!0;this.enabled=r&&s,this.installId=await Pe.Storage.get(this.installIdKey),this.installId||(this.installId=bu(),await Pe.Storage.set({[this.installIdKey]:this.installId})),t(),We==null||We("init","Initialized Amplitude",this,"INFO")}},async event(e,t){if(!this.initialized){We==null||We("event","Cannot report event until initialized",this,"WARN");return}const n=Date.now();await this.initialized;const r=Pe.RemoteConfig.get("amplitudeSampling"),s=Pe.RemoteConfig.get("defaultAmplitudeSampling"),i=r[e]??s,a=this.sampleGroup<i,l=this.enabled&&a,o={event_type:e,user_id:this.installId,user_properties:{hasAcceptedToS:!!Pe.Settings.get("hasAcceptedToS"),hasAcceptedPrivacyPolicy:!!Pe.Settings.get("hasAcceptedPrivacyPolicy"),explicitlyDeclinedPrivacyPolicy:!!Pe.Settings.get("explicitlyDeclinedPrivacyPolicy"),isNewUser:!!Pe.Settings.get("isNewUser"),is18OrOlder:Pe.Settings.get("is18OrOlder"),age:Pe.Settings.get("age")},time:n,event_properties:{page:`${location.protocol}//${location.hostname}${location.pathname}`,...t},app_version:this.version,os_name:this.browser.name,os_version:this.browser.version,platform:this.os.name};We==null||We("event",l?"Reported event":"Skipped event",{event:o,samplePercentInt:i,isSampled:a,thisEnabled:this.enabled},"DEBUG"),l&&await Pe.AmplitudeAPI.uploadEvents(o)},bindHtmlEvents(){We==null||We("bindHtmlEvents","Binding amplitude events to DOM",void 0,"DEBUG");const e="data-analytics-click";document.querySelectorAll(`*[${e}]`).forEach(n=>{n.addEventListener("click",r=>{var a;const s=r.target,i=(a=s==null?void 0:s.getAttribute)==null?void 0:a.call(s,e);i&&this.event(i)})});const t="data-analytics-toggle";document.querySelectorAll(`*[${t}]`).forEach(n=>{n.addEventListener("change",r=>{var l;const s=r.target,i=s==null?void 0:s.checked,a=(l=s==null?void 0:s.getAttribute)==null?void 0:l.call(s,t);a&&this.event(a,{checked:i})})})}},xu=Ie.createScopedLog("AmplitudeAPI"),Su={baseUrl:"https://api2.amplitude.com",apiKey:"07de81d51a94380a82c075614cd12f6e",initAPI(e){return e.mixin("AmplitudeAPI",{uploadEvents:this.uploadEvents.bind(this)})},async uploadEvents(...e){return await fetch(`${this.baseUrl}/batch`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify({api_key:this.apiKey,events:e})}).catch(t=>{xu("uploadEvents","Failed to upload event",t,"WARN")})}},Tu={initAPI(e){return e.mixin("Chrome",{Extension:{addListener:this.exists("runtime")?this.addRuntimeListener.bind(this):this.throwMisusedAPIException,connect:this.exists("runtime","connect")?chrome.runtime.connect.bind(chrome.runtime):this.throwMisusedAPIException,getID:this.exists("runtime")?function(){return chrome.runtime.id}:this.throwMisusedAPIException,getURL:this.exists("extension","getURL")?chrome.extension.getURL.bind(chrome.extension):this.throwMisusedAPIException,reload:this.exists("runtime","reload")?chrome.runtime.reload.bind(chrome.runtime):this.throwMisusedAPIException,getVersion:this.exists("runtime","getManifest")?this.getVersion.bind(this):this.throwMisusedAPIException,setUninstallURL:this.exists("runtime","setUninstallURL")?chrome.runtime.setUninstallURL.bind(chrome.runtime):this.throwMisusedAPIException},Message:{on:chrome.runtime.onMessage,send:this.exists("runtime","sendMessage")?chrome.runtime.sendMessage.bind(chrome.runtime):this.throwMisusedAPIException,sendToTab:this.exists("tabs","sendMessage")?chrome.tabs.sendMessage.bind(chrome.tabs):this.throwMisusedAPIException},Notification:{create:this.exists("notifications","create")?chrome.notifications.create.bind(chrome.notifications):this.throwMisusedAPIException,clear:this.exists("notifications","clear")?chrome.notifications.clear.bind(chrome.notifications):this.throwMisusedAPIException},Storage:{addListener:this.exists("storage")?this.addStorageListener.bind(this):this.throwMisusedAPIException,getLocal:this.exists("storage")?chrome.storage.local.get.bind(chrome.storage.local):this.throwMisusedAPIException,getSync:this.exists("storage")?chrome.storage.sync.get.bind(chrome.storage.sync):this.throwMisusedAPIException,removeLocal:this.exists("storage")?chrome.storage.local.remove.bind(chrome.storage.local):this.throwMisusedAPIException,removeSync:this.exists("storage")?chrome.storage.sync.remove.bind(chrome.storage.sync):this.throwMisusedAPIException,setLocal:this.exists("storage")?chrome.storage.local.set.bind(chrome.storage.local):this.throwMisusedAPIException,setSync:this.exists("storage")?chrome.storage.sync.set.bind(chrome.storage.sync):this.throwMisusedAPIException},Tab:{addListener:this.exists("tabs")?this.addTabsListener.bind(this):this.throwMisusedAPIException,create:this.exists("tabs","create")?chrome.tabs.create.bind(chrome.tabs):this.throwMisusedAPIException,getAllInWindow:this.exists("tabs","query")?this.getAllTabsInWindow.bind(this):this.throwMisusedAPIException,getCurrent:this.exists("tabs","getCurrent")?chrome.tabs.getCurrent.bind(chrome.tabs):this.throwMisusedAPIException,getSelected:this.exists("tabs","query")?this.getSelectedTab.bind(this):this.throwMisusedAPIException,remove:this.exists("tabs","remove")?chrome.tabs.remove.bind(chrome.tabs):this.throwMisusedAPIException,update:this.exists("tabs","update")?chrome.tabs.update.bind(chrome.tabs):this.throwMisusedAPIException,get:this.exists("tabs","get")?chrome.tabs.get.bind(chrome.tabs):this.throwMisusedAPIException},Translation:{get:this.exists("i18n","getMessage")?chrome.i18n.getMessage.bind(chrome.i18n):this.throwMisusedAPIException},Window:{addListener:this.exists("windows")?this.addWindowsListener.bind(this):this.throwMisusedAPIException,getLastFocused:this.exists("windows","getLastFocused")?chrome.windows.getLastFocused.bind(chrome.windows):this.throwMisusedAPIException},Alarms:{addListener:this.exists("alarms")?this.addAlarmsListener.bind(this):this.throwMisusedAPIException,ensure:this.exists("alarms")?this.ensureAlarm.bind(this):this.throwMisusedAPIException}})},getSelectedTab:function(e,t){const n={active:!0};e?n.windowId=e:n.currentWindow=!0,chrome.tabs.query(n,function(r){const s=r[0];typeof t=="function"&&t(s)})},getAllTabsInWindow:function(e,t){const n={};e?n.windowId=e:n.currentWindow=!0,chrome.tabs.query(n,function(r){typeof t=="function"&&t(r)})},getVersion(){return chrome.runtime.getManifest().version},async ensureAlarm(e,t){return new Promise(n=>{chrome.alarms.get(e,r=>{r||chrome.alarms.create(e,t),n()})})},addRuntimeListener:function(e,t){this.addListener("runtime",e,t)},addStorageListener:function(e,t){this.addListener("storage",e,t)},addTabsListener:function(e,t){this.addListener("tabs",e,t)},addWindowsListener:function(e,t){this.addListener("windows",e,t)},addAlarmsListener(e,t){this.addListener("alarms",e,t)},addListener:function(e,t,n){const r=e,s=t;typeof chrome[r][s]<"u"&&chrome[r][s].addListener(n)},exists:function(e,t){const n=e,r=t;let s=chrome&&typeof chrome[n]=="object";return s&&r&&(s=typeof chrome[n][r]=="function"),s},throwMisusedAPIException:function(){throw new Error("Improper use of chrome API in content script!")}},Eu={initAPI(e){return e.mixin("Date",this)},parseMilitaryTime:function(e){const t=e.split(":");let n=parseInt(t[0],10);const r=parseInt(t[1],10),s=n>=12?"pm":"am";n=n>=12?n-12:n;const i=n===0?12:n,a=s==="pm"?z.Chrome.Translation.get("timePM"):z.Chrome.Translation.get("timeAM");return{hour:this.toTwoDigits(i),min:this.toTwoDigits(r),ampm:s,display:i+":"+this.toTwoDigits(r)+" "+a}},timestampToDisplayDate:function(e){const t=new Date(e),n={},r=t.getMonth()+1,s=t.getDate(),i=t.getHours(),a=t.getMinutes();return n.year=t.getFullYear(),n.month=this.toTwoDigits(r),n.day=this.toTwoDigits(s),n.minutes=this.toTwoDigits(a),n.ampm=i>=12?z.Chrome.Translation.get("timePM"):z.Chrome.Translation.get("timeAM"),n.hours=i>12?i-12:i,n.hours===0&&(n.hours=12,n.ampm=z.Chrome.Translation.get("timeAM")),n},hasTimePassed:function(e,t,n,r=new Date){e=n==="pm"?parseInt(e,10)+12:e;const s=r.toDateString();return new Date(s+" "+e+":"+t)<r},secondsUntilTime:function(e,t,n,r=new Date){e=n==="pm"?parseInt(e,10)+12:e;const s=r.toDateString(),a=new Date(s+" "+e+":"+t).getTime()-r.getTime();return Math.floor(a/1e3)},minutesUntilTime:function(e,t,n,r){const s=this.secondsUntilTime(e,t,n,r);return Math.floor(s/60)},getTodayDateObj:function(e,t,n,r=new Date){e=n==="pm"?parseInt(e,10)+12:e;const s=r.toDateString();return new Date(s+" "+e+":"+t)},hoursToMilliseconds:function(e){return parseFloat(e)*60*60*1e3},timeUnitToMilliseconds:function(e,t){if(!this.isValidTimeUnit(t))throw new Error('[DateUtils.timeUnitToMilliseconds()] Could not convert time unit to milliseconds. "'+t+'" is not a valid time unit.');return e=parseFloat(e),this.isValidHourUnit(t)?e*60*60*1e3:this.isValidMinUnit(t)?e*60*1e3:this.isValidSecUnit(t)?e*1e3:e},isValidTime:function(e,t){if(typeof e!="string"||e.indexOf(":")!==2||e.length!==5)return!1;t=t===12?12:24;const n=e.split(":"),r=parseInt(n[0]),s=parseInt(n[1]);return s>=0&&s<=59&&(t===12&&r>=1&&r<=12||t===24&&r>=0&&r<=23)},isValidTimeUnit:function(e){return this.isValidHourUnit(e)||this.isValidMinUnit(e)||this.isValidSecUnit(e)||this.isValidMSUnit(e)},isValidHourUnit:function(e){return typeof e=="string"&&(e.indexOf("hour")===0||e.indexOf("hr")===0||e==="h")},isValidMinUnit:function(e){return typeof e=="string"&&(e.indexOf("min")===0||e==="m")},isValidSecUnit:function(e){return typeof e=="string"&&(e.indexOf("sec")===0||e==="s")},isValidMSUnit:function(e){return typeof e=="string"&&(e.indexOf("millis")===0||e==="ms")},dayNumToDay:function(e,t){if(e<0||e>6)throw new Error("[DateUtils.dayNumToDay()] Day num must be between 0 and 6");return t===!0?["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]},getDaysInMonth:function(e,t){const n=new Date;return e=e||n.getMonth(),t=t||n.getYear(),32-new Date(t,e,32).getDate()},secondsToMinsAndSecs:function(e){return e/60===Math.floor(e/60)?e/60+" minutes":Math.floor(e/60)+" minutes and "+(e-Math.floor(e/60)*60)+" seconds"},toTwoDigits:function(e){return e<10?"0"+e:e.toString()},getYMD:function(e){e=e||new Date;const t=this.toTwoDigits(e.getMonth()+1),n=this.toTwoDigits(e.getDate());return e.getFullYear()+"-"+t+"-"+n}},ke=Ie.createScopedLog("DomainParser"),ua={initAPI(e){return e.mixin("Domain",{extractBaseDomain:this.extractBaseDomain.bind(this),extractFullDomain:this.extractFullDomain.bind(this),isMoreGeneralURL:this.isMoreGeneralURL.bind(this),matchesWildcard:this.matchesWildcard.bind(this)})},extractFullDomain:function(e){if(!e)return null;ke("extractFullDomain","Extracting full domain from",e,"TRACE");const t=e.match(/^(.[^/]*?:\/\/)?(.[^/]+)/);if(t===null||t.length<2)return e.split("/")[0];let n=t[2];return n.startsWith("www.")&&(n=n.replace("www.","")),n},extractBaseDomain:function(e){ke("extractBaseDomain","Extracting base domain from",e,"TRACE");const t=this.extractFullDomain(e);if(!t||t.length===0)return"";const n=t.split(".");if(n.length===1)return t;let r=n[n.length-1];return r=n[n.length-2]+"."+r,this.isMultiPartDomain(t)&&(r=n[n.length-3]+"."+r),r},isMultiPartDomain:function(e){const t="Is "+e+" multi-part domain?",n=e.split(".");let r=[];if(n.length===1)return ke("isMultiPartDomain",t,"NO","TRACE"),!1;const s=n[n.length-2];if(s.length===1||s.length===2&&n.length>3)return ke("isMultiPartDomain",t,"YES","TRACE"),!0;if(s.length===3&&n.length>=3){r=["com","edu","gov","mil","net","org","biz","www","pro","int","web","xxx"];for(const i in r)if(r.hasOwnProperty(i)&&s===r[i])return ke("isMultiPartDomain",t,"YES","TRACE"),!0}if(s.length===4&&n.length>=3){r=["info","mobi","name","jobs","kiwi","aero","asia","coop"];for(const i in r)if(r.hasOwnProperty(i)&&s===r[i])return ke("isMultiPartDomain",t,"YES","TRACE"),!0}if(n.length>=3){const i=n[n.length-3];if(s.length===2&&n.length===3&&i.length>2&&i!=="www")return ke("isMultiPartDomain",t,"YES","TRACE"),!0}return ke("isMultiPartDomain",t,"NO","TRACE"),!1},isMoreGeneralURL:function(e,t){e=typeof e=="string"?e.toLowerCase():e,t=typeof t=="string"?t.toLowerCase():t;const n="Is "+e+" more general than "+t+"?";if(e=="chrome-extension://"&&(t==null?void 0:t.indexOf(e))==0)return!0;if(e=this.stripProtocol(e),t=this.stripProtocol(t),e==""&&t!="")return!1;const r=this.extractBaseDomain(t);if(e===t||e===r||t.indexOf(e)===0)return ke("isMoreGeneralURL",n,"YES","TRACE"),!0;const s=this.extractBaseDomain(e);return s===r&&e.length<=t.length&&t.indexOf(e)>=0&&(t.indexOf("/")>=0||t.indexOf("?")>=0)||r.length>s.length&&r.indexOf(e)>-1?(ke("isMoreGeneralURL",n,"YES","TRACE"),!0):(ke("isMoreGeneralURL",n,"NO","TRACE"),!1)},matchesWildcard:function(e,t){if(e.indexOf("*")==-1)return;const n="Does "+t+" match wildcard "+e+"?";e=e.toLowerCase(),t=t.toLowerCase();const r=e.replace("*","");if(t=t||"",t.indexOf(r)===-1)return ke("matchesWildcard",n,"NO","TRACE"),!1;const s=t.substring(0,t.indexOf(r)+r.length),a=t.substring(s.length-r.length,s.length)===r;return ke("matchesWildcard",n,a?"YES":"NO","TRACE"),a},stripProtocol:function(e){return e?e.indexOf("://")>-1?e.slice(e.indexOf("://")+3,e.length):e:""}};let rn;function da(){return rn.RemoteConfig.get("incrementalRollout")}const Cu=e=>({storageKey:`@incrementalRollout/${e}`,async getMyPercent(){return rn.Storage.getOrSet(this.storageKey,Math.random())},async getEnabledPercent(){return(await da())[e]??0},async isEnabled(){const t=await this.getEnabledPercent();return await this.getMyPercent()<t},async debug(){qn.log("IncrementalRollout","Incremental rollout info:",{isEnabled:await this.isEnabled(),myPercent:await this.getMyPercent(),enabledPercent:await this.getEnabledPercent(),remoteConfig:await da()},"DEBUG")},async enable(){await rn.Storage.set({[this.storageKey]:-1})},async disable(){await rn.Storage.set({[this.storageKey]:2})},async randomize(){await rn.Storage.set({[this.storageKey]:Math.random()})}}),Ou={initAPI(e){return rn=e,rn.mixin("IncrementalRollout",{AdFinder:Cu("ad-finder")})}};let Te;const Iu={initialized:null,onboardingSampleGroup:null,initAPI(e){return Te=e,Te.mixin("Requirements",{init:this.init.bind(this),isOnboardingCompleted:this.isOnboardingCompleted.bind(this),getPromptAgainAt:this.getPromptAgainAt.bind(this),setPromptAgainAt:this.setPromptAgainAt.bind(this),getOnboardingShownCount:this.getOnboardingShownCount.bind(this),incrementOnboardingShownCount:this.incrementOnboardingShownCount.bind(this),getConfirmationCount:this.getConfirmationCount.bind(this),incrementConfirmationCount:this.incrementConfirmationCount.bind(this),isUnder18:this.isUnder18.bind(this)})},async init(){if(this.initialized!=null)return;const{promise:e,resolve:t,reject:n}=Te.Utils.getDecoupledPromise();this.initialized=e,this.onboardingSampleGroup=await Te.Storage.getOrSet("onboardingSampleGroup",100*Math.random());try{await Promise.all([Te.Settings.initAsync(),Te.RemoteConfig.init()]),t()}catch(r){n(r)}},async isOnboardingCompleted(){const e=Date.now();if(this.initialized==null)throw Error("You must call `API.Requirements.init()` before calling `isOnboardingCompleted()`");await this.initialized;const t=Te.RemoteConfig.get("onboardingEnabledPercentInt2");if(!(this.onboardingSampleGroup<t)||this.isUnder18()||Te.Settings.get("explicitlyDeclinedPrivacyPolicy"))return!0;if(!Te.Settings.get("hasAcceptedToS"))return!1;const a=Te.Settings.get("hasAcceptedPrivacyPolicy"),l=await this.getPromptAgainAt(),o=await this.getConfirmationCount();return!!a||e<l||o>3},async getPromptAgainAt(){return await Te.Storage.get("showOnboardingAgainAt")??0},setPromptAgainAt(e){return Te.Storage.set({showOnboardingAgainAt:e})},async getOnboardingShownCount(){return await Te.Storage.get("onboardingShownCount")??0},async incrementOnboardingShownCount(){const e=await this.getOnboardingShownCount();await Te.Storage.set({onboardingShownCount:e+1})},async getConfirmationCount(){return await Te.Storage.get("privacyPolicyConfirmationCount")??0},async incrementConfirmationCount(){const e=await this.getConfirmationCount();await Te.Storage.set({privacyPolicyConfirmationCount:e+1})},isUnder18(){if(Te.Settings.get("is18OrOlder"))return!1;const t=Te.Settings.get("age");return t&&t<18},isEffectiveHourOfDay(){const e=[3,22,13,9,8,5,11,2,12,14,4,1],t=new Date().getHours();return!e.includes(t)}},we=Ie.createScopedLog("Storage");let Je;const Ve={LOCAL:1,SYNC:2,map:null,cache:{},initAPI:function(e){return Je=e,Je.mixin("Storage",{addOnChangeListener:this.addOnChangeListener.bind(this),init:this.init.bind(this),initAsync:this.initAsync.bind(this),get:this.get.bind(this),getOrSet:this.getOrSet.bind(this),getAll:this.getAll.bind(this),set:this.set.bind(this),merge:this.merge.bind(this),remove:this.remove.bind(this),setBucket:this.setBucket.bind(this)})},init:async function(e){we("init","Initializing storage",null,"DEBUG"),this.cache={},this.map=null;const t=await this.getSynced("storageMap");we("init","Storage initialization complete",t,"DEBUG"),typeof t<"u"?this.map=t:(this.map={},await this.saveMap()),typeof e=="function"&&e()},initAsync(){return new Promise(e=>this.init(e))},get:async function(e,t=!1){let n;return this.inCache(e)&&!t?n=this.getCached(e):this.inSync(e)?n=await this.getSynced(e):n=await this.getLocal(e),n},async getOrSet(e,t,n=!1){let r=await this.get(e,n);return r==null&&(r=t,await this.set({[e]:r})),r},refresh:async function(e){return await this.get(e,!0)},getAll:async function(e){const t=typeof e=="string"?e.toUpperCase():e;if(t){if(t==="SYNC")return await Je.Chrome.Storage.getSync(null);if(t==="LOCAL")return await Je.Chrome.Storage.getLocal(null)}else{const n={},[r,s]=await Promise.all([Je.Chrome.Storage.getSync(null),Je.Chrome.Storage.getLocal(null)]);return n.SYNC=r,n.LOCAL=s,n}return{}},set:async function(e,t=null){const n=typeof t=="string"?t.toUpperCase():null,r={},s={};let i=!1,a=!1;for(const o in e)e.hasOwnProperty(o)&&(this.inSync(o)||n==="SYNC"?(r[o]=e[o],i=!0):(s[o]=e[o],a=!0));const l=[];i&&l.push(this.setSynced(r)),a&&l.push(this.setLocal(s)),await Promise.all(l)},remove:async function(e,t){var n;this.inSync(e)||t==="SYNC"?await this.removeSynced(e):await this.removeLocal(e),typeof((n=this.map)==null?void 0:n[e])<"u"&&(delete this.map[e],await this.saveMap())},merge:async function(e,t,n){if(we("merge","Merging "+e+" from "+n+" to "+t,null,"TRACE"),n==="SYNC"){const r=await this.getSynced(e),s=await this.getLocal(e);await this.doMerge(e,t,s,r)}else if(n==="LOCAL"){const r=await this.getLocal(e),s=await this.getSynced(e);await this.doMerge(e,t,s,r)}},doMerge:async function(e,t,n,r){n=Pt.isObjLiteral(n)?n:{},r=Pt.isObjLiteral(r)?r:{},await this.remove(e),await this.setBucket(e,t,!0);const s={};s[e]=Pt.merge(n,r,!0),await this.set(s)},setBucket:async function(e,t,n=!1){if(this.isArray(e)){const r=e;for(let s=0;s<r.length;s++)await this.setBucket(r[s],t,n)}else if(typeof e=="string"){const r=e;typeof t=="string"&&(t=t.toUpperCase()),t=typeof this[t]<"u"?t:"LOCAL",we("setBucket","Adding "+r+" to "+t+" storage bucket",null,"TRACE"),this.map[r]=this[t],await this.saveMap(),n!==!0&&await this.migrate(r,t)}},saveMap:async function(e){const t=e??this.map;await this.setSynced({storageMap:t})},migrate:async function(e,t){const n=t==="SYNC"?"LOCAL":"SYNC";if(we("migrate","Migrating "+e+" from "+n+" to "+t,null,"DEBUG"),t==="SYNC"){const r=await this.getLocal(e),s={};s[e]=r,await this.removeLocal(e),await this.setSynced(s)}else if(t==="LOCAL"){const r=await this.getSynced(e),s={};s[e]=r,await this.removeSynced(e),await this.setLocal(s)}},addOnChangeListener:function(e){e=typeof e=="function"?e:function(){},Je.Chrome.Storage.addListener("onChanged",e)},inCache:function(e){return typeof this.cache[e]<"u"},inSync:function(e){return this.map[e]===this.SYNC},inLocal:function(e){return this.map[e]===this.LOCAL},setCached:function(e){we("setCached","Storing items in cache",e,"TRACE");for(const t in e)e.hasOwnProperty(t)&&(this.cache[t]=e[t])},getCached:function(e){return we("getCached","Getting "+e+" from cache",null,"TRACE"),this.cache[e]},removeCached:function(e){we("removeCached","Removing "+e+" from cache",null,"TRACE"),delete this.cache[e]},setSynced:async function(e,t=()=>{}){we("setSynced","Storing items in sync storage",e,"TRACE"),this.setCached(e),await Je.Chrome.Storage.setSync(e,t)},getSynced:async function(e){we("getSynced","Getting "+e+" from sync storage",null,"TRACE");const t=await Je.Chrome.Storage.getSync(e);return typeof e=="string"?(we("getSynced",e+" retrieved from sync storage:",t[e],"TRACE"),this.setCached(t),t[e]):(we("getSynced","Data retrieved from sync storage:",t,"TRACE"),t)},removeSynced:async function(e){we("removeSynced","Removing "+e+" from sync storage",null,"TRACE"),this.removeCached(e),await Je.Chrome.Storage.removeSync(e)},setLocal:async function(e){we("setLocal","Storing items in Chrome local storage",e,"TRACE"),this.setCached(e),await Je.Chrome.Storage.setLocal(e)},getLocal:async function(e){we("getLocal","Getting data from Chrome local storage",e,"TRACE");let t=await Je.Chrome.Storage.getLocal(e);if(typeof e=="string"){t=t||{};let n=t[e];(typeof n>"u"||n===null)&&(n=await this.getFromLocalStorageBackup(e)),we("getLocal",e+" retrieved from local storage:",n,"TRACE");const r={};return r[e]=n,this.setCached(r),n}else return we("getLocal","Data retrieved from local storage:",t,"TRACE"),t},getFromLocalStorageBackup:async function(e){we("getFromLocalStorageBackup","Getting "+e+" from HTML5 localStorage",null,"TRACE");let t=null;const n=await chrome.storage.local.get(e);if(n==null)return null;const r=n[e];if(typeof r<"u"&&r!==null){we("getLocal",e+" found in HTML5 localStorage:",r,"TRACE");try{t=JSON.parse(r)}catch{t=r}const s={};s[e]=t,await this.setLocal(s)}return t},removeLocal:async function(e){we("removeLocal","Removing "+e+" from Chrome local storage",null,"TRACE"),this.removeCached(e),await Je.Chrome.Storage.removeLocal(e)},isArray:function(e){return typeof e=="object"&&e!==null&&typeof e.length=="number"}},ze=Ie.createScopedLog("Settings");let Ws;const Pu={MAX_BACKUP_VERSIONS:5,keys:["activeDays","activeHours","activeHoursQueue","blacklist","challengeRequired","challengeText","customStayFocusdMsg","disableActivityMonitor","disableSync","disableUpdatePopup","firstInstallDate","firstInstallAllowanceExpiration","hideAllowSiteLink","maxTimeAllowed","notificationSettings","nuclearOptionSettings","productivityBypass","resetTimeQueue","resetTimestamp","resetTime","whitelist","hasAcceptedToS","hasAcceptedPrivacyPolicy","explicitlyDeclinedPrivacyPolicy","is18OrOlder","age","isNewUser","promptBirthYearAt","promptBirthYearInterval","promptReview","promptReviewAt","promptReviewInterval","promptSurvey","promptSurveyAt","promptSurveyInterval","debugActivityMonitor","blockedGroups","isBlockAllWebsites","blockAllWebsitesAllowedTime","blockAllWebsitesElapsedTime","showedInitialTutorial","desktopPromoDismissed","whitelistNew","activated","isActivateSwitchShown"],cache:{},backupKeys:[],initialized:!1,initAPI:function(e){return Ws=e,Ws.mixin("Settings",{init:this.init.bind(this),initAsync:this.initAsync.bind(this),get:this.get.bind(this),set:this.set.bind(this),setAsync:this.setAsync.bind(this),refresh:this.refresh.bind(this),remove:this.remove.bind(this),restoreBackup:this.restoreBackup.bind(this),isInitialized:this.isInitialized.bind(this)})},init:function(e){this.initialized?(ze("init","Settings already initialized",this.keys,"DEBUG"),typeof e=="function"&&e()):(ze("init","Initializing Settings",this.keys,"DEBUG"),this.initialized=!0,this.cache={},Ve.init(()=>{this.initBackups(),this.refresh(e)}))},initAsync(){return new Promise(e=>this.init(e))},refresh:function(e){ze("refresh","Refreshing Settings",this.keys,"TRACE");let t=0;const n=this.keys.length,r=s=>{Ve.refresh(s).then(i=>{this.cache[s]=typeof i<"u"?i:null,t++,t===n&&(ze("refresh","Settings refreshed",null,"TRACE"),typeof e=="function"&&e())})};for(let s=0;s<n;s++)r(this.keys[s])},get:function(e,t){if(!this.inCache(e))throw new Error("[Settings.get()] "+e+" is not registered as a key in Settings.js");return this.cache[e]!==null?this.cache[e]:t},set(e,t,n,r){this.saveBackup();for(const s in e){const i=s;if(e.hasOwnProperty(i)){if(!this.inCache(i)&&!r)throw new Error("[Settings.get()] "+i+" is not registered as a key in Settings.js");this.cache[i]=e[i]}}Ve.set(e,n).then(()=>{typeof t=="function"&&t()})},setAsync(e,t,n){return new Promise(r=>this.set(e,r,t,n))},remove:function(e){this.inCache(e)&&(this.cache[e]=null),Ve.remove(e)},initBackups:function(){Ve.get("backupKeys").then(e=>{this.backupKeys=typeof e=="string"?JSON.parse(e):[],this.deleteOrphanedBackups(this.backupKeys)})},saveBackup:async function(){const e="backup-"+new Date().getTime();ze("saveBackup","Saving backup: "+e,this.cache,"TRACE"),this.backupKeys.length>=this.MAX_BACKUP_VERSIONS&&this.pruneBackups(),this.backupKeys.unshift(e);const t={};t[e]=JSON.stringify(this.cache),t.backupKeys=JSON.stringify(this.backupKeys),await Ve.setBucket(e),await Ve.set(t),ze("saveBackup","Backup saved",null,"TRACE")},restoreBackup:function(e=void 0){const t=e||this.backupKeys.shift();return t?(ze("restoreBackup","Restoring backup",t,"DEBUG"),Ve.get(t).then(n=>{if(ze("restoreBackup","Backup loaded",t,"DEBUG"),typeof n=="string")try{const r=JSON.parse(n);Ve.set(r).then(async()=>{await Ve.remove(t),ze("restoreBackup","Backup restored",t,"DEBUG"),await Ve.set({backupKeys:JSON.stringify(this.backupKeys)}),Ws.Chrome.Extension.reload()})}catch{ze("restoreBackup","Backup failed. Error parsing backup JSON.",t,"DEBUG"),this.restoreBackup()}else ze("restoreBackup","Backup failed. Backup wasn't a string.",t,"DEBUG"),this.restoreBackup()}),!0):(ze("restoreBackup","No backup available to restore",null,"WARN"),!1)},pruneBackups:function(){if(this.isArray(this.backupKeys)){const e=this.backupKeys.pop();ze("pruneBackups","Pruning backup: "+e,null,"TRACE"),Ve.remove(e)}},deleteOrphanedBackups:function(e){ze("deleteOrphanedBackups","Deleting orphaned backups",null,"TRACE");const t={};for(let n=0;n<e.length;n++)t[e[n]]=1;Ve.get("storageMap").then(n=>{let r=!1;for(const s in n)n.hasOwnProperty(s)&&s.indexOf("backup-")===0&&!(s in t)&&(delete n[s],r=!0);r&&Ve.saveMap(n)})},inCache:function(e){return typeof this.cache[e]<"u"},isArray:function(e){return typeof e=="object"&&e!==null&&typeof e.length=="number"},isInitialized(){return this.initialized}},ha=1e3,sn=60*ha,Vr=60*sn,ku=24*Vr,Tn=60,an=60*Tn,ga=Tn*10,En={getToday(){return En.getStartOfDay(new Date)},getEndOfToday(){return En.getEndOfDay(new Date)},getStartOfDay(e){const t=new Date(e);return t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),t.setHours(0),t.getTime()},getEndOfDay(e){const t=new Date(e);return t.setMilliseconds(999),t.setSeconds(59),t.setMinutes(59),t.setHours(23),t.getTime()},formatDurationInSeconds(e){if(e===0||e<0)return"00:00";const t=Math.floor(e/an),n=Math.floor((e-t*an)/60),r=Math.floor(e-(t*an+n*60)),s=z.Date.toTwoDigits(t),i=z.Date.toTwoDigits(n),a=z.Date.toTwoDigits(r);return(s=="00"?"":`${s}:`)+`${i}:${a}`},formatTimeToString(e){return e>=0&&e<10?`0${e}`:e},getTimeFromSeconds(e){if(e<0)return{hours:0,minutes:0,seconds:0};const t=Math.floor(e/an),n=Math.floor((e-t*an)/60),r=e-(t*an+n*60);return{hours:t,minutes:n,seconds:r}},getTimeFromMilliseconds(e){const t=e/sn,n=t<60?0:Math.floor(t/60);let r=0;return n>0?r=t-n*60:r=Math.floor(t),{hours:n,minutes:r}},getTimeInMilliseconds(e,t){return e*Vr+t*sn},getTimeInSeconds(e,t){return e*an+t*Tn}},ye=Ie.createScopedLog("RemoteConfig");let Gr;const Du={cache:{},initialized:!1,defaults:{onboardingEnabledPercentInt2:0,defaultAmplitudeSampling:.1,amplitudeSampling:{},newTabTimeout:3*ku,uploadWebUsage:!0,usageUploadBatchSize:500,pageViewAllowlist:[],incrementalRollout:{},bugsnagSampling:.01,bugsnagIgnoreMatches:["Extension context invalidated.","Could not establish connection. Receiving end does not exist.","The browser is shutting down.",'{\\s*"?isTrusted"?:\\s*true\\s*}',"Failed to execute 'abort' on 'IDBTransaction': The transaction has finished.","Failed to execute 'transaction' on 'IDBDatabase': The database connection is closing.","^IO error: \\.\\.\\.\\/.+?: .*? \\(ChromeMethodBFE: .*\\)$","Cannot access contents of the page. Extension manifest must request permission to access the respective host.","The extensions gallery cannot be scripted."],instacartSelectors:{productSelector:['div[aria-label="Product"]'],sponsoredRegex:["/s\\s*p\\s*o\\s*n\\s*s\\s*o\\s*r\\s*/i"],companyName:[".e-1f1gsmn",".e-1opt332"],searchTerm:["#search-bar-input"],productTitle:[".e-th3ch3",".e-u2e78b",".e-1exr31r",".e-wrmemy"],productSize:[".e-k9ly30",".e-owckh2",".e-1hb8rq9",".e-1188c9v"],productPrice:[".e-1jioxed > span.screen-reader-only",".e-1ybpdrh > span.screen-reader-only",".e-1ghw7u1 > span.screen-reader-only",".e-hlbpyw > span.screen-reader-only",".e-t5lw1y > span.e-13d1dsr"]},forbiddenPromptWords:["drug","alcohol","porn"],chatGptUrl:"https://chatgpt.com/",chatGptConversationUrl:"https://chatgpt.com/c/"},url:"https://stayfocusd.st-panel-api.com/v1/remote_config/stayfocusd",sharedConfigUrl:"https://stayfocusd.st-panel-api.com/v1/remote_config/shared-web-config",storageKey:"remote-config",initAPI(e){return Gr=e,Gr.mixin("RemoteConfig",{storageKey:this.storageKey,init:this.init.bind(this),get:this.get.bind(this),refresh:this.refresh.bind(this)})},async init(){if(this.initialized){ye==null||ye("init","RemoteConfig already initialized",this.cache,"DEBUG");return}ye==null||ye("init","Initializing RemoteConfig",this.defaults,"DEBUG"),this.initialized=!0,this.cache={...this.defaults},this.cache={...this.cache,...await Gr.Storage.get(this.storageKey)},ye==null||ye("init","Initialized",this.cache,"DEBUG")},async refresh(){ye==null||ye("refresh","Refreshing...",{currentConfig:this.cache},"DEBUG");try{const e=await fetch(this.url).then(n=>n.json()),t=await fetch(this.sharedConfigUrl).then(n=>n.json());ye==null||ye("refresh","Fetched config",e,"DEBUG"),this.cache={...this.defaults,...e,...t},await Gr.Storage.set({[this.storageKey]:this.cache}),ye==null||ye("refresh","Saved config",this.cache,"DEBUG")}catch(e){ye==null||ye("refresh","Failed to fetch remote config",e,"WARN")}},get(e){if(!this.inCache(e))throw new Error("[RemoteConfig.get()] "+e+" is not registered as a key in RemoteConfig.js");return this.cache[e]},inCache(e){return typeof this.cache[e]<"u"}};var Mu=Object.defineProperty,Nu=(e,t,n)=>t in e?Mu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ee=(e,t,n)=>(Nu(e,typeof t!="symbol"?t+"":t,n),n),Vs=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},B=(e,t,n)=>(Vs(e,t,"read from private field"),n?n.call(e):t.get(e)),Ze=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},Ae=(e,t,n,r)=>(Vs(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),Yn=(e,t,n)=>(Vs(e,t,"access private method"),n),re;(function(e){e.assertEqual=s=>s;function t(s){}e.assertIs=t;function n(s){throw new Error}e.assertNever=n,e.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},e.getValidEnumValues=s=>{const i=e.objectKeys(s).filter(l=>typeof s[s[l]]!="number"),a={};for(const l of i)a[l]=s[l];return e.objectValues(a)},e.objectValues=s=>e.objectKeys(s).map(function(i){return s[i]}),e.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},e.find=(s,i)=>{for(const a of s)if(i(a))return a},e.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}e.joinValues=r,e.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(re||(re={}));const $=re.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Wt=e=>{switch(typeof e){case"undefined":return $.undefined;case"string":return $.string;case"number":return isNaN(e)?$.nan:$.number;case"boolean":return $.boolean;case"function":return $.function;case"bigint":return $.bigint;case"symbol":return $.symbol;case"object":return Array.isArray(e)?$.array:e===null?$.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?$.promise:typeof Map<"u"&&e instanceof Map?$.map:typeof Set<"u"&&e instanceof Set?$.set:typeof Date<"u"&&e instanceof Date?$.date:$.object;default:return $.unknown}},F=re.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Ru=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class kt extends Error{constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const n=t||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(n(a));else{let l=r,o=0;for(;o<a.path.length;){const c=a.path[o];o===a.path.length-1?(l[c]=l[c]||{_errors:[]},l[c]._errors.push(n(a))):l[c]=l[c]||{_errors:[]},l=l[c],o++}}};return s(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,re.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const s of this.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(t(s))):r.push(t(s));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}kt.create=e=>new kt(e);const Jn=(e,t)=>{let n;switch(e.code){case F.invalid_type:e.received===$.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case F.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,re.jsonStringifyReplacer)}`;break;case F.unrecognized_keys:n=`Unrecognized key(s) in object: ${re.joinValues(e.keys,", ")}`;break;case F.invalid_union:n="Invalid input";break;case F.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${re.joinValues(e.options)}`;break;case F.invalid_enum_value:n=`Invalid enum value. Expected ${re.joinValues(e.options)}, received '${e.received}'`;break;case F.invalid_arguments:n="Invalid function arguments";break;case F.invalid_return_type:n="Invalid function return type";break;case F.invalid_date:n="Invalid date";break;case F.invalid_string:typeof e.validation=="object"?"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:re.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case F.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(e.minimum)}`:n="Invalid input";break;case F.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(e.maximum)}`:n="Invalid input";break;case F.custom:n="Invalid input";break;case F.invalid_intersection_types:n="Intersection results could not be merged";break;case F.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case F.not_finite:n="Number must be finite";break;default:n=t.defaultError,re.assertNever(e)}return{message:n}};let fa=Jn;function Lu(e){fa=e}function Hr(){return fa}const qr=e=>{const{data:t,path:n,errorMaps:r,issueData:s}=e,i=[...n,...s.path||[]],a={...s,path:i};let l="";const o=r.filter(c=>!!c).slice().reverse();for(const c of o)l=c(a,{data:t,defaultError:l}).message;return{...s,path:i,message:s.message||l}},Uu=[];function G(e,t){const n=qr({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,Hr(),Jn].filter(r=>!!r)});e.common.issues.push(n)}class Ge{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const s of n){if(s.status==="aborted")return J;s.status==="dirty"&&t.dirty(),r.push(s.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const s of n)r.push({key:await s.key,value:await s.value});return Ge.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const s of n){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return J;i.status==="dirty"&&t.dirty(),a.status==="dirty"&&t.dirty(),(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:t.value,value:r}}}const J=Object.freeze({status:"aborted"}),pa=e=>({status:"dirty",value:e}),Ue=e=>({status:"valid",value:e}),Gs=e=>e.status==="aborted",Hs=e=>e.status==="dirty",zr=e=>e.status==="valid",Zr=e=>typeof Promise!==void 0&&e instanceof Promise;var ne;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(ne||(ne={}));class _t{constructor(t,n,r,s){this.parent=t,this.data=n,this._path=r,this._key=s}get path(){return this._path.concat(this._key)}}const ma=(e,t)=>{if(zr(t))return{success:!0,data:t.value};{if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,error:new kt(e.common.issues)}}};function ee(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:s}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:s}:{errorMap:(i,a)=>i.code!=="invalid_type"?{message:a.defaultError}:typeof a.data>"u"?{message:r??a.defaultError}:{message:n??a.defaultError},description:s}}class X{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return Wt(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:Wt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Ge,ctx:{common:t.parent.common,data:t.data,parsedType:Wt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(Zr(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){var r;const s={common:{issues:[],async:(r=n==null?void 0:n.async)!==null&&r!==void 0?r:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Wt(t)},i=this._parseSync({data:t,path:s.path,parent:s});return ma(s,i)}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Wt(t)},s=this._parse({data:t,path:r.path,parent:r}),i=await(Zr(s)?s:Promise.resolve(s));return ma(r,i)}refine(t,n){const r=s=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(s):n;return this._refinement((s,i)=>{const a=t(s),l=()=>i.addIssue({code:F.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(o=>o?!0:(l(),!1)):a?!0:(l(),!1)})}refinement(t,n){return this._refinement((r,s)=>t(r)?!0:(s.addIssue(typeof n=="function"?n(r,s):n),!1))}_refinement(t){return new gt({schema:this,typeName:Z.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return St.create(this)}nullable(){return un.create(this)}nullish(){return this.optional().nullable()}array(){return ht.create(this)}promise(){return Pn.create(this)}or(t){return nr.create([this,t])}and(t){return rr.create(this,t)}transform(t){return new gt({schema:this,typeName:Z.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new lr({innerType:this,defaultValue:n,typeName:Z.ZodDefault})}brand(){return new va({typeName:Z.ZodBranded,type:this,...ee(void 0)})}catch(t){const n=typeof t=="function"?t:()=>t;return new ts({innerType:this,defaultValue:n,typeName:Z.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return ur.create(this,t)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Bu=/^c[^\s-]{8,}$/i,ju=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,Fu=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,$u=e=>e.precision?e.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}:\\d{2})|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):e.precision===0?e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}:\\d{2})|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}:\\d{2})|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");class Dt extends X{constructor(){super(...arguments),this._regex=(t,n,r)=>this.refinement(s=>t.test(s),{validation:n,code:F.invalid_string,...ne.errToObj(r)}),this.nonempty=t=>this.min(1,ne.errToObj(t)),this.trim=()=>new Dt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==$.string){const s=this._getOrReturnCtx(t);return G(s,{code:F.invalid_type,expected:$.string,received:s.parsedType}),J}const n=new Ge;let r;for(const s of this._def.checks)if(s.kind==="min")t.data.length<s.value&&(r=this._getOrReturnCtx(t,r),G(r,{code:F.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")t.data.length>s.value&&(r=this._getOrReturnCtx(t,r),G(r,{code:F.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){const i=t.data.length>s.value,a=t.data.length<s.value;(i||a)&&(r=this._getOrReturnCtx(t,r),i?G(r,{code:F.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&G(r,{code:F.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")Fu.test(t.data)||(r=this._getOrReturnCtx(t,r),G(r,{validation:"email",code:F.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")ju.test(t.data)||(r=this._getOrReturnCtx(t,r),G(r,{validation:"uuid",code:F.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")Bu.test(t.data)||(r=this._getOrReturnCtx(t,r),G(r,{validation:"cuid",code:F.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(t.data)}catch{r=this._getOrReturnCtx(t,r),G(r,{validation:"url",code:F.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(t.data)||(r=this._getOrReturnCtx(t,r),G(r,{validation:"regex",code:F.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?t.data=t.data.trim():s.kind==="startsWith"?t.data.startsWith(s.value)||(r=this._getOrReturnCtx(t,r),G(r,{code:F.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?t.data.endsWith(s.value)||(r=this._getOrReturnCtx(t,r),G(r,{code:F.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?$u(s).test(t.data)||(r=this._getOrReturnCtx(t,r),G(r,{code:F.invalid_string,validation:"datetime",message:s.message}),n.dirty()):re.assertNever(s);return{status:n.value,value:t.data}}_addCheck(t){return new Dt({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...ne.errToObj(t)})}url(t){return this._addCheck({kind:"url",...ne.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...ne.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...ne.errToObj(t)})}datetime(t){var n;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(n=t==null?void 0:t.offset)!==null&&n!==void 0?n:!1,...ne.errToObj(t==null?void 0:t.message)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...ne.errToObj(n)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...ne.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...ne.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...ne.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...ne.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...ne.errToObj(n)})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}Dt.create=e=>{var t;return new Dt({checks:[],typeName:Z.ZodString,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...ee(e)})};function Wu(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,s=n>r?n:r,i=parseInt(e.toFixed(s).replace(".","")),a=parseInt(t.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}class Vt extends X{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==$.number){const s=this._getOrReturnCtx(t);return G(s,{code:F.invalid_type,expected:$.number,received:s.parsedType}),J}let n;const r=new Ge;for(const s of this._def.checks)s.kind==="int"?re.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),G(n,{code:F.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(n=this._getOrReturnCtx(t,n),G(n,{code:F.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(n=this._getOrReturnCtx(t,n),G(n,{code:F.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?Wu(t.data,s.value)!==0&&(n=this._getOrReturnCtx(t,n),G(n,{code:F.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),G(n,{code:F.not_finite,message:s.message}),r.dirty()):re.assertNever(s);return{status:r.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,ne.toString(n))}gt(t,n){return this.setLimit("min",t,!1,ne.toString(n))}lte(t,n){return this.setLimit("max",t,!0,ne.toString(n))}lt(t,n){return this.setLimit("max",t,!1,ne.toString(n))}setLimit(t,n,r,s){return new Vt({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:ne.toString(s)}]})}_addCheck(t){return new Vt({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:ne.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ne.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ne.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ne.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ne.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:ne.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:ne.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int")}}Vt.create=e=>new Vt({checks:[],typeName:Z.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...ee(e)});class Qn extends X{_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==$.bigint){const n=this._getOrReturnCtx(t);return G(n,{code:F.invalid_type,expected:$.bigint,received:n.parsedType}),J}return Ue(t.data)}}Qn.create=e=>{var t;return new Qn({typeName:Z.ZodBigInt,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...ee(e)})};class Xn extends X{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==$.boolean){const n=this._getOrReturnCtx(t);return G(n,{code:F.invalid_type,expected:$.boolean,received:n.parsedType}),J}return Ue(t.data)}}Xn.create=e=>new Xn({typeName:Z.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...ee(e)});class on extends X{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==$.date){const s=this._getOrReturnCtx(t);return G(s,{code:F.invalid_type,expected:$.date,received:s.parsedType}),J}if(isNaN(t.data.getTime())){const s=this._getOrReturnCtx(t);return G(s,{code:F.invalid_date}),J}const n=new Ge;let r;for(const s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(r=this._getOrReturnCtx(t,r),G(r,{code:F.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(r=this._getOrReturnCtx(t,r),G(r,{code:F.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):re.assertNever(s);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new on({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:ne.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:ne.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}on.create=e=>new on({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:Z.ZodDate,...ee(e)});class Kr extends X{_parse(t){if(this._getType(t)!==$.symbol){const n=this._getOrReturnCtx(t);return G(n,{code:F.invalid_type,expected:$.symbol,received:n.parsedType}),J}return Ue(t.data)}}Kr.create=e=>new Kr({typeName:Z.ZodSymbol,...ee(e)});class er extends X{_parse(t){if(this._getType(t)!==$.undefined){const n=this._getOrReturnCtx(t);return G(n,{code:F.invalid_type,expected:$.undefined,received:n.parsedType}),J}return Ue(t.data)}}er.create=e=>new er({typeName:Z.ZodUndefined,...ee(e)});class tr extends X{_parse(t){if(this._getType(t)!==$.null){const n=this._getOrReturnCtx(t);return G(n,{code:F.invalid_type,expected:$.null,received:n.parsedType}),J}return Ue(t.data)}}tr.create=e=>new tr({typeName:Z.ZodNull,...ee(e)});class Cn extends X{constructor(){super(...arguments),this._any=!0}_parse(t){return Ue(t.data)}}Cn.create=e=>new Cn({typeName:Z.ZodAny,...ee(e)});class cn extends X{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ue(t.data)}}cn.create=e=>new cn({typeName:Z.ZodUnknown,...ee(e)});class Mt extends X{_parse(t){const n=this._getOrReturnCtx(t);return G(n,{code:F.invalid_type,expected:$.never,received:n.parsedType}),J}}Mt.create=e=>new Mt({typeName:Z.ZodNever,...ee(e)});class Yr extends X{_parse(t){if(this._getType(t)!==$.undefined){const n=this._getOrReturnCtx(t);return G(n,{code:F.invalid_type,expected:$.void,received:n.parsedType}),J}return Ue(t.data)}}Yr.create=e=>new Yr({typeName:Z.ZodVoid,...ee(e)});class ht extends X{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),s=this._def;if(n.parsedType!==$.array)return G(n,{code:F.invalid_type,expected:$.array,received:n.parsedType}),J;if(s.exactLength!==null){const a=n.data.length>s.exactLength.value,l=n.data.length<s.exactLength.value;(a||l)&&(G(n,{code:a?F.too_big:F.too_small,minimum:l?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(G(n,{code:F.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(G(n,{code:F.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),n.common.async)return Promise.all(n.data.map((a,l)=>s.type._parseAsync(new _t(n,a,n.path,l)))).then(a=>Ge.mergeArray(r,a));const i=n.data.map((a,l)=>s.type._parseSync(new _t(n,a,n.path,l)));return Ge.mergeArray(r,i)}get element(){return this._def.type}min(t,n){return new ht({...this._def,minLength:{value:t,message:ne.toString(n)}})}max(t,n){return new ht({...this._def,maxLength:{value:t,message:ne.toString(n)}})}length(t,n){return new ht({...this._def,exactLength:{value:t,message:ne.toString(n)}})}nonempty(t){return this.min(1,t)}}ht.create=(e,t)=>new ht({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Z.ZodArray,...ee(t)});var Jr;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(Jr||(Jr={}));const ya=e=>t=>new he({...e,shape:()=>({...e.shape(),...t})});function On(e){if(e instanceof he){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=St.create(On(r))}return new he({...e._def,shape:()=>t})}else return e instanceof ht?ht.create(On(e.element)):e instanceof St?St.create(On(e.unwrap())):e instanceof un?un.create(On(e.unwrap())):e instanceof xt?xt.create(e.items.map(t=>On(t))):e}class he extends X{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=ya(this._def),this.extend=ya(this._def)}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=re.objectKeys(t);return this._cached={shape:t,keys:n}}_parse(t){if(this._getType(t)!==$.object){const o=this._getOrReturnCtx(t);return G(o,{code:F.invalid_type,expected:$.object,received:o.parsedType}),J}const{status:n,ctx:r}=this._processInputParams(t),{shape:s,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof Mt&&this._def.unknownKeys==="strip"))for(const o in r.data)i.includes(o)||a.push(o);const l=[];for(const o of i){const c=s[o],u=r.data[o];l.push({key:{status:"valid",value:o},value:c._parse(new _t(r,u,r.path,o)),alwaysSet:o in r.data})}if(this._def.catchall instanceof Mt){const o=this._def.unknownKeys;if(o==="passthrough")for(const c of a)l.push({key:{status:"valid",value:c},value:{status:"valid",value:r.data[c]}});else if(o==="strict")a.length>0&&(G(r,{code:F.unrecognized_keys,keys:a}),n.dirty());else if(o!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const o=this._def.catchall;for(const c of a){const u=r.data[c];l.push({key:{status:"valid",value:c},value:o._parse(new _t(r,u,r.path,c)),alwaysSet:c in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const o=[];for(const c of l){const u=await c.key;o.push({key:u,value:await c.value,alwaysSet:c.alwaysSet})}return o}).then(o=>Ge.mergeObjectSync(n,o)):Ge.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(t){return ne.errToObj,new he({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var s,i,a,l;const o=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,n,r).message)!==null&&a!==void 0?a:r.defaultError;return n.code==="unrecognized_keys"?{message:(l=ne.errToObj(t).message)!==null&&l!==void 0?l:o}:{message:o}}}:{}})}strip(){return new he({...this._def,unknownKeys:"strip"})}passthrough(){return new he({...this._def,unknownKeys:"passthrough"})}setKey(t,n){return this.augment({[t]:n})}merge(t){return new he({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>Jr.mergeShapes(this._def.shape(),t._def.shape()),typeName:Z.ZodObject})}catchall(t){return new he({...this._def,catchall:t})}pick(t){const n={};return re.objectKeys(t).map(r=>{this.shape[r]&&(n[r]=this.shape[r])}),new he({...this._def,shape:()=>n})}omit(t){const n={};return re.objectKeys(this.shape).map(r=>{re.objectKeys(t).indexOf(r)===-1&&(n[r]=this.shape[r])}),new he({...this._def,shape:()=>n})}deepPartial(){return On(this)}partial(t){const n={};if(t)return re.objectKeys(this.shape).map(r=>{re.objectKeys(t).indexOf(r)===-1?n[r]=this.shape[r]:n[r]=this.shape[r].optional()}),new he({...this._def,shape:()=>n});for(const r in this.shape){const s=this.shape[r];n[r]=s.optional()}return new he({...this._def,shape:()=>n})}required(t){const n={};if(t)re.objectKeys(this.shape).map(r=>{if(re.objectKeys(t).indexOf(r)===-1)n[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof St;)s=s._def.innerType;n[r]=s}});else for(const r in this.shape){let s=this.shape[r];for(;s instanceof St;)s=s._def.innerType;n[r]=s}return new he({...this._def,shape:()=>n})}keyof(){return ba(re.objectKeys(this.shape))}}he.create=(e,t)=>new he({shape:()=>e,unknownKeys:"strip",catchall:Mt.create(),typeName:Z.ZodObject,...ee(t)}),he.strictCreate=(e,t)=>new he({shape:()=>e,unknownKeys:"strict",catchall:Mt.create(),typeName:Z.ZodObject,...ee(t)}),he.lazycreate=(e,t)=>new he({shape:e,unknownKeys:"strip",catchall:Mt.create(),typeName:Z.ZodObject,...ee(t)});class nr extends X{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function s(i){for(const l of i)if(l.result.status==="valid")return l.result;for(const l of i)if(l.result.status==="dirty")return n.common.issues.push(...l.ctx.common.issues),l.result;const a=i.map(l=>new kt(l.ctx.common.issues));return G(n,{code:F.invalid_union,unionErrors:a}),J}if(n.common.async)return Promise.all(r.map(async i=>{const a={...n,common:{...n.common,issues:[]},parent:null};return{result:await i._parseAsync({data:n.data,path:n.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const o of r){const c={...n,common:{...n.common,issues:[]},parent:null},u=o._parseSync({data:n.data,path:n.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return n.common.issues.push(...i.ctx.common.issues),i.result;const l=a.map(o=>new kt(o));return G(n,{code:F.invalid_union,unionErrors:l}),J}}get options(){return this._def.options}}nr.create=(e,t)=>new nr({options:e,typeName:Z.ZodUnion,...ee(t)});const Qr=e=>e instanceof ir?Qr(e.schema):e instanceof gt?Qr(e.innerType()):e instanceof ar?[e.value]:e instanceof or?e.options:e instanceof cr?Object.keys(e.enum):e instanceof lr?Qr(e._def.innerType):e instanceof er?[void 0]:e instanceof tr?[null]:null;class Xr extends X{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==$.object)return G(n,{code:F.invalid_type,expected:$.object,received:n.parsedType}),J;const r=this.discriminator,s=n.data[r],i=this.optionsMap.get(s);return i?n.common.async?i._parseAsync({data:n.data,path:n.path,parent:n}):i._parseSync({data:n.data,path:n.path,parent:n}):(G(n,{code:F.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),J)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){const s=new Map;for(const i of n){const a=Qr(i.shape[t]);if(!a)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const l of a){if(s.has(l))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(l)}`);s.set(l,i)}}return new Xr({typeName:Z.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:s,...ee(r)})}}function qs(e,t){const n=Wt(e),r=Wt(t);if(e===t)return{valid:!0,data:e};if(n===$.object&&r===$.object){const s=re.objectKeys(t),i=re.objectKeys(e).filter(l=>s.indexOf(l)!==-1),a={...e,...t};for(const l of i){const o=qs(e[l],t[l]);if(!o.valid)return{valid:!1};a[l]=o.data}return{valid:!0,data:a}}else if(n===$.array&&r===$.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let i=0;i<e.length;i++){const a=e[i],l=t[i],o=qs(a,l);if(!o.valid)return{valid:!1};s.push(o.data)}return{valid:!0,data:s}}else return n===$.date&&r===$.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class rr extends X{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),s=(i,a)=>{if(Gs(i)||Gs(a))return J;const l=qs(i.value,a.value);return l.valid?((Hs(i)||Hs(a))&&n.dirty(),{status:n.value,value:l.data}):(G(r,{code:F.invalid_intersection_types}),J)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}rr.create=(e,t,n)=>new rr({left:e,right:t,typeName:Z.ZodIntersection,...ee(n)});class xt extends X{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==$.array)return G(r,{code:F.invalid_type,expected:$.array,received:r.parsedType}),J;if(r.data.length<this._def.items.length)return G(r,{code:F.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),J;!this._def.rest&&r.data.length>this._def.items.length&&(G(r,{code:F.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const s=r.data.map((i,a)=>{const l=this._def.items[a]||this._def.rest;return l?l._parse(new _t(r,i,r.path,a)):null}).filter(i=>!!i);return r.common.async?Promise.all(s).then(i=>Ge.mergeArray(n,i)):Ge.mergeArray(n,s)}get items(){return this._def.items}rest(t){return new xt({...this._def,rest:t})}}xt.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new xt({items:e,typeName:Z.ZodTuple,rest:null,...ee(t)})};class sr extends X{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==$.object)return G(r,{code:F.invalid_type,expected:$.object,received:r.parsedType}),J;const s=[],i=this._def.keyType,a=this._def.valueType;for(const l in r.data)s.push({key:i._parse(new _t(r,l,r.path,l)),value:a._parse(new _t(r,r.data[l],r.path,l))});return r.common.async?Ge.mergeObjectAsync(n,s):Ge.mergeObjectSync(n,s)}get element(){return this._def.valueType}static create(t,n,r){return n instanceof X?new sr({keyType:t,valueType:n,typeName:Z.ZodRecord,...ee(r)}):new sr({keyType:Dt.create(),valueType:t,typeName:Z.ZodRecord,...ee(n)})}}class es extends X{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==$.map)return G(r,{code:F.invalid_type,expected:$.map,received:r.parsedType}),J;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([l,o],c)=>({key:s._parse(new _t(r,l,r.path,[c,"key"])),value:i._parse(new _t(r,o,r.path,[c,"value"]))}));if(r.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const o of a){const c=await o.key,u=await o.value;if(c.status==="aborted"||u.status==="aborted")return J;(c.status==="dirty"||u.status==="dirty")&&n.dirty(),l.set(c.value,u.value)}return{status:n.value,value:l}})}else{const l=new Map;for(const o of a){const c=o.key,u=o.value;if(c.status==="aborted"||u.status==="aborted")return J;(c.status==="dirty"||u.status==="dirty")&&n.dirty(),l.set(c.value,u.value)}return{status:n.value,value:l}}}}es.create=(e,t,n)=>new es({valueType:t,keyType:e,typeName:Z.ZodMap,...ee(n)});class ln extends X{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==$.set)return G(r,{code:F.invalid_type,expected:$.set,received:r.parsedType}),J;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(G(r,{code:F.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(G(r,{code:F.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());const i=this._def.valueType;function a(o){const c=new Set;for(const u of o){if(u.status==="aborted")return J;u.status==="dirty"&&n.dirty(),c.add(u.value)}return{status:n.value,value:c}}const l=[...r.data.values()].map((o,c)=>i._parse(new _t(r,o,r.path,c)));return r.common.async?Promise.all(l).then(o=>a(o)):a(l)}min(t,n){return new ln({...this._def,minSize:{value:t,message:ne.toString(n)}})}max(t,n){return new ln({...this._def,maxSize:{value:t,message:ne.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}ln.create=(e,t)=>new ln({valueType:e,minSize:null,maxSize:null,typeName:Z.ZodSet,...ee(t)});class In extends X{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==$.function)return G(n,{code:F.invalid_type,expected:$.function,received:n.parsedType}),J;function r(l,o){return qr({data:l,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Hr(),Jn].filter(c=>!!c),issueData:{code:F.invalid_arguments,argumentsError:o}})}function s(l,o){return qr({data:l,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Hr(),Jn].filter(c=>!!c),issueData:{code:F.invalid_return_type,returnTypeError:o}})}const i={errorMap:n.common.contextualErrorMap},a=n.data;return this._def.returns instanceof Pn?Ue(async(...l)=>{const o=new kt([]),c=await this._def.args.parseAsync(l,i).catch(h=>{throw o.addIssue(r(l,h)),o}),u=await a(...c);return await this._def.returns._def.type.parseAsync(u,i).catch(h=>{throw o.addIssue(s(u,h)),o})}):Ue((...l)=>{const o=this._def.args.safeParse(l,i);if(!o.success)throw new kt([r(l,o.error)]);const c=a(...o.data),u=this._def.returns.safeParse(c,i);if(!u.success)throw new kt([s(c,u.error)]);return u.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new In({...this._def,args:xt.create(t).rest(cn.create())})}returns(t){return new In({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,n,r){return new In({args:t||xt.create([]).rest(cn.create()),returns:n||cn.create(),typeName:Z.ZodFunction,...ee(r)})}}class ir extends X{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}ir.create=(e,t)=>new ir({getter:e,typeName:Z.ZodLazy,...ee(t)});class ar extends X{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return G(n,{code:F.invalid_literal,expected:this._def.value}),J}return{status:"valid",value:t.data}}get value(){return this._def.value}}ar.create=(e,t)=>new ar({value:e,typeName:Z.ZodLiteral,...ee(t)});function ba(e,t){return new or({values:e,typeName:Z.ZodEnum,...ee(t)})}class or extends X{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return G(n,{expected:re.joinValues(r),received:n.parsedType,code:F.invalid_type}),J}if(this._def.values.indexOf(t.data)===-1){const n=this._getOrReturnCtx(t),r=this._def.values;return G(n,{received:n.data,code:F.invalid_enum_value,options:r}),J}return Ue(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}}or.create=ba;class cr extends X{_parse(t){const n=re.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==$.string&&r.parsedType!==$.number){const s=re.objectValues(n);return G(r,{expected:re.joinValues(s),received:r.parsedType,code:F.invalid_type}),J}if(n.indexOf(t.data)===-1){const s=re.objectValues(n);return G(r,{received:r.data,code:F.invalid_enum_value,options:s}),J}return Ue(t.data)}get enum(){return this._def.values}}cr.create=(e,t)=>new cr({values:e,typeName:Z.ZodNativeEnum,...ee(t)});class Pn extends X{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==$.promise&&n.common.async===!1)return G(n,{code:F.invalid_type,expected:$.promise,received:n.parsedType}),J;const r=n.parsedType===$.promise?n.data:Promise.resolve(n.data);return Ue(r.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}Pn.create=(e,t)=>new Pn({type:e,typeName:Z.ZodPromise,...ee(t)});class gt extends X{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Z.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),s=this._def.effect||null;if(s.type==="preprocess"){const a=s.transform(r.data);return r.common.async?Promise.resolve(a).then(l=>this._def.schema._parseAsync({data:l,path:r.path,parent:r})):this._def.schema._parseSync({data:a,path:r.path,parent:r})}const i={addIssue:a=>{G(r,a),a.fatal?n.abort():n.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="refinement"){const a=l=>{const o=s.refinement(l,i);if(r.common.async)return Promise.resolve(o);if(o instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(r.common.async===!1){const l=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return l.status==="aborted"?J:(l.status==="dirty"&&n.dirty(),a(l.value),{status:n.value,value:l.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(l=>l.status==="aborted"?J:(l.status==="dirty"&&n.dirty(),a(l.value).then(()=>({status:n.value,value:l.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!zr(a))return a;const l=s.transform(a.value,i);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:l}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>zr(a)?Promise.resolve(s.transform(a.value,i)).then(l=>({status:n.value,value:l})):a);re.assertNever(s)}}gt.create=(e,t,n)=>new gt({schema:e,typeName:Z.ZodEffects,effect:t,...ee(n)}),gt.createWithPreprocess=(e,t,n)=>new gt({schema:t,effect:{type:"preprocess",transform:e},typeName:Z.ZodEffects,...ee(n)});class St extends X{_parse(t){return this._getType(t)===$.undefined?Ue(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}St.create=(e,t)=>new St({innerType:e,typeName:Z.ZodOptional,...ee(t)});class un extends X{_parse(t){return this._getType(t)===$.null?Ue(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}un.create=(e,t)=>new un({innerType:e,typeName:Z.ZodNullable,...ee(t)});class lr extends X{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===$.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}lr.create=(e,t)=>new lr({innerType:e,typeName:Z.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...ee(t)});class ts extends X{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.innerType._parse({data:n.data,path:n.path,parent:n});return Zr(r)?r.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.defaultValue()})):{status:"valid",value:r.status==="valid"?r.value:this._def.defaultValue()}}removeDefault(){return this._def.innerType}}ts.create=(e,t)=>new ts({innerType:e,typeName:Z.ZodCatch,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...ee(t)});class ns extends X{_parse(t){if(this._getType(t)!==$.nan){const n=this._getOrReturnCtx(t);return G(n,{code:F.invalid_type,expected:$.nan,received:n.parsedType}),J}return{status:"valid",value:t.data}}}ns.create=e=>new ns({typeName:Z.ZodNaN,...ee(e)});const Vu=Symbol("zod_brand");class va extends X{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class ur extends X{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?J:s.status==="dirty"?(n.dirty(),pa(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?J:s.status==="dirty"?(n.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(t,n){return new ur({in:t,out:n,typeName:Z.ZodPipeline})}}const wa=(e,t={},n)=>e?Cn.create().superRefine((r,s)=>{if(!e(r)){const i=typeof t=="function"?t(r):t,a=typeof i=="string"?{message:i}:i;s.addIssue({code:"custom",...a,fatal:n})}}):Cn.create(),Gu={object:he.lazycreate};var Z;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline"})(Z||(Z={}));const Hu=(e,t={message:`Input not instance of ${e.name}`})=>wa(n=>n instanceof e,t,!0),Be=Dt.create,pe=Vt.create,qu=ns.create,zu=Qn.create,rs=Xn.create,Zu=on.create,Ku=Kr.create,Yu=er.create,Ju=tr.create,Aa=Cn.create,Qu=cn.create,Xu=Mt.create,ed=Yr.create,td=ht.create,nt=he.create,nd=he.strictCreate,zs=nr.create,rd=Xr.create,sd=rr.create,id=xt.create,_a=sr.create,ad=es.create,od=ln.create,cd=In.create,ld=ir.create,ud=ar.create,kn=or.create,dd=cr.create,hd=Pn.create,xa=gt.create,gd=St.create,fd=un.create,pd=gt.createWithPreprocess,md=ur.create;var rt=Object.freeze({__proto__:null,defaultErrorMap:Jn,setErrorMap:Lu,getErrorMap:Hr,makeIssue:qr,EMPTY_PATH:Uu,addIssueToContext:G,ParseStatus:Ge,INVALID:J,DIRTY:pa,OK:Ue,isAborted:Gs,isDirty:Hs,isValid:zr,isAsync:Zr,get util(){return re},ZodParsedType:$,getParsedType:Wt,ZodType:X,ZodString:Dt,ZodNumber:Vt,ZodBigInt:Qn,ZodBoolean:Xn,ZodDate:on,ZodSymbol:Kr,ZodUndefined:er,ZodNull:tr,ZodAny:Cn,ZodUnknown:cn,ZodNever:Mt,ZodVoid:Yr,ZodArray:ht,get objectUtil(){return Jr},ZodObject:he,ZodUnion:nr,ZodDiscriminatedUnion:Xr,ZodIntersection:rr,ZodTuple:xt,ZodRecord:sr,ZodMap:es,ZodSet:ln,ZodFunction:In,ZodLazy:ir,ZodLiteral:ar,ZodEnum:or,ZodNativeEnum:cr,ZodPromise:Pn,ZodEffects:gt,ZodTransformer:gt,ZodOptional:St,ZodNullable:un,ZodDefault:lr,ZodCatch:ts,ZodNaN:ns,BRAND:Vu,ZodBranded:va,ZodPipeline:ur,custom:wa,Schema:X,ZodSchema:X,late:Gu,get ZodFirstPartyTypeKind(){return Z},coerce:{string:e=>Dt.create({...e,coerce:!0}),number:e=>Vt.create({...e,coerce:!0}),boolean:e=>Xn.create({...e,coerce:!0}),bigint:e=>Qn.create({...e,coerce:!0}),date:e=>on.create({...e,coerce:!0})},any:Aa,array:td,bigint:zu,boolean:rs,date:Zu,discriminatedUnion:rd,effect:xa,enum:kn,function:cd,instanceof:Hu,intersection:sd,lazy:ld,literal:ud,map:ad,nan:qu,nativeEnum:dd,never:Xu,null:Ju,nullable:fd,number:pe,object:nt,oboolean:()=>rs().optional(),onumber:()=>pe().optional(),optional:gd,ostring:()=>Be().optional(),pipeline:md,preprocess:pd,promise:hd,record:_a,set:od,strictObject:nd,string:Be,symbol:Ku,transformer:xa,tuple:id,undefined:Yu,union:zs,unknown:Qu,void:ed,NEVER:J,ZodIssueCode:F,quotelessJson:Ru,ZodError:kt});const ss=()=>Be().uuid(),yd=/^(?=.{1,255}$)[0-9A-Za-z_](?:(?:[0-9A-Za-z_]|-){0,61}[0-9A-Za-z_])?(?:\.[0-9A-Za-z_](?:(?:[0-9A-Za-z_]|-){0,61}[0-9A-Za-z_])?)*\.?$/,Sa=()=>Be().regex(yd);nt({id:ss(),host:Sa(),startedAt:pe().positive(),endedAt:pe().nullable().optional()}).strict();const Ta=nt({id:ss(),sessionId:ss(),adUrl:Be().url(),timestamp:pe().positive().describe("The time in ms since 1970 that this ad was seen at")}).strict(),bd=Ta.extend({type:kn(["image"]),additionalDetails:nt({width:pe().nonnegative(),height:pe().nonnegative()})}).strict(),vd=Ta.extend({type:kn(["iframe"]),additionalDetails:nt({width:pe().nonnegative(),height:pe().nonnegative()})}).strict();zs([bd,vd]);const Zs=ss,Ea=Sa,Ks=()=>rs().nullable().optional(),Ys=()=>rs().nullable().optional();nt({id:Zs(),host:Ea(),startedAt:pe().positive(),endedAt:pe().nullable().optional(),imported:Ks(),generated:Ys()}).strict();const Ca=nt({id:Be(),sessionId:Zs(),timestamp:pe().positive().describe("The time in ms since 1970 that this ad was seen at"),imported:Ks()}).strict(),wd=Ca.extend({type:kn(["basic-display"]),details:nt({type:kn(["image","iframe"]),url:Be().url().describe("The URL the ad is accessible at"),width:pe().nonnegative(),height:pe().nonnegative()}).strict()}),Ad=()=>_a(Be(),Aa()),_d=Ca.extend({type:kn(["youtube/hulu/vast","pathmatics"]),details:Ad()}),xd=zs([wd,_d]),Js=Zs,Qs=Ks,Sd=Ys,Xs=()=>Ea().describe("The mobile app bundle ID or website hostname"),Td=nt({id:Js(),appId:Xs(),createdBy:Be({description:"The install id that created the session"}),startedAt:pe().positive(),endedAt:pe(),imported:Qs(),generated:Sd()}).strict(),Ed=nt({id:Js(),appId:Xs(),createdBy:Be(),startedAt:pe().positive(),endedAt:pe().nullable().optional(),imported:Qs(),generated:Ys()}).strict(),Cd=xd,Oa=Js,Ia=Qs,Pa=Xs,Od=Td,Id=Ed,Pd=nt({id:Oa(),appId:Pa(),path:Be().startsWith("/"),referrer:Be().nullish(),createdBy:Be(),startedAt:pe().positive(),endedAt:pe(),imported:Ia()}).strict(),kd=nt({id:Oa(),appId:Pa(),path:Be().startsWith("/"),referrer:Be().nullish(),createdBy:Be(),startedAt:pe().positive(),endedAt:pe().nullish(),imported:Ia()}).strict(),Dd=Cd,Md=Od,ka=Id,Nd=Pd,Rd=kd,Da=Dd;class ei{constructor(t,n){this.db=t,this.storeName=n}async deleteAll(){const t=(await this.db).transaction(this.storeName,"readwrite");let n=await t.objectStore(this.storeName).openCursor();for(;n;)await n.delete(),n=await n.continue();await t.done}async findAll(){return await(await this.db).getAll(this.storeName)}}const dr=class extends ei{constructor(e){super(e.db,dr.STORE_NAME_LATEST),this.config=e}async findAds(e,t){return await(await this.db).getAllFromIndex(this.storeName,dr.INDEX_TIMESTAMP,IDBKeyRange.bound(e,t,!1,!0))}async findAdsForSession(e){return await(await this.db).getAllFromIndex(this.storeName,dr.INDEX_SESSION_ID,e)}async upsertAd(e){var t,n;const r=await this.db,s=Da.parse(e);return(n=(t=this.config).onAdUpserted)==null||n.call(t,s),await r.put(this.storeName,s),s}};let _e=dr;_e.STORE_NAME_1="ads",_e.STORE_NAME_2="ads-2",_e.STORE_NAME_LATEST=dr.STORE_NAME_2,_e.INDEX_SESSION_ID="idx_ad_sessionId",_e.INDEX_TIMESTAMP="idx_ad_timestamp";let is;const Ld=new Uint8Array(16);function Ud(){if(!is&&(is=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!is))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return is(Ld)}const De=[];for(let e=0;e<256;++e)De.push((e+256).toString(16).slice(1));function Bd(e,t=0){return(De[e[t+0]]+De[e[t+1]]+De[e[t+2]]+De[e[t+3]]+"-"+De[e[t+4]]+De[e[t+5]]+"-"+De[e[t+6]]+De[e[t+7]]+"-"+De[e[t+8]]+De[e[t+9]]+"-"+De[e[t+10]]+De[e[t+11]]+De[e[t+12]]+De[e[t+13]]+De[e[t+14]]+De[e[t+15]]).toLowerCase()}const jd=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ma={randomUUID:jd};function hr(e,t,n){if(Ma.randomUUID&&!t&&!e)return Ma.randomUUID();e=e||{};const r=e.random||(e.rng||Ud)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(let s=0;s<16;++s)t[n+s]=r[s];return t}return Bd(r)}const ti=-1;function Fd(e){var t;return{id:e.id,appId:e.appId,path:e.path,referrer:e.referrer,createdBy:e.createdBy,endedAt:(t=e.endedAt)!=null?t:ti,startedAt:e.startedAt,imported:e.imported}}function ni(e){return{id:e.id,appId:e.appId,path:e.path,referrer:e.referrer,createdBy:e.createdBy,endedAt:e.endedAt===ti?null:e.endedAt,startedAt:e.startedAt,imported:e.imported}}const gr=class extends ei{constructor(e){super(e.db,gr.STORE_NAME_LATEST),this.config=e}async startPageView(e){const t=await this.db,n=Rd.parse({...e,id:hr(),createdBy:await this.config.getInstallId(),endedAt:void 0}),r=Fd(n);return await t.add(this.storeName,r),n}async endPageView(e,t){const n=await this.db,r=await n.get(this.storeName,e.id);if(r==null)throw Error(`Cannot update: PageView not found with id=${e.id}`);const s={...r,endedAt:t};return await n.put(this.storeName,s),ni(s)}async getActivePageViews(){return(await(await this.db).getAllFromIndex(this.storeName,gr.INDEX_ENDED_AT,ti)).map(ni)}async findPageViewsByEndedAt(e,t){return(await(await this.db).getAllFromIndex(this.storeName,gr.INDEX_ENDED_AT,IDBKeyRange.bound(e,t,!1,!0))).map(ni)}async deleteAllGeneratedPageViews(){const e=(await this.db).transaction(this.storeName,"readwrite");let t=await e.store.openCursor();for(;t;)t.value.imported&&await t.delete(),t=await t.continue();await e.done}};let Nt=gr;Nt.STORE_NAME_1="page_views",Nt.STORE_NAME_LATEST=gr.STORE_NAME_1,Nt.INDEX_ENDED_AT="idx_page_view_endedAt",Nt.INDEX_STARTED_AT="idx_page_view_startedAt";function Na(e,t,n,r){function s(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function l(u){try{c(r.next(u))}catch(h){a(h)}}function o(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?i(u.value):s(u.value).then(l,o)}c((r=r.apply(e,t||[])).next())})}function Ra(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(c){return function(u){return o([c,u])}}function o(c){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(n=0)),n;)try{if(r=1,s&&(i=c[0]&2?s.return:c[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,c[1])).done)return i;switch(s=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,s=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){n.label=c[1];break}if(c[0]===6&&n.label<i[1]){n.label=i[1],i=c;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(c);break}i[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(u){c=[6,u],s=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var $d=new Error("request for lock canceled"),Wd=function(){function e(t,n){n===void 0&&(n=$d),this._value=t,this._cancelError=n,this._weightedQueues=[],this._weightedWaiters=[]}return e.prototype.acquire=function(t){var n=this;if(t===void 0&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise(function(r,s){n._weightedQueues[t-1]||(n._weightedQueues[t-1]=[]),n._weightedQueues[t-1].push({resolve:r,reject:s}),n._dispatch()})},e.prototype.runExclusive=function(t,n){return n===void 0&&(n=1),Na(this,void 0,void 0,function(){var r,s,i;return Ra(this,function(a){switch(a.label){case 0:return[4,this.acquire(n)];case 1:r=a.sent(),s=r[0],i=r[1],a.label=2;case 2:return a.trys.push([2,,4,5]),[4,t(s)];case 3:return[2,a.sent()];case 4:return i(),[7];case 5:return[2]}})})},e.prototype.waitForUnlock=function(t){var n=this;if(t===void 0&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise(function(r){n._weightedWaiters[t-1]||(n._weightedWaiters[t-1]=[]),n._weightedWaiters[t-1].push(r),n._dispatch()})},e.prototype.isLocked=function(){return this._value<=0},e.prototype.getValue=function(){return this._value},e.prototype.setValue=function(t){this._value=t,this._dispatch()},e.prototype.release=function(t){if(t===void 0&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));this._value+=t,this._dispatch()},e.prototype.cancel=function(){var t=this;this._weightedQueues.forEach(function(n){return n.forEach(function(r){return r.reject(t._cancelError)})}),this._weightedQueues=[]},e.prototype._dispatch=function(){for(var t,n=this._value;n>0;n--){var r=(t=this._weightedQueues[n-1])===null||t===void 0?void 0:t.shift();if(r){var s=this._value,i=n;this._value-=n,n=this._value+1,r.resolve([s,this._newReleaser(i)])}}this._drainUnlockWaiters()},e.prototype._newReleaser=function(t){var n=this,r=!1;return function(){r||(r=!0,n.release(t))}},e.prototype._drainUnlockWaiters=function(){for(var t=this._value;t>0;t--)!this._weightedWaiters[t-1]||(this._weightedWaiters[t-1].forEach(function(n){return n()}),this._weightedWaiters[t-1]=[])},e}(),La=function(){function e(t){this._semaphore=new Wd(1,t)}return e.prototype.acquire=function(){return Na(this,void 0,void 0,function(){var t,n;return Ra(this,function(r){switch(r.label){case 0:return[4,this._semaphore.acquire()];case 1:return t=r.sent(),n=t[1],[2,n]}})})},e.prototype.runExclusive=function(t){return this._semaphore.runExclusive(function(){return t()})},e.prototype.isLocked=function(){return this._semaphore.isLocked()},e.prototype.waitForUnlock=function(){return this._semaphore.waitForUnlock()},e.prototype.release=function(){this._semaphore.isLocked()&&this._semaphore.release()},e.prototype.cancel=function(){return this._semaphore.cancel()},e}(),fr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ua={exports:{}};(function(e,t){(function(n,r){r(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:fr,function(n){var r,s;if(!((s=(r=globalThis.chrome)==null?void 0:r.runtime)!=null&&s.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const i="The message port closed before a response was received.",a=l=>{const o={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(o).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class c extends WeakMap{constructor(_,O=void 0){super(O),this.createItem=_}get(_){return this.has(_)||this.set(_,this.createItem(_)),super.get(_)}}const u=y=>y&&typeof y=="object"&&typeof y.then=="function",h=(y,_)=>(...O)=>{l.runtime.lastError?y.reject(new Error(l.runtime.lastError.message)):_.singleCallbackArg||O.length<=1&&_.singleCallbackArg!==!1?y.resolve(O[0]):y.resolve(O)},d=y=>y==1?"argument":"arguments",f=(y,_)=>function(O,...R){if(R.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${d(_.minArgs)} for ${y}(), got ${R.length}`);if(R.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${d(_.maxArgs)} for ${y}(), got ${R.length}`);return new Promise((V,x)=>{if(_.fallbackToNoCallback)try{O[y](...R,h({resolve:V,reject:x},_))}catch(P){console.warn(`${y} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,P),O[y](...R),_.fallbackToNoCallback=!1,_.noCallback=!0,V()}else _.noCallback?(O[y](...R),V()):O[y](...R,h({resolve:V,reject:x},_))})},g=(y,_,O)=>new Proxy(_,{apply(R,V,x){return O.call(V,y,...x)}});let m=Function.call.bind(Object.prototype.hasOwnProperty);const A=(y,_={},O={})=>{let R=Object.create(null),V={has(P,p){return p in y||p in R},get(P,p,I){if(p in R)return R[p];if(!(p in y))return;let M=y[p];if(typeof M=="function")if(typeof _[p]=="function")M=g(y,y[p],_[p]);else if(m(O,p)){let j=f(p,O[p]);M=g(y,y[p],j)}else M=M.bind(y);else if(typeof M=="object"&&M!==null&&(m(_,p)||m(O,p)))M=A(M,_[p],O[p]);else if(m(O,"*"))M=A(M,_[p],O["*"]);else return Object.defineProperty(R,p,{configurable:!0,enumerable:!0,get(){return y[p]},set(j){y[p]=j}}),M;return R[p]=M,M},set(P,p,I,M){return p in R?R[p]=I:y[p]=I,!0},defineProperty(P,p,I){return Reflect.defineProperty(R,p,I)},deleteProperty(P,p){return Reflect.deleteProperty(R,p)}},x=Object.create(y);return new Proxy(x,V)},S=y=>({addListener(_,O,...R){_.addListener(y.get(O),...R)},hasListener(_,O){return _.hasListener(y.get(O))},removeListener(_,O){_.removeListener(y.get(O))}}),C=new c(y=>typeof y!="function"?y:function(_){const O=A(_,{},{getContent:{minArgs:0,maxArgs:0}});y(O)}),v=new c(y=>typeof y!="function"?y:function(_,O,R){let V=!1,x,P=new Promise(j=>{x=function(U){V=!0,j(U)}}),p;try{p=y(_,O,x)}catch(j){p=Promise.reject(j)}const I=p!==!0&&u(p);return p!==!0&&!I&&!V?!1:((j=>{j.then(U=>{R(U)},U=>{let H;U&&(U instanceof Error||typeof U.message=="string")?H=U.message:H="An unexpected error occurred",R({__mozWebExtensionPolyfillReject__:!0,message:H})}).catch(U=>{console.error("Failed to send onMessage rejected reply",U)})})(I?p:P),!0)}),w=({reject:y,resolve:_},O)=>{l.runtime.lastError?l.runtime.lastError.message===i?_():y(new Error(l.runtime.lastError.message)):O&&O.__mozWebExtensionPolyfillReject__?y(new Error(O.message)):_(O)},k=(y,_,O,...R)=>{if(R.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${d(_.minArgs)} for ${y}(), got ${R.length}`);if(R.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${d(_.maxArgs)} for ${y}(), got ${R.length}`);return new Promise((V,x)=>{const P=w.bind(null,{resolve:V,reject:x});R.push(P),O.sendMessage(...R)})},E={devtools:{network:{onRequestFinished:S(C)}},runtime:{onMessage:S(v),onMessageExternal:S(v),sendMessage:k.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:k.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},D={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return o.privacy={network:{"*":D},services:{"*":D},websites:{"*":D}},A(l,E,o)};n.exports=a(chrome)}else n.exports=globalThis.browser})})(Ua);const le=Ua.exports;class Vd{constructor(t,n=Date.now()){this.logMethod=t,this.startedAt=n}log(t){const n=Date.now()-this.startedAt;this.logMethod(t.replace(/\{duration\}/g,`${(n/1e3).toFixed(3)}s`))}}const Dn=1e3,ri=60*Dn,Gd=60*ri;function as(e){return Math.round(e/1e3)}function Hd(){return new Promise(e=>setTimeout(e,0))}function qd(e){const t=new La;return(...n)=>t.runExclusive(()=>e(...n))}async function si(e){return(await le.storage.local.get(e))[e]}async function pr(e,t){t===void 0?await le.storage.local.remove(e):await le.storage.local.set({[e]:t})}function zd(e,t){const n=typeof t=="string",r=s=>n?s[t]:t(s);return e.reduce((s,i)=>{var a,l;const o=r(i);return s[o]=(l=(a=s[o])==null?void 0:a.concat(i))!=null?l:[i],s},{})}function Zd(e,t){const n=typeof t=="string",r=s=>n?s[t]:t(s);return e.reduce((s,i)=>{const a=r(i);return s[a]=i,s},{})}function Kd(){let e,t;return[new Promise((n,r)=>{e=n,t=r}),e,t]}function Yd(e){return e.state!=="docked"&&e.state!=="minimized"}function Jd(e,t,n,r){return r&&e.audible||e.active&&t.focused&&Yd(t)&&n}function Ba(e){const t=e.objectStoreNames.length,n=[];for(let r=0;r<t;r++){const s=e.objectStoreNames.item(r);s&&n.push(s)}return n}const ii=-1;function ja(e){var t;return{id:e.id,appId:e.appId,createdBy:e.createdBy,endedAt:(t=e.endedAt)!=null?t:ii,startedAt:e.startedAt,imported:e.imported,generated:e.generated}}function dn(e){return{id:e.id,appId:e.appId,createdBy:e.createdBy,endedAt:e.endedAt===ii?null:e.endedAt,startedAt:e.startedAt,imported:e.imported,generated:e.generated}}const Rt=class extends ei{constructor(e){super(e.db,Rt.STORE_NAME_LATEST),this.config=e}async startSession(e){const t=await this.db,n=ka.parse({...e,id:hr(),createdBy:await this.config.getInstallId(),endedAt:void 0}),r=ja(n);return await t.add(this.storeName,r),n}async createSessions(e){const t=await this.db,n=await this.config.getInstallId(),r=t.transaction(Rt.STORE_NAME_LATEST,"readwrite"),s=r.objectStore(Rt.STORE_NAME_LATEST),i=e.map(l=>ka.parse({...l,id:hr(),createdBy:n})),a=i.map(ja);return await Promise.all([...a.map(l=>s.add(l)),r.done]),i}async endSession(e,t){var n,r;const s=await this.db;t-e.startedAt>=6*Gd&&((r=(n=this.config).onLongSessionDetected)==null||r.call(n,e,t),t=e.startedAt+10*ri);const i=await s.get(this.storeName,e.id);if(i==null)throw Error(`Cannot update: Session not found with id=${e.id}`);const a={...i,endedAt:t};return await s.put(this.storeName,a),dn(a)}async findAllSessions(){return(await super.findAll()).map(dn)}async findSessions(e,t){return(await(await this.db).getAllFromIndex(this.storeName,Rt.INDEX_STARTED_AT,IDBKeyRange.bound(e,t,!1,!0))).map(dn)}async findSessionsByEndedAt(e,t){return(await(await this.db).getAllFromIndex(this.storeName,Rt.INDEX_ENDED_AT,IDBKeyRange.bound(e,t,!1,!0))).map(dn)}async findOldestSession(){const e=(await(await this.db).getAllFromIndex(this.storeName,Rt.INDEX_STARTED_AT,IDBKeyRange.lowerBound(0,!0))).shift();return e?dn(e):void 0}async getSession(e){const t=await(await this.db).get(this.storeName,e);if(t==null)throw Error(`No session with id=${e} was found`);return dn(t)}async getActiveSessions(){return(await(await this.db).getAllFromIndex(this.storeName,Rt.INDEX_ENDED_AT,ii)).map(dn)}async deleteAllGeneratedSessions(){const e=(await this.db).transaction(this.storeName,"readwrite");let t=await e.store.openCursor();for(;t;){const n=t.value;(n.imported||n.generated)&&await t.delete(),t=await t.continue()}await e.done}};let be=Rt;be.STORE_NAME_1="sessions",be.STORE_NAME_2="sessions_2",be.STORE_NAME_LATEST=Rt.STORE_NAME_2,be.INDEX_ENDED_AT="idx_session_endedAt",be.INDEX_STARTED_AT="idx_session_startedAt";var Me=(e=>(e[e.V2=2]="V2",e[e.V3=3]="V3",e[e.V4=4]="V4",e[e.V5=5]="V5",e[e.V6=6]="V6",e[e.V7=7]="V7",e[e.V8=8]="V8",e))(Me||{});const Qd=rt.object({version:rt.nativeEnum(Me),stores:rt.object({[be.STORE_NAME_LATEST]:rt.array(Md).optional(),[Nt.STORE_NAME_LATEST]:rt.array(Nd).optional(),[_e.STORE_NAME_LATEST]:rt.array(Da).optional()})});rt.object({version:rt.nativeEnum(Me),stores:rt.record(rt.string(),rt.array(rt.any()))});async function Xd(e){const t=await e,n={version:t.version,stores:{}},r=Ba(t),s=t.transaction(r,"readonly");for(const i of r){const a=await s.objectStore(i).getAll();a.forEach(l=>{delete l.imported}),n.stores[i]=a}return await s.done,n}function eh(e,t){return{...e,id:hr(),sessionId:t}}function th(e){return{...e,id:hr()}}function Fa(e){return{id:e.id,sessionId:e.sessionId,timestamp:e.timestamp,type:"basic-display",details:{type:e.type,height:e.additionalDetails.height,width:e.additionalDetails.width,url:e.adUrl}}}function os(e,t){var n;return{id:e.id,appId:e.host,createdBy:t,startedAt:e.startedAt,endedAt:(n=e.endedAt)!=null?n:-1,imported:e.imported,generated:e.generated}}async function nh({dbPromise:e,usageBackup:t,logger:n,getInstallId:r}){const s=await e;n==null||n.debug("[import-backup] Importing...",t);const i=await r(),a=await Qd.parseAsync(await $a(t,s.version,{installId:i})),l=Ba(s),o=s.transaction(l,"readwrite");for(const c of l){const u=a.stores[c];if(u!=null&&u.length){const h=o.objectStore(c);for(const d of u)n==null||n.debug(`[import-backup]: ${c}:`,d),await h.put({...d,imported:!0})}}await o.done}const ai=e=>t=>({...t,version:e}),rh=()=>e=>e,sh=e=>{var t;return{version:Me.V4,stores:{[be.STORE_NAME_2]:e.stores[be.STORE_NAME_2],[_e.STORE_NAME_2]:(t=e.stores[_e.STORE_NAME_2])==null?void 0:t.map(Fa)}}},ih=(e,{installId:t})=>{var n;return{version:Me.V6,stores:{[be.STORE_NAME_2]:(n=e.stores[be.STORE_NAME_2])==null?void 0:n.map(r=>os(r,t)),[_e.STORE_NAME_2]:e.stores[_e.STORE_NAME_2]}}},ah=(e,{installId:t})=>{var n;return{version:Me.V7,stores:{[be.STORE_NAME_2]:(n=e.stores[be.STORE_NAME_2])==null?void 0:n.map(r=>"host"in r?os(r,t):r),[_e.STORE_NAME_2]:e.stores[_e.STORE_NAME_2]}}},oh={[Me.V2]:ai(Me.V3),[Me.V3]:sh,[Me.V4]:ai(Me.V5),[Me.V5]:ih,[Me.V6]:ah,[Me.V7]:ai(Me.V8),[Me.V8]:rh()};async function $a(e,t,n){if(e.version===t)return e;const r=oh[e.version];if(r==null)throw Error(`Failed to upgrade backup version ${e.version}, version not supported`);const s=await r(e,n);return await $a(s,t,n)}const ch=(e,t)=>t.some(n=>e instanceof n);let Wa,Va;function lh(){return Wa||(Wa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function uh(){return Va||(Va=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ga=new WeakMap,oi=new WeakMap,Ha=new WeakMap,ci=new WeakMap,li=new WeakMap;function dh(e){const t=new Promise((n,r)=>{const s=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{n(Gt(e.result)),s()},a=()=>{r(e.error),s()};e.addEventListener("success",i),e.addEventListener("error",a)});return t.then(n=>{n instanceof IDBCursor&&Ga.set(n,e)}).catch(()=>{}),li.set(t,e),t}function hh(e){if(oi.has(e))return;const t=new Promise((n,r)=>{const s=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{n(),s()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)});oi.set(e,t)}let ui={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return oi.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Ha.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Gt(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function gh(e){ui=e(ui)}function fh(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const r=e.call(di(this),t,...n);return Ha.set(r,t.sort?t.sort():[t]),Gt(r)}:uh().includes(e)?function(...t){return e.apply(di(this),t),Gt(Ga.get(this))}:function(...t){return Gt(e.apply(di(this),t))}}function ph(e){return typeof e=="function"?fh(e):(e instanceof IDBTransaction&&hh(e),ch(e,lh())?new Proxy(e,ui):e)}function Gt(e){if(e instanceof IDBRequest)return dh(e);if(ci.has(e))return ci.get(e);const t=ph(e);return t!==e&&(ci.set(e,t),li.set(t,e)),t}const di=e=>li.get(e);function mh(e,t,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(e,t),l=Gt(a);return r&&a.addEventListener("upgradeneeded",o=>{r(Gt(a.result),o.oldVersion,o.newVersion,Gt(a.transaction),o)}),n&&a.addEventListener("blocked",o=>n(o.oldVersion,o.newVersion,o)),l.then(o=>{i&&o.addEventListener("close",()=>i()),s&&o.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),l}const yh=["get","getKey","getAll","getAllKeys","count"],bh=["put","add","delete","clear"],hi=new Map;function qa(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(hi.get(t))return hi.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=bh.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||yh.includes(n)))return;const i=async function(a,...l){const o=this.transaction(a,s?"readwrite":"readonly");let c=o.store;return r&&(c=c.index(l.shift())),(await Promise.all([c[n](...l),s&&o.done]))[0]};return hi.set(t,i),i}gh(e=>({...e,get:(t,n,r)=>qa(t,n)||e.get(t,n,r),has:(t,n)=>!!qa(t,n)||e.has(t,n)}));async function vh({db:e,tx:t}){const n=t.objectStore(be.STORE_NAME_1),r=t.objectStore(be.STORE_NAME_2),s=t.objectStore(_e.STORE_NAME_1),i=t.objectStore(_e.STORE_NAME_2),a=await n.index(be.INDEX_STARTED_AT).getAll();for(const l of a){const o=th(l);await r.add(o);const c=await s.index(_e.INDEX_SESSION_ID).getAll(l.id);for(const u of c){const h=eh(u,o.id);await i.add(h)}}e.deleteObjectStore(n.name),e.deleteObjectStore(s.name)}async function wh({tx:e}){const t=e.objectStore(_e.STORE_NAME_2),n=await t.getAll();for(const r of n){const s=Fa(r);await t.put(s)}}async function Ah({tx:e,ctx:t}){const n=e.objectStore(be.STORE_NAME_2),r=await n.getAll();for(const s of r){const i=os(s,t.installId);await n.put(i)}}async function _h({tx:e,ctx:t}){const n=e.objectStore(be.STORE_NAME_2),r=await n.getAll();for(const s of r)if("host"in s){const i=os(s,t.installId);await n.put(i)}}const cs=()=>{},xh=[cs,cs,cs,vh,wh,cs,Ah,_h];async function Sh(e,{logger:t}){if(e.oldVersion===0||e.newVersion==null){t==null||t.debug("[usage-database] Skipping migrations for new databases",{oldVersion:e.oldVersion,newVersion:e.newVersion});return}const n=e.oldVersion+1,r=e.newVersion,s=xh.slice(n,r+1);if(s.length===0){t==null||t.log("[usage-database] No migrations to run");return}t==null||t.log(`[usage-database] Running migrations ${n} -> ${r}`);for(const i of s)await i(e)}function Mn(e,t,n,r){return e.indexNames.contains(t)?e.index(t):e.createIndex(t,n,r)}function gi({db:e,tx:t},n,r){return e.objectStoreNames.contains(n)?t.objectStore(n):e.createObjectStore(n,r)}const Th=Me.V8;async function Eh(e){const t=await e.getInstallId();return mh("UsageSdkDb",Th,{async upgrade(n,r,s,i){const a={db:n,oldVersion:r,newVersion:s,tx:i,ctx:{installId:t}};Ch(a),await Sh(a,{logger:null})}})}function Ch(e){const t=gi(e,be.STORE_NAME_LATEST,{keyPath:"id"});Mn(t,be.INDEX_STARTED_AT,"startedAt",{unique:!1}),Mn(t,be.INDEX_ENDED_AT,"endedAt",{unique:!1});const n=gi(e,Nt.STORE_NAME_LATEST,{keyPath:"id"});Mn(n,Nt.INDEX_STARTED_AT,"startedAt",{unique:!1}),Mn(n,Nt.INDEX_ENDED_AT,"endedAt",{unique:!1});const r=gi(e,_e.STORE_NAME_LATEST,{keyPath:"id"});Mn(r,_e.INDEX_SESSION_ID,"sessionId",{unique:!1}),Mn(r,_e.INDEX_TIMESTAMP,"timestamp",{unique:!1})}function Oh(e){const t=Eh(e),n=e.logger===void 0?console:e.logger;return{indexedDb:t,sessionsRepo:new be({db:t,...e}),pageViewsRepo:new Nt({db:t,...e}),adsRepo:new _e({db:t,...e}),exportBackup:()=>Xd(t),importBackup:r=>nh({dbPromise:t,usageBackup:r,getInstallId:e.getInstallId,logger:n})}}var fi={exports:{}};(function(e,t){var n=200,r="__lodash_hash_undefined__",s=1,i=2,a=9007199254740991,l="[object Arguments]",o="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",h="[object Date]",d="[object Error]",f="[object Function]",g="[object GeneratorFunction]",m="[object Map]",A="[object Number]",S="[object Null]",C="[object Object]",v="[object Promise]",w="[object Proxy]",k="[object RegExp]",E="[object Set]",D="[object String]",y="[object Symbol]",_="[object Undefined]",O="[object WeakMap]",R="[object ArrayBuffer]",V="[object DataView]",x="[object Float32Array]",P="[object Float64Array]",p="[object Int8Array]",I="[object Int16Array]",M="[object Int32Array]",j="[object Uint8Array]",U="[object Uint8ClampedArray]",H="[object Uint16Array]",q="[object Uint32Array]",xe=/[\\^$.*+?()[\]{}|]/g,bt=/^\[object .+?Constructor\]$/,Ct=/^(?:0|[1-9]\d*)$/,ie={};ie[x]=ie[P]=ie[p]=ie[I]=ie[M]=ie[j]=ie[U]=ie[H]=ie[q]=!0,ie[l]=ie[o]=ie[R]=ie[u]=ie[V]=ie[h]=ie[d]=ie[f]=ie[m]=ie[A]=ie[C]=ie[k]=ie[E]=ie[D]=ie[O]=!1;var Ot=typeof fr=="object"&&fr&&fr.Object===Object&&fr,_r=typeof self=="object"&&self&&self.Object===Object&&self,ct=Ot||_r||Function("return this")(),xr=t&&!t.nodeType&&t,Sr=xr&&!0&&e&&!e.nodeType&&e,Ts=Sr&&Sr.exports===xr,qt=Ts&&Ot.process,Tr=function(){try{return qt&&qt.binding&&qt.binding("util")}catch{}}(),zt=Tr&&Tr.isTypedArray;function ki(b,T){for(var L=-1,W=b==null?0:b.length,de=0,Q=[];++L<W;){var me=b[L];T(me,L,b)&&(Q[de++]=me)}return Q}function Er(b,T){for(var L=-1,W=T.length,de=b.length;++L<W;)b[de+L]=T[L];return b}function pn(b,T){for(var L=-1,W=b==null?0:b.length;++L<W;)if(T(b[L],L,b))return!0;return!1}function Cr(b,T){for(var L=-1,W=Array(b);++L<b;)W[L]=T(L);return W}function Di(b){return function(T){return b(T)}}function Es(b,T){return b.has(T)}function Cs(b,T){return b==null?void 0:b[T]}function Xe(b){var T=-1,L=Array(b.size);return b.forEach(function(W,de){L[++T]=[de,W]}),L}function Zt(b,T){return function(L){return b(T(L))}}function Wn(b){var T=-1,L=Array(b.size);return b.forEach(function(W){L[++T]=W}),L}var te=Array.prototype,ae=Function.prototype,Y=Object.prototype,oe=ct["__core-js_shared__"],vt=ae.toString,ve=Y.hasOwnProperty,se=function(){var b=/[^.]+$/.exec(oe&&oe.keys&&oe.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),K=Y.toString,lt=RegExp("^"+vt.call(ve).replace(xe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vn=Ts?ct.Buffer:void 0,mn=ct.Symbol,Yo=ct.Uint8Array,Jo=Y.propertyIsEnumerable,Yp=te.splice,yn=mn?mn.toStringTag:void 0,Qo=Object.getOwnPropertySymbols,Jp=Vn?Vn.isBuffer:void 0,Qp=Zt(Object.keys,Object),Mi=Gn(ct,"DataView"),Or=Gn(ct,"Map"),Ni=Gn(ct,"Promise"),Ri=Gn(ct,"Set"),Li=Gn(ct,"WeakMap"),Ir=Gn(Object,"create"),Xp=wn(Mi),em=wn(Or),tm=wn(Ni),nm=wn(Ri),rm=wn(Li),Xo=mn?mn.prototype:void 0,Ui=Xo?Xo.valueOf:void 0;function bn(b){var T=-1,L=b==null?0:b.length;for(this.clear();++T<L;){var W=b[T];this.set(W[0],W[1])}}function sm(){this.__data__=Ir?Ir(null):{},this.size=0}function im(b){var T=this.has(b)&&delete this.__data__[b];return this.size-=T?1:0,T}function am(b){var T=this.__data__;if(Ir){var L=T[b];return L===r?void 0:L}return ve.call(T,b)?T[b]:void 0}function om(b){var T=this.__data__;return Ir?T[b]!==void 0:ve.call(T,b)}function cm(b,T){var L=this.__data__;return this.size+=this.has(b)?0:1,L[b]=Ir&&T===void 0?r:T,this}bn.prototype.clear=sm,bn.prototype.delete=im,bn.prototype.get=am,bn.prototype.has=om,bn.prototype.set=cm;function Bt(b){var T=-1,L=b==null?0:b.length;for(this.clear();++T<L;){var W=b[T];this.set(W[0],W[1])}}function lm(){this.__data__=[],this.size=0}function um(b){var T=this.__data__,L=Is(T,b);if(L<0)return!1;var W=T.length-1;return L==W?T.pop():Yp.call(T,L,1),--this.size,!0}function dm(b){var T=this.__data__,L=Is(T,b);return L<0?void 0:T[L][1]}function hm(b){return Is(this.__data__,b)>-1}function gm(b,T){var L=this.__data__,W=Is(L,b);return W<0?(++this.size,L.push([b,T])):L[W][1]=T,this}Bt.prototype.clear=lm,Bt.prototype.delete=um,Bt.prototype.get=dm,Bt.prototype.has=hm,Bt.prototype.set=gm;function vn(b){var T=-1,L=b==null?0:b.length;for(this.clear();++T<L;){var W=b[T];this.set(W[0],W[1])}}function fm(){this.size=0,this.__data__={hash:new bn,map:new(Or||Bt),string:new bn}}function pm(b){var T=Ps(this,b).delete(b);return this.size-=T?1:0,T}function mm(b){return Ps(this,b).get(b)}function ym(b){return Ps(this,b).has(b)}function bm(b,T){var L=Ps(this,b),W=L.size;return L.set(b,T),this.size+=L.size==W?0:1,this}vn.prototype.clear=fm,vn.prototype.delete=pm,vn.prototype.get=mm,vn.prototype.has=ym,vn.prototype.set=bm;function Os(b){var T=-1,L=b==null?0:b.length;for(this.__data__=new vn;++T<L;)this.add(b[T])}function vm(b){return this.__data__.set(b,r),this}function wm(b){return this.__data__.has(b)}Os.prototype.add=Os.prototype.push=vm,Os.prototype.has=wm;function Kt(b){var T=this.__data__=new Bt(b);this.size=T.size}function Am(){this.__data__=new Bt,this.size=0}function _m(b){var T=this.__data__,L=T.delete(b);return this.size=T.size,L}function xm(b){return this.__data__.get(b)}function Sm(b){return this.__data__.has(b)}function Tm(b,T){var L=this.__data__;if(L instanceof Bt){var W=L.__data__;if(!Or||W.length<n-1)return W.push([b,T]),this.size=++L.size,this;L=this.__data__=new vn(W)}return L.set(b,T),this.size=L.size,this}Kt.prototype.clear=Am,Kt.prototype.delete=_m,Kt.prototype.get=xm,Kt.prototype.has=Sm,Kt.prototype.set=Tm;function Em(b,T){var L=ks(b),W=!L&&$m(b),de=!L&&!W&&Bi(b),Q=!L&&!W&&!de&&cc(b),me=L||W||de||Q,Oe=me?Cr(b.length,String):[],Le=Oe.length;for(var fe in b)(T||ve.call(b,fe))&&!(me&&(fe=="length"||de&&(fe=="offset"||fe=="parent")||Q&&(fe=="buffer"||fe=="byteLength"||fe=="byteOffset")||Lm(fe,Le)))&&Oe.push(fe);return Oe}function Is(b,T){for(var L=b.length;L--;)if(sc(b[L][0],T))return L;return-1}function Cm(b,T,L){var W=T(b);return ks(b)?W:Er(W,L(b))}function Pr(b){return b==null?b===void 0?_:S:yn&&yn in Object(b)?Nm(b):Fm(b)}function ec(b){return kr(b)&&Pr(b)==l}function tc(b,T,L,W,de){return b===T?!0:b==null||T==null||!kr(b)&&!kr(T)?b!==b&&T!==T:Om(b,T,L,W,tc,de)}function Om(b,T,L,W,de,Q){var me=ks(b),Oe=ks(T),Le=me?o:Yt(b),fe=Oe?o:Yt(T);Le=Le==l?C:Le,fe=fe==l?C:fe;var et=Le==C,wt=fe==C,Fe=Le==fe;if(Fe&&Bi(b)){if(!Bi(T))return!1;me=!0,et=!1}if(Fe&&!et)return Q||(Q=new Kt),me||cc(b)?nc(b,T,L,W,de,Q):Dm(b,T,Le,L,W,de,Q);if(!(L&s)){var ut=et&&ve.call(b,"__wrapped__"),dt=wt&&ve.call(T,"__wrapped__");if(ut||dt){var Jt=ut?b.value():b,jt=dt?T.value():T;return Q||(Q=new Kt),de(Jt,jt,L,W,Q)}}return Fe?(Q||(Q=new Kt),Mm(b,T,L,W,de,Q)):!1}function Im(b){if(!oc(b)||Bm(b))return!1;var T=ic(b)?lt:bt;return T.test(wn(b))}function Pm(b){return kr(b)&&ac(b.length)&&!!ie[Pr(b)]}function km(b){if(!jm(b))return Qp(b);var T=[];for(var L in Object(b))ve.call(b,L)&&L!="constructor"&&T.push(L);return T}function nc(b,T,L,W,de,Q){var me=L&s,Oe=b.length,Le=T.length;if(Oe!=Le&&!(me&&Le>Oe))return!1;var fe=Q.get(b);if(fe&&Q.get(T))return fe==T;var et=-1,wt=!0,Fe=L&i?new Os:void 0;for(Q.set(b,T),Q.set(T,b);++et<Oe;){var ut=b[et],dt=T[et];if(W)var Jt=me?W(dt,ut,et,T,b,Q):W(ut,dt,et,b,T,Q);if(Jt!==void 0){if(Jt)continue;wt=!1;break}if(Fe){if(!pn(T,function(jt,An){if(!Es(Fe,An)&&(ut===jt||de(ut,jt,L,W,Q)))return Fe.push(An)})){wt=!1;break}}else if(!(ut===dt||de(ut,dt,L,W,Q))){wt=!1;break}}return Q.delete(b),Q.delete(T),wt}function Dm(b,T,L,W,de,Q,me){switch(L){case V:if(b.byteLength!=T.byteLength||b.byteOffset!=T.byteOffset)return!1;b=b.buffer,T=T.buffer;case R:return!(b.byteLength!=T.byteLength||!Q(new Yo(b),new Yo(T)));case u:case h:case A:return sc(+b,+T);case d:return b.name==T.name&&b.message==T.message;case k:case D:return b==T+"";case m:var Oe=Xe;case E:var Le=W&s;if(Oe||(Oe=Wn),b.size!=T.size&&!Le)return!1;var fe=me.get(b);if(fe)return fe==T;W|=i,me.set(b,T);var et=nc(Oe(b),Oe(T),W,de,Q,me);return me.delete(b),et;case y:if(Ui)return Ui.call(b)==Ui.call(T)}return!1}function Mm(b,T,L,W,de,Q){var me=L&s,Oe=rc(b),Le=Oe.length,fe=rc(T),et=fe.length;if(Le!=et&&!me)return!1;for(var wt=Le;wt--;){var Fe=Oe[wt];if(!(me?Fe in T:ve.call(T,Fe)))return!1}var ut=Q.get(b);if(ut&&Q.get(T))return ut==T;var dt=!0;Q.set(b,T),Q.set(T,b);for(var Jt=me;++wt<Le;){Fe=Oe[wt];var jt=b[Fe],An=T[Fe];if(W)var lc=me?W(An,jt,Fe,T,b,Q):W(jt,An,Fe,b,T,Q);if(!(lc===void 0?jt===An||de(jt,An,L,W,Q):lc)){dt=!1;break}Jt||(Jt=Fe=="constructor")}if(dt&&!Jt){var Ds=b.constructor,Ms=T.constructor;Ds!=Ms&&"constructor"in b&&"constructor"in T&&!(typeof Ds=="function"&&Ds instanceof Ds&&typeof Ms=="function"&&Ms instanceof Ms)&&(dt=!1)}return Q.delete(b),Q.delete(T),dt}function rc(b){return Cm(b,Gm,Rm)}function Ps(b,T){var L=b.__data__;return Um(T)?L[typeof T=="string"?"string":"hash"]:L.map}function Gn(b,T){var L=Cs(b,T);return Im(L)?L:void 0}function Nm(b){var T=ve.call(b,yn),L=b[yn];try{b[yn]=void 0;var W=!0}catch{}var de=K.call(b);return W&&(T?b[yn]=L:delete b[yn]),de}var Rm=Qo?function(b){return b==null?[]:(b=Object(b),ki(Qo(b),function(T){return Jo.call(b,T)}))}:Hm,Yt=Pr;(Mi&&Yt(new Mi(new ArrayBuffer(1)))!=V||Or&&Yt(new Or)!=m||Ni&&Yt(Ni.resolve())!=v||Ri&&Yt(new Ri)!=E||Li&&Yt(new Li)!=O)&&(Yt=function(b){var T=Pr(b),L=T==C?b.constructor:void 0,W=L?wn(L):"";if(W)switch(W){case Xp:return V;case em:return m;case tm:return v;case nm:return E;case rm:return O}return T});function Lm(b,T){return T=T??a,!!T&&(typeof b=="number"||Ct.test(b))&&b>-1&&b%1==0&&b<T}function Um(b){var T=typeof b;return T=="string"||T=="number"||T=="symbol"||T=="boolean"?b!=="__proto__":b===null}function Bm(b){return!!se&&se in b}function jm(b){var T=b&&b.constructor,L=typeof T=="function"&&T.prototype||Y;return b===L}function Fm(b){return K.call(b)}function wn(b){if(b!=null){try{return vt.call(b)}catch{}try{return b+""}catch{}}return""}function sc(b,T){return b===T||b!==b&&T!==T}var $m=ec(function(){return arguments}())?ec:function(b){return kr(b)&&ve.call(b,"callee")&&!Jo.call(b,"callee")},ks=Array.isArray;function Wm(b){return b!=null&&ac(b.length)&&!ic(b)}var Bi=Jp||qm;function Vm(b,T){return tc(b,T)}function ic(b){if(!oc(b))return!1;var T=Pr(b);return T==f||T==g||T==c||T==w}function ac(b){return typeof b=="number"&&b>-1&&b%1==0&&b<=a}function oc(b){var T=typeof b;return b!=null&&(T=="object"||T=="function")}function kr(b){return b!=null&&typeof b=="object"}var cc=zt?Di(zt):Pm;function Gm(b){return Wm(b)?Em(b):km(b)}function Hm(){return[]}function qm(){return!1}e.exports=Vm})(fi,fi.exports);const Ih=fi.exports;function za(e,t){var n;if(typeof e=="string"&&(e=Ph(e.trim())),!e)return;let r=(n=t==null?void 0:t.removeGenericPrefixes)!=null?n:!0,s=e.hostname;return r&&(s=s.replace(/^(m|mobile|amp|www|www1|www2|www3|tab|item|checkout|secure|user|account|accounts|web|app|open|i|v|preview|cdn|l|id|nid|user|sso|signin|login|auth0|play|api|click|detail|dashboard|console|manage|support|help)\./,"").replace(/.*\.zoom\.us/,"zoom.us").replace(/.*\.slack\.com/,"slack.com").replace(/.*\.wikipedia\.org/,"wikipedia.org").replace(/.*\.amazonaws\.com/,"amazonaws.com").replace(/.*\.netsuite\.com/,"netsuite.com")),{hostname:s,path:kh(e.pathname)}}function Ph(e){if(!e)return;let t=n=>{let r=new URL(n);if(!/^https?:/.test(r.protocol))throw Error("Invalid URL, ignored protocol found");if(!r.hostname)throw Error("Invalid URL, no hostname");if(r.hostname.lastIndexOf(".")>=r.hostname.length-2)throw Error("Invalid URL, bad domain ending");return r};try{return t(e)}catch{}if(!e.includes("://"))try{return t("https://"+e)}catch{}}function kh(e){return e.endsWith("/")?e.substring(0,Math.max(1,e.length-1)):e}const ls="tab-history-map",Za=class{constructor(e){this.tabHistoryMap=this.restoreTabHistory(),this.lock=new La;let t=0;le.tabs.onCreated.addListener(n=>this.lock.runExclusive(async()=>{var r;if(n.id!=null&&(e==null||e.debug(`[referrer] ${t++} tabs.onCreated`,n),n.openerTabId!=null)){const s=(r=(await this.tabHistoryMap)[n.openerTabId])==null?void 0:r[0];s&&await this.addHistory(n.id,s)}})),le.webNavigation.onCommitted.addListener(n=>this.lock.runExclusive(async()=>{e==null||e.debug(`[referrer] ${t++} webNavigation.onCommitted`,n);const{frameId:r,tabId:s,url:i,transitionQualifiers:a}=n;r===0&&((a.includes("forward_back")||a.includes("from_address_bar"))&&await this.addHistory(s,void 0),await this.addHistory(s,i))})),le.runtime.onStartup.addListener(()=>this.resetHistory()),le.runtime.onSuspend.addListener(()=>this.resetHistory()),le.tabs.onRemoved.addListener(n=>this.removeHistory(n))}async restoreTabHistory(){const e=await si(ls);return e??{}}async addHistory(e,t){var n;const r=await this.tabHistoryMap,s=(n=r[e])!=null?n:r[e]=[];t!==s[0]&&s.unshift(this.sanatizeReferrerUrl(t)),s.splice(Za.MAX_HISTORY_COUNT_PER_TAB),await pr(ls,r)}sanatizeReferrerUrl(e){if(e)try{const t=new URL(e);return t.search="",t.username="",t.password="",t.hash="",t.href}catch{return}}getReferrerFor(e,t){return this.lock.runExclusive(async()=>{if(e==null||!t)return;const n=(await this.tabHistoryMap)[e];if(n==null)return;const r=n.findIndex(s=>s===t);return r===-1?void 0:n[r+1]})}resetHistory(){return pr(ls,{})}async removeHistory(e){const t=await this.tabHistoryMap;delete t[e],await pr(ls,t)}};let Ka=Za;Ka.MAX_HISTORY_COUNT_PER_TAB=10;class Ya{constructor(){this.map={}}markAsProcessed(t){t.forEach(n=>this.map[n.id]=!0)}isProcessed(t){var n;return(n=this.map[t.id])!=null?n:!1}}const Tt=class{constructor(e,t){this.wakeUpTimeoutDisabled=!1,this.hasRecentUserActivity=!0,this.sessionUpdatedListeners=[],this.pageViewUpdatedListeners=[],this.checkSessionsListeners=[],this.latestTriggerId=0,this.updateSessions=qd(async s=>{var i,a,l;const o=`[update-sessions] [${s.triggerId}]`;if((i=this.logger)==null||i.debug(`${o} Waiting for startup to stop previous sessions...`),await this.startupPromise,(a=this.logger)==null||a.debug(`${o} Processing @ ${new Date(s.timestamp).toLocaleTimeString()}`),this.pingLastAliveAt(),this.invokeCheckSessionsListeners(),await this.config.enabled()){const c=this.logger?new Vd(this.logger.debug.bind(this.logger)):void 0,u=await this.getComputeDependencies();c==null||c.log(`${o} Got required data after {duration}`);const h=this.findSessionChanges(s,u);c==null||c.log(`${o} Computed session changes after {duration}`);const d=await this.findPageViewChanges(s,u);c==null||c.log(`${o} Computed page view changes after {duration}`),await this.saveSessionChanges(s.timestamp,h),c==null||c.log(`${o} Session changes committed to the database after {duration}`),await this.savePageViewChanges(s.timestamp,d),c==null||c.log(`${o} Page view changes committed to the database after {duration}`)}(l=this.logger)==null||l.log(`${o} Done`)}),this.config=t,this.sessionsRepo=e.sessionsRepo,this.pageViewsRepo=e.pageViewsRepo,this.updateSessions=this.updateSessions.bind(this),t.logger===void 0?this.logger=console:this.logger=t.logger;const[n,r]=Kd();this.startupPromise=n,this.allowSessionUpdates=r}setupTriggers(){var e,t;this.referrers=new Ka(this.logger),(t=(e=this.config).setupCustomTriggers)==null||t.call(e,{triggerSessionChangeCheck:this.basicTrigger.bind(this),setHasRecentUserActivity:this.setHasRecentUserActivity.bind(this)}),this.setupExtensionApiTriggers(),this.setupIdleTriggers(),this.setupStartupTriggers()}addSessionUpdatedListener(e){this.sessionUpdatedListeners.push(e)}addPageViewUpdatedListener(e){this.pageViewUpdatedListeners.push(e)}addCheckSessionsListener(e){this.checkSessionsListeners.push(e)}setupExtensionApiTriggers(){le.webNavigation.onCompleted.addListener(async e=>{e.frameId>0||await this.basicTrigger("webNavigation.onCompleted",Math.floor(e.timeStamp))}),le.tabs.onCreated.addListener(()=>this.basicTrigger("tabs.onCreated")),le.tabs.onUpdated.addListener(()=>this.basicTrigger("tabs.onUpdated")),le.tabs.onActivated.addListener(()=>this.basicTrigger("tabs.onActivated")),le.tabs.onRemoved.addListener(()=>this.basicTrigger("tabs.onRemoved")),le.windows.onCreated.addListener(()=>this.basicTrigger("windows.onCreated")),le.windows.onFocusChanged.addListener(()=>this.basicTrigger("windows.onFocusChanged")),le.windows.onRemoved.addListener(()=>this.basicTrigger("windows.onRemoved")),this.onWindowStateChanged(e=>this.basicTrigger("SessionMonitor.onWindowStateChanged",e))}setupIdleTriggers(){}setupStartupTriggers(){const e=Date.now();this.config.isOnStartupAvailable()?(le.runtime.onStartup.addListener(()=>{this.wakeUpTimeoutDisabled=!0,this.startupFlow({cleanupSessions:!0,trigger:"runtime.onStartup",timestamp:e})}),setTimeout(()=>{this.wakeUpTimeoutDisabled||this.startupFlow({cleanupSessions:!1,trigger:"setTimeout",timestamp:e})},Tt.ALWAYS_STARTUP_AFTER_MS)):(le.alarms.clear("ping-last-alive-at"),le.alarms.create("ping-last-alive-at",{delayInMinutes:Tt.LAST_ALIVE_AT_INTERVAL_MS/Dn,periodInMinutes:Tt.LAST_ALIVE_AT_INTERVAL_MS/Dn}),le.alarms.onAlarm.addListener(n=>{if(n.name==="ping-last-alive-at")return this.pingLastAliveAt()}),this.getLastAliveAt().then(n=>{this.wakeUpTimeoutDisabled=!0;const r=n!=null&&Date.now()-n>2*Tt.LAST_ALIVE_AT_INTERVAL_MS;this.startupFlow({cleanupSessions:r,trigger:r?"time since last alive at > 2 * lastAliveInterval":"time since last alive at <= 2 * lastAliveInterval",timestamp:e})})),le.runtime.onInstalled.addListener(n=>{this.wakeUpTimeoutDisabled=!0,this.startupFlow({cleanupSessions:n.reason!=="install",trigger:"runtime.onInstalled",timestamp:e})});const{onSuspend:t}=le.runtime;t==null||t.addListener(()=>this.endAllActiveSessions(Date.now()))}basicTrigger(e,t=Date.now()){var n;const r=this.latestTriggerId++;return(n=this.logger)==null||n.log(`[update-sessions] [${r}] Queued by ${e} @ ${new Date(t).toLocaleTimeString()}`),this.updateSessions({timestamp:t,triggerId:r,triggeredBy:e})}onWindowStateChanged(e){let t={};this.getWindowStates().then(n=>{t=n}),setInterval(async()=>{const n=Date.now(),r=await this.getWindowStates();Ih(t,r)||(e(n),t=r)},Tt.WINDOW_STATE_POLLING_INTERVAL_MS)}async getWindowStates(){return(await le.windows.getAll()).reduce((e,t)=>(t.id!=null&&(e[t.id]=t.state),e),{})}async startupFlow({cleanupSessions:e,trigger:t,timestamp:n}){e&&await this.cleanupActiveSessionsOnStartup(n),await this.pingLastAliveAt(),await Hd().then(()=>this.allowSessionUpdates()),await this.basicTrigger(t,n)}async cleanupActiveSessionsOnStartup(e){var t,n,r,s;const i=await this.getLastAliveAt();if((t=this.logger)==null||t.debug("[on-startup] onStartup()",{lastActivity:i&&new Date(i).toISOString(),now:new Date(e).toISOString()}),i==null)throw Error("lastActivity was not set yet");(n=this.logger)==null||n.log("[on-startup] Ending sessions after quit...");const a=i+Tt.LAST_ALIVE_AT_POLL_INTERVAL_MS,l=Math.min(e,a);(r=this.logger)==null||r.log("[on-startup] Timing details:",{lastActivity:new Date(i).toISOString(),now:new Date(e).toISOString(),quitAt:new Date(a).toISOString(),endAt:new Date(l).toISOString()}),await this.endAllActiveSessions(l),(s=this.logger)==null||s.log("[on-startup] Startup finished!")}async getComputeDependencies(){const[e,t]=await Promise.all([le.windows.getAll(),le.tabs.query({})]),n=await this.sessionsRepo.getActiveSessions(),r=await this.pageViewsRepo.getActivePageViews();return{isTabActiveWhenPlayingAudio:await this.config.isTabActiveWhenPlayingAudio(),hostnameToTabsMap:t.reduce((s,i)=>{var a,l;const o=(a=za(i.url))==null?void 0:a.hostname;return o&&(s[o]!=null||(s[o]=[]),(l=s[o])==null||l.push(i)),s},{}),allActiveSessions:n,allActivePageViews:r,appIdToActiveSessionMap:zd(n??[],"appId"),windowIdToWindowMap:Zd(e,"id"),processedActiveSessionCache:new Ya,processedActivePageViewCache:new Ya}}findSessionChanges(e,t){var n,r,s;const i=[],a=[];for(const[l,o]of Object.entries(t.hostnameToTabsMap))if(l)try{if(!(o!=null&&o.length))throw Error("This shouldn't be possible");const c=t.appIdToActiveSessionMap[l],u=!!(c!=null&&c.length),h=!!o.find(d=>this.isTabActive(d,t));!u&&h?i.push({appId:l,startedAt:e.timestamp}):u&&!h&&a.push(...c),u&&t.processedActiveSessionCache.markAsProcessed(c)}catch(c){(n=this.logger)==null||n.error(`[update-sessions] Failed find sessions to change for ${l}:`,c)}return((s=(r=t.allActiveSessions)==null?void 0:r.filter(l=>!t.processedActiveSessionCache.isProcessed(l)))!=null?s:[]).forEach(l=>a.push(l)),{toStart:i,toEnd:a,count:i.length+a.length}}async findPageViewChanges(e,t){var n;const r=Object.values(t.hostnameToTabsMap).flat().filter(a=>!!a&&this.isTabActive(a,t)),s=[],i=[...t.allActivePageViews];for(const a of r){const l=za(a.url);if(l==null)continue;const o=t.allActivePageViews.filter(c=>c.appId===(l==null?void 0:l.hostname)&&c.path===l.path);if(o.length>0)for(const c of o){const u=i.findIndex(h=>h.id===c.id);u>=0&&i.splice(u,1)}else s.push({appId:l.hostname,path:l.path,startedAt:e.timestamp,referrer:await((n=this.referrers)==null?void 0:n.getReferrerFor(a.id,a.url))})}return{toStart:s,toEnd:i,count:s.length+i.length}}async saveSessionChanges(e,t){const n=t.toEnd.map(a=>{var l;const o=new Date(e).toLocaleTimeString();return(l=this.logger)==null||l.log(`[change-session] Stop session ${a.appId} @ ${o} (${e-a.startedAt}ms)`),this.sessionsRepo.endSession(a,e)}),r=t.toStart.map(a=>{var l;return(l=this.logger)==null||l.log(`[change-session] Start session ${a.appId} @ ${new Date(a.startedAt).toLocaleTimeString()}`,{session:a}),this.sessionsRepo.startSession(a)}),s=await Promise.allSettled(n),i=await Promise.allSettled(r);this.logSettledErrors("sessions","ending",s),this.logSettledErrors("sessions","starting",i),t.count>0&&this.invokeSessionUpdatedListeners()}async savePageViewChanges(e,t){const n=t.toEnd.map(a=>{var l;const o=new Date(e).toLocaleTimeString();return(l=this.logger)==null||l.log(`[change-session] Stop page view ${a.appId}${a.path} @ ${o} (${e-a.startedAt}ms)`),this.pageViewsRepo.endPageView(a,e)}),r=t.toStart.map(a=>{var l;return(l=this.logger)==null||l.log(`[change-session] Start page view ${a.appId}${a.path} @ ${new Date(a.startedAt).toLocaleTimeString()}`,{session:a}),this.pageViewsRepo.startPageView(a)}),s=await Promise.allSettled(n),i=await Promise.allSettled(r);this.logSettledErrors("page views","ending",s),this.logSettledErrors("page views","starting",i),t.count>0&&this.invokePageViewUpdatedListeners()}logSettledErrors(e,t,n){var r;const s=n.map(i=>{if(i.status==="rejected")return i.reason}).filter(i=>i!=null);s.length>0&&((r=this.logger)==null||r.warn(`[update-sessions] ${s.length}/${n.length} transactions failed when ${t} ${e}`,s))}isTabActive(e,t){var n;if(e.windowId==null)return(n=this.logger)==null||n.warn("[update-sessions] Checking if tab without a windowId is active"),!1;const r=t.windowIdToWindowMap[e.windowId];return!!r&&Jd(e,r,this.hasRecentUserActivity,t.isTabActiveWhenPlayingAudio)}async endAllActiveSessions(e){var t,n,r;const s=await this.sessionsRepo.getActiveSessions();if(s.length===0){(t=this.logger)==null||t.log("[stop-active-sessions] No active sessions to stop");return}(n=this.logger)==null||n.log("[stop-active-sessions] Stopping all active sessions:",{activeSessions:s,timestamp:e}),await this.saveSessionChanges(e,{toStart:[],toEnd:s,count:s.length}),(r=this.logger)==null||r.log("[stop-active-sessions] All active sessions stopped!")}async pingLastAliveAt(){var e;const t=Date.now();(e=this.logger)==null||e.debug("[SessionMonitor] Updating last time browser was known to be open",t),await pr(Tt.LAST_ALIVE_AT_KEY,t),clearTimeout(this.lastAlivePing),this.lastAlivePing=setTimeout(()=>this.pingLastAliveAt(),Tt.LAST_ALIVE_AT_POLL_INTERVAL_MS)}getLastAliveAt(){return si(Tt.LAST_ALIVE_AT_KEY)}invokeCheckSessionsListeners(){this.checkSessionsListeners.forEach(e=>e())}invokeSessionUpdatedListeners(){this.sessionUpdatedListeners.forEach(e=>e())}invokePageViewUpdatedListeners(){this.pageViewUpdatedListeners.forEach(e=>e())}setHasRecentUserActivity(e){this.hasRecentUserActivity=e}};let Nn=Tt;Nn.LAST_ALIVE_AT_KEY="last-activity-time-ms",Nn.LAST_ALIVE_AT_INTERVAL_MS=ri,Nn.LAST_ALIVE_AT_POLL_INTERVAL_MS=30*Dn,Nn.ALWAYS_STARTUP_AFTER_MS=5*Dn,Nn.WINDOW_STATE_POLLING_INTERVAL_MS=5*Dn;function Dh(e){const t=new Nn(e.db,e);return t.setupTriggers(),{sessionMonitor:t}}var Ja=1/0,Qa=9007199254740991,Mh=17976931348623157e292,Xa=0/0,Nh="[object Function]",Rh="[object GeneratorFunction]",Lh="[object Symbol]",Uh=/^\s+|\s+$/g,Bh=/^[-+]0x[0-9a-f]+$/i,jh=/^0b[01]+$/i,Fh=/^0o[0-7]+$/i,$h=/^(?:0|[1-9]\d*)$/,Wh=parseInt,Vh=Object.prototype,eo=Vh.toString,Gh=Math.ceil,Hh=Math.max;function qh(e,t,n){var r=-1,s=e.length;t<0&&(t=-t>s?0:s+t),n=n>s?s:n,n<0&&(n+=s),s=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(s);++r<s;)i[r]=e[r+t];return i}function zh(e,t){return t=t??Qa,!!t&&(typeof e=="number"||$h.test(e))&&e>-1&&e%1==0&&e<t}function Zh(e,t,n){if(!us(n))return!1;var r=typeof t;return(r=="number"?Jh(n)&&zh(t,n.length):r=="string"&&t in n)?Yh(n[t],e):!1}function Kh(e,t,n){(n?Zh(e,t,n):t===void 0)?t=1:t=Hh(rg(t),0);var r=e?e.length:0;if(!r||t<1)return[];for(var s=0,i=0,a=Array(Gh(r/t));s<r;)a[i++]=qh(e,s,s+=t);return a}function Yh(e,t){return e===t||e!==e&&t!==t}function Jh(e){return e!=null&&Xh(e.length)&&!Qh(e)}function Qh(e){var t=us(e)?eo.call(e):"";return t==Nh||t==Rh}function Xh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Qa}function us(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function eg(e){return!!e&&typeof e=="object"}function tg(e){return typeof e=="symbol"||eg(e)&&eo.call(e)==Lh}function ng(e){if(!e)return e===0?e:0;if(e=sg(e),e===Ja||e===-Ja){var t=e<0?-1:1;return t*Mh}return e===e?e:0}function rg(e){var t=ng(e),n=t%1;return t===t?n?t-n:t:0}function sg(e){if(typeof e=="number")return e;if(tg(e))return Xa;if(us(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=us(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(Uh,"");var n=jh.test(e);return n||Fh.test(e)?Wh(e.slice(2),n?2:8):Bh.test(e)?Xa:+e}var ig=Kh;const ag=100;function og(e){const t=e.logger===void 0?console:e.logger;async function n(){var i;const[a,l,o]=await Promise.all([e.getAppId(),e.getInstallId(),(i=e.getBirthYear)==null?void 0:i.call(e)]);return{appId:a,installId:l,birthYear:o}}async function r(i,a){var l,o;let c;try{t==null||t.log(`[${i.label}-uploader] Beginning upload @ ${new Date(a).toISOString()}`);const[u,h,d]=await Promise.all([i.getLastUploadedAt(),e.db,e.enabled()]);if(!d){t==null||t.log(`[${i.label}-uploader] Uploads are disabled`);return}const f=await i.getModelsToUpload({db:h,lastUploadedAt:u,uploadStartedAt:a}),g=(o=await((l=e.getUploadBatchSize)==null?void 0:l.call(e)))!=null?o:ag,m=ig(f,g),A=await n();c={models:f,batches:m,body:A},t==null||t.debug(`[${i.label}-uploader] Data`,c);for(const C of m){t==null||t.debug(`[${i.label}-uploader] Uploading`,{batch:C,requestSkipped:!!e.dev}),e.dev||await i.upload(A,C);const v=C[C.length-1];(v==null?void 0:v.endedAt)!=null&&await i.setLastUploadedAt(v.endedAt)}await i.setLastUploadedAt(a);const S=(Date.now()-a)/1e3;t==null||t.log(`[${i.label}-uploader] Uploaded ${f.length} items in ${m.length} batches in ${S}s`),i.onSuccess({total:f.length,batches:m.length,batchSize:g,durationInSec:S})}catch(u){t==null||t.error(`[${i.label}-uploader] Failed to upload`,u,c),i.onFailure(u)}}async function s(){const i=Date.now();await Promise.allSettled(e.uploaders.map(a=>r(a,i)))}return{uploadAll:s}}function cg({api:e,onSuccess:t,onFailure:n,lastUploadedAtStorageKey:r}){return{label:"sessions",onSuccess:t,onFailure:n,async getLastUploadedAt(){const s=await si(r);return s??1},setLastUploadedAt(s){return pr(r,s)},async getModelsToUpload({db:s,lastUploadedAt:i,uploadStartedAt:a}){return(await s.sessionsRepo.findSessionsByEndedAt(i,a)).filter(l=>!l.imported)},async upload(s,i){const a=i.reduce((l,o)=>{var c;if(o.endedAt==null)throw Error("Cannot upload a session that is in progress");const u={duration:as(o.endedAt-o.startedAt),timestamp:as(o.startedAt)};return u.duration>0&&(l[c=o.appId]!=null||(l[c]={sessions:[]}),l[o.appId].sessions.push(u)),l},{});await e.uploadSessions({...s,websites:a})}}}var lg=to;function to(e,t,n){e instanceof RegExp&&(e=no(e,n)),t instanceof RegExp&&(t=no(t,n));var r=ro(e,t,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+e.length,r[1]),post:n.slice(r[1]+t.length)}}function no(e,t){var n=t.match(e);return n?n[0]:null}to.range=ro;function ro(e,t,n){var r,s,i,a,l,o=n.indexOf(e),c=n.indexOf(t,o+1),u=o;if(o>=0&&c>0){if(e===t)return[o,c];for(r=[],i=n.length;u>=0&&!l;)u==o?(r.push(u),o=n.indexOf(e,u+1)):r.length==1?l=[r.pop(),c]:(s=r.pop(),s<i&&(i=s,a=c),c=n.indexOf(t,u+1)),u=o<c&&o>=0?o:c;r.length&&(l=[i,a])}return l}var so=lg,ug=gg,io="\0SLASH"+Math.random()+"\0",ao="\0OPEN"+Math.random()+"\0",pi="\0CLOSE"+Math.random()+"\0",oo="\0COMMA"+Math.random()+"\0",co="\0PERIOD"+Math.random()+"\0";function mi(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function dg(e){return e.split("\\\\").join(io).split("\\{").join(ao).split("\\}").join(pi).split("\\,").join(oo).split("\\.").join(co)}function hg(e){return e.split(io).join("\\").split(ao).join("{").split(pi).join("}").split(oo).join(",").split(co).join(".")}function lo(e){if(!e)return[""];var t=[],n=so("{","}",e);if(!n)return e.split(",");var r=n.pre,s=n.body,i=n.post,a=r.split(",");a[a.length-1]+="{"+s+"}";var l=lo(i);return i.length&&(a[a.length-1]+=l.shift(),a.push.apply(a,l)),t.push.apply(t,a),t}function gg(e){return e?(e.substr(0,2)==="{}"&&(e="\\{\\}"+e.substr(2)),mr(dg(e),!0).map(hg)):[]}function fg(e){return"{"+e+"}"}function pg(e){return/^-?0\d/.test(e)}function mg(e,t){return e<=t}function yg(e,t){return e>=t}function mr(e,t){var n=[],r=so("{","}",e);if(!r)return[e];var s=r.pre,i=r.post.length?mr(r.post,!1):[""];if(/\$$/.test(r.pre))for(var a=0;a<i.length;a++){var l=s+"{"+r.body+"}"+i[a];n.push(l)}else{var o=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),c=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),u=o||c,h=r.body.indexOf(",")>=0;if(!u&&!h)return r.post.match(/,.*\}/)?(e=r.pre+"{"+r.body+pi+r.post,mr(e)):[e];var d;if(u)d=r.body.split(/\.\./);else if(d=lo(r.body),d.length===1&&(d=mr(d[0],!1).map(fg),d.length===1))return i.map(function(O){return r.pre+d[0]+O});var f;if(u){var g=mi(d[0]),m=mi(d[1]),A=Math.max(d[0].length,d[1].length),S=d.length==3?Math.abs(mi(d[2])):1,C=mg,v=m<g;v&&(S*=-1,C=yg);var w=d.some(pg);f=[];for(var k=g;C(k,m);k+=S){var E;if(c)E=String.fromCharCode(k),E==="\\"&&(E="");else if(E=String(k),w){var D=A-E.length;if(D>0){var y=new Array(D+1).join("0");k<0?E="-"+y+E.slice(1):E=y+E}}f.push(E)}}else{f=[];for(var _=0;_<d.length;_++)f.push.apply(f,mr(d[_],!1))}for(var _=0;_<f.length;_++)for(var a=0;a<i.length;a++){var l=s+f[_]+i[a];(!t||u||l)&&n.push(l)}}return n}const bg=1024*64,ds=e=>{if(typeof e!="string")throw new TypeError("invalid pattern");if(e.length>bg)throw new TypeError("pattern is too long")},vg={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},yr=e=>e.replace(/[[\]\\-]/g,"\\$&"),wg=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),uo=e=>e.join(""),Ag=(e,t)=>{const n=t;if(e.charAt(n)!=="[")throw new Error("not in a brace expression");const r=[],s=[];let i=n+1,a=!1,l=!1,o=!1,c=!1,u=n,h="";e:for(;i<e.length;){const g=e.charAt(i);if((g==="!"||g==="^")&&i===n+1){c=!0,i++;continue}if(g==="]"&&a&&!o){u=i+1;break}if(a=!0,g==="\\"&&!o){o=!0,i++;continue}if(g==="["&&!o){for(const[m,[A,S,C]]of Object.entries(vg))if(e.startsWith(m,i)){if(h)return["$.",!1,e.length-n,!0];i+=m.length,C?s.push(A):r.push(A),l=l||S;continue e}}if(o=!1,h){g>h?r.push(yr(h)+"-"+yr(g)):g===h&&r.push(yr(g)),h="",i++;continue}if(e.startsWith("-]",i+1)){r.push(yr(g+"-")),i+=2;continue}if(e.startsWith("-",i+1)){h=g,i+=2;continue}r.push(yr(g)),i++}if(u<i)return["",!1,0,!1];if(!r.length&&!s.length)return["$.",!1,e.length-n,!0];if(s.length===0&&r.length===1&&/^\\?.$/.test(r[0])&&!c){const g=r[0].length===2?r[0].slice(-1):r[0];return[wg(g),!1,u-n,!1]}const d="["+(c?"^":"")+uo(r)+"]",f="["+(c?"":"^")+uo(s)+"]";return[r.length&&s.length?"("+d+"|"+f+")":r.length?d:f,l,u-n,!0]},br=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/\[([^\/\\])\]/g,"$1"):e.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),_g=new Set(["!","?","+","*","@"]),ho=e=>_g.has(e),xg="(?!\\.\\.?(?:$|/))",yi="(?!\\.)",Sg=new Set(["[","."]),Tg=new Set(["..","."]),Eg=new Set("().*{}+?[]^$\\!"),Cg=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),bi="[^/]",go=bi+"*?",fo=bi+"+?";var Ce,Ne,Ht,ge,Se,hn,Rn,gn,ft,Ln,hs,vi,po,vr,gs,wi,mo;const Qe=class{constructor(e,t,n={}){Ze(this,vi),Ee(this,"type"),Ze(this,Ce,void 0),Ze(this,Ne,void 0),Ze(this,Ht,!1),Ze(this,ge,[]),Ze(this,Se,void 0),Ze(this,hn,void 0),Ze(this,Rn,void 0),Ze(this,gn,!1),Ze(this,ft,void 0),Ze(this,Ln,void 0),Ze(this,hs,!1),this.type=e,e&&Ae(this,Ne,!0),Ae(this,Se,t),Ae(this,Ce,B(this,Se)?B(B(this,Se),Ce):this),Ae(this,ft,B(this,Ce)===this?n:B(B(this,Ce),ft)),Ae(this,Rn,B(this,Ce)===this?[]:B(B(this,Ce),Rn)),e==="!"&&!B(B(this,Ce),gn)&&B(this,Rn).push(this),Ae(this,hn,B(this,Se)?B(B(this,Se),ge).length:0)}get hasMagic(){if(B(this,Ne)!==void 0)return B(this,Ne);for(const e of B(this,ge))if(typeof e!="string"&&(e.type||e.hasMagic))return Ae(this,Ne,!0);return B(this,Ne)}toString(){return B(this,Ln)!==void 0?B(this,Ln):this.type?Ae(this,Ln,this.type+"("+B(this,ge).map(e=>String(e)).join("|")+")"):Ae(this,Ln,B(this,ge).map(e=>String(e)).join(""))}push(...e){for(const t of e)if(t!==""){if(typeof t!="string"&&!(t instanceof Qe&&B(t,Se)===this))throw new Error("invalid part: "+t);B(this,ge).push(t)}}toJSON(){var e;const t=this.type===null?B(this,ge).slice().map(n=>typeof n=="string"?n:n.toJSON()):[this.type,...B(this,ge).map(n=>n.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===B(this,Ce)||B(B(this,Ce),gn)&&((e=B(this,Se))==null?void 0:e.type)==="!")&&t.push({}),t}isStart(){var e;if(B(this,Ce)===this)return!0;if(!((e=B(this,Se))!=null&&e.isStart()))return!1;if(B(this,hn)===0)return!0;const t=B(this,Se);for(let n=0;n<B(this,hn);n++){const r=B(t,ge)[n];if(!(r instanceof Qe&&r.type==="!"))return!1}return!0}isEnd(){var e,t,n;if(B(this,Ce)===this||((e=B(this,Se))==null?void 0:e.type)==="!")return!0;if(!((t=B(this,Se))!=null&&t.isEnd()))return!1;if(!this.type)return(n=B(this,Se))==null?void 0:n.isEnd();const r=B(this,Se)?B(B(this,Se),ge).length:0;return B(this,hn)===r-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new Qe(this.type,e);for(const n of B(this,ge))t.copyIn(n);return t}static fromGlob(e,t={}){var n;const r=new Qe(null,void 0,t);return Yn(n=Qe,vr,gs).call(n,e,r,0,t),r}toMMPattern(){if(this!==B(this,Ce))return B(this,Ce).toMMPattern();const e=this.toString(),[t,n,r,s]=this.toRegExpSource();if(!(r||B(this,Ne)||B(this,ft).nocase&&!B(this,ft).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return n;const i=(B(this,ft).nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${t}$`,i),{_src:t,_glob:e})}toRegExpSource(){var e;if(B(this,Ce)===this&&Yn(this,vi,po).call(this),!this.type){const s=this.isStart()&&this.isEnd(),i=B(this,ge).map(o=>{var c;const[u,h,d,f]=typeof o=="string"?Yn(c=Qe,wi,mo).call(c,o,B(this,Ne),s):o.toRegExpSource();return Ae(this,Ne,B(this,Ne)||d),Ae(this,Ht,B(this,Ht)||f),u}).join("");let a="";if(this.isStart()&&typeof B(this,ge)[0]=="string"&&!(B(this,ge).length===1&&Tg.has(B(this,ge)[0]))){const o=Sg,c=B(this,ft).dot&&o.has(i.charAt(0))||i.startsWith("\\.")&&o.has(i.charAt(2))||i.startsWith("\\.\\.")&&o.has(i.charAt(4)),u=!B(this,ft).dot&&o.has(i.charAt(0));a=c?xg:u?yi:""}let l="";return this.isEnd()&&B(B(this,Ce),gn)&&((e=B(this,Se))==null?void 0:e.type)==="!"&&(l="(?:$|\\/)"),[a+i+l,br(i),Ae(this,Ne,!!B(this,Ne)),B(this,Ht)]}const t=this.type==="!"?"(?:(?!(?:":"(?:",n=B(this,ge).map(s=>{if(typeof s=="string")throw new Error("string type in extglob ast??");const[i,a,l,o]=s.toRegExpSource();return Ae(this,Ht,B(this,Ht)||o),i}).filter(s=>!(this.isStart()&&this.isEnd())||!!s).join("|");if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){const s=this.toString();return Ae(this,ge,[s]),this.type=null,Ae(this,Ne,void 0),[s,br(this.toString()),!1,!1]}let r="";if(this.type==="!"&&B(this,hs))r=(this.isStart()&&!B(this,ft).dot?yi:"")+fo;else{const s=this.type==="!"?"))"+(this.isStart()&&!B(this,ft).dot?yi:"")+go+")":this.type==="@"?")":`)${this.type}`;r=t+n+s}return[r,br(n),Ae(this,Ne,!!B(this,Ne)),B(this,Ht)]}};let fs=Qe;Ce=new WeakMap,Ne=new WeakMap,Ht=new WeakMap,ge=new WeakMap,Se=new WeakMap,hn=new WeakMap,Rn=new WeakMap,gn=new WeakMap,ft=new WeakMap,Ln=new WeakMap,hs=new WeakMap,vi=new WeakSet,po=function(){if(this!==B(this,Ce))throw new Error("should only call on root");if(B(this,gn))return this;this.toString(),Ae(this,gn,!0);let e;for(;e=B(this,Rn).pop();){if(e.type!=="!")continue;let t=e,n=B(t,Se);for(;n;){for(let r=B(t,hn)+1;!n.type&&r<B(n,ge).length;r++)for(const s of B(e,ge)){if(typeof s=="string")throw new Error("string part in extglob AST??");s.copyIn(B(n,ge)[r])}t=n,n=B(t,Se)}}return this},vr=new WeakSet,gs=function(e,t,n,r){var s,i;let a=!1,l=!1,o=-1,c=!1;if(t.type===null){let g=n,m="";for(;g<e.length;){const A=e.charAt(g++);if(a||A==="\\"){a=!a,m+=A;continue}if(l){g===o+1?(A==="^"||A==="!")&&(c=!0):A==="]"&&!(g===o+2&&c)&&(l=!1),m+=A;continue}else if(A==="["){l=!0,o=g,c=!1,m+=A;continue}if(!r.noext&&ho(A)&&e.charAt(g)==="("){t.push(m),m="";const S=new Qe(A,t);g=Yn(s=Qe,vr,gs).call(s,e,S,g,r),t.push(S);continue}m+=A}return t.push(m),g}let u=n+1,h=new Qe(null,t);const d=[];let f="";for(;u<e.length;){const g=e.charAt(u++);if(a||g==="\\"){a=!a,f+=g;continue}if(l){u===o+1?(g==="^"||g==="!")&&(c=!0):g==="]"&&!(u===o+2&&c)&&(l=!1),f+=g;continue}else if(g==="["){l=!0,o=u,c=!1,f+=g;continue}if(ho(g)&&e.charAt(u)==="("){h.push(f),f="";const m=new Qe(g,h);h.push(m),u=Yn(i=Qe,vr,gs).call(i,e,m,u,r);continue}if(g==="|"){h.push(f),f="",d.push(h),h=new Qe(null,t);continue}if(g===")")return f===""&&B(t,ge).length===0&&Ae(t,hs,!0),h.push(f),f="",t.push(...d,h),u;f+=g}return t.type=null,Ae(t,Ne,void 0),Ae(t,ge,[e.substring(n-1)]),u},wi=new WeakSet,mo=function(e,t,n=!1){let r=!1,s="",i=!1;for(let a=0;a<e.length;a++){const l=e.charAt(a);if(r){r=!1,s+=(Eg.has(l)?"\\":"")+l;continue}if(l==="\\"){a===e.length-1?s+="\\\\":r=!0;continue}if(l==="["){const[o,c,u,h]=Ag(e,a);if(u){s+=o,i=i||c,a+=u-1,t=t||h;continue}}if(l==="*"){n&&e==="*"?s+=fo:s+=go,t=!0;continue}if(l==="?"){s+=bi,t=!0;continue}s+=Cg(l)}return[s,br(e),!!t,i]},Ze(fs,vr),Ze(fs,wi);const Og=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/[?*()[\]]/g,"[$&]"):e.replace(/[?*()[\]\\]/g,"\\$&"),je=(e,t,n={})=>(ds(t),!n.nocomment&&t.charAt(0)==="#"?!1:new ps(t,n).match(e)),Ig=/^\*+([^+@!?\*\[\(]*)$/,Pg=e=>t=>!t.startsWith(".")&&t.endsWith(e),kg=e=>t=>t.endsWith(e),Dg=e=>(e=e.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(e)),Mg=e=>(e=e.toLowerCase(),t=>t.toLowerCase().endsWith(e)),Ng=/^\*+\.\*+$/,Rg=e=>!e.startsWith(".")&&e.includes("."),Lg=e=>e!=="."&&e!==".."&&e.includes("."),Ug=/^\.\*+$/,Bg=e=>e!=="."&&e!==".."&&e.startsWith("."),jg=/^\*+$/,Fg=e=>e.length!==0&&!e.startsWith("."),$g=e=>e.length!==0&&e!=="."&&e!=="..",Wg=/^\?+([^+@!?\*\[\(]*)?$/,Vg=([e,t=""])=>{const n=yo([e]);return t?(t=t.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(t)):n},Gg=([e,t=""])=>{const n=bo([e]);return t?(t=t.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(t)):n},Hg=([e,t=""])=>{const n=bo([e]);return t?r=>n(r)&&r.endsWith(t):n},qg=([e,t=""])=>{const n=yo([e]);return t?r=>n(r)&&r.endsWith(t):n},yo=([e])=>{const t=e.length;return n=>n.length===t&&!n.startsWith(".")},bo=([e])=>{const t=e.length;return n=>n.length===t&&n!=="."&&n!==".."},vo=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",wo={win32:{sep:"\\"},posix:{sep:"/"}},zg=vo==="win32"?wo.win32.sep:wo.posix.sep;je.sep=zg;const st=Symbol("globstar **");je.GLOBSTAR=st;const Zg="[^/]",Kg=Zg+"*?",Yg="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Jg="(?:(?!(?:\\/|^)\\.).)*?",Qg=(e,t={})=>n=>je(n,e,t);je.filter=Qg;const it=(e,t={})=>Object.assign({},e,t),Xg=e=>{if(!e||typeof e!="object"||!Object.keys(e).length)return je;const t=je;return Object.assign((n,r,s={})=>t(n,r,it(e,s)),{Minimatch:class extends t.Minimatch{constructor(n,r={}){super(n,it(e,r))}static defaults(n){return t.defaults(it(e,n)).Minimatch}},AST:class extends t.AST{constructor(n,r,s={}){super(n,r,it(e,s))}static fromGlob(n,r={}){return t.AST.fromGlob(n,it(e,r))}},unescape:(n,r={})=>t.unescape(n,it(e,r)),escape:(n,r={})=>t.escape(n,it(e,r)),filter:(n,r={})=>t.filter(n,it(e,r)),defaults:n=>t.defaults(it(e,n)),makeRe:(n,r={})=>t.makeRe(n,it(e,r)),braceExpand:(n,r={})=>t.braceExpand(n,it(e,r)),match:(n,r,s={})=>t.match(n,r,it(e,s)),sep:t.sep,GLOBSTAR:st})};je.defaults=Xg;const Ao=(e,t={})=>(ds(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:ug(e));je.braceExpand=Ao;const ef=(e,t={})=>new ps(e,t).makeRe();je.makeRe=ef;const tf=(e,t,n={})=>{const r=new ps(t,n);return e=e.filter(s=>r.match(s)),r.options.nonull&&!e.length&&e.push(t),e};je.match=tf;const _o=/[?*]|[+@!]\(.*?\)|\[|\]/,nf=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class ps{constructor(t,n={}){Ee(this,"options"),Ee(this,"set"),Ee(this,"pattern"),Ee(this,"windowsPathsNoEscape"),Ee(this,"nonegate"),Ee(this,"negate"),Ee(this,"comment"),Ee(this,"empty"),Ee(this,"preserveMultipleSlashes"),Ee(this,"partial"),Ee(this,"globSet"),Ee(this,"globParts"),Ee(this,"nocase"),Ee(this,"isWindows"),Ee(this,"platform"),Ee(this,"windowsNoMagicRoot"),Ee(this,"regexp"),ds(t),n=n||{},this.options=n,this.pattern=t,this.platform=n.platform||vo,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!n.windowsPathsNoEscape||n.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!n.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!n.nonegate,this.comment=!1,this.empty=!1,this.partial=!!n.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=n.windowsNoMagicRoot!==void 0?n.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const n of t)if(typeof n!="string")return!0;return!1}debug(...t){}make(){const t=this.pattern,n=this.options;if(!n.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],n.debug&&(this.debug=(...i)=>console.error(...i)),this.debug(this.pattern,this.globSet);const r=this.globSet.map(i=>this.slashSplit(i));this.globParts=this.preprocess(r),this.debug(this.pattern,this.globParts);let s=this.globParts.map((i,a,l)=>{if(this.isWindows&&this.windowsNoMagicRoot){const o=i[0]===""&&i[1]===""&&(i[2]==="?"||!_o.test(i[2]))&&!_o.test(i[3]),c=/^[a-z]:/i.test(i[0]);if(o)return[...i.slice(0,4),...i.slice(4).map(u=>this.parse(u))];if(c)return[i[0],...i.slice(1).map(u=>this.parse(u))]}return i.map(o=>this.parse(o))});if(this.debug(this.pattern,s),this.set=s.filter(i=>i.indexOf(!1)===-1),this.isWindows)for(let i=0;i<this.set.length;i++){const a=this.set[i];a[0]===""&&a[1]===""&&this.globParts[i][2]==="?"&&typeof a[3]=="string"&&/^[a-z]:$/i.test(a[3])&&(a[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let r=0;r<t.length;r++)for(let s=0;s<t[r].length;s++)t[r][s]==="**"&&(t[r][s]="*");const{optimizationLevel:n=1}=this.options;return n>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):n>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(n=>{let r=-1;for(;(r=n.indexOf("**",r+1))!==-1;){let s=r;for(;n[s+1]==="**";)s++;s!==r&&n.splice(r,s-r)}return n})}levelOneOptimize(t){return t.map(n=>(n=n.reduce((r,s)=>{const i=r[r.length-1];return s==="**"&&i==="**"?r:s===".."&&i&&i!==".."&&i!=="."&&i!=="**"?(r.pop(),r):(r.push(s),r)},[]),n.length===0?[""]:n))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let n=!1;do{if(n=!1,!this.preserveMultipleSlashes){for(let s=1;s<t.length-1;s++){const i=t[s];s===1&&i===""&&t[0]===""||(i==="."||i==="")&&(n=!0,t.splice(s,1),s--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(n=!0,t.pop())}let r=0;for(;(r=t.indexOf("..",r+1))!==-1;){const s=t[r-1];s&&s!=="."&&s!==".."&&s!=="**"&&(n=!0,t.splice(r-1,2),r-=2)}}while(n);return t.length===0?[""]:t}firstPhasePreProcess(t){let n=!1;do{n=!1;for(let r of t){let s=-1;for(;(s=r.indexOf("**",s+1))!==-1;){let a=s;for(;r[a+1]==="**";)a++;a>s&&r.splice(s+1,a-s);let l=r[s+1];const o=r[s+2],c=r[s+3];if(l!==".."||!o||o==="."||o===".."||!c||c==="."||c==="..")continue;n=!0,r.splice(s,1);const u=r.slice(0);u[s]="**",t.push(u),s--}if(!this.preserveMultipleSlashes){for(let a=1;a<r.length-1;a++){const l=r[a];a===1&&l===""&&r[0]===""||(l==="."||l==="")&&(n=!0,r.splice(a,1),a--)}r[0]==="."&&r.length===2&&(r[1]==="."||r[1]==="")&&(n=!0,r.pop())}let i=0;for(;(i=r.indexOf("..",i+1))!==-1;){const a=r[i-1];if(a&&a!=="."&&a!==".."&&a!=="**"){n=!0;const l=i===1&&r[i+1]==="**"?["."]:[];r.splice(i-1,2,...l),r.length===0&&r.push(""),i-=2}}}}while(n);return t}secondPhasePreProcess(t){for(let n=0;n<t.length-1;n++)for(let r=n+1;r<t.length;r++){const s=this.partsMatch(t[n],t[r],!this.preserveMultipleSlashes);!s||(t[n]=s,t[r]=[])}return t.filter(n=>n.length)}partsMatch(t,n,r=!1){let s=0,i=0,a=[],l="";for(;s<t.length&&i<n.length;)if(t[s]===n[i])a.push(l==="b"?n[i]:t[s]),s++,i++;else if(r&&t[s]==="**"&&n[i]===t[s+1])a.push(t[s]),s++;else if(r&&n[i]==="**"&&t[s]===n[i+1])a.push(n[i]),i++;else if(t[s]==="*"&&n[i]&&(this.options.dot||!n[i].startsWith("."))&&n[i]!=="**"){if(l==="b")return!1;l="a",a.push(t[s]),s++,i++}else if(n[i]==="*"&&t[s]&&(this.options.dot||!t[s].startsWith("."))&&t[s]!=="**"){if(l==="a")return!1;l="b",a.push(n[i]),s++,i++}else return!1;return t.length===n.length&&a}parseNegate(){if(this.nonegate)return;const t=this.pattern;let n=!1,r=0;for(let s=0;s<t.length&&t.charAt(s)==="!";s++)n=!n,r++;r&&(this.pattern=t.slice(r)),this.negate=n}matchOne(t,n,r=!1){const s=this.options;if(this.isWindows){const m=t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),A=n[0]===""&&n[1]===""&&n[2]==="?"&&typeof n[3]=="string"&&/^[a-z]:$/i.test(n[3]);if(m&&A){const S=t[3],C=n[3];S.toLowerCase()===C.toLowerCase()&&(t[3]=C)}else if(A&&typeof t[0]=="string"){const S=n[3],C=t[0];S.toLowerCase()===C.toLowerCase()&&(n[3]=C,n=n.slice(3))}else if(m&&typeof n[0]=="string"){const S=t[3];S.toLowerCase()===n[0].toLowerCase()&&(n[0]=S,t=t.slice(3))}}const{optimizationLevel:i=1}=this.options;i>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:n}),this.debug("matchOne",t.length,n.length);for(var a=0,l=0,o=t.length,c=n.length;a<o&&l<c;a++,l++){this.debug("matchOne loop");var u=n[l],h=t[a];if(this.debug(n,u,h),u===!1)return!1;if(u===st){this.debug("GLOBSTAR",[n,u,h]);var d=a,f=l+1;if(f===c){for(this.debug("** at the end");a<o;a++)if(t[a]==="."||t[a]===".."||!s.dot&&t[a].charAt(0)===".")return!1;return!0}for(;d<o;){var g=t[d];if(this.debug(`
globstar while`,t,d,n,f,g),this.matchOne(t.slice(d),n.slice(f),r))return this.debug("globstar found match!",d,o,g),!0;if(g==="."||g===".."||!s.dot&&g.charAt(0)==="."){this.debug("dot detected!",t,d,n,f);break}this.debug("globstar swallow a segment, and continue"),d++}return!!(r&&(this.debug(`
>>> no match, partial?`,t,d,n,f),d===o))}let m;if(typeof u=="string"?(m=h===u,this.debug("string match",u,h,m)):(m=u.test(h),this.debug("pattern match",u,h,m)),!m)return!1}if(a===o&&l===c)return!0;if(a===o)return r;if(l===c)return a===o-1&&t[a]==="";throw new Error("wtf?")}braceExpand(){return Ao(this.pattern,this.options)}parse(t){ds(t);const n=this.options;if(t==="**")return st;if(t==="")return"";let r,s=null;(r=t.match(jg))?s=n.dot?$g:Fg:(r=t.match(Ig))?s=(n.nocase?n.dot?Mg:Dg:n.dot?kg:Pg)(r[1]):(r=t.match(Wg))?s=(n.nocase?n.dot?Gg:Vg:n.dot?Hg:qg)(r):(r=t.match(Ng))?s=n.dot?Lg:Rg:(r=t.match(Ug))&&(s=Bg);const i=fs.fromGlob(t,this.options).toMMPattern();return s?Object.assign(i,{test:s}):i}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const n=this.options,r=n.noglobstar?Kg:n.dot?Yg:Jg,s=new Set(n.nocase?["i"]:[]);let i=t.map(o=>{const c=o.map(u=>{if(u instanceof RegExp)for(const h of u.flags.split(""))s.add(h);return typeof u=="string"?nf(u):u===st?st:u._src});return c.forEach((u,h)=>{const d=c[h+1],f=c[h-1];u!==st||f===st||(f===void 0?d!==void 0&&d!==st?c[h+1]="(?:\\/|"+r+"\\/)?"+d:c[h]=r:d===void 0?c[h-1]=f+"(?:\\/|"+r+")?":d!==st&&(c[h-1]=f+"(?:\\/|\\/"+r+"\\/)"+d,c[h+1]=st))}),c.filter(u=>u!==st).join("/")}).join("|");const[a,l]=t.length>1?["(?:",")"]:["",""];i="^"+a+i+l+"$",this.negate&&(i="^(?!"+i+").+$");try{this.regexp=new RegExp(i,[...s].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,n=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&n)return!0;const r=this.options;this.isWindows&&(t=t.split("\\").join("/"));const s=this.slashSplit(t);this.debug(this.pattern,"split",s);const i=this.set;this.debug(this.pattern,"set",i);let a=s[s.length-1];if(!a)for(let l=s.length-2;!a&&l>=0;l--)a=s[l];for(let l=0;l<i.length;l++){const o=i[l];let c=s;if(r.matchBase&&o.length===1&&(c=[a]),this.matchOne(c,o,n))return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}static defaults(t){return je.defaults(t).Minimatch}}je.AST=fs,je.Minimatch=ps,je.escape=Og,je.unescape=br;function rf({api:e,onSuccess:t,onFailure:n,lastUploadedAtStorageKey:r,getUploadAllowlist:s}){return{label:"page-views",onSuccess:t,onFailure:n,async getLastUploadedAt(){const i=(await le.storage.local.get(r))[r];return i??1},setLastUploadedAt(i){return le.storage.local.set({[r]:i})},async getModelsToUpload({db:i,lastUploadedAt:a,uploadStartedAt:l}){var o;const c=await i.pageViewsRepo.findPageViewsByEndedAt(a,l),u=(o=await s())!=null?o:[];return c.filter(h=>h.imported?!1:!!u.find(d=>je(h.appId+h.path,d)))},async upload(i,a){const l=a.reduce((o,c)=>{var u,h,d;if(c.endedAt==null)throw Error("Cannot upload a page view that is in progress");const f={duration:as(c.endedAt-c.startedAt),timestamp:as(c.startedAt),referrer:c.referrer};return f.duration>0&&(o[u=c.appId]!=null||(o[u]={}),(h=o[c.appId])[d=c.path]!=null||(h[d]={page_views:[]}),o[c.appId][c.path].page_views.push(f)),o},{});await e.uploadPageViews({...i,websites:l})}}}function sf(e){const t=cg({api:e.api,...e.sessions}),n=rf({api:e.api,...e.pageViews});return og({...e,uploaders:[t,n]})}const ms={APP_ID:"laankejkbhbdhmipfmgcngdelahlfoji",INSTALL_ID_KEY:"install-id"},ys=Ie.createScopedLog("WebUsage");let Un;const af="https://api-pm.stayfocusd.st-panel-api.com/Ajax0001/IPD",of="https://api-pm.stayfocusd.st-panel-api.com/Ajax0001/Config",cf=33,lf={initialized:null,usageDatabase:null,initAPI(e){return Un=e,Un.mixin("WebUsage",{init:this.init.bind(this),getUsageDatabase:this.getUsageDatabase.bind(this)})},async init(){if(this.initialized!=null)ys("init","WebUsage already initialized",{sessionId:""},"DEBUG");else{const e=async()=>await Un.Storage.get("hasAcceptedToS",!0)??!1,t=Un.Storage.get("install-id",!0),{promise:n,resolve:r}=Un.Utils.getDecoupledPromise();this.initialized=n,this.usageDatabase=Oh({getInstallId:()=>t}),Dh({db:this.usageDatabase,enabled:e,isOnStartupAvailable:()=>!0,isTabActiveWhenPlayingAudio:()=>!0,logger:null}),r(),ys==null||ys("init","Initialized WebUsage",this,"INFO");const{processAdFinderMessage:s}=await Vc({isEnabled:e,getInstallId:()=>t,extensionVersion:Un.Chrome.Extension.getVersion(),extensionId:ms.APP_ID,crawlUploadUrl:af,pmExternalConfigUrl:of,panelPartnerId:cf});chrome.runtime.onConnect.addListener(i=>{i.name=="ad-finder"&&i.onMessage.addListener(async a=>{var l,o,c,u;if(a.message=="forward-message.request"){const h=await s(a.payload);i.postMessage({message:"forward-message.response",payload:h,nonce:a.nonce})}if(a.message=="ad-found"){const h=vu(a.payload.hostname);if(!h)return;const d=a.payload.ad,f=await((o=(l=this.usageDatabase)==null?void 0:l.sessionsRepo)==null?void 0:o.getActiveSessions()),g=f==null?void 0:f.find(m=>m.appId===h.hostname);if(!g)return;await((u=(c=this.usageDatabase)==null?void 0:c.adsRepo)==null?void 0:u.upsertAd({...d,sessionId:g.id}))}})})}},async getUsageDatabase(){if(await this.initialized,this.usageDatabase==null)throw Error("WebUsage not initialized");return this.usageDatabase}},uf=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,df=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,hf=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function gf(e,t){if(e==="__proto__"||e==="constructor"&&t&&typeof t=="object"&&"prototype"in t){ff(e);return}return t}function ff(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function pf(e,t={}){if(typeof e!="string")return e;const n=e.trim();if(e[0]==='"'&&e.endsWith('"')&&!e.includes("\\"))return n.slice(1,-1);if(n.length<=9){const r=n.toLowerCase();if(r==="true")return!0;if(r==="false")return!1;if(r==="undefined")return;if(r==="null")return null;if(r==="nan")return Number.NaN;if(r==="infinity")return Number.POSITIVE_INFINITY;if(r==="-infinity")return Number.NEGATIVE_INFINITY}if(!hf.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(uf.test(e)||df.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,gf)}return JSON.parse(e)}catch(r){if(t.strict)throw r;return e}}const mf=/#/g,yf=/&/g,bf=/\//g,vf=/=/g,Ai=/\+/g,wf=/%5e/gi,Af=/%60/gi,_f=/%7c/gi,xf=/%20/gi;function Sf(e){return encodeURI(""+e).replace(_f,"|")}function _i(e){return Sf(typeof e=="string"?e:JSON.stringify(e)).replace(Ai,"%2B").replace(xf,"+").replace(mf,"%23").replace(yf,"%26").replace(Af,"`").replace(wf,"^").replace(bf,"%2F")}function xi(e){return _i(e).replace(vf,"%3D")}function xo(e=""){try{return decodeURIComponent(""+e)}catch{return""+e}}function Tf(e){return xo(e.replace(Ai," "))}function Ef(e){return xo(e.replace(Ai," "))}function Cf(e=""){const t={};e[0]==="?"&&(e=e.slice(1));for(const n of e.split("&")){const r=n.match(/([^=]+)=?(.*)/)||[];if(r.length<2)continue;const s=Tf(r[1]);if(s==="__proto__"||s==="constructor")continue;const i=Ef(r[2]||"");t[s]===void 0?t[s]=i:Array.isArray(t[s])?t[s].push(i):t[s]=[t[s],i]}return t}function Of(e,t){return(typeof t=="number"||typeof t=="boolean")&&(t=String(t)),t?Array.isArray(t)?t.map(n=>`${xi(e)}=${_i(n)}`).join("&"):`${xi(e)}=${_i(t)}`:xi(e)}function If(e){return Object.keys(e).filter(t=>e[t]!==void 0).map(t=>Of(t,e[t])).filter(Boolean).join("&")}const Pf=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,kf=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,Df=/^([/\\]\s*){2,}[^/\\]/,Mf=/\/$|\/\?|\/#/,Nf=/^\.?\//;function So(e,t={}){return typeof t=="boolean"&&(t={acceptRelative:t}),t.strict?Pf.test(e):kf.test(e)||(t.acceptRelative?Df.test(e):!1)}function Si(e="",t){return t?Mf.test(e):e.endsWith("/")}function Rf(e="",t){if(!t)return(Si(e)?e.slice(0,-1):e)||"/";if(!Si(e,!0))return e||"/";let n=e,r="";const s=e.indexOf("#");s>=0&&(n=e.slice(0,s),r=e.slice(s));const[i,...a]=n.split("?");return((i.endsWith("/")?i.slice(0,-1):i)||"/")+(a.length>0?`?${a.join("?")}`:"")+r}function Lf(e="",t){if(!t)return e.endsWith("/")?e:e+"/";if(Si(e,!0))return e||"/";let n=e,r="";const s=e.indexOf("#");if(s>=0&&(n=e.slice(0,s),r=e.slice(s),!n))return r;const[i,...a]=n.split("?");return i+"/"+(a.length>0?`?${a.join("?")}`:"")+r}function Uf(e,t){if(jf(t)||So(e))return e;const n=Rf(t);return e.startsWith(n)?e:$f(n,e)}function Bf(e,t){const n=Eo(e),r={...Cf(n.search),...t};return n.search=If(r),Wf(n)}function jf(e){return!e||e==="/"}function Ff(e){return e&&e!=="/"}function $f(e,...t){let n=e||"";for(const r of t.filter(s=>Ff(s)))if(n){const s=r.replace(Nf,"");n=Lf(n)+s}else n=r;return n}const To=Symbol.for("ufo:protocolRelative");function Eo(e="",t){const n=e.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(n){const[,h,d=""]=n;return{protocol:h.toLowerCase(),pathname:d,href:h+d,auth:"",host:"",search:"",hash:""}}if(!So(e,{acceptRelative:!0}))return t?Eo(t+e):Co(e);const[,r="",s,i=""]=e.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[],[,a="",l=""]=i.match(/([^#/?]*)(.*)?/)||[],{pathname:o,search:c,hash:u}=Co(l.replace(/\/(?=[A-Za-z]:)/,""));return{protocol:r.toLowerCase(),auth:s?s.slice(0,Math.max(0,s.length-1)):"",host:a,pathname:o,search:c,hash:u,[To]:!r}}function Co(e=""){const[t="",n="",r=""]=(e.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:t,search:n,hash:r}}function Wf(e){const t=e.pathname||"",n=e.search?(e.search.startsWith("?")?"":"?")+e.search:"",r=e.hash||"",s=e.auth?e.auth+"@":"",i=e.host||"";return(e.protocol||e[To]?(e.protocol||"")+"//":"")+s+i+t+n+r}class Vf extends Error{constructor(t,n){super(t,n),this.name="FetchError",n!=null&&n.cause&&!this.cause&&(this.cause=n.cause)}}function Gf(e){var o,c,u,h,d;const t=((o=e.error)==null?void 0:o.message)||((c=e.error)==null?void 0:c.toString())||"",n=((u=e.request)==null?void 0:u.method)||((h=e.options)==null?void 0:h.method)||"GET",r=((d=e.request)==null?void 0:d.url)||String(e.request)||"/",s=`[${n}] ${JSON.stringify(r)}`,i=e.response?`${e.response.status} ${e.response.statusText}`:"<no response>",a=`${s}: ${i}${t?` ${t}`:""}`,l=new Vf(a,e.error?{cause:e.error}:void 0);for(const f of["request","options","response"])Object.defineProperty(l,f,{get(){return e[f]}});for(const[f,g]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(l,f,{get(){return e.response&&e.response[g]}});return l}const Hf=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function Oo(e="GET"){return Hf.has(e.toUpperCase())}function qf(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}const zf=new Set(["image/svg","application/xml","application/xhtml","application/html"]),Zf=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Kf(e=""){if(!e)return"json";const t=e.split(";").shift()||"";return Zf.test(t)?"json":zf.has(t)||t.startsWith("text/")?"text":"blob"}function Yf(e,t,n=globalThis.Headers){const r={...t,...e};if(t!=null&&t.params&&(e!=null&&e.params)&&(r.params={...t==null?void 0:t.params,...e==null?void 0:e.params}),t!=null&&t.query&&(e!=null&&e.query)&&(r.query={...t==null?void 0:t.query,...e==null?void 0:e.query}),t!=null&&t.headers&&(e!=null&&e.headers)){r.headers=new n((t==null?void 0:t.headers)||{});for(const[s,i]of new n((e==null?void 0:e.headers)||{}))r.headers.set(s,i)}return r}const Jf=new Set([408,409,425,429,500,502,503,504]),Qf=new Set([101,204,205,304]);function Io(e={}){const{fetch:t=globalThis.fetch,Headers:n=globalThis.Headers,AbortController:r=globalThis.AbortController}=e;async function s(l){const o=l.error&&l.error.name==="AbortError"&&!l.options.timeout||!1;if(l.options.retry!==!1&&!o){let u;typeof l.options.retry=="number"?u=l.options.retry:u=Oo(l.options.method)?0:1;const h=l.response&&l.response.status||500;if(u>0&&(Array.isArray(l.options.retryStatusCodes)?l.options.retryStatusCodes.includes(h):Jf.has(h))){const d=l.options.retryDelay||0;return d>0&&await new Promise(f=>setTimeout(f,d)),i(l.request,{...l.options,retry:u-1})}}const c=Gf(l);throw Error.captureStackTrace&&Error.captureStackTrace(c,i),c}const i=async function(o,c={}){var f;const u={request:o,options:Yf(c,e.defaults,n),response:void 0,error:void 0};u.options.method=(f=u.options.method)==null?void 0:f.toUpperCase(),u.options.onRequest&&await u.options.onRequest(u),typeof u.request=="string"&&(u.options.baseURL&&(u.request=Uf(u.request,u.options.baseURL)),(u.options.query||u.options.params)&&(u.request=Bf(u.request,{...u.options.params,...u.options.query}))),u.options.body&&Oo(u.options.method)&&(qf(u.options.body)?(u.options.body=typeof u.options.body=="string"?u.options.body:JSON.stringify(u.options.body),u.options.headers=new n(u.options.headers||{}),u.options.headers.has("content-type")||u.options.headers.set("content-type","application/json"),u.options.headers.has("accept")||u.options.headers.set("accept","application/json")):("pipeTo"in u.options.body&&typeof u.options.body.pipeTo=="function"||typeof u.options.body.pipe=="function")&&("duplex"in u.options||(u.options.duplex="half")));let h;if(!u.options.signal&&u.options.timeout){const g=new r;h=setTimeout(()=>g.abort(),u.options.timeout),u.options.signal=g.signal}try{u.response=await t(u.request,u.options)}catch(g){return u.error=g,u.options.onRequestError&&await u.options.onRequestError(u),await s(u)}finally{h&&clearTimeout(h)}if(u.response.body&&!Qf.has(u.response.status)&&u.options.method!=="HEAD"){const g=(u.options.parseResponse?"json":u.options.responseType)||Kf(u.response.headers.get("content-type")||"");switch(g){case"json":{const m=await u.response.text(),A=u.options.parseResponse||pf;u.response._data=A(m);break}case"stream":{u.response._data=u.response.body;break}default:u.response._data=await u.response[g]()}}return u.options.onResponse&&await u.options.onResponse(u),!u.options.ignoreResponseError&&u.response.status>=400&&u.response.status<600?(u.options.onResponseError&&await u.options.onResponseError(u),await s(u)):u.response},a=async function(o,c){return(await i(o,c))._data};return a.raw=i,a.native=(...l)=>t(...l),a.create=(l={})=>Io({...e,defaults:{...e.defaults,...l}}),a}const Ti=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),Xf=Ti.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),ep=Ti.Headers,tp=Ti.AbortController,np=Io({fetch:Xf,Headers:ep,AbortController:tp});var rp=(e=>(e.Notification="notification",e.Block="block",e.Popup="popup",e))(rp||{}),sp=(e=>(e.UsageTime="usage-time",e.SessionCount="session-count",e))(sp||{}),ip=(e=>(e.Android="android",e.Windows="windows",e.Mac="mac",e.Linux="linux",e.Web="web",e.Category="category",e.Brand="brand",e))(ip||{}),ap=class extends Error{constructor(){super("Invalid code entered")}},op=class extends Error{constructor(){super("Both devices already belong to a device group")}},cp=class extends Error{constructor(){super("Forbidden")}},bs=(fn=class extends Error{static matchesMessage(t){return t instanceof Error?t.message===fn.message:!1}constructor(){super(fn.message)}},_n(fn,"message","Not in a device group"),fn);function wr(e,t){return Object.entries(e).flatMap(([n,r])=>r.sessions.map(s=>({appId:n,startedAt:s.timestamp*1e3,endedAt:(s.timestamp+s.duration)*1e3,installId:s.install_id,platform:t})))}function Po(e){return new Date(e).toISOString()}function ko(e){let t=np.create({retry:3,...e==null?void 0:e.ofetchDefaults}),n=(e==null?void 0:e.formatDeviceName)??(x=>x),r=e==null?void 0:e.logger;function s(x){return t("/v1/android/apps",{query:{app_ids:x.appIds.join(",")}})}async function i(x){let P=await t("/v1/sync/pairing/generate",{method:"POST",retry:0,query:{install_id:x.installId}});return{code:P.code,expiration:new Date(P.expiration*1e3).getTime()}}function a(x){return t("/v1/sync/pairing/validate",{method:"POST",retry:0,query:{install_id:x.installId,code:x.code}}).catch(P=>{var p;let I=(p=P.response)==null?void 0:p.status;throw I===403?new op:I===404?new ap:P})}function l(x){return t("/v1/sync/pairing/check",{query:{install_id:x.installId}}).catch(P=>{var p;if(((p=P.response)==null?void 0:p.status)!==404)throw P})}async function o(x){return t("/v1/sync/devices",{query:{key:x.deviceGroupKey}}).catch(P=>{var p;throw((p=P.response)==null?void 0:p.status)===404?new bs:P})}async function c(x){await t("/v1/sync/devices/remove",{method:"POST",retry:0,query:{key:x.deviceGroupKey,install_id:x.installIdToRemove}})}async function u(x){return(await t.raw("/v1/sync/devices/sessions",{method:"HEAD",query:{key:x.deviceGroupKey,install_id:x.installId}}).catch(P=>{var p;throw((p=P.response)==null?void 0:p.status)===404?new bs:P})).headers.get("Last-Modified")??void 0}async function h(x){return t("/v1/analytics/avg_usage",{query:{app_ids:x.appIds.join(","),gender:x.gender,country_code:x.countryCode}})}async function d(x){return t("/v1/analytics/avg_web_usage",{query:{websites:x.appIds.join(","),gender:x.gender,country_code:x.countryCode}})}async function f(x){var P;let{android_apps:p,websites:I,windows_apps:M,mac_apps:j,linux_apps:U}=await t("/v1/sync/devices/sessions",{query:{key:x.deviceGroupKey,install_id:x.installId,start_time:Po(x.startTime),end_time:Po(x.endTime),app_ids:(P=x.appIds)==null?void 0:P.join(",")}}).catch(H=>{var q;throw((q=H.response)==null?void 0:q.status)===404?new bs:H});return[...wr(p,"android"),...wr(M??{},"windows"),...wr(j??{},"mac"),...wr(U??{},"linux"),...wr(I,"web")].sort((H,q)=>H.startedAt-q.startedAt)}async function g(x){var P;if(!x.appId.trim()){let{websites:M,diffPrivateWebsites:j,...U}=x;throw r==null||r.error("Missing required parameter 'appId'",U),Error("Missing required parameter 'appId'")}if(!x.installId.trim()){let{websites:M,diffPrivateWebsites:j,...U}=x;throw r==null||r.error("Missing required parameter 'installId'",U),Error("Missing required parameter 'installId'")}let p=$s(navigator==null?void 0:navigator.userAgent),I={app_id:x.appId,install_id:x.installId,time_zone:Kn(),country_code:Wr(),device_name:n((P=p.browser)==null?void 0:P.name),device_type:p.os.name,birth_year:x.birthYear,websites:x.websites,diff_private_websites:x.diffPrivateWebsites};await t("/v1/web/upload",{method:"POST",retry:0,body:I})}async function m(x){var P;if(!x.appId.trim()){let{websites:M,diffPrivateWebsites:j,...U}=x;throw r==null||r.error("Missing required parameter 'appId'",U),Error("Missing required parameter 'appId'")}if(!x.installId.trim()){let{websites:M,diffPrivateWebsites:j,...U}=x;throw r==null||r.error("Missing required parameter 'installId'",U),Error("Missing required parameter 'installId'")}let p=$s(navigator==null?void 0:navigator.userAgent),I={app_id:x.appId,install_id:x.installId,time_zone:Kn(),country_code:Wr(),device_name:n((P=p.browser)==null?void 0:P.name),device_type:p.os.name,birth_year:x.birthYear,websites:x.websites,diff_private_websites:x.diffPrivateWebsites};await t("/v1/page_views/upload",{method:"POST",retry:0,body:I})}async function A(x){if(!x.appId.trim()){let{apps:p,...I}=x;throw r==null||r.error("Missing required parameter 'appId'",I),Error("Missing required parameter 'appId'")}if(!x.installId.trim()){let{apps:p,...I}=x;throw r==null||r.error("Missing required parameter 'installId'",I),Error("Missing required parameter 'installId'")}let P={app_id:x.appId,install_id:x.installId,time_zone:Kn(),country_code:Wr(),device_name:n("App"),device_type:x.platform,birth_year:x.birthYear,apps:x.apps};await t("/v1/desktop/upload",{method:"POST",retry:0,body:P})}function S(x){return g({appId:x.appId,installId:x.installId,websites:{}})}function C(x){return A({appId:x.appId,installId:x.installId,platform:x.platform})}function v(x){return t("/v1/brands",{query:{install_id:x.installId}}).catch(P=>{var p;throw((p=P.response)==null?void 0:p.status)===403?new cp:P})}function w(x){return t("/v1/sync/config",{query:{key:x.deviceGroupKey}}).catch(P=>{var p;throw((p=P.response)==null?void 0:p.status)===404?new bs:P})}async function k(x){await t("/v1/sync/config/reset_time",{method:"POST",retry:0,body:x})}async function E(x){await t("/v1/sync/config/ignore_list/remove",{method:"POST",retry:0,body:x})}async function D(x){await t("/v1/sync/config/ignore_list/add",{method:"POST",retry:0,body:x})}async function y(x){await t("/v1/sync/config/usage_limit/add",{method:"POST",retry:0,body:x})}async function _(x){let P={key:x.key,limit_ids:x.limitIds};await t("/v1/sync/config/usage_limit/remove",{method:"POST",retry:0,body:P})}async function O(x){let P={app_id:x.appId,install_id:x.installId,time_zone:Kn(),country_code:Wr(),ads:x.ads};await t("/v1/desktop/retail/"+x.website,{method:"POST",retry:0,body:P})}async function R(x){let P={app_id:x.appId,country_code:x.countryCode,time_zone:Kn(),prompts:x.prompts};await t("/v1/ai/analytics",{method:"POST",retry:0,body:P})}async function V(x){let P={app_id:x.appId,service:x.service,install_id:x.installId,status:x.status,country_code:x.countryCode,timestamp:Math.round(Date.now()/1e3)};await t("/v1/subscriptions/status",{method:"POST",retry:0,body:P})}return{getAndroidAppInfo:s,createPairingCode:i,validatePairingCode:a,getMyDeviceGroup:l,getSessionsLastUploadedAt:u,getAverageAppUsage:h,getAverageWebUsage:d,listDeviceGroupDevices:o,removeDeviceFromDeviceGroup:c,listDeviceGroupSessions:f,uploadSessions:g,uploadPageViews:m,uploadDesktopUsage:A,createDevice:S,createDesktopDevice:C,getBrandMapping:v,getGroupConfig:w,setResetTime:k,removeFromIgnoreList:E,addToIgnoreList:D,addUsageLimit:y,removeUsageLimit:_,uploadRetailAds:O,uploadPrompts:R,uploadSubscriptionStatus:V}}const lp=Ie.createScopedLog("ScheduleJobs");let He;const Do={UploadWebUsage:"@alarm/upload-web-usage"},up="@stayfocusd/sessions-last-uploaded-at-key",dp="@stayfocusd/page-views-last-uploaded-at-key",hp={initAPI(e){return He=e,He.mixin("ScheduleJobs",{init:this.init.bind(this)})},init(){He.Chrome.Alarms.addListener("onAlarm",async e=>{e.name===Do.UploadWebUsage&&(lp("Alarm fired",e.name),await this.uploadWebUsageJob())}),He.Chrome.Alarms.ensure(Do.UploadWebUsage,{periodInMinutes:Vr/sn})},async uploadWebUsageJob(){const e=await He.WebUsage.getUsageDatabase(),t=ko({ofetchDefaults:{baseURL:"https://stayfocusd.st-panel-api.com"}});await sf({db:e,enabled:async()=>{const r=await He.RemoteConfig.get("uploadWebUsage"),s=await He.Storage.get("hasAcceptedPrivacyPolicy",!0);return r&&s},getAppId:()=>ms.APP_ID,dev:!1,getInstallId:()=>He.Storage.get(ms.INSTALL_ID_KEY),getBirthYear:()=>He.Settings.get("age")??void 0,logger:null,getUploadBatchSize:()=>He.RemoteConfig.get("usageUploadBatchSize"),api:t,sessions:{lastUploadedAtStorageKey:up,onFailure:()=>He.Analytics.event("WEB_USAGE_UPLOAD_FAILED"),onSuccess:r=>He.Analytics.event("WEB_USAGE_UPLOAD_COMPLETED",r)},pageViews:{lastUploadedAtStorageKey:dp,onFailure:()=>He.Analytics.event("PAGE_VIEWS_UPLOAD_FAILED"),onSuccess:r=>He.Analytics.event("PAGE_VIEWS_UPLOAD_COMPLETED",r),getUploadAllowlist:()=>He.RemoteConfig.get("pageViewAllowlist")}}).uploadAll()}};/** @license DropletJS.PubSub | MIT License | https://github.com/wmbenedetto/DropletJS.PubSub#mit-license */const Mo=function(e,t){var n,n=function(){};typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(o){var c=this;return function(){return c.apply(o,arguments)}});var r=function(o){return typeof o=="object"&&o!==null&&typeof o.length=="number"},s=function(o){return typeof o=="object"&&o!==null&&typeof o.length!="number"},i=function(o,c){try{delete o[c]}catch{o[c]=t}},a=function(c){if(this.namespace=this.DEFAULT_NS,c.indexOf(":")>-1&&(this.namespace=c.substr(0,c.indexOf(":")),c=c.substr(c.indexOf(":")+1,c.length)),c.indexOf(".")>-1){var u=c.split(".");this.msgArray=[u[0]||"*",u[1]||"*",u[2]||"*",u[3]||"*"],this.msgString=this.msgArray.join(".")}else this.msgArray=[c],this.msgString=c};a.prototype={DEFAULT_NS:"__default",matches:function(o){if(this.msgString===o)return!0;var c=this.msgArray,u=o.split(".");if(c.length!==u.length)return!1;for(var h="",d="",f=c.length>=u.length?c.length:u.length,g=0;g<f;g++){if(c[g]!=="*"&&u[g]!=="*"&&c[g]!==u[g])return!1;h+=c[g]==="*"?"0":"1",d+=u[g]==="*"?"0":"1"}return h>=d},toString:function(){return this.msgString}};var l={handlers:{},subscribers:{before:[],after:[]},getAPI:function(){return{clear:this.clear.bind(this),listen:this.listen.bind(this),once:this.once.bind(this),publish:this.publish.bind(this),stop:this.stop.bind(this),subscribe:this.subscribe.bind(this),unsubscribe:this.unsubscribe.bind(this)}},listen:function(){var o=this.processListenArgs(Array.prototype.slice.call(arguments));if(this.log("listen","Adding listener",o),r(o.message))return this.each(o,this.listen.bind(this)),null;this.addHandler(o)},once:function(){var o=this.processListenArgs(Array.prototype.slice.call(arguments));if(o.limit=1,this.log("once","Adding one-time listener",o),r(o.message))return this.each(o,this.once.bind(this)),null;this.addHandler(o)},stop:function(o){if(o)throw new Error("Message(s) must be passed to stop()");var c={message:this.toMessage(o)};if(this.log("stop","Stopping listener",c),r(c.message))return this.each(c,this.stop.bind(this)),null;this.removeHandlers(c)},subscribe:function(){var o=this.processSubscribeArgs(Array.prototype.slice.call(arguments)),c=o.phase;this.log("subscribe","Adding subscriber",o),this.subscribers[c]=this.subscribers[c]||[],this.subscribers[c].push(o)},unsubscribe:function(){var o=this.processUnsubscribeArgs(Array.prototype.slice.call(arguments));if(!o.phase)return this.unsubscribe(o.namespace,"before"),this.unsubscribe(o.namespace,"after"),null;var c=o.namespace,u=o.phase,h=this.subscribers[u];if(this.log("unsubscribe","Unsubscribe from "+u+" phase"+(c?" in "+c+" namespace":""),o),r(h))for(var d=0;d<h.length;d++)(!c||h[d].namespace===c)&&h.splice(d,1)},publish:function(){var o=this.processPublishArgs(Array.prototype.slice.call(arguments));if(r(o.message)){var c=o.onComplete;return o.onComplete=null,this.each(o,this.publish.bind(this),c),null}var u=o.message.toString();this.log("publish","# START publishing "+u,o);for(var h=o.message,d=o.payload,f=o.onPublish,g=this.subscribers.before.concat(this.getHandlers(h)).concat(this.subscribers.after),m=0;m<g.length;m++){if(g[m].limit===null||g[m].count<g[m].limit){var A=g[m].async?g[m].handler(h,d,f):g[m].handler(h,d);g[m].async!==!0&&typeof f=="function"&&f(A),g[m].count+=1}typeof g[m].limit=="number"&&g[m].count===g[m].limit&&this.removeHandlers(o,m)}this.log("publish","# END publishing "+u,o),typeof o.onComplete=="function"&&o.onComplete()},getHandlers:function(o){var c=[];for(var u in this.handlers)this.handlers.hasOwnProperty(u)&&o.matches(u)&&(c=c.concat(this.handlers[u]));return c},clear:function(){this.log("clear","Clearing PubSub"),this.handlers={},this.subscribers={before:[],after:[]}},each:function(o,c,u){for(var h=0;h<o.message.length;h++){var d={};for(var f in o)o.hasOwnProperty(f)&&f!=="message"&&(d[f]=o[f]);d.message=o.message[h],c(d)}typeof u=="function"&&u()},addHandler:function(o){var c=o.message.toString();this.log("addHandler","Adding handler for "+c+" message",null,"TRACE"),this.handlers[c]=this.handlers[c]||[],this.handlers[c].push({namespace:o.message.namespace,handler:o.handler,async:o.async,limit:typeof o.limit=="number"?o.limit:null,count:0})},removeHandlers:function(o,c){var u=o.message.toString(),h=o.message.namespace,d=this.handlers;if(d&&d[u]){var f="Removing handler for "+u+" message";if(f+=h!==o.message.DEFAULT_NS?" in "+h+" namespace":"",this.log("removeHandlers",f,null,"TRACE"),typeof c=="number")d[u][c].namespace===h&&d[u].splice(c,1);else for(var g=0;g<d[u].length;g++)d[u][g].namespace===h&&d[u].splice(g,1);d[u].length===0&&i(d,u)}},processListenArgs:function(o){var c={};if(s(o[0])?c=o[0]:(c.message=typeof o[0]=="string"||r(o[0])?o[0]:null,c.handler=typeof o[1]=="function"?o[1]:null),!c.message||typeof c.handler!="function")throw new Error("Message(s) and handler function must be passed to listen() and/or once()");return c.message=this.toMessage(c.message),c},processSubscribeArgs:function(o){var c={};if(s(o[0])?c=o[0]:c.handler=typeof o[0]=="function"?o[0]:null,typeof c.handler!="function")throw new Error("Handler must be passed to subscribe()");if(c.phase=c.phase||"after",c.limit=null,c.count=0,c.phase&&!(c.phase in{before:1,after:1}))throw new Error(c.phase+" is not a valid phase for subscribe().");return c},processUnsubscribeArgs:function(o){var c={};if(s(o[0])?c=o[0]:(c.namespace=typeof o[0]=="string"?o[0]:null,c.phase=typeof o[1]=="string"?o[1]:null),c.phase&&!(c.phase in{before:1,after:1}))throw new Error(c.phase+" is not a valid phase for unsubscribe().");return c},processPublishArgs:function(o){var c={};if(s(o[0])?c=o[0]:(c.message=typeof o[0]=="string"||r(o[0])?o[0]:null,c.payload=typeof o[1]<"u"?o[1]:null),!c.message)throw new Error("Message(s) must be passed to publish()");return c.message=this.toMessage(c.message),c.async&&typeof c.onPublish!="function"&&(c.onPublish=function(){}),c},toMessage:function(o){if(r(o)){for(var c=[],u=0;u<o.length;u++)o[u]instanceof a||(c[u]=new a(o[u]));o=c}else o&&!(o instanceof a)&&(o=new a(o));return o},log:function(o,c,u,h){n("DropletJS.PubSub."+o,c,u,h)},setLogLevel:function(o){}};return l}(),vs=Ie.createScopedLog("Notification");let pt;const Bn={settings:[300,60,10],NOTIFICATION_TTL:5e3,initAPI:function(e){return pt=e,pt.mixin("Notification",{initAsync:this.initAsync.bind(this),get:this.get.bind(this),saveSettings:this.saveSettings.bind(this)})},init:function(e){vs("init","Initializing Notification",null,"DEBUG"),this.loadSettings(),typeof e=="function"&&e()},initAsync(){return new Promise(e=>this.init(e))},get:function(){return this.settings},show:function(e){vs("show","Showing "+e+" notification");let t="",n="",r=0;e==="nuclear"?(r=pt.NuclearOption.getSecondsUntilActive(),t="/common/img/icon-nuclear-48.png",n=pt.Chrome.Translation.get("nuclearNotification")||"The Nuclear Option will start blocking sites in"):e==="block"&&(r=pt.StayFocusd.getTotalSecondsRemaining(),t="/common/img/icon-red-48.png",n=pt.Chrome.Translation.get("blockNotification")||"StayFocusd will start blocking your Blocked Sites in"),n+=r>60?" "+pt.Date.secondsToMinsAndSecs(r):" "+r+" seconds";const s={type:"basic",title:"StayFocusd",iconUrl:t,message:n};pt.Chrome.Notification.create("",s,i=>{i!=null&&setTimeout(()=>{pt.Chrome.Notification.clear(i)},this.NOTIFICATION_TTL)})},isset:function(e){return this.settings.inArray(e)},saveSettings:function(e){vs("saveSettings","Saving settings",e,"TRACE"),this.settings=e,pt.Settings.set({notificationSettings:e})},loadSettings:function(){vs("loadSettings","Loading settings",null,"TRACE");const e=pt.Settings.get("notificationSettings");e&&(this.settings=e)}};var Ar=(e=>(e.RED="#FF0000",e.YELLOW="#FDD017",e.GREEN="#009933",e.BLACK="#000000",e))(Ar||{}),jn=(e=>(e.ONBOARDING="/common/img/icon-red-dot-24.png",e.ALLOWED="/common/img/icon-green-24.png",e.BLOCKED="/common/img/icon-red-24.png",e.DEFAULT="/common/img/icon-24.png",e.NUCLEAR="/common/img/icon-nuclear-24.png",e.DEACTIVATED="/common/img/icon-disabled-24.png",e))(jn||{});const ws=function(e,t,n,r){qn.log(`BadgeIcons.${e}`,t,n,r)};function No(){function e(a,l,o){const c=a||"",u=o||void 0;ws("showBadge","Showing badge",{text:c,iconColor:l,tabID:u},"DEBUG"),l&&r(l,u),s(c,u)}function t(a){a=a||void 0,s("",a)}async function n(a,l){l=l||void 0,ws("setIcon","Setting icon",a,"TRACE"),await i()?chrome.action.setIcon({tabId:l,path:"/common/img/icon-red-dot-24.png"}):chrome.action.setIcon({tabId:l,path:a})}function r(a,l){ws("setBadgeColor","Setting badge color",a,"TRACE"),l=l||void 0,chrome.action.setBadgeBackgroundColor({tabId:l,color:a})}function s(a,l){ws("setBadgeText","Setting badge text",a,"TRACE"),l=l||void 0,chrome.action.setBadgeText({tabId:l,text:a})}async function i(){return!1}return{showBadge:e,hideBadge:t,setIcon:n}}const gp=No(),Lt=Ie.createScopedLog("NuclearOption");let Ke;const at={timer:null,interval:1,settings:{},initialized:!1,initAPI:function(e){return Ke=e,Ke.mixin("NuclearOption",{init:this.init.bind(this),initAsync:this.initAsync.bind(this),activate:this.activate.bind(this),isActive:this.isActive.bind(this),getBlockLength:this.getBlockLength.bind(this),getBlockType:this.getBlockType.bind(this),getContentType:this.getContentType.bind(this),getExpiration:this.getExpiration.bind(this),getFrequency:this.getFrequency.bind(this),getSecondsUntilActive:this.getSecondsUntilActive.bind(this),getSmartBomb:this.getSmartBomb.bind(this),getStartAmPm:this.getStartAmPm.bind(this),getStartHour:this.getStartHour.bind(this),getStartMin:this.getStartMin.bind(this),getStartType:this.getStartType.bind(this),saveSettings:this.saveSettings.bind(this),updateActiveDays:this.updateActiveDays.bind(this)})},init:function(e){Lt("init","Initializing NuclearOption",null,"DEBUG"),this.loadSettings(),this.timer=setInterval(this.tick.bind(this),this.interval*1e3),this.initialized=!0,typeof e=="function"&&e(),Ke.PubSub.listen("Settings.data.refreshed",(t,n)=>{n.changes.nuclearOptionSettings&&this.loadSettings()})},initAsync(){return new Promise(e=>this.init(e))},saveSettings:function(e){this.settings=e,e.activeDays=this.calculateActiveDays(e),Lt("saveSettings","Saving settings",e,"DEBUG"),Ke.Settings.set({nuclearOptionSettings:e})},calculateActiveDays:function(e){let t=[];return e.frequency==="activeDays"?t=Ke.StayFocusd.getActiveDays(!0):typeof e.frequency<"u"&&(t[0]=e.frequency==="everyDay",t[1]=e.frequency.indexOf("every")>-1,t[2]=e.frequency.indexOf("every")>-1,t[3]=e.frequency.indexOf("every")>-1,t[4]=e.frequency.indexOf("every")>-1,t[5]=e.frequency.indexOf("every")>-1,t[6]=e.frequency==="everyDay"),Lt("calculateActiveDays","Calculating active days",t,"DEBUG"),t},updateActiveDays:function(e){Lt("updateActiveDays","Updating active days",e,"DEBUG"),this.initialized||this.init(()=>{this.updateActiveDays(e)}),this.settings.activeDays=e,this.saveSettings(this.settings)},loadSettings:function(){Lt("loadSettings","Loading settings",this.settings,"DEBUG");const e=Ke.Settings.get("nuclearOptionSettings");e&&(this.settings=e)},isActive:function(){this.isCurrentlyActive()?this.isExpired()&&this.deactivate():this.isStarted()&&this.activate();const e=this.isCurrentlyActive();return Lt("isActive","Is Nuclear Option active?",e?"YES":"NO","TRACE"),e},isActiveToday:function(){const e=this.getFrequency(),t=this.getLastActiveDate(),n=this.getLastExpiredDate(),r=new Date().toDateString();if(e==="todayOnly"&&(t===r||t===null)&&n!==r)return!0;const s=new Date().getDay(),i=this.getActiveDays();return i.length===0?!1:i[s]},isStarted:function(){const e=this.getStartType(),t=this.getLastActiveDate(),n=this.getLastExpiredDate(),r=new Date().toDateString();if(!this.isActiveToday()||n===r)if(e==="atScheduledTime"){const s=new Date(r+" "+this.getStartHour()+":"+this.getStartMin()+" "+this.getStartAmPm());if(new Date(this.getExpiration())>s)return!1}else return!1;if(e==="now")return t===r;if(this.isActiveToday()){if(e==="atScheduledTime")return Ke.Date.hasTimePassed(this.getStartHour(),this.getStartMin(),this.getStartAmPm());if(e==="whenMaxTimeAllowedExceeded")return!!Ke.BlockedAllWebsites.isMaxTimeAllowedExceeded()}return!1},activate:function(){Ke.Analytics.event("TOGGLE_NUCLEAR_OPTION",{enabled:!0}),Lt("activate","Activating Nuclear Option");const e=this.hasScheduledTime()?Ke.Date.getTodayDateObj(this.getStartHour(),this.getStartMin(),this.getStartAmPm()):new Date;this.settings.expiration=e.getTime()+this.getBlockLength(),this.settings.lastActiveDate=new Date().toDateString(),this.settings.lastExpiredDate=null,this.settings.isCurrentlyActive=!0,this.saveSettings(this.settings),gp.hideBadge()},deactivate:function(){Ke.Analytics.event("TOGGLE_NUCLEAR_OPTION",{enabled:!1}),Lt("deactivate","Deactivating Nuclear Option"),this.settings.lastExpiredDate=new Date().toDateString(),this.settings.isCurrentlyActive=!1,this.saveSettings(this.settings)},isExpired:function(){if(this.getExpiration()===null)return!0;const e=new Date;return new Date(this.getExpiration())<e},isBlockable:function(e,t){if(this.isActive()===!1)return!1;switch(this.getBlockType()){case"all":return!0;case"allExceptAllowed":return!t;case"blocked":return e&&!t;default:return!1}},hasScheduledTime:function(){return this.getStartType()==="atScheduledTime"},getSecondsUntilActive:function(){return Ke.Date.secondsUntilTime(this.getStartHour(),this.getStartMin(),this.getStartAmPm())},hasSmartBomb:function(){return this.getContentType()==="smartBomb"},isCurrentlyActive:function(){return typeof this.settings.isCurrentlyActive>"u"?!1:this.settings.isCurrentlyActive},getSmartBomb:function(){return this.settings.smartBomb??{}},getContentType:function(){return typeof this.settings.contentType>"u"?"wholeSite":this.settings.contentType},getExpiration:function(){return typeof this.settings.expiration>"u"?null:Number(this.settings.expiration)},getLastActiveDate:function(){return typeof this.settings.lastActiveDate>"u"?null:this.settings.lastActiveDate},getLastExpiredDate:function(){return typeof this.settings.lastExpiredDate>"u"?null:this.settings.lastExpiredDate},getBlockType:function(){return typeof this.settings.blockType>"u"?"blocked":this.settings.blockType},getBlockLength:function(){if(typeof this.settings.blockLength>"u")return Vr;{const e=this.settings.blockLength;return Number(e)===e&&e%1!==0||e<sn?Math.floor(e*60)*sn:e}},getStartType:function(){return typeof this.settings.startType>"u"?"now":this.settings.startType},getStartHour:function(){return this.settings.startHour??"00"},getStartMin:function(){return this.settings.startMin??"00"},getStartAmPm:function(){return this.settings.startAmPm??"am"},getFrequency:function(){return this.settings.frequency??null},getActiveDays:function(){return this.settings.activeDays??[]},tick:function(){if(this.hasScheduledTime()&&!this.isActive()){const e=this.getSecondsUntilActive();Lt("tick",e+" seconds until Nuclear Option",null,"TRACE"),Bn.isset(e)&&Bn.show("nuclear"),this.updateBadge()}else this.isActive()&&this.updatePopupTimer();return!0},updatePopupTimer(){Ke.StayFocusd.postTimerUpdatedMessage()},updateBadge:function(){const e=this.getSecondsUntilActive();e>0&&e<60&&Ke.StayFocusd.updateBadge(this.getSecondsUntilActive(),!0)}},As=Ie.createScopedLog("WebUsage"),fp=1e3;let ot;const pp={_timer:null,_isNewDay:null,_killPageAction:null,_updateBadgeAction:null,_postTimerUpdatedMessage:null,_showNotification:null,initAPI(e){return ot=e,ot.mixin("BlockedGroupsTimer",{init:this.init.bind(this),startCountdown:this.startCountdown.bind(this),stopCountdown:this.stopCountdown.bind(this),tick:this.tick.bind(this),isMaxTimeAllowedExceeded:this.isMaxTimeAllowedExceeded.bind(this),getTotalSecondsRemaining:this.getTotalSecondsRemaining.bind(this)})},async init(e,t,n,r,s){this._isNewDay=e,this._killPageAction=t,this._updateBadgeAction=n,this._postTimerUpdatedMessage=r,this._showNotification=s},startCountdown(e){if(this._timer&&this.stopCountdown(),!ot.Settings.get("activated",!0)){As("startCountdown","Extension is not activated");return}As("startCountdown","Starting countdown"),this._timer=setInterval(async()=>await this.tick(e),fp)},stopCountdown(){As("stopCountdown","Stopping countdown"),this._timer&&clearInterval(this._timer),this._timer=null},async tick(e){var n;(n=this._isNewDay)!=null&&n.call(this)&&ot.BlockedGroupsRepository.clearElapsedTime();const t=ot.BlockedAllWebsites.getTime();if(t!=null)await ot.Storage.set({blockAllWebsitesElapsedTime:t.elapsedTime+1}),this.actionsAfterCheckingTime(e,t.elapsedTime,t.allowedTime-t.elapsedTime);else{const r=ot.BlockedGroupsRepository.getBlockedGroupByDomain(e);if(!r)return;await ot.BlockedGroupsRepository.incrementElapsedTime(r.groupName);const s=r.maxTimeAllowed-r.elapsedTime;this.actionsAfterCheckingTime(e,r.elapsedTime,s)}},actionsAfterCheckingTime(e,t,n){var r,s,i,a;if(As("tick",`Elapsed time: ${t}. Time remaining: ${n}`,null,"DEBUG"),(r=this._showNotification)==null||r.call(this,n),n<=0){(s=this._killPageAction)==null||s.call(this,e);return}(i=this._postTimerUpdatedMessage)==null||i.call(this),(a=this._updateBadgeAction)==null||a.call(this,n)},isMaxTimeAllowedExceeded(e){const t=ot.BlockedAllWebsites.isMaxTimeAllowedExceeded();if(t!=null)return t;{const n=ot.BlockedGroupsRepository.getBlockedGroupByDomain(e);if(n)return n.elapsedTime>=n.maxTimeAllowed}return!1},getTotalSecondsRemaining(e){const t=ot.BlockedAllWebsites.getTotalSecondsRemaining();if(t!=null)return t;{const n=ot.BlockedGroupsRepository.getBlockedGroupByDomain(e);if(n!=null)return n.maxTimeAllowed-n.elapsedTime}}};let Fn;const mp={initAPI(e){return Fn=e,Fn.mixin("BlockedAllWebsites",{getTime:this.getTime.bind(this),isMaxTimeAllowedExceeded:this.isMaxTimeAllowedExceeded.bind(this),getTotalSecondsRemaining:this.getTotalSecondsRemaining.bind(this),clearElapsedTime:this.clearElapsedTime.bind(this)})},getTime(){if(Fn.Settings.get("isBlockAllWebsites")??!1){const t=Fn.Settings.get("blockAllWebsitesAllowedTime")??Tn*10,n=Fn.Settings.get("blockAllWebsitesElapsedTime")??0;return{allowedTime:t,elapsedTime:n}}return null},isMaxTimeAllowedExceeded(){const e=this.getTime();return e!=null?e.elapsedTime>=e.allowedTime:null},getTotalSecondsRemaining(){const e=this.getTime();return e!=null?e.allowedTime-e.elapsedTime:null},async clearElapsedTime(){await Fn.Storage.set({blockAllWebsitesElapsedTime:0})}};function _s(e,t){return z.Domain.isMoreGeneralURL(e,t)||z.Domain.matchesWildcard(e,t)}const Et="blockedGroups",Ro="blacklist",Lo="maxTimeAllowed",Ei="Default";let Re,qe=[];const yp={initAPI(e){return Re=e,Re.mixin("BlockedGroupsRepository",{init:this.init.bind(this),add:this.add.bind(this),get:this.get.bind(this),getByName:this.getByName.bind(this),update:this.update.bind(this),updateWebsites:this.updateWebsites.bind(this),addWebsite:this.addWebsite.bind(this),clearElapsedTime:this.clearElapsedTime.bind(this),incrementElapsedTime:this.incrementElapsedTime.bind(this),delete:this.delete.bind(this),isBlockable:this.isBlockable.bind(this),getBlockedGroupByDomain:this.getBlockedGroupByDomain.bind(this),getBlockedGroupsByDomain:this.getBlockedGroupsByDomain.bind(this),migrate:this.migrate.bind(this),importBlockedsites:this.importBlockedsites.bind(this)})},async init(){if(z.Settings.get("disableSync")===!0){const n=!!(await Re.Chrome.Storage.getSync(Et))[Et];await Re.Storage.setBucket(Et,"LOCAL",!n)}else{const n=!!(await Re.Chrome.Storage.getLocal(Et))[Et];await Re.Storage.setBucket(Et,"SYNC",!n)}this.getGroups(),this.addListeners()},async getGroups(){const e=Re.Settings.get(Et);qe=e??[]},async add(e,t,n,r){if(qe.find(i=>i.groupName==e)==null){const i={groupName:e,maxTimeAllowed:t,websites:n,elapsedTime:r??0};qe.push(i),await this.saveChanges(),z.Analytics.event("CREATE_BLOCKED_GROUP")}},get(){return qe},getByName(e){return qe.find(t=>t.groupName==e)},async update(e,t,n,r){const s=qe.find(i=>i.groupName==e);typeof s>"u"||(s.groupName!=t&&z.Analytics.event("UPDATE_BLOCKED_GROUP_NAME"),s.groupName!="Default"&&(s.groupName=t),s.maxTimeAllowed!=n&&z.Analytics.event("UPDATE_BLOCKED_GROUP_MAX_TIME_ALLOWED",{minutes:n/60}),s.maxTimeAllowed=n,s.websites=r,await this.saveChanges())},async updateWebsites(e,t){const n=qe.find(r=>r.groupName==e);typeof n>"u"||(n.websites=t,await this.saveChanges())},async addWebsite(e,t){const n=qe.find(r=>r.groupName==e);if(!(typeof n>"u"))return n.websites.find(r=>r==t)==null?(n.websites.push(t),await this.saveChanges(),!0):!1},async clearElapsedTime(){this.get().forEach(t=>t.elapsedTime=0),await this.saveChanges(),await Re.BlockedAllWebsites.clearElapsedTime()},async delete(e){const t=qe.findIndex(n=>n.groupName==e);t>-1&&(qe.splice(t,1),await this.saveChanges(),z.Analytics.event("DELETE_BLOCKED_GROUP"))},isBlockable(e){return e=e.toLowerCase(),qe.find(t=>t.websites.find(n=>_s(n,e)))!=null},getBlockedGroupByDomain(e){return e==null?null:(e=e.toLowerCase(),qe.find(t=>t.websites.find(n=>_s(n,e))))},getBlockedGroupsByDomain(e){return qe.filter(t=>t.websites.find(n=>_s(n,e)))},async migrate(){if(this.needMigrate()){const e=Re.Settings.get(Ro);let t=Re.Settings.get(Lo);t==null?t=ga:t=t*Tn;let n=await Re.Storage.get("elapsedTime");if((isNaN(n)||n==null)&&(n=0),e!=null){const r=Object.keys(e);await this.add(Ei,t,r,n)}else await this.add(Ei,t,[],n)}},needMigrate(){return Re.Settings.get(Et)==null},async importBlockedsites(){qe=[];const e=Re.Settings.get(Ro);if(e!=null){const t=Object.keys(e);let n=Re.Settings.get(Lo);n==null?n=ga:n=n*Tn,await this.add(Ei,n,t,0)}},async incrementElapsedTime(e){const t=this.getByName(e);t&&(t.elapsedTime+=1,await this.saveChanges())},async saveChanges(){await Re.Storage.set({blockedGroups:qe})},addListeners(){z.PubSub.listen("Settings.data.refreshed",async(e,t)=>{(t.changes.blockedGroups||t.changes.disableSync)&&(t.changes.disableSync&&(t.disableSync===!1?await Re.Storage.setBucket(Et,"SYNC"):await Re.Storage.setBucket(Et,"LOCAL")),this.getGroups())})}},xs=Ie.createScopedLog("Message");class bp{constructor(t){_n(this,"DEFAULT_NS","__default");_n(this,"msgArray",null);_n(this,"msgString",null);_n(this,"namespace",null);if(this.namespace=this.DEFAULT_NS,t.indexOf(":")>-1&&(this.namespace=t.substr(0,t.indexOf(":")),t=t.substr(t.indexOf(":")+1,t.length)),t.indexOf(".")>-1){const n=t.split(".");this.msgArray=[n[0]||"*",n[1]||"*",n[2]||"*",n[3]||"*"],this.msgString=this.msgArray.join(".")}else this.msgArray=[t],this.msgString=t}matches(t){if(this.msgString===t)return xs("matches",this.msgString+" matches "+t+"?","YES","TRACE"),!0;const n=this.msgArray,r=t.split(".");if((n==null?void 0:n.length)!==r.length)return xs("matches",this.msgString+" matches "+t+"?","NO","TRACE"),!1;let s="",i="";const a=n.length>=r.length?n.length:r.length;for(let l=0;l<a;l++){if(n[l]!=="*"&&r[l]!=="*"&&n[l]!==r[l])return xs("matches",this.msgString+" matches "+t+"?","NO","TRACE"),!1;s+=n[l]==="*"?"0":"1",i+=r[l]==="*"?"0":"1"}return xs("matches",this.msgString+" matches "+t+"?",s>=i?"YES":"NO","TRACE"),s>=i}toString(){return this.msgString}getOriginator(){var t,n;return((t=this.msgArray)==null?void 0:t[0])==="*"?null:(n=this.msgArray)==null?void 0:n[0]}getDescriptor(){var t,n;return((t=this.msgArray)==null?void 0:t[3])==="*"?null:(n=this.msgArray)==null?void 0:n[3]}}const ue=Ie.createScopedLog("StayFocusd"),$n=No();let N;const Uo="onboarding-opened-at",vp={firstInstallAllowance:60,interval:1,timer:null,apiURL:"https://www.stayfocusd.com",redirectURL:"https://www.stayfocusd.com/blocked/",uninstallUrl:"https://www.stayfocusd.com/goodbye/",onboardingUrl:"https://www.stayfocusd.com/extension-get-started",currentURL:null,version:null,selectedTabID:null,active:null,popupPort:null,initAPI:function(e){return N=e,N.mixin("StayFocusd",{getActiveDays:this.getActiveDays.bind(this),getActiveHours:this.getActiveHours.bind(this),getActiveHoursQueue:this.getActiveHoursQueue.bind(this),getAPIURL:()=>this.apiURL,getCurrentURL:()=>this.currentURL,getResetTime:this.getResetTime.bind(this),getResetTimeQueue:this.getResetTimeQueue.bind(this),getTotalSecondsRemaining:this.getTotalSecondsRemaining.bind(this),isActive:this.isActive.bind(this),isFirstInstallAllowanceActive:this.isFirstInstallAllowanceActive.bind(this),isUpdatePopupDisabled:this.isUpdatePopupDisabled.bind(this),localizeHTML:this.localizeHTML.bind(this),setActiveDays:this.setActiveDays.bind(this),setActiveHoursQueue:this.setActiveHoursQueue.bind(this),setResetTimeQueue:this.setResetTimeQueue.bind(this),updateBadge:this.updateBadge.bind(this),hideBadge:this.hideBadge.bind(this),postTimerUpdatedMessage:this.postTimerUpdatedMessage.bind(this),onInstalled:this.onInstalled.bind(this),onUpdated:this.onUpdated.bind(this),activated:this.activated.bind(this),setActivated:this.setActivated.bind(this),isActivateSwitchShown:this.isActivateSwitchShown.bind(this),setActivateSwitchShown:this.setActivateSwitchShown.bind(this)})},async init(){ue("init","Initializing StayFocusd",null,"DEBUG"),this.initCheckingTab(),await this.initSettings(),await this.initRemoteConfig(),this.initAnalytics(),this.initBugsnag(),await this.initRequirements(),await this.initBlockedGroups(),this.initBlockedGroupTimer(),await this.initWhitelist(),await this.initNuclearOption(),await this.initNotification(),this.initListeners(),this.initUninstallURL(),await this.initWebUsageCollect(),this.initScheduleJobs(),await this.forceOnboardingOnNewTab()},initBlockedGroupTimer(){const e=()=>this.isNewDay(),t=i=>this.killPage(i),n=i=>this.updateBadge(i),r=()=>this.postTimerUpdatedMessage(),s=i=>this.showNotification(i);N.BlockedGroupsTimer.init(e,t,n,r,s)},async initSettings(){await N.Settings.initAsync(),await N.Storage.setBucket(["backupKeys","disableUpdatePopup","isUpdated","previousVersion","productivityBypass"]),N.Storage.addOnChangeListener(async(e,t)=>{ue("init",t+" storage changed",e),N.Settings.refresh(()=>{N.PubSub.publish("Settings.data.refreshed",{areaName:t,changes:e})})}),this.isFirstInstall()&&this.setFirstInstallAllowance()},async initRemoteConfig(){await N.RemoteConfig.init(),await N.Chrome.Alarms.ensure("remote-config",{periodInMinutes:30}),N.Chrome.Alarms.addListener("onAlarm",async e=>{e.name==="remote-config"&&await N.RemoteConfig.refresh()}),await N.RemoteConfig.refresh()},initAnalytics(){N.Analytics.init()},initBugsnag(){N.Bugsnag.init("background")},async initWebUsageCollect(){await N.WebUsage.init(),chrome.runtime.onConnect.addListener(e=>{e.name=="getUsageSummaryData"&&e.onMessage.addListener(async t=>{if(t.message=="usage.getUsageSummaryData.request"){const n=await N.WebUsage.getUsageDatabase(),r=await n.sessionsRepo.findSessions(t.startDate,t.endDate),s=await n.adsRepo.findAds(t.startDate,t.endDate);e.postMessage({message:"usage.getUsageSummaryData.response",startDate:t.startDate,endDate:t.endDate,sessions:r,ads:s})}})})},initCheckingTab(){setInterval(()=>{N.Chrome.Tab.getSelected(void 0,e=>{e&&N.PubSub.publish("StayFocusd.tab.activity",{tabID:e.id,tab:e})})},1e3)},initScheduleJobs(){N.ScheduleJobs.init()},async initRequirements(){await N.Requirements.init()},async initBlockedGroups(){await N.BlockedGroupsRepository.init(),await N.BlockedGroupsRepository.migrate(),this.isNewDay()===!0&&N.BlockedGroupsRepository.clearElapsedTime()},async initWhitelist(){ue("initWhitelist","Initializing whitelist",null,"DEBUG"),await N.WhitelistRepository.init(),await N.WhitelistRepository.migrate()},async initNuclearOption(){ue("initNuclearOption","Initializing Nuclear Option",null,"DEBUG"),await at.initAsync(),ue("initNuclearOption","Nuclear Option initialized",null,"DEBUG")},async initNotification(){ue("initNotification","Initializing Notification",null,"DEBUG"),await Bn.initAsync(),ue("initNotification","Notification initialized",null,"DEBUG")},showNotification(e){Bn.isset(e)&&Bn.show("block")},initListeners(){ue("initListeners","Initializing listeners",null,"DEBUG"),N.PubSub.subscribe({async:!0,handler:async(e,t,n)=>{var a;function r(l){return chrome.runtime.lastError&&ue("initListeners","runtime.lastError",chrome.runtime.lastError),l!=null&&typeof l=="function"?l:()=>!0}if(n=r(n),!t||!t.tabID||(a=t.sender)!=null&&a.tab)return!0;const s=await N.Chrome.Tab.get(t.tabID);if(!s||s.status==="loading")return!0;const i=(s.url==""?s.pendingUrl:s.url)??"";return/^about:|^chrome-extension:|^chrome:\/\//i.test(i)||N.Chrome.Message.sendToTab(t.tabID,{message:e.toString(),payload:t},n),!0}}),N.Chrome.Message.on.addListener((e,t,n)=>(e.payload=e.payload||{},e.payload.sender=t||{},/^proxy-service.*$/.test(e.type)||t.tab&&N.PubSub.publish({message:e.message,payload:e.payload,onPublish:typeof n=="function"?n:()=>{}}),!0)),N.PubSub.listen("ActivityMonitor.component.initialized",()=>{N.Chrome.Tab.getSelected(void 0,e=>{e&&N.PubSub.publish("StayFocusd.tab.selected",{tab:e,tabID:e.id,blockable:this.isBlockable(e.url??"")})})}),N.PubSub.listen({message:"ActivityMonitor.overlay.hidden",async:!0,handler:(e,t,n)=>{const r={countdownStarted:N.BlockedGroupsTimer.startCountdown(this.currentURL)};typeof n=="function"&&n(r)}}),N.PubSub.listen({message:"ActivityMonitor.overlay.shown",async:!0,handler:(e,t,n)=>{const r={countdownStopped:N.BlockedGroupsTimer.stopCountdown()};typeof n=="function"&&n(r)}}),N.Chrome.Extension.addListener("onConnect",e=>{e.name==="popup"&&this.onPopupConnected(e)}),N.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)}),N.Chrome.Tab.addListener("onActivated",()=>{N.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)})}),N.Chrome.Tab.addListener("onUpdated",()=>{N.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)})}),N.Chrome.Tab.addListener("onRemoved",()=>{N.Chrome.Tab.getSelected(void 0,e=>{typeof e>"u"&&N.BlockedGroupsTimer.stopCountdown()})}),N.Chrome.Window.addListener("onRemoved",()=>{N.BlockedGroupsTimer.stopCountdown()}),N.Chrome.Window.addListener("onFocusChanged",()=>{N.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)})})},async onInstalled(e){await chrome.tabs.create({url:this.onboardingUrl,active:!0}),ue("onInstalled","Installed extension",e,"INFO");const{promise:t,resolve:n}=Ie.getDecoupledPromise();chrome.runtime.onConnect.addListener(r=>{r.name=="startOnboardingAfterInstall"&&r.onMessage.addListener(async s=>{s.message=="start-onboarding"&&n()})}),await t,N.Settings.set({isNewUser:!0}),await this.openOnboarding()},async onUpdated(e){if(!e.previousVersion)return;const t=await N.Storage.get("previousVersion"),n=await N.Storage.get("disableUpdatePopup");t!==e.previousVersion&&(n!=="true"&&n!==!0&&$n.showBadge("NEW",Ar.GREEN),N.Storage.set({isUpdated:!0,previousVersion:e.previousVersion}))},async openOnboarding(){ue("openOnboarding","Opening onboarding in new tab",void 0,"INFO"),await N.Storage.set({[Uo]:Date.now()}),await N.Chrome.Tab.update({url:this.getOptionsPage(),active:!0})},async forceOnboardingOnNewTab(){ue("initOnboarding","initializing...",void 0,"INFO");const e=await this.getFirstSensorTowerInstallDate();N.Chrome.Tab.addListener("onCreated",async t=>{if(Date.now()-e<sn)return;ue("initOnboarding","tab.onCreated",t,"DEBUG");const n=N.RemoteConfig.get("newTabTimeout"),r=await N.Requirements.isOnboardingCompleted(),s=await N.Storage.get(Uo)??0,i=Date.now()>=s+n;!r&&i&&(await N.Analytics.event("OPENING_ONBOARDING_ON_TAB_CREATED"),await this.openOnboarding())})},initUninstallURL(){N.Chrome.Extension.setUninstallURL(this.uninstallUrl)},onPopupConnected(e){ue("onPopupConnected","Popup connected",e,"DEBUG"),this.popupPort=e,e.onMessage.addListener(async t=>{const n=new bp(t.message);if(n.matches("*.domain.add.BLACKLIST")){const r=t.payload.groupName,s=t.payload.domain,i=await N.BlockedGroupsRepository.addWebsite(r,s);e.postMessage({message:"StayFocusd.domain.added."+n.getDescriptor(),payload:{success:i}}),await this.checkURL(t.payload.domain)}if(n.matches("*.domain.add.WHITELIST")){const r=[t.payload.domain],s=await N.WhitelistRepository.add(r);e.postMessage({message:"StayFocusd.domain.added."+n.getDescriptor(),payload:{success:s}}),await this.checkURL(t.payload.domain)}if(n.matches("PopupController.toggle.*.*")){const{value:r}=t.payload;this.setActivated(r),e.postMessage({message:"StayFocusd.toggled",payload:{value:this.activated()}}),N.Chrome.Tab.getSelected(void 0,async s=>{await this.onTabStateChange(s)})}return!0}),e.onDisconnect.addListener(()=>{this.popupPort=null}),this.postTimerUpdatedMessage()},postTimerUpdatedMessage:function(){N.PubSub.publish("StayFocusd.timer.updated",{tabID:this.selectedTabID,displayTimer:this.getDisplayTimer()}),this.popupPort&&this.popupPort.postMessage({message:"StayFocusd.timer.updated",payload:{displayTimer:this.getDisplayTimer()}})},onTabStateChange:async function(e){if(typeof e>"u")return;ue("onTabStateChange","Tab state changed",e),this.currentURL=e.url,this.selectedTabID=e.id,await this.checkURL(e.url);const t=this.isBlockable(e.url);N.PubSub.publish("StayFocusd.tab.selected",{tab:e,tabID:e.id,blockable:t})},checkURL:async function(e){e=typeof e>"u"||typeof e=="string"&&e.length===0?this.currentURL:e,ue("checkURL","Checking url: ",e),this.isNewDay()===!0&&N.BlockedGroupsRepository.clearElapsedTime(),N.BlockedGroupsTimer.stopCountdown(),this.isBlockable(e)?(N.Chrome.Tab.getSelected(void 0,t=>{this.setBadgeIcon(t,jn.BLOCKED)}),this.isKillable(e)?this.killPage(e):N.BlockedGroupsTimer.startCountdown(e)):N.WhitelistRepository.isExists(e)?N.Chrome.Tab.getSelected(void 0,n=>{this.setBadgeIcon(n,jn.ALLOWED)}):N.Chrome.Tab.getSelected(void 0,n=>{this.setBadgeIcon(n,jn.DEFAULT)})},setBadgeIcon(e,t){e&&(this.activated()?at.isActive()?$n.setIcon(jn.NUCLEAR,e.id):$n.setIcon(t,e.id):$n.setIcon(jn.DEACTIVATED,e.id))},isKillable:function(e){return N.BlockedGroupsTimer.isMaxTimeAllowedExceeded(e)||at.isActive()},isProtectedURL:function(e){return e===null||typeof e>"u"||e.length===0?!1:e.indexOf(this.redirectURL)===0||e.indexOf("rescueMe")>=0||e.indexOf("chrome")>=0&&e.indexOf("chrome")<e.indexOf("://")&&(e.indexOf("sf")>-1||e.indexOf("devtools")>-1)},isBlockable:function(e){if(!this.activated()||this.isProtectedURL(e)||e===null||typeof e>"u"||e===""||this.isActive()===!1)return!1;const t=N.BlockedGroupsRepository.isBlockable(e),n=N.WhitelistRepository.isExists(e),r=at.isBlockable(t,n);if(N.Settings.get("isBlockAllWebsites")&&!n||r||t&&!n)return!0;if(t&&n){const i=N.BlockedGroupsRepository.getBlockedGroupByDomain(e),a=(i==null?void 0:i.websites.find(c=>N.Domain.isMoreGeneralURL(c,e)))??"",o=N.WhitelistRepository.isExists(e)?e:"";return a===e&&o!==e?!0:a!==e&&o===e?!1:ua.isMoreGeneralURL(o,a)}return n||at.isActive()&&!r,!1},isNewDay:function(){let e=!1;const t=new Date;let n=t.getTime(),r=N.Settings.get("resetTimestamp"),s=this.getResetTime();if(/null/.test(s)&&(s="00:00",this.setResetTime(s)),typeof r>"u"||r===null||r===""){const i=s.split(":"),a=Math.floor(i[0]),l=Math.floor(i[1]);r=new Date(t.toDateString()+" "+a+":"+l).getTime(),this.updateResetTimestamp(s)}return r=Math.floor(r),n=Math.floor(n),n>r&&(e=!0,this.updateResetTimestamp(s)),e},updateBadge:function(e,t=!1){let n=!1,r;const s=Math.floor(e),i=s.toString();t&&s<=60?(n=!0,r=Ar.BLACK):s<=30?(n=!0,r=Ar.RED):s<=60&&(n=!0,r=Ar.YELLOW),n?$n.showBadge(i,r,this.selectedTabID??void 0):this.hideBadge()},hideBadge(){$n.hideBadge(this.selectedTabID??void 0)},killPage:function(e){return ue("killPage","Killing page",null,"INFO"),N.BlockedGroupsTimer.stopCountdown(),N.Chrome.Window.getLastFocused(t=>{typeof t<"u"&&N.Chrome.Tab.getAllInWindow(t.id,n=>{for(const r in n)if(n[r].highlighted)if(N.BlockedGroupsTimer.isMaxTimeAllowedExceeded(e)||at.isActive()&&!at.hasSmartBomb()){const s=N.Settings.get("customStayFocusdMsg")||"";N.Chrome.Tab.update(n[r].id,{url:this.redirectURL+"?background&customMsg="+encodeURIComponent(s)})}else at.isActive()&&at.hasSmartBomb()&&N.PubSub.publish("StayFocusd.smartBomb.activate",{tabID:n[r].id,smartBomb:at.getSmartBomb()})})}),!1},getTotalSecondsRemaining:function(){return N.BlockedGroupsTimer.getTotalSecondsRemaining(this.currentURL)},getDisplayTimer:function(){function e(){const r="Default",s=z.BlockedGroupsRepository.getByName(r);return{groupName:r,time:En.formatDurationInSeconds(s.maxTimeAllowed-s.elapsedTime),nuclear:!1}}if(z.NuclearOption.isActive()){const r=z.NuclearOption.getExpiration();if(r){const s=(r-Date.now())/ha;return{groupName:z.Chrome.Translation.get("nuclear"),time:En.formatDurationInSeconds(s),nuclear:!0}}}const t=N.BlockedAllWebsites.getTime();if(t!=null)return{groupName:null,time:En.formatDurationInSeconds(t.allowedTime-t.elapsedTime),nuclear:!1};if(this.currentURL==null||this.currentURL=="")return e();const n=N.BlockedGroupsRepository.getBlockedGroupByDomain(this.currentURL);return n==null?e():{groupName:n.groupName,time:En.formatDurationInSeconds(n.maxTimeAllowed-n.elapsedTime),nuclear:!1}},getDateString:function(){const e=new Date,t=e.getMonth()+1,n=e.getDate();return e.getFullYear()+"-"+t+"-"+n},setActiveDays:function(e){let t=null;e.length===0?t="none":t=e.join("|"),ue("setActiveDays","Setting active days",e),N.Settings.set({activeDays:t}),N.NuclearOption.updateActiveDays(this.getActiveDays(!0))},getActiveDays:function(e=!1){const t=N.Settings.get("activeDays");if(t==="none")return[];if(typeof t>"u"||t===null||t.length===0)return this.setActiveDays([0,1,2,3,4,5,6]),[0,1,2,3,4,5,6];if(typeof t!="string"||t.indexOf("|")===-1)return[Number(t)];const n=t.split("|"),r=[];for(let s=0;s<n.length;s++)r[s]=Number(n[s]);return e?this.getActiveDaysAsWeekArray(r):r},getActiveDaysAsWeekArray:function(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];t[r]=!0}for(let n=0;n<7;n++)t[n]=t[n]||!1;return t},isActiveDay:function(){const t=new Date().getDay(),n=this.getActiveDays();return typeof n>"u"||n===null||n.length===0?!1:n.inArray(t)},setActiveHours:function(e,t){ue("setActiveHours","Setting active hours",{startTime:e,endTime:t}),N.Settings.set({activeHours:e+"|"+t})},getActiveHours:function(){let e=!1,t=!1;const n=this.getActiveHoursQueue();if(n!==!1){const i=n;(new Date().getTime()>i.timestamp||this.isFirstInstallAllowanceActive())&&(e=i.startTime,t=i.endTime,this.clearActiveHoursQueue(),this.setActiveHours(e,t))}if(e===!1&&t===!1){let i=N.Settings.get("activeHours");(typeof i>"u"||i===null||i==="")&&(this.setActiveHours("00:00","23:59"),i=N.Settings.get("activeHours"));const a=i.split("|");e=a[0],t=a[1]}const r=e.split(":"),s=t.split(":");return{startTime:e,endTime:t,startHour:r[0],startMin:r[1],startHourInt:parseInt(r[0],10),startMinInt:parseInt(r[1],10),endHour:s[0],endMin:s[1],endHourInt:parseInt(s[0],10),endMinInt:parseInt(s[1],10)}},isActiveHour:function(){const e=this.getActiveHours(),t=new Date,n=t.getHours(),r=t.getMinutes();return this.isStartTimeLater(e)===!0?this.isBetween(n,r,e.startHourInt,e.startMinInt,23,59)||this.isBetween(n,r,0,0,e.endHourInt,e.endMinInt):this.isBetween(n,r,e.startHourInt,e.startMinInt,e.endHourInt,e.endMinInt)},isBetween:function(e,t,n,r,s,i){return e>n&&e<s?!0:e===n&&e===s?t>=r&&t<=i:e===n&&t>=r||e===s&&t<=i},isStartTimeLater:function(e){return e.startHourInt===e.endHourInt&&e.startMinInt>=e.endMinInt?!0:e.startHourInt>e.endHourInt},setActiveHoursQueue:function(e,t){const s=new Date().getTime()+N.Date.hoursToMilliseconds(24)+"|"+e+"|"+t;ue("setActiveHoursQueue","Setting active hours queue",s),N.Settings.set({activeHoursQueue:s})},getActiveHoursQueue:function(){const e=N.Settings.get("activeHoursQueue");if(typeof e>"u"||e===null||e==="")return!1;const t=e.split("|");return{timestamp:parseInt(t[0]),startTime:t[1],endTime:t[2]}},clearActiveHoursQueue:function(){ue("clearActiveHoursQueue","Clearing active hours queue"),N.Settings.remove("activeHoursQueue")},isActive:function(){return at.isActive()===!0?!0:this.isActiveDay()===!0&&this.isActiveHour()===!0},activated:function(){return N.Settings.get("activated",!0)},setActivated:function(e){if(e===!1){if(!confirm(z.Chrome.Translation.get("areYouSure"))||!confirm(z.Chrome.Translation.get("disableExtension1"))||!confirm(z.Chrome.Translation.get("disableExtension2"))||!confirm(z.Chrome.Translation.get("disableExtension3"))||!confirm(z.Chrome.Translation.get("disableExtension4"))||!confirm(z.Chrome.Translation.get("disableExtension5"))||!confirm(z.Chrome.Translation.get("disableExtension6"))||!confirm(z.Chrome.Translation.get("disableExtension7"))||!confirm(z.Chrome.Translation.get("disableExtension8"))||!confirm(z.Chrome.Translation.get("disableFinalWarning")))return!1;alert(z.Chrome.Translation.get("extensionDisabled"))}return N.Settings.set({activated:e}),this.checkURL(),N.Analytics.event(e?"EXTENSION_ACTIVATED":"EXTENSION_DEACTIVATED"),!0},isActivateSwitchShown:function(){return N.Settings.get("isActivateSwitchShown",!0)},setActivateSwitchShown:function(e){N.Settings.set({isActivateSwitchShown:e})},updateResetTimestamp:function(e){const t=e.split(":"),n=parseInt(t[0],10),r=parseInt(t[1],10),i=new Date(new Date().toDateString()+" "+n+":"+r).getTime()+864e5;ue("updateResetTimestamp","Updating reset timestamp to: "+i),N.Settings.set({resetTimestamp:i})},setResetTime:function(e){ue("setResetTime","Setting reset time to: "+e),N.Settings.set({resetTime:e})},getResetTime:function(){let e=N.Settings.get("resetTime");const t=this.getResetTimeQueue(),n="00:00";if(t!==!1){const s=new Date().getTime(),i=t;(s>i.timestamp||this.isFirstInstallAllowanceActive())&&(e=i.resetTime,this.clearResetTimeQueue(),this.setResetTime(e),this.updateResetTimestamp(e))}return(typeof e>"u"||e===null||e==="")&&(this.setResetTime(n),e=n,this.updateResetTimestamp(e)),e},setResetTimeQueue:function(e){const r=new Date().getTime()+N.Date.hoursToMilliseconds(24)+"|"+e;ue("setResetTimeQueue","Setting reset time queue: "+r),N.Settings.set({resetTimeQueue:r})},getResetTimeQueue:function(){const e=N.Settings.get("resetTimeQueue");if(Ie.isEmpty(e))return!1;const t=e.split("|");return{timestamp:t[0],resetTime:t[1]}},clearResetTimeQueue:function(){ue("clearResetTimeQueue","Clearing reset time queue"),N.Settings.remove("resetTimeQueue")},isFirstInstall:function(){return typeof N.Settings.get("firstInstallDate")!="string"},async getFirstSensorTowerInstallDate(){let e=await N.Storage.get("firstSensorTowerInstallDate");return typeof e!="number"&&(e=Date.now(),await N.Storage.set({firstSensorTowerInstallDate:e})),e},getOptionsPage:function(){return Ft.runtime.getURL("options.html")},isUpdatePopupDisabled:function(){const e=N.Settings.get("disableUpdatePopup");return e===!0||e==="true"},setFirstInstallAllowance:function(){const e=new Date;N.Settings.set({firstInstallDate:e.toDateString()}),e.setMinutes(e.getMinutes()+this.firstInstallAllowance),ue("setFirstInstallAllowance","Setting first install allowance to: "+e.getTime()),N.Settings.set({firstInstallAllowanceExpiration:e.getTime()})},isFirstInstallAllowanceActive:function(){const e=new Date;return N.Settings.get("firstInstallAllowanceExpiration")>e.getTime()},localizeHTML:function(e){ue("localizeHTML","Localizing HTML");const t=e.getElementsByTagName("*");for(let n=0;n<t.length;n++)t[n].dataset&&t[n].dataset.i18n&&(t[n].innerHTML=N.Chrome.Translation.get(t[n].dataset.i18n))}};Array.prototype.inArray=function(e){for(const t in this)if(this.hasOwnProperty(t)&&this[t]==e)return!0;return!1};const Bo="whitelist",mt="whitelistNew";let yt,Ut=[];const jo=[z,la,Su,en,Tu,Eu,ua,Ie,Ou,Pt,Iu,Ve,Pu,Du,lf,hp,Mo,Bn,at,yp,mp,pp,{initAPI(e){return yt=e,yt.mixin("WhitelistRepository",{init:this.init.bind(this),add:this.add.bind(this),getAll:this.getAll.bind(this),isExists:this.isExists.bind(this),delete:this.delete.bind(this),migrate:this.migrate.bind(this),importWhitelist:this.importWhitelist.bind(this)})},async init(){if(await z.Settings.get("disableSync")===!0){const n=!!(await yt.Chrome.Storage.getSync(mt))[mt];await z.Storage.setBucket(mt,"LOCAL",!n)}else{const n=!!(await yt.Chrome.Storage.getLocal(mt))[mt];await z.Storage.setBucket(mt,"SYNC",!n)}this.getWhitelist(),this.addListeners()},getWhitelist(){const e=yt.Settings.get(mt);Ut=e??[]},async add(e){let t=!1;for(let n=0;n<e.length;n++){const r=e[n];r&&Ut.find(s=>s==r)==null&&(t=!0,Ut.push(r),await this.saveChanges())}return t},getAll(){return Ut},async delete(e){const t=Ut.findIndex(n=>n==e);t>-1&&(Ut.splice(t,1),await this.saveChanges())},isExists(e){return e==null?!1:(e=e.toLowerCase(),Ut.find(t=>_s(t,e))!=null)},async migrate(){if(this.needMigrate()){const e=yt.Settings.get(Bo);if(e!=null){const t=Object.keys(e);await this.add(t)}}},needMigrate(){return yt.Settings.get(mt)==null},async importWhitelist(){Ut=[];const e=yt.Settings.get(Bo);if(e!=null){const t=Object.keys(e);await this.add(t)}},async saveChanges(){await yt.Storage.set({[mt]:Ut})},addListeners(){z.PubSub.listen("Settings.data.refreshed",async(e,t)=>{(t.changes.whitelistNew||t.changes.disableSync)&&(t.changes.disableSync&&(t.disableSync===!1?await yt.Storage.setBucket(mt,"SYNC"):await yt.Storage.setBucket(mt,"LOCAL")),this.getWhitelist())})}},vp];z.mixin({mixin:z.mixin.bind(z),PubSub:Mo});for(let e=0;e<jo.length;e++){const t=jo[e];typeof t=="object"&&t!==null&&typeof t.initAPI=="function"&&t.initAPI(z)}la.initAPI(z),en.initAPI(z);const wp=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),Ap=new Map(wp);class Ci extends Error{constructor(n){super(Ci._prepareSuperMessage(n));_n(this,"name","NonError")}static _prepareSuperMessage(n){try{return JSON.stringify(n)}catch{return String(n)}}}const _p=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],Oi=new WeakSet,xp=e=>{Oi.add(e);const t=e.toJSON();return Oi.delete(e),t},Fo=e=>Ap.get(e)??Error,Ii=({from:e,seen:t,to:n,forceEnumerable:r,maxDepth:s,depth:i,useToJSON:a,serialize:l})=>{if(!n)if(Array.isArray(e))n=[];else if(!l&&$o(e)){const c=Fo(e.name);n=new c}else n={};if(t.push(e),i>=s)return n;if(a&&typeof e.toJSON=="function"&&!Oi.has(e))return xp(e);const o=c=>Ii({from:c,seen:[...t],forceEnumerable:r,maxDepth:s,depth:i,useToJSON:a,serialize:l});for(const[c,u]of Object.entries(e)){if(u&&u instanceof Uint8Array&&u.constructor.name==="Buffer"){n[c]="[object Buffer]";continue}if(u!==null&&typeof u=="object"&&typeof u.pipe=="function"){n[c]="[object Stream]";continue}if(typeof u!="function"){if(!u||typeof u!="object"){try{n[c]=u}catch{}continue}if(!t.includes(e[c])){i++,n[c]=o(e[c]);continue}n[c]="[Circular]"}}for(const{property:c,enumerable:u}of _p)typeof e[c]<"u"&&e[c]!==null&&Object.defineProperty(n,c,{value:$o(e[c])?o(e[c]):e[c],enumerable:r?!0:u,configurable:!0,writable:!0});return n};function Sp(e,t={}){const{maxDepth:n=Number.POSITIVE_INFINITY,useToJSON:r=!0}=t;return typeof e=="object"&&e!==null?Ii({from:e,seen:[],forceEnumerable:!0,maxDepth:n,depth:0,useToJSON:r,serialize:!0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}function Tp(e,t={}){const{maxDepth:n=Number.POSITIVE_INFINITY}=t;if(e instanceof Error)return e;if(Ep(e)){const r=Fo(e.name);return Ii({from:e,seen:[],to:new r,maxDepth:n,depth:0,serialize:!1})}return new Ci(e)}function $o(e){return!!e&&typeof e=="object"&&"name"in e&&"message"in e&&"stack"in e}function Ep(e){return!!e&&typeof e=="object"&&"message"in e&&!Array.isArray(e)}var Cp=Object.defineProperty,Op=Object.defineProperties,Ip=Object.getOwnPropertyDescriptors,Wo=Object.getOwnPropertySymbols,Pp=Object.prototype.hasOwnProperty,kp=Object.prototype.propertyIsEnumerable,Vo=(e,t,n)=>t in e?Cp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Go=(e,t)=>{for(var n in t||(t={}))Pp.call(t,n)&&Vo(e,n,t[n]);if(Wo)for(var n of Wo(t))kp.call(t,n)&&Vo(e,n,t[n]);return e},Ho=(e,t)=>Op(e,Ip(t)),Dp=(e,t,n)=>new Promise((r,s)=>{var i=o=>{try{l(n.next(o))}catch(c){s(c)}},a=o=>{try{l(n.throw(o))}catch(c){s(c)}},l=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,a);l((n=n.apply(e,t)).next())});function Mp(e){let t,n={};function r(){Object.entries(n).length===0&&(t==null||t(),t=void 0)}let s=Math.floor(Math.random()*1e4);function i(){return s++}return{sendMessage(a,l,...o){return Dp(this,null,function*(){var c,u;const h={id:i(),type:a,data:l,timestamp:Date.now()};(c=e.logger)==null||c.debug(`[messaging] sendMessage {id=${h.id}} `,h,...o);const d=yield e.sendMessage(h,...o),{res:f,err:g}=d??{err:new Error("No response")};if((u=e.logger)==null||u.debug(`[messaging] sendMessage {id=${h.id}} `,{res:f,err:g}),g!=null)throw Tp(g);return f})},onMessage(a,l){var o,c,u;if(t==null&&((o=e.logger)==null||o.debug(`[messaging] "${a}" initialized the message listener for this context`),t=e.addRootListener(h=>{var d,f;if(typeof h.type!="string"||typeof h.timestamp!="number"){const A=Error(`[messaging] Unknown message format, must include the 'type' & 'timestamp' fields, received: ${JSON.stringify(h)}`);throw(d=e.logger)==null||d.error(A),A}(f=e==null?void 0:e.logger)==null||f.debug("[messaging] Received message",h);const g=n[h.type];if(g==null)return;const m=g(h);return Promise.resolve(m).then(A=>{var S;return(S=e==null?void 0:e.logger)==null||S.debug(`[messaging] onMessage {id=${h.id}} `,{res:A}),{res:A}}).catch(A=>{var S;return(S=e==null?void 0:e.logger)==null||S.debug(`[messaging] onMessage {id=${h.id}} `,{err:A}),{err:Sp(A)}})})),n[a]!=null){const h=Error(`[messaging] In this JS context, only one listener can be setup for ${a}`);throw(c=e.logger)==null||c.error(h),h}return n[a]=l,(u=e.logger)==null||u.log(`[messaging] Added listener for ${a}`),()=>{delete n[a],r()}},removeAllListeners(){Object.keys(n).forEach(a=>{delete n[a]}),r()}}}function Np(e){return Mp(Ho(Go({},e),{sendMessage(t,n){return n==null?Ft.runtime.sendMessage(t):Ft.tabs.sendMessage(n,t)},addRootListener(t){const n=(r,s)=>t(typeof r=="object"?Ho(Go({},r),{sender:s}):r);return Ft.runtime.onMessage.addListener(n),()=>Ft.runtime.onMessage.removeListener(n)}}))}/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Rp=function(t){return t!=null&&typeof t=="object"&&Array.isArray(t)===!1};/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2018, Jon Schlinkert.
 * Released under the MIT License.
 */const qo=Rp;var Lp=function(e,t,n){if(qo(n)||(n={default:n}),!Zo(e))return typeof n.default<"u"?n.default:e;typeof t=="number"&&(t=String(t));const r=Array.isArray(t),s=typeof t=="string",i=n.separator||".",a=n.joinChar||(typeof i=="string"?i:".");if(!s&&!r)return e;if(s&&t in e)return Pi(t,e,n)?e[t]:n.default;let l=r?t:Up(t,i,n),o=l.length,c=0;do{let u=l[c];for(typeof u=="number"&&(u=String(u));u&&u.slice(-1)==="\\";)u=zo([u.slice(0,-1),l[++c]||""],a,n);if(u in e){if(!Pi(u,e,n))return n.default;e=e[u]}else{let h=!1,d=c+1;for(;d<o;)if(u=zo([u,l[d++]],a,n),h=u in e){if(!Pi(u,e,n))return n.default;e=e[u],c=d-1;break}if(!h)return n.default}}while(++c<o&&Zo(e));return c===o?e:n.default};function zo(e,t,n){return typeof n.join=="function"?n.join(e):e[0]+t+e[1]}function Up(e,t,n){return typeof n.split=="function"?n.split(e):e.split(t)}function Pi(e,t,n){return typeof n.isValid=="function"?n.isValid(e,t):!0}function Zo(e){return qo(e)||Array.isArray(e)||typeof e=="function"}const Bp=Lr(Lp);var jp=(e,t,n)=>new Promise((r,s)=>{var i=o=>{try{l(n.next(o))}catch(c){s(c)}},a=o=>{try{l(n.throw(o))}catch(c){s(c)}},l=o=>o.done?r(o.value):Promise.resolve(o.value).then(i,a);l((n=n.apply(e,t)).next())});function Fp(){if(!$p())return!1;const e=Ft.runtime.getManifest();return e.background?e.manifest_version===3?Gp():Vp():!1}function $p(){var e;return!!((e=Ft.runtime)!=null&&e.id)}var Wp=["/_generated_background_page.html"];function Vp(){return typeof window<"u"&&Wp.includes(location.pathname)}function Gp(){return typeof window>"u"}function Hp(e,t,n){let r;const s=`proxy-service.${e}`,{onMessage:i,sendMessage:a}=Np(n);function l(o){const c=()=>{},u=new Proxy(c,{apply(h,d,f){return jp(this,null,function*(){return yield a(s,{path:o,args:f})})},get(h,d,f){return d==="__proxy"||typeof d=="symbol"?Reflect.get(h,d,f):l(o==null?d:`${o}.${d}`)}});return u.__proxy=!0,u}return[function(...c){return r=t(...c),i(s,({data:u})=>{const h=u.path==null?r:Bp(r??{},u.path);if(h)return Promise.resolve(h.bind(r)(...u.args))}),r},function(){if(!Fp())return l();if(r==null)throw Error(`Failed to get an instance of ${e}: in background, but registerService has not been called. Did you forget to call registerService?`);return r}]}const[iy,qp]=Hp("BackgroundApi",()=>ko({ofetchDefaults:{baseURL:"https://stayfocusd.st-panel-api.com"}})),zp=z.Chrome.Extension.getID();function Zp(){z.Chrome.Message.on.addListener(function(e,t,n){return e.payload=e.payload||{},e.payload.sender=t||{},t.tab||z.PubSub.publish({message:e.message,payload:e.payload,onPublish:typeof n=="function"?n:function(){}}),!0}),z.PubSub.subscribe({async:!0,handler:function(e,t,n){t=t||{};function r(s){return chrome.runtime.lastError&&qn.log("Content.js subscribe to all messages","runtime.lastError",chrome.runtime.lastError),s!=null&&typeof s=="function"?()=>s:()=>!0}return n=r(n),(!t.sender||t.sender.id!==zp)&&z.Chrome.Message.send(null,{message:e.toString(),payload:t},null,n),!0}})}let Ko;const Ss=chrome.runtime.connect({name:"ad-finder"});Zp(),z.PubSub.listen("StayFocusd.tab.selected.*",function(e,t){Ko=t.tab.url});const Kp=async()=>{const e=await z.Storage.get("install-id");Lc({getInstallId:()=>z.Storage.get("install-id",!0),sendMessageToBackground:t=>{const n=Math.random();return Ss.postMessage({message:"forward-message.request",payload:t,nonce:n}),new Promise(r=>{const s=({message:i,payload:a,nonce:l})=>{i==="forward-message.response"&&n===l&&(Ss.onMessage.removeListener(s),r(a))};Ss.onMessage.addListener(s)})},logger:null,enablePathmaticsLogs:!1,mv3PathmaticsPath:"common/youtube-hulu-vast-ads.js",onAdDetected:t=>{Ss.postMessage({message:"ad-found",payload:{hostname:Ko,ad:t}})}},{api:qp(),appId:ms.APP_ID,installId:e,instacartSelectors:await z.RemoteConfig.get("instacartSelectors"),onAdFound(t,n){}})};(async()=>{await z.Storage.initAsync(),await z.RemoteConfig.init();const e=await z.IncrementalRollout.AdFinder.isEnabled();qn.log("ad-finder","Ad finder enabled? "+e,void 0,"INFO"),e&&Kp()})()})();
//# sourceMappingURL=ad-finder.js.map
