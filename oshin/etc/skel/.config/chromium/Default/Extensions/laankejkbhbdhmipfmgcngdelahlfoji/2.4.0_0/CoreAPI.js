var kc=Object.defineProperty;var Pc=(e,t,n)=>t in e?kc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var wn=(e,t,n)=>(Pc(e,typeof t!="symbol"?t+"":t,n),n);import{L as ts,c as Mc,g as Lc,B as Rc,a as Aa}from"./Logger.js";const Ct={initAPI(e){return e.mixin("Object",this)},merge:function(e,t,n=!1){return n?Object.assign(!0,e,t):Object.assign(e,t)},lookup:function(e,t){const n=e.split("."),i=n.pop(),r=n.length;let s=1,a=n[0];for(;(t=t[a])&&s<r;)a=n[s],s+=1;if(t)return t[i]},isObjLiteral:function(e){return typeof e=="object"&&e!==null&&typeof e.length>"u"},isArray:function(e){return typeof e=="object"&&e!==null&&typeof e.length<"u"},isJSON:function(e){try{JSON.parse(e)}catch{return!1}return!0},sort:function(e){const t=[],n={};for(const i in e)e.hasOwnProperty(i)&&t.push(i);t.sort();for(let i=0;i<t.length;i++){const r=t[i];n[r]=e[r]}return n}},Le={firstToLower:function(e){return typeof e=="string"?e.toLowerCase()[0]+e.slice(1):e},firstToUpper:function(e){return typeof e=="string"?e.toUpperCase()[0]+e.slice(1):e},isEmpty:function(e){return e===null||e===""||typeof e>"u"||Object.keys(e).length===0},sanitizeMSWordChars:function(e){let t=e;return t=t.replace(/[\u2018\u2019\u201A]/g,"'"),t=t.replace(/[\u201C\u201D\u201E]/g,'"'),t=t.replace(/\u2026/g,"..."),t=t.replace(/[\u2013\u2014]/g,"--"),t=t.replace(/\u02C6/g,"^"),t=t.replace(/\u2039/g,"<"),t=t.replace(/\u203A/g,">"),t=t.replace(/[\u02DC\u00A0]/g," "),t},getDecoupledPromise(){let e,t;const n=new Promise((i,r)=>{e=i,t=r});return{resolve:e,reject:t,promise:n}},createScopedLog(e){return(t,n,i=void 0,r="INFO")=>{ts.log(`${e}.${t}`,n,i,r)}},isTopFrame(){return window.self===window.top},initAPI(e){return e.mixin("Utils",{firstToLower:this.firstToLower.bind(this),firstToUpper:this.firstToUpper.bind(this),isEmpty:this.isEmpty.bind(this),sanitizeMSWordChars:this.sanitizeMSWordChars.bind(this),getDecoupledPromise:this.getDecoupledPromise.bind(this),createScopedLog:this.createScopedLog.bind(this),isTopFrame:this.isTopFrame.bind(this)})}},Nc=Le.createScopedLog("API"),Uc=(()=>(()=>{let t={},n=null;const i=function(...r){let s="",a=null;if(r.length===0)throw new TypeError("Mixin has no arguments");if(Nc("mixin","Adding mixin to API",r,"DEBUG"),r.length===2&&typeof r[0]=="string"){if(s=r[0],typeof r[1]=="object"&&r[1]!==null?a=r[1]:typeof r[1]=="function"&&(a=r[1]()),a)if(s.indexOf(".")>-1){const l=s.split("."),o=l.pop(),c={};n||(n=Ct.lookup(s,t)),c[o]=n?Ct.merge(n,a,!0):a,i(l.join("."),c)}else{const l=s;s in t?t[l]=Ct.merge(t[l],a):t[l]=a,n=null}}else r.length===1&&typeof r[0]=="object"&&r[0]!==null?t=Ct.merge(t,r[0]):r.length===1&&typeof r[0]=="function"&&(a=r[0](),typeof a=="object"&&a!==null&&(t=Ct.merge(t,a)))};return i({mixin:i}),t})())(),q=Uc;function Yi(e){"@babel/helpers - typeof";return Yi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yi(e)}function on(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function Ve(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function bt(e){Ve(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||Yi(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Bc(e,t){Ve(2,arguments);var n=bt(e).getTime(),i=on(t);return new Date(n+i)}var jc={};function fr(){return jc}function Wc(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Fc(e){return Ve(1,arguments),e instanceof Date||Yi(e)==="object"&&Object.prototype.toString.call(e)==="[object Date]"}function $c(e){if(Ve(1,arguments),!Fc(e)&&typeof e!="number")return!1;var t=bt(e);return!isNaN(Number(t))}function Vc(e,t){Ve(2,arguments);var n=on(t);return Bc(e,-n)}var Gc=864e5;function qc(e){Ve(1,arguments);var t=bt(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var i=t.getTime(),r=n-i;return Math.floor(r/Gc)+1}function Ki(e){Ve(1,arguments);var t=1,n=bt(e),i=n.getUTCDay(),r=(i<t?7:0)+i-t;return n.setUTCDate(n.getUTCDate()-r),n.setUTCHours(0,0,0,0),n}function Sa(e){Ve(1,arguments);var t=bt(e),n=t.getUTCFullYear(),i=new Date(0);i.setUTCFullYear(n+1,0,4),i.setUTCHours(0,0,0,0);var r=Ki(i),s=new Date(0);s.setUTCFullYear(n,0,4),s.setUTCHours(0,0,0,0);var a=Ki(s);return t.getTime()>=r.getTime()?n+1:t.getTime()>=a.getTime()?n:n-1}function Hc(e){Ve(1,arguments);var t=Sa(e),n=new Date(0);n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0);var i=Ki(n);return i}var zc=6048e5;function Zc(e){Ve(1,arguments);var t=bt(e),n=Ki(t).getTime()-Hc(t).getTime();return Math.round(n/zc)+1}function Qi(e,t){var n,i,r,s,a,l,o,c;Ve(1,arguments);var u=fr(),p=on((n=(i=(r=(s=t==null?void 0:t.weekStartsOn)!==null&&s!==void 0?s:t==null||(a=t.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&r!==void 0?r:u.weekStartsOn)!==null&&i!==void 0?i:(o=u.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.weekStartsOn)!==null&&n!==void 0?n:0);if(!(p>=0&&p<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var d=bt(e),f=d.getUTCDay(),g=(f<p?7:0)+f-p;return d.setUTCDate(d.getUTCDate()-g),d.setUTCHours(0,0,0,0),d}function _a(e,t){var n,i,r,s,a,l,o,c;Ve(1,arguments);var u=bt(e),p=u.getUTCFullYear(),d=fr(),f=on((n=(i=(r=(s=t==null?void 0:t.firstWeekContainsDate)!==null&&s!==void 0?s:t==null||(a=t.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&r!==void 0?r:d.firstWeekContainsDate)!==null&&i!==void 0?i:(o=d.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&n!==void 0?n:1);if(!(f>=1&&f<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var g=new Date(0);g.setUTCFullYear(p+1,0,f),g.setUTCHours(0,0,0,0);var m=Qi(g,t),v=new Date(0);v.setUTCFullYear(p,0,f),v.setUTCHours(0,0,0,0);var D=Qi(v,t);return u.getTime()>=m.getTime()?p+1:u.getTime()>=D.getTime()?p:p-1}function Yc(e,t){var n,i,r,s,a,l,o,c;Ve(1,arguments);var u=fr(),p=on((n=(i=(r=(s=t==null?void 0:t.firstWeekContainsDate)!==null&&s!==void 0?s:t==null||(a=t.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&r!==void 0?r:u.firstWeekContainsDate)!==null&&i!==void 0?i:(o=u.locale)===null||o===void 0||(c=o.options)===null||c===void 0?void 0:c.firstWeekContainsDate)!==null&&n!==void 0?n:1),d=_a(e,t),f=new Date(0);f.setUTCFullYear(d,0,p),f.setUTCHours(0,0,0,0);var g=Qi(f,t);return g}var Kc=6048e5;function Qc(e,t){Ve(1,arguments);var n=bt(e),i=Qi(n,t).getTime()-Yc(n,t).getTime();return Math.round(i/Kc)+1}function ae(e,t){for(var n=e<0?"-":"",i=Math.abs(e).toString();i.length<t;)i="0"+i;return n+i}var Jc={y:function(t,n){var i=t.getUTCFullYear(),r=i>0?i:1-i;return ae(n==="yy"?r%100:r,n.length)},M:function(t,n){var i=t.getUTCMonth();return n==="M"?String(i+1):ae(i+1,2)},d:function(t,n){return ae(t.getUTCDate(),n.length)},a:function(t,n){var i=t.getUTCHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h:function(t,n){return ae(t.getUTCHours()%12||12,n.length)},H:function(t,n){return ae(t.getUTCHours(),n.length)},m:function(t,n){return ae(t.getUTCMinutes(),n.length)},s:function(t,n){return ae(t.getUTCSeconds(),n.length)},S:function(t,n){var i=n.length,r=t.getUTCMilliseconds(),s=Math.floor(r*Math.pow(10,i-3));return ae(s,n.length)}};const Bt=Jc;var vn={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Xc={G:function(t,n,i){var r=t.getUTCFullYear()>0?1:0;switch(n){case"G":case"GG":case"GGG":return i.era(r,{width:"abbreviated"});case"GGGGG":return i.era(r,{width:"narrow"});case"GGGG":default:return i.era(r,{width:"wide"})}},y:function(t,n,i){if(n==="yo"){var r=t.getUTCFullYear(),s=r>0?r:1-r;return i.ordinalNumber(s,{unit:"year"})}return Bt.y(t,n)},Y:function(t,n,i,r){var s=_a(t,r),a=s>0?s:1-s;if(n==="YY"){var l=a%100;return ae(l,2)}return n==="Yo"?i.ordinalNumber(a,{unit:"year"}):ae(a,n.length)},R:function(t,n){var i=Sa(t);return ae(i,n.length)},u:function(t,n){var i=t.getUTCFullYear();return ae(i,n.length)},Q:function(t,n,i){var r=Math.ceil((t.getUTCMonth()+1)/3);switch(n){case"Q":return String(r);case"QQ":return ae(r,2);case"Qo":return i.ordinalNumber(r,{unit:"quarter"});case"QQQ":return i.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,n,i){var r=Math.ceil((t.getUTCMonth()+1)/3);switch(n){case"q":return String(r);case"qq":return ae(r,2);case"qo":return i.ordinalNumber(r,{unit:"quarter"});case"qqq":return i.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,n,i){var r=t.getUTCMonth();switch(n){case"M":case"MM":return Bt.M(t,n);case"Mo":return i.ordinalNumber(r+1,{unit:"month"});case"MMM":return i.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(r,{width:"wide",context:"formatting"})}},L:function(t,n,i){var r=t.getUTCMonth();switch(n){case"L":return String(r+1);case"LL":return ae(r+1,2);case"Lo":return i.ordinalNumber(r+1,{unit:"month"});case"LLL":return i.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(r,{width:"wide",context:"standalone"})}},w:function(t,n,i,r){var s=Qc(t,r);return n==="wo"?i.ordinalNumber(s,{unit:"week"}):ae(s,n.length)},I:function(t,n,i){var r=Zc(t);return n==="Io"?i.ordinalNumber(r,{unit:"week"}):ae(r,n.length)},d:function(t,n,i){return n==="do"?i.ordinalNumber(t.getUTCDate(),{unit:"date"}):Bt.d(t,n)},D:function(t,n,i){var r=qc(t);return n==="Do"?i.ordinalNumber(r,{unit:"dayOfYear"}):ae(r,n.length)},E:function(t,n,i){var r=t.getUTCDay();switch(n){case"E":case"EE":case"EEE":return i.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(r,{width:"short",context:"formatting"});case"EEEE":default:return i.day(r,{width:"wide",context:"formatting"})}},e:function(t,n,i,r){var s=t.getUTCDay(),a=(s-r.weekStartsOn+8)%7||7;switch(n){case"e":return String(a);case"ee":return ae(a,2);case"eo":return i.ordinalNumber(a,{unit:"day"});case"eee":return i.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(s,{width:"short",context:"formatting"});case"eeee":default:return i.day(s,{width:"wide",context:"formatting"})}},c:function(t,n,i,r){var s=t.getUTCDay(),a=(s-r.weekStartsOn+8)%7||7;switch(n){case"c":return String(a);case"cc":return ae(a,n.length);case"co":return i.ordinalNumber(a,{unit:"day"});case"ccc":return i.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(s,{width:"narrow",context:"standalone"});case"cccccc":return i.day(s,{width:"short",context:"standalone"});case"cccc":default:return i.day(s,{width:"wide",context:"standalone"})}},i:function(t,n,i){var r=t.getUTCDay(),s=r===0?7:r;switch(n){case"i":return String(s);case"ii":return ae(s,n.length);case"io":return i.ordinalNumber(s,{unit:"day"});case"iii":return i.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(r,{width:"short",context:"formatting"});case"iiii":default:return i.day(r,{width:"wide",context:"formatting"})}},a:function(t,n,i){var r=t.getUTCHours(),s=r/12>=1?"pm":"am";switch(n){case"a":case"aa":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(t,n,i){var r=t.getUTCHours(),s;switch(r===12?s=vn.noon:r===0?s=vn.midnight:s=r/12>=1?"pm":"am",n){case"b":case"bb":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(t,n,i){var r=t.getUTCHours(),s;switch(r>=17?s=vn.evening:r>=12?s=vn.afternoon:r>=4?s=vn.morning:s=vn.night,n){case"B":case"BB":case"BBB":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(t,n,i){if(n==="ho"){var r=t.getUTCHours()%12;return r===0&&(r=12),i.ordinalNumber(r,{unit:"hour"})}return Bt.h(t,n)},H:function(t,n,i){return n==="Ho"?i.ordinalNumber(t.getUTCHours(),{unit:"hour"}):Bt.H(t,n)},K:function(t,n,i){var r=t.getUTCHours()%12;return n==="Ko"?i.ordinalNumber(r,{unit:"hour"}):ae(r,n.length)},k:function(t,n,i){var r=t.getUTCHours();return r===0&&(r=24),n==="ko"?i.ordinalNumber(r,{unit:"hour"}):ae(r,n.length)},m:function(t,n,i){return n==="mo"?i.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):Bt.m(t,n)},s:function(t,n,i){return n==="so"?i.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):Bt.s(t,n)},S:function(t,n){return Bt.S(t,n)},X:function(t,n,i,r){var s=r._originalDate||t,a=s.getTimezoneOffset();if(a===0)return"Z";switch(n){case"X":return js(a);case"XXXX":case"XX":return Xt(a);case"XXXXX":case"XXX":default:return Xt(a,":")}},x:function(t,n,i,r){var s=r._originalDate||t,a=s.getTimezoneOffset();switch(n){case"x":return js(a);case"xxxx":case"xx":return Xt(a);case"xxxxx":case"xxx":default:return Xt(a,":")}},O:function(t,n,i,r){var s=r._originalDate||t,a=s.getTimezoneOffset();switch(n){case"O":case"OO":case"OOO":return"GMT"+Bs(a,":");case"OOOO":default:return"GMT"+Xt(a,":")}},z:function(t,n,i,r){var s=r._originalDate||t,a=s.getTimezoneOffset();switch(n){case"z":case"zz":case"zzz":return"GMT"+Bs(a,":");case"zzzz":default:return"GMT"+Xt(a,":")}},t:function(t,n,i,r){var s=r._originalDate||t,a=Math.floor(s.getTime()/1e3);return ae(a,n.length)},T:function(t,n,i,r){var s=r._originalDate||t,a=s.getTime();return ae(a,n.length)}};function Bs(e,t){var n=e>0?"-":"+",i=Math.abs(e),r=Math.floor(i/60),s=i%60;if(s===0)return n+String(r);var a=t||"";return n+String(r)+a+ae(s,2)}function js(e,t){if(e%60===0){var n=e>0?"-":"+";return n+ae(Math.abs(e)/60,2)}return Xt(e,t)}function Xt(e,t){var n=t||"",i=e>0?"-":"+",r=Math.abs(e),s=ae(Math.floor(r/60),2),a=ae(r%60,2);return i+s+n+a}const el=Xc;var Ws=function(t,n){switch(t){case"P":return n.date({width:"short"});case"PP":return n.date({width:"medium"});case"PPP":return n.date({width:"long"});case"PPPP":default:return n.date({width:"full"})}},Ta=function(t,n){switch(t){case"p":return n.time({width:"short"});case"pp":return n.time({width:"medium"});case"ppp":return n.time({width:"long"});case"pppp":default:return n.time({width:"full"})}},tl=function(t,n){var i=t.match(/(P+)(p+)?/)||[],r=i[1],s=i[2];if(!s)return Ws(t,n);var a;switch(r){case"P":a=n.dateTime({width:"short"});break;case"PP":a=n.dateTime({width:"medium"});break;case"PPP":a=n.dateTime({width:"long"});break;case"PPPP":default:a=n.dateTime({width:"full"});break}return a.replace("{{date}}",Ws(r,n)).replace("{{time}}",Ta(s,n))},nl={p:Ta,P:tl};const il=nl;var rl=["D","DD"],sl=["YY","YYYY"];function al(e){return rl.indexOf(e)!==-1}function ol(e){return sl.indexOf(e)!==-1}function Fs(e,t,n){if(e==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var cl={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},ll=function(t,n,i){var r,s=cl[t];return typeof s=="string"?r=s:n===1?r=s.one:r=s.other.replace("{{count}}",n.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+r:r+" ago":r};const ul=ll;function Ir(e){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth,i=e.formats[n]||e.formats[e.defaultWidth];return i}}var dl={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},hl={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},gl={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},pl={date:Ir({formats:dl,defaultWidth:"full"}),time:Ir({formats:hl,defaultWidth:"full"}),dateTime:Ir({formats:gl,defaultWidth:"full"})};const fl=pl;var ml={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},yl=function(t,n,i,r){return ml[t]};const wl=yl;function Kn(e){return function(t,n){var i=n!=null&&n.context?String(n.context):"standalone",r;if(i==="formatting"&&e.formattingValues){var s=e.defaultFormattingWidth||e.defaultWidth,a=n!=null&&n.width?String(n.width):s;r=e.formattingValues[a]||e.formattingValues[s]}else{var l=e.defaultWidth,o=n!=null&&n.width?String(n.width):e.defaultWidth;r=e.values[o]||e.values[l]}var c=e.argumentCallback?e.argumentCallback(t):t;return r[c]}}var vl={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},bl={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Al={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Sl={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},_l={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Tl={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},xl=function(t,n){var i=Number(t),r=i%100;if(r>20||r<10)switch(r%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},El={ordinalNumber:xl,era:Kn({values:vl,defaultWidth:"wide"}),quarter:Kn({values:bl,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:Kn({values:Al,defaultWidth:"wide"}),day:Kn({values:Sl,defaultWidth:"wide"}),dayPeriod:Kn({values:_l,defaultWidth:"wide",formattingValues:Tl,defaultFormattingWidth:"wide"})};const Cl=El;function Qn(e){return function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.width,r=i&&e.matchPatterns[i]||e.matchPatterns[e.defaultMatchWidth],s=t.match(r);if(!s)return null;var a=s[0],l=i&&e.parsePatterns[i]||e.parsePatterns[e.defaultParseWidth],o=Array.isArray(l)?Il(l,function(p){return p.test(a)}):Ol(l,function(p){return p.test(a)}),c;c=e.valueCallback?e.valueCallback(o):o,c=n.valueCallback?n.valueCallback(c):c;var u=t.slice(a.length);return{value:c,rest:u}}}function Ol(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}function Il(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}function Dl(e){return function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=t.match(e.matchPattern);if(!i)return null;var r=i[0],s=t.match(e.parsePattern);if(!s)return null;var a=e.valueCallback?e.valueCallback(s[0]):s[0];a=n.valueCallback?n.valueCallback(a):a;var l=t.slice(r.length);return{value:a,rest:l}}}var kl=/^(\d+)(th|st|nd|rd)?/i,Pl=/\d+/i,Ml={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Ll={any:[/^b/i,/^(a|c)/i]},Rl={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Nl={any:[/1/i,/2/i,/3/i,/4/i]},Ul={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Bl={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},jl={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Wl={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Fl={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},$l={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Vl={ordinalNumber:Dl({matchPattern:kl,parsePattern:Pl,valueCallback:function(t){return parseInt(t,10)}}),era:Qn({matchPatterns:Ml,defaultMatchWidth:"wide",parsePatterns:Ll,defaultParseWidth:"any"}),quarter:Qn({matchPatterns:Rl,defaultMatchWidth:"wide",parsePatterns:Nl,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:Qn({matchPatterns:Ul,defaultMatchWidth:"wide",parsePatterns:Bl,defaultParseWidth:"any"}),day:Qn({matchPatterns:jl,defaultMatchWidth:"wide",parsePatterns:Wl,defaultParseWidth:"any"}),dayPeriod:Qn({matchPatterns:Fl,defaultMatchWidth:"any",parsePatterns:$l,defaultParseWidth:"any"})};const Gl=Vl;var ql={code:"en-US",formatDistance:ul,formatLong:fl,formatRelative:wl,localize:Cl,match:Gl,options:{weekStartsOn:0,firstWeekContainsDate:1}};const Hl=ql;var zl=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Zl=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Yl=/^'([^]*?)'?$/,Kl=/''/g,Ql=/[a-zA-Z]/;function Jl(e,t,n){var i,r,s,a,l,o,c,u,p,d,f,g,m,v,D,U,E,O;Ve(2,arguments);var B=String(t),T=fr(),P=(i=(r=n==null?void 0:n.locale)!==null&&r!==void 0?r:T.locale)!==null&&i!==void 0?i:Hl,w=on((s=(a=(l=(o=n==null?void 0:n.firstWeekContainsDate)!==null&&o!==void 0?o:n==null||(c=n.locale)===null||c===void 0||(u=c.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&l!==void 0?l:T.firstWeekContainsDate)!==null&&a!==void 0?a:(p=T.locale)===null||p===void 0||(d=p.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&s!==void 0?s:1);if(!(w>=1&&w<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var _=on((f=(g=(m=(v=n==null?void 0:n.weekStartsOn)!==null&&v!==void 0?v:n==null||(D=n.locale)===null||D===void 0||(U=D.options)===null||U===void 0?void 0:U.weekStartsOn)!==null&&m!==void 0?m:T.weekStartsOn)!==null&&g!==void 0?g:(E=T.locale)===null||E===void 0||(O=E.options)===null||O===void 0?void 0:O.weekStartsOn)!==null&&f!==void 0?f:0);if(!(_>=0&&_<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!P.localize)throw new RangeError("locale must contain localize property");if(!P.formatLong)throw new RangeError("locale must contain formatLong property");var C=bt(e);if(!$c(C))throw new RangeError("Invalid time value");var M=Wc(C),Z=Vc(C,M),b={firstWeekContainsDate:w,weekStartsOn:_,locale:P,_originalDate:C},L=B.match(Zl).map(function(A){var G=A[0];if(G==="p"||G==="P"){var W=il[G];return W(A,P.formatLong)}return A}).join("").match(zl).map(function(A){if(A==="''")return"'";var G=A[0];if(G==="'")return Xl(A);var W=el[G];if(W)return!(n!=null&&n.useAdditionalWeekYearTokens)&&ol(A)&&Fs(A,t,String(e)),!(n!=null&&n.useAdditionalDayOfYearTokens)&&al(A)&&Fs(A,t,String(e)),W(Z,A,P.localize,b);if(G.match(Ql))throw new RangeError("Format string contains an unescaped latin alphabet character `"+G+"`");return A}).join("");return L}function Xl(e){var t=e.match(Yl);return t?t[1].replace(Kl,"'"):e}function Jn(){return Jl(new Date,"OOOO")}function Ri(){let e=/^.+?(-|_)(.+?)($|-|_)/,t=[...typeof navigator<"u"?navigator.languages:[],Intl.DateTimeFormat().resolvedOptions().locale].map(n=>{var i;return(i=n.match(e))==null?void 0:i[2]}).find(n=>!!n);return t==null?void 0:t.toUpperCase()}var eu=13,xa="abcdefghijklmnopqrstuvwxyz0123456789",tu=xa.length;function nu(){let e="";for(let t=0;t<eu;t++)e+=xa.charAt(Math.floor(Math.random()*tu));return e}function iu(e,t){if(typeof e=="string"&&(e=ru(e.trim())),!e)return;let n=(t==null?void 0:t.removeGenericPrefixes)??!0,i=e.hostname;return n&&(i=i.replace(/^(m|mobile|amp|www|www1|www2|www3|tab|item|checkout|secure|user|account|accounts|web|app|open|i|v|preview|cdn|l|id|nid|user|sso|signin|login|auth0|play|api|click|detail|dashboard|console|manage|support|help)\./,"").replace(/.*\.zoom\.us/,"zoom.us").replace(/.*\.slack\.com/,"slack.com").replace(/.*\.wikipedia\.org/,"wikipedia.org").replace(/.*\.amazonaws\.com/,"amazonaws.com").replace(/.*\.netsuite\.com/,"netsuite.com").replace(/.*\.tumblr\.com/,"tumblr.com").replace(/.*\.deviantart\.com/,"deviantart.com")),{hostname:i,path:su(e.pathname)}}function ru(e){if(!e)return;let t=n=>{let i=new URL(n);if(!/^https?:/.test(i.protocol))throw Error("Invalid URL, ignored protocol found");if(!i.hostname)throw Error("Invalid URL, no hostname");if(i.hostname.lastIndexOf(".")>=i.hostname.length-2)throw Error("Invalid URL, bad domain ending");return i};try{return t(e)}catch{}if(!e.includes("://"))try{return t("https://"+e)}catch{}}function su(e){return e.endsWith("/")?e.substring(0,Math.max(1,e.length-1)):e}var $r={exports:{}};(function(e,t){(function(n,i){var r="1.0.37",s="",a="?",l="function",o="undefined",c="object",u="string",p="major",d="model",f="name",g="type",m="vendor",v="version",D="architecture",U="console",E="mobile",O="tablet",B="smarttv",T="wearable",P="embedded",w=500,_="Amazon",C="Apple",M="ASUS",Z="BlackBerry",b="Browser",L="Chrome",A="Edge",G="Firefox",W="Google",ie="Huawei",Q="LG",Se="Microsoft",At="Motorola",hn="Opera",gn="Samsung",xi="Sharp",re="Sony",pn="Xiaomi",Wn="Zebra",Je="Facebook",Fn="Chromium OS",$n="Mac OS",Ei=function(J,ne){var V={};for(var se in J)ne[se]&&ne[se].length%2===0?V[se]=ne[se].concat(J[se]):V[se]=J[se];return V},Pt=function(J){for(var ne={},V=0;V<J.length;V++)ne[J[V].toUpperCase()]=J[V];return ne},Vn=function(J,ne){return typeof J===u?Mt(ne).indexOf(Mt(J))!==-1:!1},Mt=function(J){return J.toLowerCase()},Ar=function(J){return typeof J===u?J.replace(/[^\d\.]/g,s).split(".")[0]:i},Gn=function(J,ne){if(typeof J===u)return J=J.replace(/^\s\s*/,s),typeof ne===o?J:J.substring(0,w)},qt=function(J,ne){for(var V=0,se,ct,fe,ee,F,Xe;V<ne.length&&!F;){var mn=ne[V],Ht=ne[V+1];for(se=ct=0;se<mn.length&&!F&&mn[se];)if(F=mn[se++].exec(J),F)for(fe=0;fe<Ht.length;fe++)Xe=F[++ct],ee=Ht[fe],typeof ee===c&&ee.length>0?ee.length===2?typeof ee[1]==l?this[ee[0]]=ee[1].call(this,Xe):this[ee[0]]=ee[1]:ee.length===3?typeof ee[1]===l&&!(ee[1].exec&&ee[1].test)?this[ee[0]]=Xe?ee[1].call(this,Xe,ee[2]):i:this[ee[0]]=Xe?Xe.replace(ee[1],ee[2]):i:ee.length===4&&(this[ee[0]]=Xe?ee[3].call(this,Xe.replace(ee[1],ee[2])):i):this[ee]=Xe||i;V+=2}},qn=function(J,ne){for(var V in ne)if(typeof ne[V]===c&&ne[V].length>0){for(var se=0;se<ne[V].length;se++)if(Vn(ne[V][se],J))return V===a?i:V}else if(Vn(ne[V],J))return V===a?i:V;return J},Sr={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Ci={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Oi={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[v,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[v,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,v],[/opios[\/ ]+([\w\.]+)/i],[v,[f,hn+" Mini"]],[/\bopr\/([\w\.]+)/i],[v,[f,hn]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[v,[f,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[f,v],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[v,[f,"UC"+b]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[v,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[v,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[v,[f,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[v,[f,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[v,[f,"Smart Lenovo "+b]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+b],v],[/\bfocus\/([\w\.]+)/i],[v,[f,G+" Focus"]],[/\bopt\/([\w\.]+)/i],[v,[f,hn+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[v,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[v,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[v,[f,hn+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[v,[f,"MIUI "+b]],[/fxios\/([-\w\.]+)/i],[v,[f,G]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 "+b]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 "+b],v],[/samsungbrowser\/([\w\.]+)/i],[v,[f,gn+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],v],[/metasr[\/ ]?([\d\.]+)/i],[v,[f,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[f,"Sogou Mobile"],v],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[f,v],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,Je],v],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[f,v],[/\bgsa\/([\w\.]+) .*safari\//i],[v,[f,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[v,[f,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[v,[f,L+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,L+" WebView"],v],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[v,[f,"Android "+b]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,v],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[v,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[v,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[v,qn,Sr]],[/(webkit|khtml)\/([\w\.]+)/i],[f,v],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],v],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[v,[f,G+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,v],[/(cobalt)\/([\w\.]+)/i],[f,[v,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[D,"amd64"]],[/(ia32(?=;))/i],[[D,Mt]],[/((?:i[346]|x)86)[;\)]/i],[[D,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[D,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[D,"armhf"]],[/windows (ce|mobile); ppc;/i],[[D,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[D,/ower/,s,Mt]],[/(sun4\w)[;\)]/i],[[D,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[D,Mt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[m,gn],[g,O]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[m,gn],[g,E]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[m,C],[g,E]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[m,C],[g,O]],[/(macintosh);/i],[d,[m,C]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[m,xi],[g,E]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[m,ie],[g,O]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[m,ie],[g,E]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[m,pn],[g,E]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[m,pn],[g,O]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[m,"OPPO"],[g,E]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[m,"Vivo"],[g,E]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[m,"Realme"],[g,E]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[m,At],[g,E]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[m,At],[g,O]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[m,Q],[g,O]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[m,Q],[g,E]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[m,"Lenovo"],[g,O]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[m,"Nokia"],[g,E]],[/(pixel c)\b/i],[d,[m,W],[g,O]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[m,W],[g,E]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[m,re],[g,E]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[m,re],[g,O]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[m,"OnePlus"],[g,E]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[m,_],[g,O]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[m,_],[g,E]],[/(playbook);[-\w\),; ]+(rim)/i],[d,m,[g,O]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[m,Z],[g,E]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[m,M],[g,O]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[m,M],[g,E]],[/(nexus 9)/i],[d,[m,"HTC"],[g,O]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[d,/_/g," "],[g,E]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[m,"Acer"],[g,O]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[m,"Meizu"],[g,E]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[m,"Ulefone"],[g,E]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,d,[g,E]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,d,[g,O]],[/(surface duo)/i],[d,[m,Se],[g,O]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[m,"Fairphone"],[g,E]],[/(u304aa)/i],[d,[m,"AT&T"],[g,E]],[/\bsie-(\w*)/i],[d,[m,"Siemens"],[g,E]],[/\b(rct\w+) b/i],[d,[m,"RCA"],[g,O]],[/\b(venue[\d ]{2,7}) b/i],[d,[m,"Dell"],[g,O]],[/\b(q(?:mv|ta)\w+) b/i],[d,[m,"Verizon"],[g,O]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[m,"Barnes & Noble"],[g,O]],[/\b(tm\d{3}\w+) b/i],[d,[m,"NuVision"],[g,O]],[/\b(k88) b/i],[d,[m,"ZTE"],[g,O]],[/\b(nx\d{3}j) b/i],[d,[m,"ZTE"],[g,E]],[/\b(gen\d{3}) b.+49h/i],[d,[m,"Swiss"],[g,E]],[/\b(zur\d{3}) b/i],[d,[m,"Swiss"],[g,O]],[/\b((zeki)?tb.*\b) b/i],[d,[m,"Zeki"],[g,O]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],d,[g,O]],[/\b(ns-?\w{0,9}) b/i],[d,[m,"Insignia"],[g,O]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[m,"NextBook"],[g,O]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],d,[g,E]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],d,[g,E]],[/\b(ph-1) /i],[d,[m,"Essential"],[g,E]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[m,"Envizen"],[g,O]],[/\b(trio[-\w\. ]+) b/i],[d,[m,"MachSpeed"],[g,O]],[/\btu_(1491) b/i],[d,[m,"Rotor"],[g,O]],[/(shield[\w ]+) b/i],[d,[m,"Nvidia"],[g,O]],[/(sprint) (\w+)/i],[m,d,[g,E]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[m,Se],[g,E]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[m,Wn],[g,O]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[m,Wn],[g,E]],[/smart-tv.+(samsung)/i],[m,[g,B]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[m,gn],[g,B]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,Q],[g,B]],[/(apple) ?tv/i],[m,[d,C+" TV"],[g,B]],[/crkey/i],[[d,L+"cast"],[m,W],[g,B]],[/droid.+aft(\w+)( bui|\))/i],[d,[m,_],[g,B]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[m,xi],[g,B]],[/(bravia[\w ]+)( bui|\))/i],[d,[m,re],[g,B]],[/(mitv-\w{5}) bui/i],[d,[m,pn],[g,B]],[/Hbbtv.*(technisat) (.*);/i],[m,d,[g,B]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,Gn],[d,Gn],[g,B]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,B]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,d,[g,U]],[/droid.+; (shield) bui/i],[d,[m,"Nvidia"],[g,U]],[/(playstation [345portablevi]+)/i],[d,[m,re],[g,U]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[m,Se],[g,U]],[/((pebble))app/i],[m,d,[g,T]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[m,C],[g,T]],[/droid.+; (glass) \d/i],[d,[m,W],[g,T]],[/droid.+; (wt63?0{2,3})\)/i],[d,[m,Wn],[g,T]],[/(quest( 2| pro)?)/i],[d,[m,Je],[g,T]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[g,P]],[/(aeobc)\b/i],[d,[m,_],[g,P]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[g,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[g,O]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,O]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,E]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[v,[f,A+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[v,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[f,v],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[v,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,v],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[f,[v,qn,Ci]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,qn,Ci],[f,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[v,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,$n],[v,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[v,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,v],[/\(bb(10);/i],[v,[f,Z]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[v,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[v,[f,G+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[v,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[v,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[v,[f,L+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,Fn],v],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,v],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],v],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[f,v]]},ze=function(J,ne){if(typeof J===c&&(ne=J,J=i),!(this instanceof ze))return new ze(J,ne).getResult();var V=typeof n!==o&&n.navigator?n.navigator:i,se=J||(V&&V.userAgent?V.userAgent:s),ct=V&&V.userAgentData?V.userAgentData:i,fe=ne?Ei(Oi,ne):Oi,ee=V&&V.userAgent==se;return this.getBrowser=function(){var F={};return F[f]=i,F[v]=i,qt.call(F,se,fe.browser),F[p]=Ar(F[v]),ee&&V&&V.brave&&typeof V.brave.isBrave==l&&(F[f]="Brave"),F},this.getCPU=function(){var F={};return F[D]=i,qt.call(F,se,fe.cpu),F},this.getDevice=function(){var F={};return F[m]=i,F[d]=i,F[g]=i,qt.call(F,se,fe.device),ee&&!F[g]&&ct&&ct.mobile&&(F[g]=E),ee&&F[d]=="Macintosh"&&V&&typeof V.standalone!==o&&V.maxTouchPoints&&V.maxTouchPoints>2&&(F[d]="iPad",F[g]=O),F},this.getEngine=function(){var F={};return F[f]=i,F[v]=i,qt.call(F,se,fe.engine),F},this.getOS=function(){var F={};return F[f]=i,F[v]=i,qt.call(F,se,fe.os),ee&&!F[f]&&ct&&ct.platform!="Unknown"&&(F[f]=ct.platform.replace(/chrome os/i,Fn).replace(/macos/i,$n)),F},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return se},this.setUA=function(F){return se=typeof F===u&&F.length>w?Gn(F,w):F,this},this.setUA(se),this};ze.VERSION=r,ze.BROWSER=Pt([f,v,p]),ze.CPU=Pt([D]),ze.DEVICE=Pt([d,m,g,U,E,B,O,T,P]),ze.ENGINE=ze.OS=Pt([f,v]),e.exports&&(t=e.exports=ze),t.UAParser=ze;var Lt=typeof n!==o&&(n.jQuery||n.Zepto);if(Lt&&!Lt.ua){var fn=new ze;Lt.ua=fn.getResult(),Lt.ua.get=function(){return fn.getUA()},Lt.ua.set=function(J){fn.setUA(J);var ne=fn.getResult();for(var V in ne)Lt.ua[V]=ne[V]}}})(typeof window=="object"?window:Mc)})($r,$r.exports);var au=$r.exports;const Vr=Lc(au),je=Le.createScopedLog("Amplitude");let Oe;const Ea={installIdKey:"install-id",initialized:null,installId:null,browser:null,os:null,version:null,sessionId:null,sampleGroup:null,enabled:null,initAPI(e){return Oe=e,Oe.mixin("Analytics",{init:this.init.bind(this),event:this.event.bind(this),bindHtmlEvents:this.bindHtmlEvents.bind(this)})},async init(){if(this.initialized!=null)je==null||je("init","Amplitude already initialized",{sessionId:this.sessionId},"DEBUG");else{const{promise:e,resolve:t}=Oe.Utils.getDecoupledPromise();this.initialized=e;const n=new Vr(navigator.userAgent);this.sessionId=Date.now(),this.os=n.getOS(),this.browser=n.getBrowser(),this.version=Oe.Chrome.Extension.getVersion(),this.sampleGroup=await Oe.Storage.getOrSet("analyticsSamplingGroup",100*Math.random());const i=Oe.Settings.get("hasAcceptedPrivacyPolicy")??!0,r=!0;this.enabled=i&&r,this.installId=await Oe.Storage.get(this.installIdKey),this.installId||(this.installId=nu(),await Oe.Storage.set({[this.installIdKey]:this.installId})),t(),je==null||je("init","Initialized Amplitude",this,"INFO")}},async event(e,t){if(!this.initialized){je==null||je("event","Cannot report event until initialized",this,"WARN");return}const n=Date.now();await this.initialized;const i=Oe.RemoteConfig.get("amplitudeSampling"),r=Oe.RemoteConfig.get("defaultAmplitudeSampling"),s=i[e]??r,a=this.sampleGroup<s,l=this.enabled&&a,o={event_type:e,user_id:this.installId,user_properties:{hasAcceptedToS:!!Oe.Settings.get("hasAcceptedToS"),hasAcceptedPrivacyPolicy:!!Oe.Settings.get("hasAcceptedPrivacyPolicy"),explicitlyDeclinedPrivacyPolicy:!!Oe.Settings.get("explicitlyDeclinedPrivacyPolicy"),isNewUser:!!Oe.Settings.get("isNewUser"),is18OrOlder:Oe.Settings.get("is18OrOlder"),age:Oe.Settings.get("age")},time:n,event_properties:{page:`${location.protocol}//${location.hostname}${location.pathname}`,...t},app_version:this.version,os_name:this.browser.name,os_version:this.browser.version,platform:this.os.name};je==null||je("event",l?"Reported event":"Skipped event",{event:o,samplePercentInt:s,isSampled:a,thisEnabled:this.enabled},"DEBUG"),l&&await Oe.AmplitudeAPI.uploadEvents(o)},bindHtmlEvents(){je==null||je("bindHtmlEvents","Binding amplitude events to DOM",void 0,"DEBUG");const e="data-analytics-click";document.querySelectorAll(`*[${e}]`).forEach(n=>{n.addEventListener("click",i=>{var a;const r=i.target,s=(a=r==null?void 0:r.getAttribute)==null?void 0:a.call(r,e);s&&this.event(s)})});const t="data-analytics-toggle";document.querySelectorAll(`*[${t}]`).forEach(n=>{n.addEventListener("change",i=>{var l;const r=i.target,s=r==null?void 0:r.checked,a=(l=r==null?void 0:r.getAttribute)==null?void 0:l.call(r,t);a&&this.event(a,{checked:s})})})}},ou=Le.createScopedLog("AmplitudeAPI"),cu={baseUrl:"https://api2.amplitude.com",apiKey:"07de81d51a94380a82c075614cd12f6e",initAPI(e){return e.mixin("AmplitudeAPI",{uploadEvents:this.uploadEvents.bind(this)})},async uploadEvents(...e){return await fetch(`${this.baseUrl}/batch`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify({api_key:this.apiKey,events:e})}).catch(t=>{ou("uploadEvents","Failed to upload event",t,"WARN")})}},lu={initAPI(e){return e.mixin("Chrome",{Extension:{addListener:this.exists("runtime")?this.addRuntimeListener.bind(this):this.throwMisusedAPIException,connect:this.exists("runtime","connect")?chrome.runtime.connect.bind(chrome.runtime):this.throwMisusedAPIException,getID:this.exists("runtime")?function(){return chrome.runtime.id}:this.throwMisusedAPIException,getURL:this.exists("extension","getURL")?chrome.extension.getURL.bind(chrome.extension):this.throwMisusedAPIException,reload:this.exists("runtime","reload")?chrome.runtime.reload.bind(chrome.runtime):this.throwMisusedAPIException,getVersion:this.exists("runtime","getManifest")?this.getVersion.bind(this):this.throwMisusedAPIException,setUninstallURL:this.exists("runtime","setUninstallURL")?chrome.runtime.setUninstallURL.bind(chrome.runtime):this.throwMisusedAPIException},Message:{on:chrome.runtime.onMessage,send:this.exists("runtime","sendMessage")?chrome.runtime.sendMessage.bind(chrome.runtime):this.throwMisusedAPIException,sendToTab:this.exists("tabs","sendMessage")?chrome.tabs.sendMessage.bind(chrome.tabs):this.throwMisusedAPIException},Notification:{create:this.exists("notifications","create")?chrome.notifications.create.bind(chrome.notifications):this.throwMisusedAPIException,clear:this.exists("notifications","clear")?chrome.notifications.clear.bind(chrome.notifications):this.throwMisusedAPIException},Storage:{addListener:this.exists("storage")?this.addStorageListener.bind(this):this.throwMisusedAPIException,getLocal:this.exists("storage")?chrome.storage.local.get.bind(chrome.storage.local):this.throwMisusedAPIException,getSync:this.exists("storage")?chrome.storage.sync.get.bind(chrome.storage.sync):this.throwMisusedAPIException,removeLocal:this.exists("storage")?chrome.storage.local.remove.bind(chrome.storage.local):this.throwMisusedAPIException,removeSync:this.exists("storage")?chrome.storage.sync.remove.bind(chrome.storage.sync):this.throwMisusedAPIException,setLocal:this.exists("storage")?chrome.storage.local.set.bind(chrome.storage.local):this.throwMisusedAPIException,setSync:this.exists("storage")?chrome.storage.sync.set.bind(chrome.storage.sync):this.throwMisusedAPIException},Tab:{addListener:this.exists("tabs")?this.addTabsListener.bind(this):this.throwMisusedAPIException,create:this.exists("tabs","create")?chrome.tabs.create.bind(chrome.tabs):this.throwMisusedAPIException,getAllInWindow:this.exists("tabs","query")?this.getAllTabsInWindow.bind(this):this.throwMisusedAPIException,getCurrent:this.exists("tabs","getCurrent")?chrome.tabs.getCurrent.bind(chrome.tabs):this.throwMisusedAPIException,getSelected:this.exists("tabs","query")?this.getSelectedTab.bind(this):this.throwMisusedAPIException,remove:this.exists("tabs","remove")?chrome.tabs.remove.bind(chrome.tabs):this.throwMisusedAPIException,update:this.exists("tabs","update")?chrome.tabs.update.bind(chrome.tabs):this.throwMisusedAPIException,get:this.exists("tabs","get")?chrome.tabs.get.bind(chrome.tabs):this.throwMisusedAPIException},Translation:{get:this.exists("i18n","getMessage")?chrome.i18n.getMessage.bind(chrome.i18n):this.throwMisusedAPIException},Window:{addListener:this.exists("windows")?this.addWindowsListener.bind(this):this.throwMisusedAPIException,getLastFocused:this.exists("windows","getLastFocused")?chrome.windows.getLastFocused.bind(chrome.windows):this.throwMisusedAPIException},Alarms:{addListener:this.exists("alarms")?this.addAlarmsListener.bind(this):this.throwMisusedAPIException,ensure:this.exists("alarms")?this.ensureAlarm.bind(this):this.throwMisusedAPIException}})},getSelectedTab:function(e,t){const n={active:!0};e?n.windowId=e:n.currentWindow=!0,chrome.tabs.query(n,function(i){const r=i[0];typeof t=="function"&&t(r)})},getAllTabsInWindow:function(e,t){const n={};e?n.windowId=e:n.currentWindow=!0,chrome.tabs.query(n,function(i){typeof t=="function"&&t(i)})},getVersion(){return chrome.runtime.getManifest().version},async ensureAlarm(e,t){return new Promise(n=>{chrome.alarms.get(e,i=>{i||chrome.alarms.create(e,t),n()})})},addRuntimeListener:function(e,t){this.addListener("runtime",e,t)},addStorageListener:function(e,t){this.addListener("storage",e,t)},addTabsListener:function(e,t){this.addListener("tabs",e,t)},addWindowsListener:function(e,t){this.addListener("windows",e,t)},addAlarmsListener(e,t){this.addListener("alarms",e,t)},addListener:function(e,t,n){const i=e,r=t;typeof chrome[i][r]<"u"&&chrome[i][r].addListener(n)},exists:function(e,t){const n=e,i=t;let r=chrome&&typeof chrome[n]=="object";return r&&i&&(r=typeof chrome[n][i]=="function"),r},throwMisusedAPIException:function(){throw new Error("Improper use of chrome API in content script!")}},uu={initAPI(e){return e.mixin("Date",this)},parseMilitaryTime:function(e){const t=e.split(":");let n=parseInt(t[0],10);const i=parseInt(t[1],10),r=n>=12?"pm":"am";n=n>=12?n-12:n;const s=n===0?12:n,a=r==="pm"?q.Chrome.Translation.get("timePM"):q.Chrome.Translation.get("timeAM");return{hour:this.toTwoDigits(s),min:this.toTwoDigits(i),ampm:r,display:s+":"+this.toTwoDigits(i)+" "+a}},timestampToDisplayDate:function(e){const t=new Date(e),n={},i=t.getMonth()+1,r=t.getDate(),s=t.getHours(),a=t.getMinutes();return n.year=t.getFullYear(),n.month=this.toTwoDigits(i),n.day=this.toTwoDigits(r),n.minutes=this.toTwoDigits(a),n.ampm=s>=12?q.Chrome.Translation.get("timePM"):q.Chrome.Translation.get("timeAM"),n.hours=s>12?s-12:s,n.hours===0&&(n.hours=12,n.ampm=q.Chrome.Translation.get("timeAM")),n},hasTimePassed:function(e,t,n,i=new Date){e=n==="pm"?parseInt(e,10)+12:e;const r=i.toDateString();return new Date(r+" "+e+":"+t)<i},secondsUntilTime:function(e,t,n,i=new Date){e=n==="pm"?parseInt(e,10)+12:e;const r=i.toDateString(),a=new Date(r+" "+e+":"+t).getTime()-i.getTime();return Math.floor(a/1e3)},minutesUntilTime:function(e,t,n,i){const r=this.secondsUntilTime(e,t,n,i);return Math.floor(r/60)},getTodayDateObj:function(e,t,n,i=new Date){e=n==="pm"?parseInt(e,10)+12:e;const r=i.toDateString();return new Date(r+" "+e+":"+t)},hoursToMilliseconds:function(e){return parseFloat(e)*60*60*1e3},timeUnitToMilliseconds:function(e,t){if(!this.isValidTimeUnit(t))throw new Error('[DateUtils.timeUnitToMilliseconds()] Could not convert time unit to milliseconds. "'+t+'" is not a valid time unit.');return e=parseFloat(e),this.isValidHourUnit(t)?e*60*60*1e3:this.isValidMinUnit(t)?e*60*1e3:this.isValidSecUnit(t)?e*1e3:e},isValidTime:function(e,t){if(typeof e!="string"||e.indexOf(":")!==2||e.length!==5)return!1;t=t===12?12:24;const n=e.split(":"),i=parseInt(n[0]),r=parseInt(n[1]);return r>=0&&r<=59&&(t===12&&i>=1&&i<=12||t===24&&i>=0&&i<=23)},isValidTimeUnit:function(e){return this.isValidHourUnit(e)||this.isValidMinUnit(e)||this.isValidSecUnit(e)||this.isValidMSUnit(e)},isValidHourUnit:function(e){return typeof e=="string"&&(e.indexOf("hour")===0||e.indexOf("hr")===0||e==="h")},isValidMinUnit:function(e){return typeof e=="string"&&(e.indexOf("min")===0||e==="m")},isValidSecUnit:function(e){return typeof e=="string"&&(e.indexOf("sec")===0||e==="s")},isValidMSUnit:function(e){return typeof e=="string"&&(e.indexOf("millis")===0||e==="ms")},dayNumToDay:function(e,t){if(e<0||e>6)throw new Error("[DateUtils.dayNumToDay()] Day num must be between 0 and 6");return t===!0?["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]},getDaysInMonth:function(e,t){const n=new Date;return e=e||n.getMonth(),t=t||n.getYear(),32-new Date(t,e,32).getDate()},secondsToMinsAndSecs:function(e){return e/60===Math.floor(e/60)?e/60+" minutes":Math.floor(e/60)+" minutes and "+(e-Math.floor(e/60)*60)+" seconds"},toTwoDigits:function(e){return e<10?"0"+e:e.toString()},getYMD:function(e){e=e||new Date;const t=this.toTwoDigits(e.getMonth()+1),n=this.toTwoDigits(e.getDate());return e.getFullYear()+"-"+t+"-"+n}},Ie=Le.createScopedLog("DomainParser"),Ca={initAPI(e){return e.mixin("Domain",{extractBaseDomain:this.extractBaseDomain.bind(this),extractFullDomain:this.extractFullDomain.bind(this),isMoreGeneralURL:this.isMoreGeneralURL.bind(this),matchesWildcard:this.matchesWildcard.bind(this)})},extractFullDomain:function(e){if(!e)return null;Ie("extractFullDomain","Extracting full domain from",e,"TRACE");const t=e.match(/^(.[^/]*?:\/\/)?(.[^/]+)/);if(t===null||t.length<2)return e.split("/")[0];let n=t[2];return n.startsWith("www.")&&(n=n.replace("www.","")),n},extractBaseDomain:function(e){Ie("extractBaseDomain","Extracting base domain from",e,"TRACE");const t=this.extractFullDomain(e);if(!t||t.length===0)return"";const n=t.split(".");if(n.length===1)return t;let i=n[n.length-1];return i=n[n.length-2]+"."+i,this.isMultiPartDomain(t)&&(i=n[n.length-3]+"."+i),i},isMultiPartDomain:function(e){const t="Is "+e+" multi-part domain?",n=e.split(".");let i=[];if(n.length===1)return Ie("isMultiPartDomain",t,"NO","TRACE"),!1;const r=n[n.length-2];if(r.length===1||r.length===2&&n.length>3)return Ie("isMultiPartDomain",t,"YES","TRACE"),!0;if(r.length===3&&n.length>=3){i=["com","edu","gov","mil","net","org","biz","www","pro","int","web","xxx"];for(const s in i)if(i.hasOwnProperty(s)&&r===i[s])return Ie("isMultiPartDomain",t,"YES","TRACE"),!0}if(r.length===4&&n.length>=3){i=["info","mobi","name","jobs","kiwi","aero","asia","coop"];for(const s in i)if(i.hasOwnProperty(s)&&r===i[s])return Ie("isMultiPartDomain",t,"YES","TRACE"),!0}if(n.length>=3){const s=n[n.length-3];if(r.length===2&&n.length===3&&s.length>2&&s!=="www")return Ie("isMultiPartDomain",t,"YES","TRACE"),!0}return Ie("isMultiPartDomain",t,"NO","TRACE"),!1},isMoreGeneralURL:function(e,t){e=typeof e=="string"?e.toLowerCase():e,t=typeof t=="string"?t.toLowerCase():t;const n="Is "+e+" more general than "+t+"?";if(e=="chrome-extension://"&&(t==null?void 0:t.indexOf(e))==0)return!0;if(e=this.stripProtocol(e),t=this.stripProtocol(t),e==""&&t!="")return!1;const i=this.extractBaseDomain(t);if(e===t||e===i||t.indexOf(e)===0)return Ie("isMoreGeneralURL",n,"YES","TRACE"),!0;const r=this.extractBaseDomain(e);return r===i&&e.length<=t.length&&t.indexOf(e)>=0&&(t.indexOf("/")>=0||t.indexOf("?")>=0)||i.length>r.length&&i.indexOf(e)>-1?(Ie("isMoreGeneralURL",n,"YES","TRACE"),!0):(Ie("isMoreGeneralURL",n,"NO","TRACE"),!1)},matchesWildcard:function(e,t){if(e.indexOf("*")==-1)return;const n="Does "+t+" match wildcard "+e+"?";e=e.toLowerCase(),t=t.toLowerCase();const i=e.replace("*","");if(t=t||"",t.indexOf(i)===-1)return Ie("matchesWildcard",n,"NO","TRACE"),!1;const r=t.substring(0,t.indexOf(i)+i.length),a=t.substring(r.length-i.length,r.length)===i;return Ie("matchesWildcard",n,a?"YES":"NO","TRACE"),a},stripProtocol:function(e){return e?e.indexOf("://")>-1?e.slice(e.indexOf("://")+3,e.length):e:""}};let tn;function $s(){return tn.RemoteConfig.get("incrementalRollout")}const du=e=>({storageKey:`@incrementalRollout/${e}`,async getMyPercent(){return tn.Storage.getOrSet(this.storageKey,Math.random())},async getEnabledPercent(){return(await $s())[e]??0},async isEnabled(){const t=await this.getEnabledPercent();return await this.getMyPercent()<t},async debug(){ts.log("IncrementalRollout","Incremental rollout info:",{isEnabled:await this.isEnabled(),myPercent:await this.getMyPercent(),enabledPercent:await this.getEnabledPercent(),remoteConfig:await $s()},"DEBUG")},async enable(){await tn.Storage.set({[this.storageKey]:-1})},async disable(){await tn.Storage.set({[this.storageKey]:2})},async randomize(){await tn.Storage.set({[this.storageKey]:Math.random()})}}),hu={initAPI(e){return tn=e,tn.mixin("IncrementalRollout",{AdFinder:du("ad-finder")})}};let Te;const gu={initialized:null,onboardingSampleGroup:null,initAPI(e){return Te=e,Te.mixin("Requirements",{init:this.init.bind(this),isOnboardingCompleted:this.isOnboardingCompleted.bind(this),getPromptAgainAt:this.getPromptAgainAt.bind(this),setPromptAgainAt:this.setPromptAgainAt.bind(this),getOnboardingShownCount:this.getOnboardingShownCount.bind(this),incrementOnboardingShownCount:this.incrementOnboardingShownCount.bind(this),getConfirmationCount:this.getConfirmationCount.bind(this),incrementConfirmationCount:this.incrementConfirmationCount.bind(this),isUnder18:this.isUnder18.bind(this)})},async init(){if(this.initialized!=null)return;const{promise:e,resolve:t,reject:n}=Te.Utils.getDecoupledPromise();this.initialized=e,this.onboardingSampleGroup=await Te.Storage.getOrSet("onboardingSampleGroup",100*Math.random());try{await Promise.all([Te.Settings.initAsync(),Te.RemoteConfig.init()]),t()}catch(i){n(i)}},async isOnboardingCompleted(){const e=Date.now();if(this.initialized==null)throw Error("You must call `API.Requirements.init()` before calling `isOnboardingCompleted()`");await this.initialized;const t=Te.RemoteConfig.get("onboardingEnabledPercentInt2");if(!(this.onboardingSampleGroup<t)||this.isUnder18()||Te.Settings.get("explicitlyDeclinedPrivacyPolicy"))return!0;if(!Te.Settings.get("hasAcceptedToS"))return!1;const a=Te.Settings.get("hasAcceptedPrivacyPolicy"),l=await this.getPromptAgainAt(),o=await this.getConfirmationCount();return!!a||e<l||o>3},async getPromptAgainAt(){return await Te.Storage.get("showOnboardingAgainAt")??0},setPromptAgainAt(e){return Te.Storage.set({showOnboardingAgainAt:e})},async getOnboardingShownCount(){return await Te.Storage.get("onboardingShownCount")??0},async incrementOnboardingShownCount(){const e=await this.getOnboardingShownCount();await Te.Storage.set({onboardingShownCount:e+1})},async getConfirmationCount(){return await Te.Storage.get("privacyPolicyConfirmationCount")??0},async incrementConfirmationCount(){const e=await this.getConfirmationCount();await Te.Storage.set({privacyPolicyConfirmationCount:e+1})},isUnder18(){if(Te.Settings.get("is18OrOlder"))return!1;const t=Te.Settings.get("age");return t&&t<18},isEffectiveHourOfDay(){const e=[3,22,13,9,8,5,11,2,12,14,4,1],t=new Date().getHours();return!e.includes(t)}},we=Le.createScopedLog("Storage");let Ye;const $e={LOCAL:1,SYNC:2,map:null,cache:{},initAPI:function(e){return Ye=e,Ye.mixin("Storage",{addOnChangeListener:this.addOnChangeListener.bind(this),init:this.init.bind(this),initAsync:this.initAsync.bind(this),get:this.get.bind(this),getOrSet:this.getOrSet.bind(this),getAll:this.getAll.bind(this),set:this.set.bind(this),merge:this.merge.bind(this),remove:this.remove.bind(this),setBucket:this.setBucket.bind(this)})},init:async function(e){we("init","Initializing storage",null,"DEBUG"),this.cache={},this.map=null;const t=await this.getSynced("storageMap");we("init","Storage initialization complete",t,"DEBUG"),typeof t<"u"?this.map=t:(this.map={},await this.saveMap()),typeof e=="function"&&e()},initAsync(){return new Promise(e=>this.init(e))},get:async function(e,t=!1){let n;return this.inCache(e)&&!t?n=this.getCached(e):this.inSync(e)?n=await this.getSynced(e):n=await this.getLocal(e),n},async getOrSet(e,t,n=!1){let i=await this.get(e,n);return i==null&&(i=t,await this.set({[e]:i})),i},refresh:async function(e){return await this.get(e,!0)},getAll:async function(e){const t=typeof e=="string"?e.toUpperCase():e;if(t){if(t==="SYNC")return await Ye.Chrome.Storage.getSync(null);if(t==="LOCAL")return await Ye.Chrome.Storage.getLocal(null)}else{const n={},[i,r]=await Promise.all([Ye.Chrome.Storage.getSync(null),Ye.Chrome.Storage.getLocal(null)]);return n.SYNC=i,n.LOCAL=r,n}return{}},set:async function(e,t=null){const n=typeof t=="string"?t.toUpperCase():null,i={},r={};let s=!1,a=!1;for(const o in e)e.hasOwnProperty(o)&&(this.inSync(o)||n==="SYNC"?(i[o]=e[o],s=!0):(r[o]=e[o],a=!0));const l=[];s&&l.push(this.setSynced(i)),a&&l.push(this.setLocal(r)),await Promise.all(l)},remove:async function(e,t){var n;this.inSync(e)||t==="SYNC"?await this.removeSynced(e):await this.removeLocal(e),typeof((n=this.map)==null?void 0:n[e])<"u"&&(delete this.map[e],await this.saveMap())},merge:async function(e,t,n){if(we("merge","Merging "+e+" from "+n+" to "+t,null,"TRACE"),n==="SYNC"){const i=await this.getSynced(e),r=await this.getLocal(e);await this.doMerge(e,t,r,i)}else if(n==="LOCAL"){const i=await this.getLocal(e),r=await this.getSynced(e);await this.doMerge(e,t,r,i)}},doMerge:async function(e,t,n,i){n=Ct.isObjLiteral(n)?n:{},i=Ct.isObjLiteral(i)?i:{},await this.remove(e),await this.setBucket(e,t,!0);const r={};r[e]=Ct.merge(n,i,!0),await this.set(r)},setBucket:async function(e,t,n=!1){if(this.isArray(e)){const i=e;for(let r=0;r<i.length;r++)await this.setBucket(i[r],t,n)}else if(typeof e=="string"){const i=e;typeof t=="string"&&(t=t.toUpperCase()),t=typeof this[t]<"u"?t:"LOCAL",we("setBucket","Adding "+i+" to "+t+" storage bucket",null,"TRACE"),this.map[i]=this[t],await this.saveMap(),n!==!0&&await this.migrate(i,t)}},saveMap:async function(e){const t=e??this.map;await this.setSynced({storageMap:t})},migrate:async function(e,t){const n=t==="SYNC"?"LOCAL":"SYNC";if(we("migrate","Migrating "+e+" from "+n+" to "+t,null,"DEBUG"),t==="SYNC"){const i=await this.getLocal(e),r={};r[e]=i,await this.removeLocal(e),await this.setSynced(r)}else if(t==="LOCAL"){const i=await this.getSynced(e),r={};r[e]=i,await this.removeSynced(e),await this.setLocal(r)}},addOnChangeListener:function(e){e=typeof e=="function"?e:function(){},Ye.Chrome.Storage.addListener("onChanged",e)},inCache:function(e){return typeof this.cache[e]<"u"},inSync:function(e){return this.map[e]===this.SYNC},inLocal:function(e){return this.map[e]===this.LOCAL},setCached:function(e){we("setCached","Storing items in cache",e,"TRACE");for(const t in e)e.hasOwnProperty(t)&&(this.cache[t]=e[t])},getCached:function(e){return we("getCached","Getting "+e+" from cache",null,"TRACE"),this.cache[e]},removeCached:function(e){we("removeCached","Removing "+e+" from cache",null,"TRACE"),delete this.cache[e]},setSynced:async function(e,t=()=>{}){we("setSynced","Storing items in sync storage",e,"TRACE"),this.setCached(e),await Ye.Chrome.Storage.setSync(e,t)},getSynced:async function(e){we("getSynced","Getting "+e+" from sync storage",null,"TRACE");const t=await Ye.Chrome.Storage.getSync(e);return typeof e=="string"?(we("getSynced",e+" retrieved from sync storage:",t[e],"TRACE"),this.setCached(t),t[e]):(we("getSynced","Data retrieved from sync storage:",t,"TRACE"),t)},removeSynced:async function(e){we("removeSynced","Removing "+e+" from sync storage",null,"TRACE"),this.removeCached(e),await Ye.Chrome.Storage.removeSync(e)},setLocal:async function(e){we("setLocal","Storing items in Chrome local storage",e,"TRACE"),this.setCached(e),await Ye.Chrome.Storage.setLocal(e)},getLocal:async function(e){we("getLocal","Getting data from Chrome local storage",e,"TRACE");let t=await Ye.Chrome.Storage.getLocal(e);if(typeof e=="string"){t=t||{};let n=t[e];(typeof n>"u"||n===null)&&(n=await this.getFromLocalStorageBackup(e)),we("getLocal",e+" retrieved from local storage:",n,"TRACE");const i={};return i[e]=n,this.setCached(i),n}else return we("getLocal","Data retrieved from local storage:",t,"TRACE"),t},getFromLocalStorageBackup:async function(e){we("getFromLocalStorageBackup","Getting "+e+" from HTML5 localStorage",null,"TRACE");let t=null;const n=await chrome.storage.local.get(e);if(n==null)return null;const i=n[e];if(typeof i<"u"&&i!==null){we("getLocal",e+" found in HTML5 localStorage:",i,"TRACE");try{t=JSON.parse(i)}catch{t=i}const r={};r[e]=t,await this.setLocal(r)}return t},removeLocal:async function(e){we("removeLocal","Removing "+e+" from Chrome local storage",null,"TRACE"),this.removeCached(e),await Ye.Chrome.Storage.removeLocal(e)},isArray:function(e){return typeof e=="object"&&e!==null&&typeof e.length=="number"}},Ge=Le.createScopedLog("Settings");let Dr;const pu=["activeDays","activeHours","activeHoursQueue","blacklist","challengeRequired","challengeText","customStayFocusdMsg","disableActivityMonitor","disableSync","disableUpdatePopup","firstInstallDate","firstInstallAllowanceExpiration","hideAllowSiteLink","maxTimeAllowed","notificationSettings","nuclearOptionSettings","productivityBypass","resetTimeQueue","resetTimestamp","resetTime","whitelist","hasAcceptedToS","hasAcceptedPrivacyPolicy","explicitlyDeclinedPrivacyPolicy","is18OrOlder","age","isNewUser","promptBirthYearAt","promptBirthYearInterval","promptReview","promptReviewAt","promptReviewInterval","promptSurvey","promptSurveyAt","promptSurveyInterval","debugActivityMonitor","blockedGroups","isBlockAllWebsites","blockAllWebsitesAllowedTime","blockAllWebsitesElapsedTime","showedInitialTutorial","desktopPromoDismissed","whitelistNew","activated","isActivateSwitchShown"],fu={MAX_BACKUP_VERSIONS:5,keys:pu,cache:{},backupKeys:[],initialized:!1,initAPI:function(e){return Dr=e,Dr.mixin("Settings",{init:this.init.bind(this),initAsync:this.initAsync.bind(this),get:this.get.bind(this),set:this.set.bind(this),setAsync:this.setAsync.bind(this),refresh:this.refresh.bind(this),remove:this.remove.bind(this),restoreBackup:this.restoreBackup.bind(this),isInitialized:this.isInitialized.bind(this)})},init:function(e){this.initialized?(Ge("init","Settings already initialized",this.keys,"DEBUG"),typeof e=="function"&&e()):(Ge("init","Initializing Settings",this.keys,"DEBUG"),this.initialized=!0,this.cache={},$e.init(()=>{this.initBackups(),this.refresh(e)}))},initAsync(){return new Promise(e=>this.init(e))},refresh:function(e){Ge("refresh","Refreshing Settings",this.keys,"TRACE");let t=0;const n=this.keys.length,i=r=>{$e.refresh(r).then(s=>{this.cache[r]=typeof s<"u"?s:null,t++,t===n&&(Ge("refresh","Settings refreshed",null,"TRACE"),typeof e=="function"&&e())})};for(let r=0;r<n;r++)i(this.keys[r])},get:function(e,t){if(!this.inCache(e))throw new Error("[Settings.get()] "+e+" is not registered as a key in Settings.js");return this.cache[e]!==null?this.cache[e]:t},set(e,t,n,i){this.saveBackup();for(const r in e){const s=r;if(e.hasOwnProperty(s)){if(!this.inCache(s)&&!i)throw new Error("[Settings.get()] "+s+" is not registered as a key in Settings.js");this.cache[s]=e[s]}}$e.set(e,n).then(()=>{typeof t=="function"&&t()})},setAsync(e,t,n){return new Promise(i=>this.set(e,i,t,n))},remove:function(e){this.inCache(e)&&(this.cache[e]=null),$e.remove(e)},initBackups:function(){$e.get("backupKeys").then(e=>{this.backupKeys=typeof e=="string"?JSON.parse(e):[],this.deleteOrphanedBackups(this.backupKeys)})},saveBackup:async function(){const e="backup-"+new Date().getTime();Ge("saveBackup","Saving backup: "+e,this.cache,"TRACE"),this.backupKeys.length>=this.MAX_BACKUP_VERSIONS&&this.pruneBackups(),this.backupKeys.unshift(e);const t={};t[e]=JSON.stringify(this.cache),t.backupKeys=JSON.stringify(this.backupKeys),await $e.setBucket(e),await $e.set(t),Ge("saveBackup","Backup saved",null,"TRACE")},restoreBackup:function(e=void 0){const t=e||this.backupKeys.shift();return t?(Ge("restoreBackup","Restoring backup",t,"DEBUG"),$e.get(t).then(n=>{if(Ge("restoreBackup","Backup loaded",t,"DEBUG"),typeof n=="string")try{const i=JSON.parse(n);$e.set(i).then(async()=>{await $e.remove(t),Ge("restoreBackup","Backup restored",t,"DEBUG"),await $e.set({backupKeys:JSON.stringify(this.backupKeys)}),Dr.Chrome.Extension.reload()})}catch{Ge("restoreBackup","Backup failed. Error parsing backup JSON.",t,"DEBUG"),this.restoreBackup()}else Ge("restoreBackup","Backup failed. Backup wasn't a string.",t,"DEBUG"),this.restoreBackup()}),!0):(Ge("restoreBackup","No backup available to restore",null,"WARN"),!1)},pruneBackups:function(){if(this.isArray(this.backupKeys)){const e=this.backupKeys.pop();Ge("pruneBackups","Pruning backup: "+e,null,"TRACE"),$e.remove(e)}},deleteOrphanedBackups:function(e){Ge("deleteOrphanedBackups","Deleting orphaned backups",null,"TRACE");const t={};for(let n=0;n<e.length;n++)t[e[n]]=1;$e.get("storageMap").then(n=>{let i=!1;for(const r in n)n.hasOwnProperty(r)&&r.indexOf("backup-")===0&&!(r in t)&&(delete n[r],i=!0);i&&$e.saveMap(n)})},inCache:function(e){return typeof this.cache[e]<"u"},isArray:function(e){return typeof e=="object"&&e!==null&&typeof e.length=="number"},isInitialized(){return this.initialized}},Oa=1e3,cn=60*Oa,mr=60*cn,ns=24*mr,jf=7*ns,Wf=30*ns,Mn=60,jt=60*Mn,Ff=24*jt,Vs=Mn*10,Cn={getToday(){return Cn.getStartOfDay(new Date)},getEndOfToday(){return Cn.getEndOfDay(new Date)},getStartOfDay(e){const t=new Date(e);return t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),t.setHours(0),t.getTime()},getEndOfDay(e){const t=new Date(e);return t.setMilliseconds(999),t.setSeconds(59),t.setMinutes(59),t.setHours(23),t.getTime()},formatDurationInSeconds(e){if(e===0||e<0)return"00:00";const t=Math.floor(e/jt),n=Math.floor((e-t*jt)/60),i=Math.floor(e-(t*jt+n*60)),r=q.Date.toTwoDigits(t),s=q.Date.toTwoDigits(n),a=q.Date.toTwoDigits(i);return(r=="00"?"":`${r}:`)+`${s}:${a}`},formatTimeToString(e){return e>=0&&e<10?`0${e}`:e},getTimeFromSeconds(e){if(e<0)return{hours:0,minutes:0,seconds:0};const t=Math.floor(e/jt),n=Math.floor((e-t*jt)/60),i=e-(t*jt+n*60);return{hours:t,minutes:n,seconds:i}},getTimeFromMilliseconds(e){const t=e/cn,n=t<60?0:Math.floor(t/60);let i=0;return n>0?i=t-n*60:i=Math.floor(t),{hours:n,minutes:i}},getTimeInMilliseconds(e,t){return e*mr+t*cn},getTimeInSeconds(e,t){return e*jt+t*Mn}},me=Le.createScopedLog("RemoteConfig");let Ni;const mu={cache:{},initialized:!1,defaults:{onboardingEnabledPercentInt2:0,defaultAmplitudeSampling:.1,amplitudeSampling:{},newTabTimeout:3*ns,uploadWebUsage:!0,usageUploadBatchSize:500,pageViewAllowlist:[],incrementalRollout:{},bugsnagSampling:.01,bugsnagIgnoreMatches:["Extension context invalidated.","Could not establish connection. Receiving end does not exist.","The browser is shutting down.",'{\\s*"?isTrusted"?:\\s*true\\s*}',"Failed to execute 'abort' on 'IDBTransaction': The transaction has finished.","Failed to execute 'transaction' on 'IDBDatabase': The database connection is closing.","^IO error: \\.\\.\\.\\/.+?: .*? \\(ChromeMethodBFE: .*\\)$","Cannot access contents of the page. Extension manifest must request permission to access the respective host.","The extensions gallery cannot be scripted."],instacartSelectors:{productSelector:['div[aria-label="Product"]'],sponsoredRegex:["/s\\s*p\\s*o\\s*n\\s*s\\s*o\\s*r\\s*/i"],companyName:[".e-1f1gsmn",".e-1opt332"],searchTerm:["#search-bar-input"],productTitle:[".e-th3ch3",".e-u2e78b",".e-1exr31r",".e-wrmemy"],productSize:[".e-k9ly30",".e-owckh2",".e-1hb8rq9",".e-1188c9v"],productPrice:[".e-1jioxed > span.screen-reader-only",".e-1ybpdrh > span.screen-reader-only",".e-1ghw7u1 > span.screen-reader-only",".e-hlbpyw > span.screen-reader-only",".e-t5lw1y > span.e-13d1dsr"]},forbiddenPromptWords:["drug","alcohol","porn"],chatGptUrl:"https://chatgpt.com/",chatGptConversationUrl:"https://chatgpt.com/c/"},url:"https://stayfocusd.st-panel-api.com/v1/remote_config/stayfocusd",sharedConfigUrl:"https://stayfocusd.st-panel-api.com/v1/remote_config/shared-web-config",storageKey:"remote-config",initAPI(e){return Ni=e,Ni.mixin("RemoteConfig",{storageKey:this.storageKey,init:this.init.bind(this),get:this.get.bind(this),refresh:this.refresh.bind(this)})},async init(){if(this.initialized){me==null||me("init","RemoteConfig already initialized",this.cache,"DEBUG");return}me==null||me("init","Initializing RemoteConfig",this.defaults,"DEBUG"),this.initialized=!0,this.cache={...this.defaults},this.cache={...this.cache,...await Ni.Storage.get(this.storageKey)},me==null||me("init","Initialized",this.cache,"DEBUG")},async refresh(){me==null||me("refresh","Refreshing...",{currentConfig:this.cache},"DEBUG");try{const e=await fetch(this.url).then(n=>n.json()),t=await fetch(this.sharedConfigUrl).then(n=>n.json());me==null||me("refresh","Fetched config",e,"DEBUG"),this.cache={...this.defaults,...e,...t},await Ni.Storage.set({[this.storageKey]:this.cache}),me==null||me("refresh","Saved config",this.cache,"DEBUG")}catch(e){me==null||me("refresh","Failed to fetch remote config",e,"WARN")}},get(e){if(!this.inCache(e))throw new Error("[RemoteConfig.get()] "+e+" is not registered as a key in RemoteConfig.js");return this.cache[e]},inCache(e){return typeof this.cache[e]<"u"}};var yu=Object.defineProperty,wu=(e,t,n)=>t in e?yu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,xe=(e,t,n)=>(wu(e,typeof t!="symbol"?t+"":t,n),n),is=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},I=(e,t,n)=>(is(e,t,"read from private field"),n?n.call(e):t.get(e)),He=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},ve=(e,t,n,i)=>(is(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n),si=(e,t,n)=>(is(e,t,"access private method"),n),te;(function(e){e.assertEqual=r=>r;function t(r){}e.assertIs=t;function n(r){throw new Error}e.assertNever=n,e.arrayToEnum=r=>{const s={};for(const a of r)s[a]=a;return s},e.getValidEnumValues=r=>{const s=e.objectKeys(r).filter(l=>typeof r[r[l]]!="number"),a={};for(const l of s)a[l]=r[l];return e.objectValues(a)},e.objectValues=r=>e.objectKeys(r).map(function(s){return r[s]}),e.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const s=[];for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&s.push(a);return s},e.find=(r,s)=>{for(const a of r)if(s(a))return a},e.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function i(r,s=" | "){return r.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}e.joinValues=i,e.jsonStringifyReplacer=(r,s)=>typeof s=="bigint"?s.toString():s})(te||(te={}));const R=te.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ft=e=>{switch(typeof e){case"undefined":return R.undefined;case"string":return R.string;case"number":return isNaN(e)?R.nan:R.number;case"boolean":return R.boolean;case"function":return R.function;case"bigint":return R.bigint;case"symbol":return R.symbol;case"object":return Array.isArray(e)?R.array:e===null?R.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?R.promise:typeof Map<"u"&&e instanceof Map?R.map:typeof Set<"u"&&e instanceof Set?R.set:typeof Date<"u"&&e instanceof Date?R.date:R.object;default:return R.unknown}},k=te.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),vu=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class Ot extends Error{constructor(t){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const n=t||function(s){return s.message},i={_errors:[]},r=s=>{for(const a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(r);else if(a.code==="invalid_return_type")r(a.returnTypeError);else if(a.code==="invalid_arguments")r(a.argumentsError);else if(a.path.length===0)i._errors.push(n(a));else{let l=i,o=0;for(;o<a.path.length;){const c=a.path[o];o===a.path.length-1?(l[c]=l[c]||{_errors:[]},l[c]._errors.push(n(a))):l[c]=l[c]||{_errors:[]},l=l[c],o++}}};return r(this),i}toString(){return this.message}get message(){return JSON.stringify(this.issues,te.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},i=[];for(const r of this.issues)r.path.length>0?(n[r.path[0]]=n[r.path[0]]||[],n[r.path[0]].push(t(r))):i.push(t(r));return{formErrors:i,fieldErrors:n}}get formErrors(){return this.flatten()}}Ot.create=e=>new Ot(e);const ui=(e,t)=>{let n;switch(e.code){case k.invalid_type:e.received===R.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case k.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,te.jsonStringifyReplacer)}`;break;case k.unrecognized_keys:n=`Unrecognized key(s) in object: ${te.joinValues(e.keys,", ")}`;break;case k.invalid_union:n="Invalid input";break;case k.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${te.joinValues(e.options)}`;break;case k.invalid_enum_value:n=`Invalid enum value. Expected ${te.joinValues(e.options)}, received '${e.received}'`;break;case k.invalid_arguments:n="Invalid function arguments";break;case k.invalid_return_type:n="Invalid function return type";break;case k.invalid_date:n="Invalid date";break;case k.invalid_string:typeof e.validation=="object"?"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:te.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case k.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(e.minimum)}`:n="Invalid input";break;case k.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(e.maximum)}`:n="Invalid input";break;case k.custom:n="Invalid input";break;case k.invalid_intersection_types:n="Intersection results could not be merged";break;case k.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case k.not_finite:n="Number must be finite";break;default:n=t.defaultError,te.assertNever(e)}return{message:n}};let Ia=ui;function bu(e){Ia=e}function Ji(){return Ia}const Xi=e=>{const{data:t,path:n,errorMaps:i,issueData:r}=e,s=[...n,...r.path||[]],a={...r,path:s};let l="";const o=i.filter(c=>!!c).slice().reverse();for(const c of o)l=c(a,{data:t,defaultError:l}).message;return{...r,path:s,message:r.message||l}},Au=[];function j(e,t){const n=Xi({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,Ji(),ui].filter(i=>!!i)});e.common.issues.push(n)}let Qe=class Da{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const i=[];for(const r of n){if(r.status==="aborted")return H;r.status==="dirty"&&t.dirty(),i.push(r.value)}return{status:t.value,value:i}}static async mergeObjectAsync(t,n){const i=[];for(const r of n)i.push({key:await r.key,value:await r.value});return Da.mergeObjectSync(t,i)}static mergeObjectSync(t,n){const i={};for(const r of n){const{key:s,value:a}=r;if(s.status==="aborted"||a.status==="aborted")return H;s.status==="dirty"&&t.dirty(),a.status==="dirty"&&t.dirty(),(typeof a.value<"u"||r.alwaysSet)&&(i[s.value]=a.value)}return{status:t.value,value:i}}};const H=Object.freeze({status:"aborted"}),ka=e=>({status:"dirty",value:e}),Ue=e=>({status:"valid",value:e}),Gr=e=>e.status==="aborted",qr=e=>e.status==="dirty",er=e=>e.status==="valid",tr=e=>typeof Promise!==void 0&&e instanceof Promise;var X;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(X||(X={}));let vt=class{constructor(t,n,i,r){this.parent=t,this.data=n,this._path=i,this._key=r}get path(){return this._path.concat(this._key)}};const Gs=(e,t)=>{if(er(t))return{success:!0,data:t.value};{if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,error:new Ot(e.common.issues)}}};function K(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:i,description:r}=e;if(t&&(n||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:r}:{errorMap:(s,a)=>s.code!=="invalid_type"?{message:a.defaultError}:typeof a.data>"u"?{message:i??a.defaultError}:{message:n??a.defaultError},description:r}}class Y{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return Ft(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:Ft(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Qe,ctx:{common:t.parent.common,data:t.data,parsedType:Ft(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(tr(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const i=this.safeParse(t,n);if(i.success)return i.data;throw i.error}safeParse(t,n){var i;const r={common:{issues:[],async:(i=n==null?void 0:n.async)!==null&&i!==void 0?i:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ft(t)},s=this._parseSync({data:t,path:r.path,parent:r});return Gs(r,s)}async parseAsync(t,n){const i=await this.safeParseAsync(t,n);if(i.success)return i.data;throw i.error}async safeParseAsync(t,n){const i={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ft(t)},r=this._parse({data:t,path:i.path,parent:i}),s=await(tr(r)?r:Promise.resolve(r));return Gs(i,s)}refine(t,n){const i=r=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(r):n;return this._refinement((r,s)=>{const a=t(r),l=()=>s.addIssue({code:k.custom,...i(r)});return typeof Promise<"u"&&a instanceof Promise?a.then(o=>o?!0:(l(),!1)):a?!0:(l(),!1)})}refinement(t,n){return this._refinement((i,r)=>t(i)?!0:(r.addIssue(typeof n=="function"?n(i,r):n),!1))}_refinement(t){return new ft({schema:this,typeName:$.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return wt.create(this)}nullable(){return dn.create(this)}nullish(){return this.optional().nullable()}array(){return pt.create(this)}promise(){return Rn.create(this)}or(t){return fi.create([this,t])}and(t){return mi.create(this,t)}transform(t){return new ft({schema:this,typeName:$.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new Ai({innerType:this,defaultValue:n,typeName:$.ZodDefault})}brand(){return new La({typeName:$.ZodBranded,type:this,...K(void 0)})}catch(t){const n=typeof t=="function"?t:()=>t;return new ar({innerType:this,defaultValue:n,typeName:$.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return Ti.create(this,t)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Su=/^c[^\s-]{8,}$/i,_u=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,Tu=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,xu=e=>e.precision?e.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}:\\d{2})|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):e.precision===0?e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}:\\d{2})|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}:\\d{2})|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");class Dt extends Y{constructor(){super(...arguments),this._regex=(t,n,i)=>this.refinement(r=>t.test(r),{validation:n,code:k.invalid_string,...X.errToObj(i)}),this.nonempty=t=>this.min(1,X.errToObj(t)),this.trim=()=>new Dt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==R.string){const r=this._getOrReturnCtx(t);return j(r,{code:k.invalid_type,expected:R.string,received:r.parsedType}),H}const n=new Qe;let i;for(const r of this._def.checks)if(r.kind==="min")t.data.length<r.value&&(i=this._getOrReturnCtx(t,i),j(i,{code:k.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),n.dirty());else if(r.kind==="max")t.data.length>r.value&&(i=this._getOrReturnCtx(t,i),j(i,{code:k.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),n.dirty());else if(r.kind==="length"){const s=t.data.length>r.value,a=t.data.length<r.value;(s||a)&&(i=this._getOrReturnCtx(t,i),s?j(i,{code:k.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):a&&j(i,{code:k.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),n.dirty())}else if(r.kind==="email")Tu.test(t.data)||(i=this._getOrReturnCtx(t,i),j(i,{validation:"email",code:k.invalid_string,message:r.message}),n.dirty());else if(r.kind==="uuid")_u.test(t.data)||(i=this._getOrReturnCtx(t,i),j(i,{validation:"uuid",code:k.invalid_string,message:r.message}),n.dirty());else if(r.kind==="cuid")Su.test(t.data)||(i=this._getOrReturnCtx(t,i),j(i,{validation:"cuid",code:k.invalid_string,message:r.message}),n.dirty());else if(r.kind==="url")try{new URL(t.data)}catch{i=this._getOrReturnCtx(t,i),j(i,{validation:"url",code:k.invalid_string,message:r.message}),n.dirty()}else r.kind==="regex"?(r.regex.lastIndex=0,r.regex.test(t.data)||(i=this._getOrReturnCtx(t,i),j(i,{validation:"regex",code:k.invalid_string,message:r.message}),n.dirty())):r.kind==="trim"?t.data=t.data.trim():r.kind==="startsWith"?t.data.startsWith(r.value)||(i=this._getOrReturnCtx(t,i),j(i,{code:k.invalid_string,validation:{startsWith:r.value},message:r.message}),n.dirty()):r.kind==="endsWith"?t.data.endsWith(r.value)||(i=this._getOrReturnCtx(t,i),j(i,{code:k.invalid_string,validation:{endsWith:r.value},message:r.message}),n.dirty()):r.kind==="datetime"?xu(r).test(t.data)||(i=this._getOrReturnCtx(t,i),j(i,{code:k.invalid_string,validation:"datetime",message:r.message}),n.dirty()):te.assertNever(r);return{status:n.value,value:t.data}}_addCheck(t){return new Dt({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...X.errToObj(t)})}url(t){return this._addCheck({kind:"url",...X.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...X.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...X.errToObj(t)})}datetime(t){var n;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(n=t==null?void 0:t.offset)!==null&&n!==void 0?n:!1,...X.errToObj(t==null?void 0:t.message)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...X.errToObj(n)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...X.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...X.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...X.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...X.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...X.errToObj(n)})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}Dt.create=e=>{var t;return new Dt({checks:[],typeName:$.ZodString,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...K(e)})};function Eu(e,t){const n=(e.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,r=n>i?n:i,s=parseInt(e.toFixed(r).replace(".","")),a=parseInt(t.toFixed(r).replace(".",""));return s%a/Math.pow(10,r)}class Vt extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==R.number){const r=this._getOrReturnCtx(t);return j(r,{code:k.invalid_type,expected:R.number,received:r.parsedType}),H}let n;const i=new Qe;for(const r of this._def.checks)r.kind==="int"?te.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),j(n,{code:k.invalid_type,expected:"integer",received:"float",message:r.message}),i.dirty()):r.kind==="min"?(r.inclusive?t.data<r.value:t.data<=r.value)&&(n=this._getOrReturnCtx(t,n),j(n,{code:k.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):r.kind==="max"?(r.inclusive?t.data>r.value:t.data>=r.value)&&(n=this._getOrReturnCtx(t,n),j(n,{code:k.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),i.dirty()):r.kind==="multipleOf"?Eu(t.data,r.value)!==0&&(n=this._getOrReturnCtx(t,n),j(n,{code:k.not_multiple_of,multipleOf:r.value,message:r.message}),i.dirty()):r.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),j(n,{code:k.not_finite,message:r.message}),i.dirty()):te.assertNever(r);return{status:i.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,X.toString(n))}gt(t,n){return this.setLimit("min",t,!1,X.toString(n))}lte(t,n){return this.setLimit("max",t,!0,X.toString(n))}lt(t,n){return this.setLimit("max",t,!1,X.toString(n))}setLimit(t,n,i,r){return new Vt({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:i,message:X.toString(r)}]})}_addCheck(t){return new Vt({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:X.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:X.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:X.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:X.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:X.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:X.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:X.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int")}}Vt.create=e=>new Vt({checks:[],typeName:$.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...K(e)});class di extends Y{_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==R.bigint){const n=this._getOrReturnCtx(t);return j(n,{code:k.invalid_type,expected:R.bigint,received:n.parsedType}),H}return Ue(t.data)}}di.create=e=>{var t;return new di({typeName:$.ZodBigInt,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...K(e)})};class hi extends Y{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==R.boolean){const n=this._getOrReturnCtx(t);return j(n,{code:k.invalid_type,expected:R.boolean,received:n.parsedType}),H}return Ue(t.data)}}hi.create=e=>new hi({typeName:$.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...K(e)});class ln extends Y{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==R.date){const r=this._getOrReturnCtx(t);return j(r,{code:k.invalid_type,expected:R.date,received:r.parsedType}),H}if(isNaN(t.data.getTime())){const r=this._getOrReturnCtx(t);return j(r,{code:k.invalid_date}),H}const n=new Qe;let i;for(const r of this._def.checks)r.kind==="min"?t.data.getTime()<r.value&&(i=this._getOrReturnCtx(t,i),j(i,{code:k.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),n.dirty()):r.kind==="max"?t.data.getTime()>r.value&&(i=this._getOrReturnCtx(t,i),j(i,{code:k.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),n.dirty()):te.assertNever(r);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new ln({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:X.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:X.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}ln.create=e=>new ln({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:$.ZodDate,...K(e)});class nr extends Y{_parse(t){if(this._getType(t)!==R.symbol){const n=this._getOrReturnCtx(t);return j(n,{code:k.invalid_type,expected:R.symbol,received:n.parsedType}),H}return Ue(t.data)}}nr.create=e=>new nr({typeName:$.ZodSymbol,...K(e)});class gi extends Y{_parse(t){if(this._getType(t)!==R.undefined){const n=this._getOrReturnCtx(t);return j(n,{code:k.invalid_type,expected:R.undefined,received:n.parsedType}),H}return Ue(t.data)}}gi.create=e=>new gi({typeName:$.ZodUndefined,...K(e)});class pi extends Y{_parse(t){if(this._getType(t)!==R.null){const n=this._getOrReturnCtx(t);return j(n,{code:k.invalid_type,expected:R.null,received:n.parsedType}),H}return Ue(t.data)}}pi.create=e=>new pi({typeName:$.ZodNull,...K(e)});class Ln extends Y{constructor(){super(...arguments),this._any=!0}_parse(t){return Ue(t.data)}}Ln.create=e=>new Ln({typeName:$.ZodAny,...K(e)});class rn extends Y{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ue(t.data)}}rn.create=e=>new rn({typeName:$.ZodUnknown,...K(e)});let kt=class extends Y{_parse(t){const n=this._getOrReturnCtx(t);return j(n,{code:k.invalid_type,expected:R.never,received:n.parsedType}),H}};kt.create=e=>new kt({typeName:$.ZodNever,...K(e)});class ir extends Y{_parse(t){if(this._getType(t)!==R.undefined){const n=this._getOrReturnCtx(t);return j(n,{code:k.invalid_type,expected:R.void,received:n.parsedType}),H}return Ue(t.data)}}ir.create=e=>new ir({typeName:$.ZodVoid,...K(e)});class pt extends Y{_parse(t){const{ctx:n,status:i}=this._processInputParams(t),r=this._def;if(n.parsedType!==R.array)return j(n,{code:k.invalid_type,expected:R.array,received:n.parsedType}),H;if(r.exactLength!==null){const a=n.data.length>r.exactLength.value,l=n.data.length<r.exactLength.value;(a||l)&&(j(n,{code:a?k.too_big:k.too_small,minimum:l?r.exactLength.value:void 0,maximum:a?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),i.dirty())}if(r.minLength!==null&&n.data.length<r.minLength.value&&(j(n,{code:k.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),i.dirty()),r.maxLength!==null&&n.data.length>r.maxLength.value&&(j(n,{code:k.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),i.dirty()),n.common.async)return Promise.all(n.data.map((a,l)=>r.type._parseAsync(new vt(n,a,n.path,l)))).then(a=>Qe.mergeArray(i,a));const s=n.data.map((a,l)=>r.type._parseSync(new vt(n,a,n.path,l)));return Qe.mergeArray(i,s)}get element(){return this._def.type}min(t,n){return new pt({...this._def,minLength:{value:t,message:X.toString(n)}})}max(t,n){return new pt({...this._def,maxLength:{value:t,message:X.toString(n)}})}length(t,n){return new pt({...this._def,exactLength:{value:t,message:X.toString(n)}})}nonempty(t){return this.min(1,t)}}pt.create=(e,t)=>new pt({type:e,minLength:null,maxLength:null,exactLength:null,typeName:$.ZodArray,...K(t)});var rr;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(rr||(rr={}));const qs=e=>t=>new ue({...e,shape:()=>({...e.shape(),...t})});function Tn(e){if(e instanceof ue){const t={};for(const n in e.shape){const i=e.shape[n];t[n]=wt.create(Tn(i))}return new ue({...e._def,shape:()=>t})}else return e instanceof pt?pt.create(Tn(e.element)):e instanceof wt?wt.create(Tn(e.unwrap())):e instanceof dn?dn.create(Tn(e.unwrap())):e instanceof Gt?Gt.create(e.items.map(t=>Tn(t))):e}class ue extends Y{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=qs(this._def),this.extend=qs(this._def)}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=te.objectKeys(t);return this._cached={shape:t,keys:n}}_parse(t){if(this._getType(t)!==R.object){const o=this._getOrReturnCtx(t);return j(o,{code:k.invalid_type,expected:R.object,received:o.parsedType}),H}const{status:n,ctx:i}=this._processInputParams(t),{shape:r,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof kt&&this._def.unknownKeys==="strip"))for(const o in i.data)s.includes(o)||a.push(o);const l=[];for(const o of s){const c=r[o],u=i.data[o];l.push({key:{status:"valid",value:o},value:c._parse(new vt(i,u,i.path,o)),alwaysSet:o in i.data})}if(this._def.catchall instanceof kt){const o=this._def.unknownKeys;if(o==="passthrough")for(const c of a)l.push({key:{status:"valid",value:c},value:{status:"valid",value:i.data[c]}});else if(o==="strict")a.length>0&&(j(i,{code:k.unrecognized_keys,keys:a}),n.dirty());else if(o!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const o=this._def.catchall;for(const c of a){const u=i.data[c];l.push({key:{status:"valid",value:c},value:o._parse(new vt(i,u,i.path,c)),alwaysSet:c in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const o=[];for(const c of l){const u=await c.key;o.push({key:u,value:await c.value,alwaysSet:c.alwaysSet})}return o}).then(o=>Qe.mergeObjectSync(n,o)):Qe.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(t){return X.errToObj,new ue({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,i)=>{var r,s,a,l;const o=(a=(s=(r=this._def).errorMap)===null||s===void 0?void 0:s.call(r,n,i).message)!==null&&a!==void 0?a:i.defaultError;return n.code==="unrecognized_keys"?{message:(l=X.errToObj(t).message)!==null&&l!==void 0?l:o}:{message:o}}}:{}})}strip(){return new ue({...this._def,unknownKeys:"strip"})}passthrough(){return new ue({...this._def,unknownKeys:"passthrough"})}setKey(t,n){return this.augment({[t]:n})}merge(t){return new ue({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>rr.mergeShapes(this._def.shape(),t._def.shape()),typeName:$.ZodObject})}catchall(t){return new ue({...this._def,catchall:t})}pick(t){const n={};return te.objectKeys(t).map(i=>{this.shape[i]&&(n[i]=this.shape[i])}),new ue({...this._def,shape:()=>n})}omit(t){const n={};return te.objectKeys(this.shape).map(i=>{te.objectKeys(t).indexOf(i)===-1&&(n[i]=this.shape[i])}),new ue({...this._def,shape:()=>n})}deepPartial(){return Tn(this)}partial(t){const n={};if(t)return te.objectKeys(this.shape).map(i=>{te.objectKeys(t).indexOf(i)===-1?n[i]=this.shape[i]:n[i]=this.shape[i].optional()}),new ue({...this._def,shape:()=>n});for(const i in this.shape){const r=this.shape[i];n[i]=r.optional()}return new ue({...this._def,shape:()=>n})}required(t){const n={};if(t)te.objectKeys(this.shape).map(i=>{if(te.objectKeys(t).indexOf(i)===-1)n[i]=this.shape[i];else{let r=this.shape[i];for(;r instanceof wt;)r=r._def.innerType;n[i]=r}});else for(const i in this.shape){let r=this.shape[i];for(;r instanceof wt;)r=r._def.innerType;n[i]=r}return new ue({...this._def,shape:()=>n})}keyof(){return Ma(te.objectKeys(this.shape))}}ue.create=(e,t)=>new ue({shape:()=>e,unknownKeys:"strip",catchall:kt.create(),typeName:$.ZodObject,...K(t)});ue.strictCreate=(e,t)=>new ue({shape:()=>e,unknownKeys:"strict",catchall:kt.create(),typeName:$.ZodObject,...K(t)});ue.lazycreate=(e,t)=>new ue({shape:e,unknownKeys:"strip",catchall:kt.create(),typeName:$.ZodObject,...K(t)});class fi extends Y{_parse(t){const{ctx:n}=this._processInputParams(t),i=this._def.options;function r(s){for(const l of s)if(l.result.status==="valid")return l.result;for(const l of s)if(l.result.status==="dirty")return n.common.issues.push(...l.ctx.common.issues),l.result;const a=s.map(l=>new Ot(l.ctx.common.issues));return j(n,{code:k.invalid_union,unionErrors:a}),H}if(n.common.async)return Promise.all(i.map(async s=>{const a={...n,common:{...n.common,issues:[]},parent:null};return{result:await s._parseAsync({data:n.data,path:n.path,parent:a}),ctx:a}})).then(r);{let s;const a=[];for(const o of i){const c={...n,common:{...n.common,issues:[]},parent:null},u=o._parseSync({data:n.data,path:n.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!s&&(s={result:u,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(s)return n.common.issues.push(...s.ctx.common.issues),s.result;const l=a.map(o=>new Ot(o));return j(n,{code:k.invalid_union,unionErrors:l}),H}}get options(){return this._def.options}}fi.create=(e,t)=>new fi({options:e,typeName:$.ZodUnion,...K(t)});const Hi=e=>e instanceof wi?Hi(e.schema):e instanceof ft?Hi(e.innerType()):e instanceof vi?[e.value]:e instanceof _i?e.options:e instanceof bi?Object.keys(e.enum):e instanceof Ai?Hi(e._def.innerType):e instanceof gi?[void 0]:e instanceof pi?[null]:null;class yr extends Y{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==R.object)return j(n,{code:k.invalid_type,expected:R.object,received:n.parsedType}),H;const i=this.discriminator,r=n.data[i],s=this.optionsMap.get(r);return s?n.common.async?s._parseAsync({data:n.data,path:n.path,parent:n}):s._parseSync({data:n.data,path:n.path,parent:n}):(j(n,{code:k.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),H)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,i){const r=new Map;for(const s of n){const a=Hi(s.shape[t]);if(!a)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const l of a){if(r.has(l))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(l)}`);r.set(l,s)}}return new yr({typeName:$.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:r,...K(i)})}}function Hr(e,t){const n=Ft(e),i=Ft(t);if(e===t)return{valid:!0,data:e};if(n===R.object&&i===R.object){const r=te.objectKeys(t),s=te.objectKeys(e).filter(l=>r.indexOf(l)!==-1),a={...e,...t};for(const l of s){const o=Hr(e[l],t[l]);if(!o.valid)return{valid:!1};a[l]=o.data}return{valid:!0,data:a}}else if(n===R.array&&i===R.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let s=0;s<e.length;s++){const a=e[s],l=t[s],o=Hr(a,l);if(!o.valid)return{valid:!1};r.push(o.data)}return{valid:!0,data:r}}else return n===R.date&&i===R.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class mi extends Y{_parse(t){const{status:n,ctx:i}=this._processInputParams(t),r=(s,a)=>{if(Gr(s)||Gr(a))return H;const l=Hr(s.value,a.value);return l.valid?((qr(s)||qr(a))&&n.dirty(),{status:n.value,value:l.data}):(j(i,{code:k.invalid_intersection_types}),H)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([s,a])=>r(s,a)):r(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}mi.create=(e,t,n)=>new mi({left:e,right:t,typeName:$.ZodIntersection,...K(n)});let Gt=class Pa extends Y{_parse(t){const{status:n,ctx:i}=this._processInputParams(t);if(i.parsedType!==R.array)return j(i,{code:k.invalid_type,expected:R.array,received:i.parsedType}),H;if(i.data.length<this._def.items.length)return j(i,{code:k.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),H;!this._def.rest&&i.data.length>this._def.items.length&&(j(i,{code:k.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const r=i.data.map((s,a)=>{const l=this._def.items[a]||this._def.rest;return l?l._parse(new vt(i,s,i.path,a)):null}).filter(s=>!!s);return i.common.async?Promise.all(r).then(s=>Qe.mergeArray(n,s)):Qe.mergeArray(n,r)}get items(){return this._def.items}rest(t){return new Pa({...this._def,rest:t})}};Gt.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Gt({items:e,typeName:$.ZodTuple,rest:null,...K(t)})};class yi extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:i}=this._processInputParams(t);if(i.parsedType!==R.object)return j(i,{code:k.invalid_type,expected:R.object,received:i.parsedType}),H;const r=[],s=this._def.keyType,a=this._def.valueType;for(const l in i.data)r.push({key:s._parse(new vt(i,l,i.path,l)),value:a._parse(new vt(i,i.data[l],i.path,l))});return i.common.async?Qe.mergeObjectAsync(n,r):Qe.mergeObjectSync(n,r)}get element(){return this._def.valueType}static create(t,n,i){return n instanceof Y?new yi({keyType:t,valueType:n,typeName:$.ZodRecord,...K(i)}):new yi({keyType:Dt.create(),valueType:t,typeName:$.ZodRecord,...K(n)})}}class sr extends Y{_parse(t){const{status:n,ctx:i}=this._processInputParams(t);if(i.parsedType!==R.map)return j(i,{code:k.invalid_type,expected:R.map,received:i.parsedType}),H;const r=this._def.keyType,s=this._def.valueType,a=[...i.data.entries()].map(([l,o],c)=>({key:r._parse(new vt(i,l,i.path,[c,"key"])),value:s._parse(new vt(i,o,i.path,[c,"value"]))}));if(i.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const o of a){const c=await o.key,u=await o.value;if(c.status==="aborted"||u.status==="aborted")return H;(c.status==="dirty"||u.status==="dirty")&&n.dirty(),l.set(c.value,u.value)}return{status:n.value,value:l}})}else{const l=new Map;for(const o of a){const c=o.key,u=o.value;if(c.status==="aborted"||u.status==="aborted")return H;(c.status==="dirty"||u.status==="dirty")&&n.dirty(),l.set(c.value,u.value)}return{status:n.value,value:l}}}}sr.create=(e,t,n)=>new sr({valueType:t,keyType:e,typeName:$.ZodMap,...K(n)});class un extends Y{_parse(t){const{status:n,ctx:i}=this._processInputParams(t);if(i.parsedType!==R.set)return j(i,{code:k.invalid_type,expected:R.set,received:i.parsedType}),H;const r=this._def;r.minSize!==null&&i.data.size<r.minSize.value&&(j(i,{code:k.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),n.dirty()),r.maxSize!==null&&i.data.size>r.maxSize.value&&(j(i,{code:k.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),n.dirty());const s=this._def.valueType;function a(o){const c=new Set;for(const u of o){if(u.status==="aborted")return H;u.status==="dirty"&&n.dirty(),c.add(u.value)}return{status:n.value,value:c}}const l=[...i.data.values()].map((o,c)=>s._parse(new vt(i,o,i.path,c)));return i.common.async?Promise.all(l).then(o=>a(o)):a(l)}min(t,n){return new un({...this._def,minSize:{value:t,message:X.toString(n)}})}max(t,n){return new un({...this._def,maxSize:{value:t,message:X.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}un.create=(e,t)=>new un({valueType:e,minSize:null,maxSize:null,typeName:$.ZodSet,...K(t)});class In extends Y{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==R.function)return j(n,{code:k.invalid_type,expected:R.function,received:n.parsedType}),H;function i(l,o){return Xi({data:l,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Ji(),ui].filter(c=>!!c),issueData:{code:k.invalid_arguments,argumentsError:o}})}function r(l,o){return Xi({data:l,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Ji(),ui].filter(c=>!!c),issueData:{code:k.invalid_return_type,returnTypeError:o}})}const s={errorMap:n.common.contextualErrorMap},a=n.data;return this._def.returns instanceof Rn?Ue(async(...l)=>{const o=new Ot([]),c=await this._def.args.parseAsync(l,s).catch(p=>{throw o.addIssue(i(l,p)),o}),u=await a(...c);return await this._def.returns._def.type.parseAsync(u,s).catch(p=>{throw o.addIssue(r(u,p)),o})}):Ue((...l)=>{const o=this._def.args.safeParse(l,s);if(!o.success)throw new Ot([i(l,o.error)]);const c=a(...o.data),u=this._def.returns.safeParse(c,s);if(!u.success)throw new Ot([r(c,u.error)]);return u.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new In({...this._def,args:Gt.create(t).rest(rn.create())})}returns(t){return new In({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,n,i){return new In({args:t||Gt.create([]).rest(rn.create()),returns:n||rn.create(),typeName:$.ZodFunction,...K(i)})}}class wi extends Y{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}wi.create=(e,t)=>new wi({getter:e,typeName:$.ZodLazy,...K(t)});class vi extends Y{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return j(n,{code:k.invalid_literal,expected:this._def.value}),H}return{status:"valid",value:t.data}}get value(){return this._def.value}}vi.create=(e,t)=>new vi({value:e,typeName:$.ZodLiteral,...K(t)});function Ma(e,t){return new _i({values:e,typeName:$.ZodEnum,...K(t)})}class _i extends Y{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),i=this._def.values;return j(n,{expected:te.joinValues(i),received:n.parsedType,code:k.invalid_type}),H}if(this._def.values.indexOf(t.data)===-1){const n=this._getOrReturnCtx(t),i=this._def.values;return j(n,{received:n.data,code:k.invalid_enum_value,options:i}),H}return Ue(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}}_i.create=Ma;class bi extends Y{_parse(t){const n=te.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(t);if(i.parsedType!==R.string&&i.parsedType!==R.number){const r=te.objectValues(n);return j(i,{expected:te.joinValues(r),received:i.parsedType,code:k.invalid_type}),H}if(n.indexOf(t.data)===-1){const r=te.objectValues(n);return j(i,{received:i.data,code:k.invalid_enum_value,options:r}),H}return Ue(t.data)}get enum(){return this._def.values}}bi.create=(e,t)=>new bi({values:e,typeName:$.ZodNativeEnum,...K(t)});class Rn extends Y{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==R.promise&&n.common.async===!1)return j(n,{code:k.invalid_type,expected:R.promise,received:n.parsedType}),H;const i=n.parsedType===R.promise?n.data:Promise.resolve(n.data);return Ue(i.then(r=>this._def.type.parseAsync(r,{path:n.path,errorMap:n.common.contextualErrorMap})))}}Rn.create=(e,t)=>new Rn({type:e,typeName:$.ZodPromise,...K(t)});let ft=class extends Y{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===$.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:i}=this._processInputParams(t),r=this._def.effect||null;if(r.type==="preprocess"){const a=r.transform(i.data);return i.common.async?Promise.resolve(a).then(l=>this._def.schema._parseAsync({data:l,path:i.path,parent:i})):this._def.schema._parseSync({data:a,path:i.path,parent:i})}const s={addIssue:a=>{j(i,a),a.fatal?n.abort():n.dirty()},get path(){return i.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="refinement"){const a=l=>{const o=r.refinement(l,s);if(i.common.async)return Promise.resolve(o);if(o instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(i.common.async===!1){const l=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return l.status==="aborted"?H:(l.status==="dirty"&&n.dirty(),a(l.value),{status:n.value,value:l.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(l=>l.status==="aborted"?H:(l.status==="dirty"&&n.dirty(),a(l.value).then(()=>({status:n.value,value:l.value}))))}if(r.type==="transform")if(i.common.async===!1){const a=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!er(a))return a;const l=r.transform(a.value,s);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:l}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(a=>er(a)?Promise.resolve(r.transform(a.value,s)).then(l=>({status:n.value,value:l})):a);te.assertNever(r)}};ft.create=(e,t,n)=>new ft({schema:e,typeName:$.ZodEffects,effect:t,...K(n)});ft.createWithPreprocess=(e,t,n)=>new ft({schema:t,effect:{type:"preprocess",transform:e},typeName:$.ZodEffects,...K(n)});class wt extends Y{_parse(t){return this._getType(t)===R.undefined?Ue(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}wt.create=(e,t)=>new wt({innerType:e,typeName:$.ZodOptional,...K(t)});class dn extends Y{_parse(t){return this._getType(t)===R.null?Ue(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}dn.create=(e,t)=>new dn({innerType:e,typeName:$.ZodNullable,...K(t)});class Ai extends Y{_parse(t){const{ctx:n}=this._processInputParams(t);let i=n.data;return n.parsedType===R.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}Ai.create=(e,t)=>new Ai({innerType:e,typeName:$.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...K(t)});class ar extends Y{_parse(t){const{ctx:n}=this._processInputParams(t),i=this._def.innerType._parse({data:n.data,path:n.path,parent:n});return tr(i)?i.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.defaultValue()})):{status:"valid",value:i.status==="valid"?i.value:this._def.defaultValue()}}removeDefault(){return this._def.innerType}}ar.create=(e,t)=>new ar({innerType:e,typeName:$.ZodCatch,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...K(t)});class or extends Y{_parse(t){if(this._getType(t)!==R.nan){const n=this._getOrReturnCtx(t);return j(n,{code:k.invalid_type,expected:R.nan,received:n.parsedType}),H}return{status:"valid",value:t.data}}}or.create=e=>new or({typeName:$.ZodNaN,...K(e)});const Cu=Symbol("zod_brand");class La extends Y{_parse(t){const{ctx:n}=this._processInputParams(t),i=n.data;return this._def.type._parse({data:i,path:n.path,parent:n})}unwrap(){return this._def.type}}class Ti extends Y{_parse(t){const{status:n,ctx:i}=this._processInputParams(t);if(i.common.async)return(async()=>{const r=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return r.status==="aborted"?H:r.status==="dirty"?(n.dirty(),ka(r.value)):this._def.out._parseAsync({data:r.value,path:i.path,parent:i})})();{const r=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return r.status==="aborted"?H:r.status==="dirty"?(n.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:i.path,parent:i})}}static create(t,n){return new Ti({in:t,out:n,typeName:$.ZodPipeline})}}const Ra=(e,t={},n)=>e?Ln.create().superRefine((i,r)=>{if(!e(i)){const s=typeof t=="function"?t(i):t,a=typeof s=="string"?{message:s}:s;r.addIssue({code:"custom",...a,fatal:n})}}):Ln.create(),Ou={object:ue.lazycreate};var $;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline"})($||($={}));const Iu=(e,t={message:`Input not instance of ${e.name}`})=>Ra(n=>n instanceof e,t,!0),Ne=Dt.create,pe=Vt.create,Du=or.create,ku=di.create,wr=hi.create,Pu=ln.create,Mu=nr.create,Lu=gi.create,Ru=pi.create,Na=Ln.create,Nu=rn.create,Uu=kt.create,Bu=ir.create,ju=pt.create,ot=ue.create,Wu=ue.strictCreate,rs=fi.create,Fu=yr.create,$u=mi.create,Vu=Gt.create,Ua=yi.create,Gu=sr.create,qu=un.create,Hu=In.create,zu=wi.create,Zu=vi.create,Nn=_i.create,Yu=bi.create,Ku=Rn.create,Hs=ft.create,Qu=wt.create,Ju=dn.create,Xu=ft.createWithPreprocess,ed=Ti.create,td=()=>Ne().optional(),nd=()=>pe().optional(),id=()=>wr().optional(),rd={string:e=>Dt.create({...e,coerce:!0}),number:e=>Vt.create({...e,coerce:!0}),boolean:e=>hi.create({...e,coerce:!0}),bigint:e=>di.create({...e,coerce:!0}),date:e=>ln.create({...e,coerce:!0})},sd=H;var at=Object.freeze({__proto__:null,defaultErrorMap:ui,setErrorMap:bu,getErrorMap:Ji,makeIssue:Xi,EMPTY_PATH:Au,addIssueToContext:j,ParseStatus:Qe,INVALID:H,DIRTY:ka,OK:Ue,isAborted:Gr,isDirty:qr,isValid:er,isAsync:tr,get util(){return te},ZodParsedType:R,getParsedType:Ft,ZodType:Y,ZodString:Dt,ZodNumber:Vt,ZodBigInt:di,ZodBoolean:hi,ZodDate:ln,ZodSymbol:nr,ZodUndefined:gi,ZodNull:pi,ZodAny:Ln,ZodUnknown:rn,ZodNever:kt,ZodVoid:ir,ZodArray:pt,get objectUtil(){return rr},ZodObject:ue,ZodUnion:fi,ZodDiscriminatedUnion:yr,ZodIntersection:mi,ZodTuple:Gt,ZodRecord:yi,ZodMap:sr,ZodSet:un,ZodFunction:In,ZodLazy:wi,ZodLiteral:vi,ZodEnum:_i,ZodNativeEnum:bi,ZodPromise:Rn,ZodEffects:ft,ZodTransformer:ft,ZodOptional:wt,ZodNullable:dn,ZodDefault:Ai,ZodCatch:ar,ZodNaN:or,BRAND:Cu,ZodBranded:La,ZodPipeline:Ti,custom:Ra,Schema:Y,ZodSchema:Y,late:Ou,get ZodFirstPartyTypeKind(){return $},coerce:rd,any:Na,array:ju,bigint:ku,boolean:wr,date:Pu,discriminatedUnion:Fu,effect:Hs,enum:Nn,function:Hu,instanceof:Iu,intersection:$u,lazy:zu,literal:Zu,map:Gu,nan:Du,nativeEnum:Yu,never:Uu,null:Ru,nullable:Ju,number:pe,object:ot,oboolean:id,onumber:nd,optional:Qu,ostring:td,pipeline:ed,preprocess:Xu,promise:Ku,record:Ua,set:qu,strictObject:Wu,string:Ne,symbol:Mu,transformer:Hs,tuple:Vu,undefined:Lu,union:rs,unknown:Nu,void:Bu,NEVER:sd,ZodIssueCode:k,quotelessJson:vu,ZodError:Ot});const cr=()=>Ne().uuid(),ad=/^(?=.{1,255}$)[0-9A-Za-z_](?:(?:[0-9A-Za-z_]|-){0,61}[0-9A-Za-z_])?(?:\.[0-9A-Za-z_](?:(?:[0-9A-Za-z_]|-){0,61}[0-9A-Za-z_])?)*\.?$/,Ba=()=>Ne().regex(ad);ot({id:cr(),host:Ba(),startedAt:pe().positive(),endedAt:pe().nullable().optional()}).strict();const ja=ot({id:cr(),sessionId:cr(),adUrl:Ne().url(),timestamp:pe().positive().describe("The time in ms since 1970 that this ad was seen at")}).strict(),od=ja.extend({type:Nn(["image"]),additionalDetails:ot({width:pe().nonnegative(),height:pe().nonnegative()})}).strict(),cd=ja.extend({type:Nn(["iframe"]),additionalDetails:ot({width:pe().nonnegative(),height:pe().nonnegative()})}).strict();rs([od,cd]);const ss=cr,Wa=Ba,as=()=>wr().nullable().optional(),os=()=>wr().nullable().optional();ot({id:ss(),host:Wa(),startedAt:pe().positive(),endedAt:pe().nullable().optional(),imported:as(),generated:os()}).strict();const Fa=ot({id:Ne(),sessionId:ss(),timestamp:pe().positive().describe("The time in ms since 1970 that this ad was seen at"),imported:as()}).strict(),ld=Fa.extend({type:Nn(["basic-display"]),details:ot({type:Nn(["image","iframe"]),url:Ne().url().describe("The URL the ad is accessible at"),width:pe().nonnegative(),height:pe().nonnegative()}).strict()}),ud=()=>Ua(Ne(),Na()),dd=Fa.extend({type:Nn(["youtube/hulu/vast","pathmatics"]),details:ud()}),hd=rs([ld,dd]),cs=ss,ls=as,gd=os,us=()=>Wa().describe("The mobile app bundle ID or website hostname"),pd=ot({id:cs(),appId:us(),createdBy:Ne({description:"The install id that created the session"}),startedAt:pe().positive(),endedAt:pe(),imported:ls(),generated:gd()}).strict(),fd=ot({id:cs(),appId:us(),createdBy:Ne(),startedAt:pe().positive(),endedAt:pe().nullable().optional(),imported:ls(),generated:os()}).strict(),md=hd,$a=cs,Va=ls,Ga=us,yd=pd,wd=fd,vd=ot({id:$a(),appId:Ga(),path:Ne().startsWith("/"),referrer:Ne().nullish(),createdBy:Ne(),startedAt:pe().positive(),endedAt:pe(),imported:Va()}).strict(),bd=ot({id:$a(),appId:Ga(),path:Ne().startsWith("/"),referrer:Ne().nullish(),createdBy:Ne(),startedAt:pe().positive(),endedAt:pe().nullish(),imported:Va()}).strict(),Ad=md,Sd=yd,zs=wd,_d=vd,Td=bd,qa=Ad;class ds{constructor(t,n){this.db=t,this.storeName=n}async deleteAll(){const t=(await this.db).transaction(this.storeName,"readwrite");let n=await t.objectStore(this.storeName).openCursor();for(;n;)await n.delete(),n=await n.continue();await t.done}async findAll(){return await(await this.db).getAll(this.storeName)}}const ai=class extends ds{constructor(e){super(e.db,ai.STORE_NAME_LATEST),this.config=e}async findAds(e,t){return await(await this.db).getAllFromIndex(this.storeName,ai.INDEX_TIMESTAMP,IDBKeyRange.bound(e,t,!1,!0))}async findAdsForSession(e){return await(await this.db).getAllFromIndex(this.storeName,ai.INDEX_SESSION_ID,e)}async upsertAd(e){var t,n;const i=await this.db,r=qa.parse(e);return(n=(t=this.config).onAdUpserted)==null||n.call(t,r),await i.put(this.storeName,r),r}};let be=ai;be.STORE_NAME_1="ads";be.STORE_NAME_2="ads-2";be.STORE_NAME_LATEST=ai.STORE_NAME_2;be.INDEX_SESSION_ID="idx_ad_sessionId";be.INDEX_TIMESTAMP="idx_ad_timestamp";let Ui;const xd=new Uint8Array(16);function Ed(){if(!Ui&&(Ui=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ui))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ui(xd)}const ke=[];for(let e=0;e<256;++e)ke.push((e+256).toString(16).slice(1));function Cd(e,t=0){return(ke[e[t+0]]+ke[e[t+1]]+ke[e[t+2]]+ke[e[t+3]]+"-"+ke[e[t+4]]+ke[e[t+5]]+"-"+ke[e[t+6]]+ke[e[t+7]]+"-"+ke[e[t+8]]+ke[e[t+9]]+"-"+ke[e[t+10]]+ke[e[t+11]]+ke[e[t+12]]+ke[e[t+13]]+ke[e[t+14]]+ke[e[t+15]]).toLowerCase()}const Od=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Zs={randomUUID:Od};function Si(e,t,n){if(Zs.randomUUID&&!t&&!e)return Zs.randomUUID();e=e||{};const i=e.random||(e.rng||Ed)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){n=n||0;for(let r=0;r<16;++r)t[n+r]=i[r];return t}return Cd(i)}const hs=-1;function Id(e){var t;return{id:e.id,appId:e.appId,path:e.path,referrer:e.referrer,createdBy:e.createdBy,endedAt:(t=e.endedAt)!=null?t:hs,startedAt:e.startedAt,imported:e.imported}}function kr(e){return{id:e.id,appId:e.appId,path:e.path,referrer:e.referrer,createdBy:e.createdBy,endedAt:e.endedAt===hs?null:e.endedAt,startedAt:e.startedAt,imported:e.imported}}const oi=class extends ds{constructor(e){super(e.db,oi.STORE_NAME_LATEST),this.config=e}async startPageView(e){const t=await this.db,n=Td.parse({...e,id:Si(),createdBy:await this.config.getInstallId(),endedAt:void 0}),i=Id(n);return await t.add(this.storeName,i),n}async endPageView(e,t){const n=await this.db,i=await n.get(this.storeName,e.id);if(i==null)throw Error(`Cannot update: PageView not found with id=${e.id}`);const r={...i,endedAt:t};return await n.put(this.storeName,r),kr(r)}async getActivePageViews(){return(await(await this.db).getAllFromIndex(this.storeName,oi.INDEX_ENDED_AT,hs)).map(kr)}async findPageViewsByEndedAt(e,t){return(await(await this.db).getAllFromIndex(this.storeName,oi.INDEX_ENDED_AT,IDBKeyRange.bound(e,t,!1,!0))).map(kr)}async deleteAllGeneratedPageViews(){const e=(await this.db).transaction(this.storeName,"readwrite");let t=await e.store.openCursor();for(;t;)t.value.imported&&await t.delete(),t=await t.continue();await e.done}};let It=oi;It.STORE_NAME_1="page_views";It.STORE_NAME_LATEST=oi.STORE_NAME_1;It.INDEX_ENDED_AT="idx_page_view_endedAt";It.INDEX_STARTED_AT="idx_page_view_startedAt";function Ha(e,t,n,i){function r(s){return s instanceof n?s:new n(function(a){a(s)})}return new(n||(n=Promise))(function(s,a){function l(u){try{c(i.next(u))}catch(p){a(p)}}function o(u){try{c(i.throw(u))}catch(p){a(p)}}function c(u){u.done?s(u.value):r(u.value).then(l,o)}c((i=i.apply(e,t||[])).next())})}function za(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(c){return function(u){return o([c,u])}}function o(c){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(n=0)),n;)try{if(i=1,r&&(s=c[0]&2?r.return:c[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,c[1])).done)return s;switch(r=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,r=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(u){c=[6,u],r=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var Dd=new Error("request for lock canceled"),kd=function(){function e(t,n){n===void 0&&(n=Dd),this._value=t,this._cancelError=n,this._weightedQueues=[],this._weightedWaiters=[]}return e.prototype.acquire=function(t){var n=this;if(t===void 0&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise(function(i,r){n._weightedQueues[t-1]||(n._weightedQueues[t-1]=[]),n._weightedQueues[t-1].push({resolve:i,reject:r}),n._dispatch()})},e.prototype.runExclusive=function(t,n){return n===void 0&&(n=1),Ha(this,void 0,void 0,function(){var i,r,s;return za(this,function(a){switch(a.label){case 0:return[4,this.acquire(n)];case 1:i=a.sent(),r=i[0],s=i[1],a.label=2;case 2:return a.trys.push([2,,4,5]),[4,t(r)];case 3:return[2,a.sent()];case 4:return s(),[7];case 5:return[2]}})})},e.prototype.waitForUnlock=function(t){var n=this;if(t===void 0&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise(function(i){n._weightedWaiters[t-1]||(n._weightedWaiters[t-1]=[]),n._weightedWaiters[t-1].push(i),n._dispatch()})},e.prototype.isLocked=function(){return this._value<=0},e.prototype.getValue=function(){return this._value},e.prototype.setValue=function(t){this._value=t,this._dispatch()},e.prototype.release=function(t){if(t===void 0&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));this._value+=t,this._dispatch()},e.prototype.cancel=function(){var t=this;this._weightedQueues.forEach(function(n){return n.forEach(function(i){return i.reject(t._cancelError)})}),this._weightedQueues=[]},e.prototype._dispatch=function(){for(var t,n=this._value;n>0;n--){var i=(t=this._weightedQueues[n-1])===null||t===void 0?void 0:t.shift();if(i){var r=this._value,s=n;this._value-=n,n=this._value+1,i.resolve([r,this._newReleaser(s)])}}this._drainUnlockWaiters()},e.prototype._newReleaser=function(t){var n=this,i=!1;return function(){i||(i=!0,n.release(t))}},e.prototype._drainUnlockWaiters=function(){for(var t=this._value;t>0;t--)!this._weightedWaiters[t-1]||(this._weightedWaiters[t-1].forEach(function(n){return n()}),this._weightedWaiters[t-1]=[])},e}(),Za=function(){function e(t){this._semaphore=new kd(1,t)}return e.prototype.acquire=function(){return Ha(this,void 0,void 0,function(){var t,n;return za(this,function(i){switch(i.label){case 0:return[4,this._semaphore.acquire()];case 1:return t=i.sent(),n=t[1],[2,n]}})})},e.prototype.runExclusive=function(t){return this._semaphore.runExclusive(function(){return t()})},e.prototype.isLocked=function(){return this._semaphore.isLocked()},e.prototype.waitForUnlock=function(){return this._semaphore.waitForUnlock()},e.prototype.release=function(){this._semaphore.isLocked()&&this._semaphore.release()},e.prototype.cancel=function(){return this._semaphore.cancel()},e}(),ti=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ya={exports:{}};(function(e,t){(function(n,i){i(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ti,function(n){var i,r;if(!((r=(i=globalThis.chrome)==null?void 0:i.runtime)!=null&&r.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const s="The message port closed before a response was received.",a=l=>{const o={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(o).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class c extends WeakMap{constructor(_,C=void 0){super(C),this.createItem=_}get(_){return this.has(_)||this.set(_,this.createItem(_)),super.get(_)}}const u=w=>w&&typeof w=="object"&&typeof w.then=="function",p=(w,_)=>(...C)=>{l.runtime.lastError?w.reject(new Error(l.runtime.lastError.message)):_.singleCallbackArg||C.length<=1&&_.singleCallbackArg!==!1?w.resolve(C[0]):w.resolve(C)},d=w=>w==1?"argument":"arguments",f=(w,_)=>function(C,...M){if(M.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${d(_.minArgs)} for ${w}(), got ${M.length}`);if(M.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${d(_.maxArgs)} for ${w}(), got ${M.length}`);return new Promise((Z,b)=>{if(_.fallbackToNoCallback)try{C[w](...M,p({resolve:Z,reject:b},_))}catch(L){console.warn(`${w} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,L),C[w](...M),_.fallbackToNoCallback=!1,_.noCallback=!0,Z()}else _.noCallback?(C[w](...M),Z()):C[w](...M,p({resolve:Z,reject:b},_))})},g=(w,_,C)=>new Proxy(_,{apply(M,Z,b){return C.call(Z,w,...b)}});let m=Function.call.bind(Object.prototype.hasOwnProperty);const v=(w,_={},C={})=>{let M=Object.create(null),Z={has(L,A){return A in w||A in M},get(L,A,G){if(A in M)return M[A];if(!(A in w))return;let W=w[A];if(typeof W=="function")if(typeof _[A]=="function")W=g(w,w[A],_[A]);else if(m(C,A)){let ie=f(A,C[A]);W=g(w,w[A],ie)}else W=W.bind(w);else if(typeof W=="object"&&W!==null&&(m(_,A)||m(C,A)))W=v(W,_[A],C[A]);else if(m(C,"*"))W=v(W,_[A],C["*"]);else return Object.defineProperty(M,A,{configurable:!0,enumerable:!0,get(){return w[A]},set(ie){w[A]=ie}}),W;return M[A]=W,W},set(L,A,G,W){return A in M?M[A]=G:w[A]=G,!0},defineProperty(L,A,G){return Reflect.defineProperty(M,A,G)},deleteProperty(L,A){return Reflect.deleteProperty(M,A)}},b=Object.create(w);return new Proxy(b,Z)},D=w=>({addListener(_,C,...M){_.addListener(w.get(C),...M)},hasListener(_,C){return _.hasListener(w.get(C))},removeListener(_,C){_.removeListener(w.get(C))}}),U=new c(w=>typeof w!="function"?w:function(_){const C=v(_,{},{getContent:{minArgs:0,maxArgs:0}});w(C)}),E=new c(w=>typeof w!="function"?w:function(_,C,M){let Z=!1,b,L=new Promise(ie=>{b=function(Q){Z=!0,ie(Q)}}),A;try{A=w(_,C,b)}catch(ie){A=Promise.reject(ie)}const G=A!==!0&&u(A);return A!==!0&&!G&&!Z?!1:((ie=>{ie.then(Q=>{M(Q)},Q=>{let Se;Q&&(Q instanceof Error||typeof Q.message=="string")?Se=Q.message:Se="An unexpected error occurred",M({__mozWebExtensionPolyfillReject__:!0,message:Se})}).catch(Q=>{console.error("Failed to send onMessage rejected reply",Q)})})(G?A:L),!0)}),O=({reject:w,resolve:_},C)=>{l.runtime.lastError?l.runtime.lastError.message===s?_():w(new Error(l.runtime.lastError.message)):C&&C.__mozWebExtensionPolyfillReject__?w(new Error(C.message)):_(C)},B=(w,_,C,...M)=>{if(M.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${d(_.minArgs)} for ${w}(), got ${M.length}`);if(M.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${d(_.maxArgs)} for ${w}(), got ${M.length}`);return new Promise((Z,b)=>{const L=O.bind(null,{resolve:Z,reject:b});M.push(L),C.sendMessage(...M)})},T={devtools:{network:{onRequestFinished:D(U)}},runtime:{onMessage:D(E),onMessageExternal:D(E),sendMessage:B.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:B.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},P={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return o.privacy={network:{"*":P},services:{"*":P},websites:{"*":P}},v(l,T,o)};n.exports=a(chrome)}else n.exports=globalThis.browser})})(Ya);const ce=Ya.exports;class Pd{constructor(t,n=Date.now()){this.logMethod=t,this.startedAt=n}log(t){const n=Date.now()-this.startedAt;this.logMethod(t.replace(/\{duration\}/g,`${(n/1e3).toFixed(3)}s`))}}const Un=1e3,gs=60*Un,Md=60*gs;function lr(e){return Math.round(e/1e3)}function Ld(){return new Promise(e=>setTimeout(e,0))}function Rd(e){const t=new Za;return(...n)=>t.runExclusive(()=>e(...n))}async function ps(e){return(await ce.storage.local.get(e))[e]}async function ci(e,t){t===void 0?await ce.storage.local.remove(e):await ce.storage.local.set({[e]:t})}function Nd(e,t){const n=typeof t=="string",i=r=>n?r[t]:t(r);return e.reduce((r,s)=>{var a,l;const o=i(s);return r[o]=(l=(a=r[o])==null?void 0:a.concat(s))!=null?l:[s],r},{})}function Ud(e,t){const n=typeof t=="string",i=r=>n?r[t]:t(r);return e.reduce((r,s)=>{const a=i(s);return r[a]=s,r},{})}function Bd(){let e,t;return[new Promise((n,i)=>{e=n,t=i}),e,t]}function jd(e){return e.state!=="docked"&&e.state!=="minimized"}function Wd(e,t,n,i){return i&&e.audible||e.active&&t.focused&&jd(t)&&n}function Ka(e){const t=e.objectStoreNames.length,n=[];for(let i=0;i<t;i++){const r=e.objectStoreNames.item(i);r&&n.push(r)}return n}const fs=-1;function Ys(e){var t;return{id:e.id,appId:e.appId,createdBy:e.createdBy,endedAt:(t=e.endedAt)!=null?t:fs,startedAt:e.startedAt,imported:e.imported,generated:e.generated}}function Jt(e){return{id:e.id,appId:e.appId,createdBy:e.createdBy,endedAt:e.endedAt===fs?null:e.endedAt,startedAt:e.startedAt,imported:e.imported,generated:e.generated}}const Et=class extends ds{constructor(e){super(e.db,Et.STORE_NAME_LATEST),this.config=e}async startSession(e){const t=await this.db,n=zs.parse({...e,id:Si(),createdBy:await this.config.getInstallId(),endedAt:void 0}),i=Ys(n);return await t.add(this.storeName,i),n}async createSessions(e){const t=await this.db,n=await this.config.getInstallId(),i=t.transaction(Et.STORE_NAME_LATEST,"readwrite"),r=i.objectStore(Et.STORE_NAME_LATEST),s=e.map(l=>zs.parse({...l,id:Si(),createdBy:n})),a=s.map(Ys);return await Promise.all([...a.map(l=>r.add(l)),i.done]),s}async endSession(e,t){var n,i;const r=await this.db;t-e.startedAt>=6*Md&&((i=(n=this.config).onLongSessionDetected)==null||i.call(n,e,t),t=e.startedAt+10*gs);const s=await r.get(this.storeName,e.id);if(s==null)throw Error(`Cannot update: Session not found with id=${e.id}`);const a={...s,endedAt:t};return await r.put(this.storeName,a),Jt(a)}async findAllSessions(){return(await super.findAll()).map(Jt)}async findSessions(e,t){return(await(await this.db).getAllFromIndex(this.storeName,Et.INDEX_STARTED_AT,IDBKeyRange.bound(e,t,!1,!0))).map(Jt)}async findSessionsByEndedAt(e,t){return(await(await this.db).getAllFromIndex(this.storeName,Et.INDEX_ENDED_AT,IDBKeyRange.bound(e,t,!1,!0))).map(Jt)}async findOldestSession(){const e=(await(await this.db).getAllFromIndex(this.storeName,Et.INDEX_STARTED_AT,IDBKeyRange.lowerBound(0,!0))).shift();return e?Jt(e):void 0}async getSession(e){const t=await(await this.db).get(this.storeName,e);if(t==null)throw Error(`No session with id=${e} was found`);return Jt(t)}async getActiveSessions(){return(await(await this.db).getAllFromIndex(this.storeName,Et.INDEX_ENDED_AT,fs)).map(Jt)}async deleteAllGeneratedSessions(){const e=(await this.db).transaction(this.storeName,"readwrite");let t=await e.store.openCursor();for(;t;){const n=t.value;(n.imported||n.generated)&&await t.delete(),t=await t.continue()}await e.done}};let ye=Et;ye.STORE_NAME_1="sessions";ye.STORE_NAME_2="sessions_2";ye.STORE_NAME_LATEST=Et.STORE_NAME_2;ye.INDEX_ENDED_AT="idx_session_endedAt";ye.INDEX_STARTED_AT="idx_session_startedAt";var Me=(e=>(e[e.V2=2]="V2",e[e.V3=3]="V3",e[e.V4=4]="V4",e[e.V5=5]="V5",e[e.V6=6]="V6",e[e.V7=7]="V7",e[e.V8=8]="V8",e))(Me||{});const Fd=at.object({version:at.nativeEnum(Me),stores:at.object({[ye.STORE_NAME_LATEST]:at.array(Sd).optional(),[It.STORE_NAME_LATEST]:at.array(_d).optional(),[be.STORE_NAME_LATEST]:at.array(qa).optional()})});at.object({version:at.nativeEnum(Me),stores:at.record(at.string(),at.array(at.any()))});async function $d(e){const t=await e,n={version:t.version,stores:{}},i=Ka(t),r=t.transaction(i,"readonly");for(const s of i){const a=await r.objectStore(s).getAll();a.forEach(l=>{delete l.imported}),n.stores[s]=a}return await r.done,n}function Vd(e,t){return{...e,id:Si(),sessionId:t}}function Gd(e){return{...e,id:Si()}}function Qa(e){return{id:e.id,sessionId:e.sessionId,timestamp:e.timestamp,type:"basic-display",details:{type:e.type,height:e.additionalDetails.height,width:e.additionalDetails.width,url:e.adUrl}}}function vr(e,t){var n;return{id:e.id,appId:e.host,createdBy:t,startedAt:e.startedAt,endedAt:(n=e.endedAt)!=null?n:-1,imported:e.imported,generated:e.generated}}async function qd({dbPromise:e,usageBackup:t,logger:n,getInstallId:i}){const r=await e;n==null||n.debug("[import-backup] Importing...",t);const s=await i(),a=await Fd.parseAsync(await Ja(t,r.version,{installId:s})),l=Ka(r),o=r.transaction(l,"readwrite");for(const c of l){const u=a.stores[c];if(u!=null&&u.length){const p=o.objectStore(c);for(const d of u)n==null||n.debug(`[import-backup]: ${c}:`,d),await p.put({...d,imported:!0})}}await o.done}const Pr=e=>t=>({...t,version:e}),Hd=()=>e=>e,zd=e=>{var t;return{version:Me.V4,stores:{[ye.STORE_NAME_2]:e.stores[ye.STORE_NAME_2],[be.STORE_NAME_2]:(t=e.stores[be.STORE_NAME_2])==null?void 0:t.map(Qa)}}},Zd=(e,{installId:t})=>{var n;return{version:Me.V6,stores:{[ye.STORE_NAME_2]:(n=e.stores[ye.STORE_NAME_2])==null?void 0:n.map(i=>vr(i,t)),[be.STORE_NAME_2]:e.stores[be.STORE_NAME_2]}}},Yd=(e,{installId:t})=>{var n;return{version:Me.V7,stores:{[ye.STORE_NAME_2]:(n=e.stores[ye.STORE_NAME_2])==null?void 0:n.map(i=>"host"in i?vr(i,t):i),[be.STORE_NAME_2]:e.stores[be.STORE_NAME_2]}}},Kd={[Me.V2]:Pr(Me.V3),[Me.V3]:zd,[Me.V4]:Pr(Me.V5),[Me.V5]:Zd,[Me.V6]:Yd,[Me.V7]:Pr(Me.V8),[Me.V8]:Hd()};async function Ja(e,t,n){if(e.version===t)return e;const i=Kd[e.version];if(i==null)throw Error(`Failed to upgrade backup version ${e.version}, version not supported`);const r=await i(e,n);return await Ja(r,t,n)}const Qd=(e,t)=>t.some(n=>e instanceof n);let Ks,Qs;function Jd(){return Ks||(Ks=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xd(){return Qs||(Qs=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Xa=new WeakMap,zr=new WeakMap,eo=new WeakMap,Mr=new WeakMap,ms=new WeakMap;function eh(e){const t=new Promise((n,i)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",a)},s=()=>{n($t(e.result)),r()},a=()=>{i(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",a)});return t.then(n=>{n instanceof IDBCursor&&Xa.set(n,e)}).catch(()=>{}),ms.set(t,e),t}function th(e){if(zr.has(e))return;const t=new Promise((n,i)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",a),e.removeEventListener("abort",a)},s=()=>{n(),r()},a=()=>{i(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",a),e.addEventListener("abort",a)});zr.set(e,t)}let Zr={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return zr.get(e);if(t==="objectStoreNames")return e.objectStoreNames||eo.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return $t(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function nh(e){Zr=e(Zr)}function ih(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const i=e.call(Lr(this),t,...n);return eo.set(i,t.sort?t.sort():[t]),$t(i)}:Xd().includes(e)?function(...t){return e.apply(Lr(this),t),$t(Xa.get(this))}:function(...t){return $t(e.apply(Lr(this),t))}}function rh(e){return typeof e=="function"?ih(e):(e instanceof IDBTransaction&&th(e),Qd(e,Jd())?new Proxy(e,Zr):e)}function $t(e){if(e instanceof IDBRequest)return eh(e);if(Mr.has(e))return Mr.get(e);const t=rh(e);return t!==e&&(Mr.set(e,t),ms.set(t,e)),t}const Lr=e=>ms.get(e);function sh(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const a=indexedDB.open(e,t),l=$t(a);return i&&a.addEventListener("upgradeneeded",o=>{i($t(a.result),o.oldVersion,o.newVersion,$t(a.transaction),o)}),n&&a.addEventListener("blocked",o=>n(o.oldVersion,o.newVersion,o)),l.then(o=>{s&&o.addEventListener("close",()=>s()),r&&o.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),l}const ah=["get","getKey","getAll","getAllKeys","count"],oh=["put","add","delete","clear"],Rr=new Map;function Js(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(Rr.get(t))return Rr.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=oh.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||ah.includes(n)))return;const s=async function(a,...l){const o=this.transaction(a,r?"readwrite":"readonly");let c=o.store;return i&&(c=c.index(l.shift())),(await Promise.all([c[n](...l),r&&o.done]))[0]};return Rr.set(t,s),s}nh(e=>({...e,get:(t,n,i)=>Js(t,n)||e.get(t,n,i),has:(t,n)=>!!Js(t,n)||e.has(t,n)}));async function ch({db:e,tx:t}){const n=t.objectStore(ye.STORE_NAME_1),i=t.objectStore(ye.STORE_NAME_2),r=t.objectStore(be.STORE_NAME_1),s=t.objectStore(be.STORE_NAME_2),a=await n.index(ye.INDEX_STARTED_AT).getAll();for(const l of a){const o=Gd(l);await i.add(o);const c=await r.index(be.INDEX_SESSION_ID).getAll(l.id);for(const u of c){const p=Vd(u,o.id);await s.add(p)}}e.deleteObjectStore(n.name),e.deleteObjectStore(r.name)}async function lh({tx:e}){const t=e.objectStore(be.STORE_NAME_2),n=await t.getAll();for(const i of n){const r=Qa(i);await t.put(r)}}async function uh({tx:e,ctx:t}){const n=e.objectStore(ye.STORE_NAME_2),i=await n.getAll();for(const r of i){const s=vr(r,t.installId);await n.put(s)}}async function dh({tx:e,ctx:t}){const n=e.objectStore(ye.STORE_NAME_2),i=await n.getAll();for(const r of i)if("host"in r){const s=vr(r,t.installId);await n.put(s)}}const Bi=()=>{},hh=[Bi,Bi,Bi,ch,lh,Bi,uh,dh];async function gh(e,{logger:t}){if(e.oldVersion===0||e.newVersion==null){t==null||t.debug("[usage-database] Skipping migrations for new databases",{oldVersion:e.oldVersion,newVersion:e.newVersion});return}const n=e.oldVersion+1,i=e.newVersion,r=hh.slice(n,i+1);if(r.length===0){t==null||t.log("[usage-database] No migrations to run");return}t==null||t.log(`[usage-database] Running migrations ${n} -> ${i}`);for(const s of r)await s(e)}function bn(e,t,n,i){return e.indexNames.contains(t)?e.index(t):e.createIndex(t,n,i)}function Nr({db:e,tx:t},n,i){return e.objectStoreNames.contains(n)?t.objectStore(n):e.createObjectStore(n,i)}const ph=Me.V8;async function fh(e){const t=await e.getInstallId();return sh("UsageSdkDb",ph,{async upgrade(n,i,r,s){const a={db:n,oldVersion:i,newVersion:r,tx:s,ctx:{installId:t}};mh(a),await gh(a,{logger:null})}})}function mh(e){const t=Nr(e,ye.STORE_NAME_LATEST,{keyPath:"id"});bn(t,ye.INDEX_STARTED_AT,"startedAt",{unique:!1}),bn(t,ye.INDEX_ENDED_AT,"endedAt",{unique:!1});const n=Nr(e,It.STORE_NAME_LATEST,{keyPath:"id"});bn(n,It.INDEX_STARTED_AT,"startedAt",{unique:!1}),bn(n,It.INDEX_ENDED_AT,"endedAt",{unique:!1});const i=Nr(e,be.STORE_NAME_LATEST,{keyPath:"id"});bn(i,be.INDEX_SESSION_ID,"sessionId",{unique:!1}),bn(i,be.INDEX_TIMESTAMP,"timestamp",{unique:!1})}function yh(e){const t=fh(e),n=e.logger===void 0?console:e.logger;return{indexedDb:t,sessionsRepo:new ye({db:t,...e}),pageViewsRepo:new It({db:t,...e}),adsRepo:new be({db:t,...e}),exportBackup:()=>$d(t),importBackup:i=>qd({dbPromise:t,usageBackup:i,getInstallId:e.getInstallId,logger:n})}}var Yr={exports:{}};(function(e,t){var n=200,i="__lodash_hash_undefined__",r=1,s=2,a=9007199254740991,l="[object Arguments]",o="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",p="[object Date]",d="[object Error]",f="[object Function]",g="[object GeneratorFunction]",m="[object Map]",v="[object Number]",D="[object Null]",U="[object Object]",E="[object Promise]",O="[object Proxy]",B="[object RegExp]",T="[object Set]",P="[object String]",w="[object Symbol]",_="[object Undefined]",C="[object WeakMap]",M="[object ArrayBuffer]",Z="[object DataView]",b="[object Float32Array]",L="[object Float64Array]",A="[object Int8Array]",G="[object Int16Array]",W="[object Int32Array]",ie="[object Uint8Array]",Q="[object Uint8ClampedArray]",Se="[object Uint16Array]",At="[object Uint32Array]",hn=/[\\^$.*+?()[\]{}|]/g,gn=/^\[object .+?Constructor\]$/,xi=/^(?:0|[1-9]\d*)$/,re={};re[b]=re[L]=re[A]=re[G]=re[W]=re[ie]=re[Q]=re[Se]=re[At]=!0,re[l]=re[o]=re[M]=re[u]=re[Z]=re[p]=re[d]=re[f]=re[m]=re[v]=re[U]=re[B]=re[T]=re[P]=re[C]=!1;var pn=typeof ti=="object"&&ti&&ti.Object===Object&&ti,Wn=typeof self=="object"&&self&&self.Object===Object&&self,Je=pn||Wn||Function("return this")(),Fn=t&&!t.nodeType&&t,$n=Fn&&!0&&e&&!e.nodeType&&e,Ei=$n&&$n.exports===Fn,Pt=Ei&&pn.process,Vn=function(){try{return Pt&&Pt.binding&&Pt.binding("util")}catch{}}(),Mt=Vn&&Vn.isTypedArray;function Ar(h,y){for(var x=-1,N=h==null?0:h.length,le=0,z=[];++x<N;){var ge=h[x];y(ge,x,h)&&(z[le++]=ge)}return z}function Gn(h,y){for(var x=-1,N=y.length,le=h.length;++x<N;)h[le+x]=y[x];return h}function qt(h,y){for(var x=-1,N=h==null?0:h.length;++x<N;)if(y(h[x],x,h))return!0;return!1}function qn(h,y){for(var x=-1,N=Array(h);++x<h;)N[x]=y(x);return N}function Sr(h){return function(y){return h(y)}}function Ci(h,y){return h.has(y)}function Oi(h,y){return h==null?void 0:h[y]}function ze(h){var y=-1,x=Array(h.size);return h.forEach(function(N,le){x[++y]=[le,N]}),x}function Lt(h,y){return function(x){return h(y(x))}}function fn(h){var y=-1,x=Array(h.size);return h.forEach(function(N){x[++y]=N}),x}var J=Array.prototype,ne=Function.prototype,V=Object.prototype,se=Je["__core-js_shared__"],ct=ne.toString,fe=V.hasOwnProperty,ee=function(){var h=/[^.]+$/.exec(se&&se.keys&&se.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),F=V.toString,Xe=RegExp("^"+ct.call(fe).replace(hn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),mn=Ei?Je.Buffer:void 0,Ht=Je.Symbol,Ts=Je.Uint8Array,xs=V.propertyIsEnumerable,Lo=J.splice,zt=Ht?Ht.toStringTag:void 0,Es=Object.getOwnPropertySymbols,Ro=mn?mn.isBuffer:void 0,No=Lt(Object.keys,Object),_r=yn(Je,"DataView"),Hn=yn(Je,"Map"),Tr=yn(Je,"Promise"),xr=yn(Je,"Set"),Er=yn(Je,"WeakMap"),zn=yn(Object,"create"),Uo=Kt(_r),Bo=Kt(Hn),jo=Kt(Tr),Wo=Kt(xr),Fo=Kt(Er),Cs=Ht?Ht.prototype:void 0,Cr=Cs?Cs.valueOf:void 0;function Zt(h){var y=-1,x=h==null?0:h.length;for(this.clear();++y<x;){var N=h[y];this.set(N[0],N[1])}}function $o(){this.__data__=zn?zn(null):{},this.size=0}function Vo(h){var y=this.has(h)&&delete this.__data__[h];return this.size-=y?1:0,y}function Go(h){var y=this.__data__;if(zn){var x=y[h];return x===i?void 0:x}return fe.call(y,h)?y[h]:void 0}function qo(h){var y=this.__data__;return zn?y[h]!==void 0:fe.call(y,h)}function Ho(h,y){var x=this.__data__;return this.size+=this.has(h)?0:1,x[h]=zn&&y===void 0?i:y,this}Zt.prototype.clear=$o,Zt.prototype.delete=Vo,Zt.prototype.get=Go,Zt.prototype.has=qo,Zt.prototype.set=Ho;function St(h){var y=-1,x=h==null?0:h.length;for(this.clear();++y<x;){var N=h[y];this.set(N[0],N[1])}}function zo(){this.__data__=[],this.size=0}function Zo(h){var y=this.__data__,x=Di(y,h);if(x<0)return!1;var N=y.length-1;return x==N?y.pop():Lo.call(y,x,1),--this.size,!0}function Yo(h){var y=this.__data__,x=Di(y,h);return x<0?void 0:y[x][1]}function Ko(h){return Di(this.__data__,h)>-1}function Qo(h,y){var x=this.__data__,N=Di(x,h);return N<0?(++this.size,x.push([h,y])):x[N][1]=y,this}St.prototype.clear=zo,St.prototype.delete=Zo,St.prototype.get=Yo,St.prototype.has=Ko,St.prototype.set=Qo;function Yt(h){var y=-1,x=h==null?0:h.length;for(this.clear();++y<x;){var N=h[y];this.set(N[0],N[1])}}function Jo(){this.size=0,this.__data__={hash:new Zt,map:new(Hn||St),string:new Zt}}function Xo(h){var y=ki(this,h).delete(h);return this.size-=y?1:0,y}function ec(h){return ki(this,h).get(h)}function tc(h){return ki(this,h).has(h)}function nc(h,y){var x=ki(this,h),N=x.size;return x.set(h,y),this.size+=x.size==N?0:1,this}Yt.prototype.clear=Jo,Yt.prototype.delete=Xo,Yt.prototype.get=ec,Yt.prototype.has=tc,Yt.prototype.set=nc;function Ii(h){var y=-1,x=h==null?0:h.length;for(this.__data__=new Yt;++y<x;)this.add(h[y])}function ic(h){return this.__data__.set(h,i),this}function rc(h){return this.__data__.has(h)}Ii.prototype.add=Ii.prototype.push=ic,Ii.prototype.has=rc;function Rt(h){var y=this.__data__=new St(h);this.size=y.size}function sc(){this.__data__=new St,this.size=0}function ac(h){var y=this.__data__,x=y.delete(h);return this.size=y.size,x}function oc(h){return this.__data__.get(h)}function cc(h){return this.__data__.has(h)}function lc(h,y){var x=this.__data__;if(x instanceof St){var N=x.__data__;if(!Hn||N.length<n-1)return N.push([h,y]),this.size=++x.size,this;x=this.__data__=new Yt(N)}return x.set(h,y),this.size=x.size,this}Rt.prototype.clear=sc,Rt.prototype.delete=ac,Rt.prototype.get=oc,Rt.prototype.has=cc,Rt.prototype.set=lc;function uc(h,y){var x=Pi(h),N=!x&&xc(h),le=!x&&!N&&Or(h),z=!x&&!N&&!le&&Ns(h),ge=x||N||le||z,_e=ge?qn(h.length,String):[],Ce=_e.length;for(var de in h)(y||fe.call(h,de))&&!(ge&&(de=="length"||le&&(de=="offset"||de=="parent")||z&&(de=="buffer"||de=="byteLength"||de=="byteOffset")||bc(de,Ce)))&&_e.push(de);return _e}function Di(h,y){for(var x=h.length;x--;)if(Ps(h[x][0],y))return x;return-1}function dc(h,y,x){var N=y(h);return Pi(h)?N:Gn(N,x(h))}function Zn(h){return h==null?h===void 0?_:D:zt&&zt in Object(h)?wc(h):Tc(h)}function Os(h){return Yn(h)&&Zn(h)==l}function Is(h,y,x,N,le){return h===y?!0:h==null||y==null||!Yn(h)&&!Yn(y)?h!==h&&y!==y:hc(h,y,x,N,Is,le)}function hc(h,y,x,N,le,z){var ge=Pi(h),_e=Pi(y),Ce=ge?o:Nt(h),de=_e?o:Nt(y);Ce=Ce==l?U:Ce,de=de==l?U:de;var Ze=Ce==U,lt=de==U,Re=Ce==de;if(Re&&Or(h)){if(!Or(y))return!1;ge=!0,Ze=!1}if(Re&&!Ze)return z||(z=new Rt),ge||Ns(h)?Ds(h,y,x,N,le,z):mc(h,y,Ce,x,N,le,z);if(!(x&r)){var et=Ze&&fe.call(h,"__wrapped__"),tt=lt&&fe.call(y,"__wrapped__");if(et||tt){var Ut=et?h.value():h,_t=tt?y.value():y;return z||(z=new Rt),le(Ut,_t,x,N,z)}}return Re?(z||(z=new Rt),yc(h,y,x,N,le,z)):!1}function gc(h){if(!Rs(h)||Sc(h))return!1;var y=Ms(h)?Xe:gn;return y.test(Kt(h))}function pc(h){return Yn(h)&&Ls(h.length)&&!!re[Zn(h)]}function fc(h){if(!_c(h))return No(h);var y=[];for(var x in Object(h))fe.call(h,x)&&x!="constructor"&&y.push(x);return y}function Ds(h,y,x,N,le,z){var ge=x&r,_e=h.length,Ce=y.length;if(_e!=Ce&&!(ge&&Ce>_e))return!1;var de=z.get(h);if(de&&z.get(y))return de==y;var Ze=-1,lt=!0,Re=x&s?new Ii:void 0;for(z.set(h,y),z.set(y,h);++Ze<_e;){var et=h[Ze],tt=y[Ze];if(N)var Ut=ge?N(tt,et,Ze,y,h,z):N(et,tt,Ze,h,y,z);if(Ut!==void 0){if(Ut)continue;lt=!1;break}if(Re){if(!qt(y,function(_t,Qt){if(!Ci(Re,Qt)&&(et===_t||le(et,_t,x,N,z)))return Re.push(Qt)})){lt=!1;break}}else if(!(et===tt||le(et,tt,x,N,z))){lt=!1;break}}return z.delete(h),z.delete(y),lt}function mc(h,y,x,N,le,z,ge){switch(x){case Z:if(h.byteLength!=y.byteLength||h.byteOffset!=y.byteOffset)return!1;h=h.buffer,y=y.buffer;case M:return!(h.byteLength!=y.byteLength||!z(new Ts(h),new Ts(y)));case u:case p:case v:return Ps(+h,+y);case d:return h.name==y.name&&h.message==y.message;case B:case P:return h==y+"";case m:var _e=ze;case T:var Ce=N&r;if(_e||(_e=fn),h.size!=y.size&&!Ce)return!1;var de=ge.get(h);if(de)return de==y;N|=s,ge.set(h,y);var Ze=Ds(_e(h),_e(y),N,le,z,ge);return ge.delete(h),Ze;case w:if(Cr)return Cr.call(h)==Cr.call(y)}return!1}function yc(h,y,x,N,le,z){var ge=x&r,_e=ks(h),Ce=_e.length,de=ks(y),Ze=de.length;if(Ce!=Ze&&!ge)return!1;for(var lt=Ce;lt--;){var Re=_e[lt];if(!(ge?Re in y:fe.call(y,Re)))return!1}var et=z.get(h);if(et&&z.get(y))return et==y;var tt=!0;z.set(h,y),z.set(y,h);for(var Ut=ge;++lt<Ce;){Re=_e[lt];var _t=h[Re],Qt=y[Re];if(N)var Us=ge?N(Qt,_t,Re,y,h,z):N(_t,Qt,Re,h,y,z);if(!(Us===void 0?_t===Qt||le(_t,Qt,x,N,z):Us)){tt=!1;break}Ut||(Ut=Re=="constructor")}if(tt&&!Ut){var Mi=h.constructor,Li=y.constructor;Mi!=Li&&"constructor"in h&&"constructor"in y&&!(typeof Mi=="function"&&Mi instanceof Mi&&typeof Li=="function"&&Li instanceof Li)&&(tt=!1)}return z.delete(h),z.delete(y),tt}function ks(h){return dc(h,Oc,vc)}function ki(h,y){var x=h.__data__;return Ac(y)?x[typeof y=="string"?"string":"hash"]:x.map}function yn(h,y){var x=Oi(h,y);return gc(x)?x:void 0}function wc(h){var y=fe.call(h,zt),x=h[zt];try{h[zt]=void 0;var N=!0}catch{}var le=F.call(h);return N&&(y?h[zt]=x:delete h[zt]),le}var vc=Es?function(h){return h==null?[]:(h=Object(h),Ar(Es(h),function(y){return xs.call(h,y)}))}:Ic,Nt=Zn;(_r&&Nt(new _r(new ArrayBuffer(1)))!=Z||Hn&&Nt(new Hn)!=m||Tr&&Nt(Tr.resolve())!=E||xr&&Nt(new xr)!=T||Er&&Nt(new Er)!=C)&&(Nt=function(h){var y=Zn(h),x=y==U?h.constructor:void 0,N=x?Kt(x):"";if(N)switch(N){case Uo:return Z;case Bo:return m;case jo:return E;case Wo:return T;case Fo:return C}return y});function bc(h,y){return y=y??a,!!y&&(typeof h=="number"||xi.test(h))&&h>-1&&h%1==0&&h<y}function Ac(h){var y=typeof h;return y=="string"||y=="number"||y=="symbol"||y=="boolean"?h!=="__proto__":h===null}function Sc(h){return!!ee&&ee in h}function _c(h){var y=h&&h.constructor,x=typeof y=="function"&&y.prototype||V;return h===x}function Tc(h){return F.call(h)}function Kt(h){if(h!=null){try{return ct.call(h)}catch{}try{return h+""}catch{}}return""}function Ps(h,y){return h===y||h!==h&&y!==y}var xc=Os(function(){return arguments}())?Os:function(h){return Yn(h)&&fe.call(h,"callee")&&!xs.call(h,"callee")},Pi=Array.isArray;function Ec(h){return h!=null&&Ls(h.length)&&!Ms(h)}var Or=Ro||Dc;function Cc(h,y){return Is(h,y)}function Ms(h){if(!Rs(h))return!1;var y=Zn(h);return y==f||y==g||y==c||y==O}function Ls(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=a}function Rs(h){var y=typeof h;return h!=null&&(y=="object"||y=="function")}function Yn(h){return h!=null&&typeof h=="object"}var Ns=Mt?Sr(Mt):pc;function Oc(h){return Ec(h)?uc(h):fc(h)}function Ic(){return[]}function Dc(){return!1}e.exports=Cc})(Yr,Yr.exports);const wh=Yr.exports;function Xs(e,t){var n;if(typeof e=="string"&&(e=vh(e.trim())),!e)return;let i=(n=t==null?void 0:t.removeGenericPrefixes)!=null?n:!0,r=e.hostname;return i&&(r=r.replace(/^(m|mobile|amp|www|www1|www2|www3|tab|item|checkout|secure|user|account|accounts|web|app|open|i|v|preview|cdn|l|id|nid|user|sso|signin|login|auth0|play|api|click|detail|dashboard|console|manage|support|help)\./,"").replace(/.*\.zoom\.us/,"zoom.us").replace(/.*\.slack\.com/,"slack.com").replace(/.*\.wikipedia\.org/,"wikipedia.org").replace(/.*\.amazonaws\.com/,"amazonaws.com").replace(/.*\.netsuite\.com/,"netsuite.com")),{hostname:r,path:bh(e.pathname)}}function vh(e){if(!e)return;let t=n=>{let i=new URL(n);if(!/^https?:/.test(i.protocol))throw Error("Invalid URL, ignored protocol found");if(!i.hostname)throw Error("Invalid URL, no hostname");if(i.hostname.lastIndexOf(".")>=i.hostname.length-2)throw Error("Invalid URL, bad domain ending");return i};try{return t(e)}catch{}if(!e.includes("://"))try{return t("https://"+e)}catch{}}function bh(e){return e.endsWith("/")?e.substring(0,Math.max(1,e.length-1)):e}const ji="tab-history-map",to=class{constructor(e){this.tabHistoryMap=this.restoreTabHistory(),this.lock=new Za;let t=0;ce.tabs.onCreated.addListener(n=>this.lock.runExclusive(async()=>{var i;if(n.id!=null&&(e==null||e.debug(`[referrer] ${t++} tabs.onCreated`,n),n.openerTabId!=null)){const r=(i=(await this.tabHistoryMap)[n.openerTabId])==null?void 0:i[0];r&&await this.addHistory(n.id,r)}})),ce.webNavigation.onCommitted.addListener(n=>this.lock.runExclusive(async()=>{e==null||e.debug(`[referrer] ${t++} webNavigation.onCommitted`,n);const{frameId:i,tabId:r,url:s,transitionQualifiers:a}=n;i===0&&((a.includes("forward_back")||a.includes("from_address_bar"))&&await this.addHistory(r,void 0),await this.addHistory(r,s))})),ce.runtime.onStartup.addListener(()=>this.resetHistory()),ce.runtime.onSuspend.addListener(()=>this.resetHistory()),ce.tabs.onRemoved.addListener(n=>this.removeHistory(n))}async restoreTabHistory(){const e=await ps(ji);return e??{}}async addHistory(e,t){var n;const i=await this.tabHistoryMap,r=(n=i[e])!=null?n:i[e]=[];t!==r[0]&&r.unshift(this.sanatizeReferrerUrl(t)),r.splice(to.MAX_HISTORY_COUNT_PER_TAB),await ci(ji,i)}sanatizeReferrerUrl(e){if(e)try{const t=new URL(e);return t.search="",t.username="",t.password="",t.hash="",t.href}catch{return}}getReferrerFor(e,t){return this.lock.runExclusive(async()=>{if(e==null||!t)return;const n=(await this.tabHistoryMap)[e];if(n==null)return;const i=n.findIndex(r=>r===t);return i===-1?void 0:n[i+1]})}resetHistory(){return ci(ji,{})}async removeHistory(e){const t=await this.tabHistoryMap;delete t[e],await ci(ji,t)}};let no=to;no.MAX_HISTORY_COUNT_PER_TAB=10;class ea{constructor(){this.map={}}markAsProcessed(t){t.forEach(n=>this.map[n.id]=!0)}isProcessed(t){var n;return(n=this.map[t.id])!=null?n:!1}}const yt=class{constructor(e,t){this.wakeUpTimeoutDisabled=!1,this.hasRecentUserActivity=!0,this.sessionUpdatedListeners=[],this.pageViewUpdatedListeners=[],this.checkSessionsListeners=[],this.latestTriggerId=0,this.updateSessions=Rd(async r=>{var s,a,l;const o=`[update-sessions] [${r.triggerId}]`;if((s=this.logger)==null||s.debug(`${o} Waiting for startup to stop previous sessions...`),await this.startupPromise,(a=this.logger)==null||a.debug(`${o} Processing @ ${new Date(r.timestamp).toLocaleTimeString()}`),this.pingLastAliveAt(),this.invokeCheckSessionsListeners(),await this.config.enabled()){const c=this.logger?new Pd(this.logger.debug.bind(this.logger)):void 0,u=await this.getComputeDependencies();c==null||c.log(`${o} Got required data after {duration}`);const p=this.findSessionChanges(r,u);c==null||c.log(`${o} Computed session changes after {duration}`);const d=await this.findPageViewChanges(r,u);c==null||c.log(`${o} Computed page view changes after {duration}`),await this.saveSessionChanges(r.timestamp,p),c==null||c.log(`${o} Session changes committed to the database after {duration}`),await this.savePageViewChanges(r.timestamp,d),c==null||c.log(`${o} Page view changes committed to the database after {duration}`)}(l=this.logger)==null||l.log(`${o} Done`)}),this.config=t,this.sessionsRepo=e.sessionsRepo,this.pageViewsRepo=e.pageViewsRepo,this.updateSessions=this.updateSessions.bind(this),t.logger===void 0?this.logger=console:this.logger=t.logger;const[n,i]=Bd();this.startupPromise=n,this.allowSessionUpdates=i}setupTriggers(){var e,t;this.referrers=new no(this.logger),(t=(e=this.config).setupCustomTriggers)==null||t.call(e,{triggerSessionChangeCheck:this.basicTrigger.bind(this),setHasRecentUserActivity:this.setHasRecentUserActivity.bind(this)}),this.setupExtensionApiTriggers(),this.setupIdleTriggers(),this.setupStartupTriggers()}addSessionUpdatedListener(e){this.sessionUpdatedListeners.push(e)}addPageViewUpdatedListener(e){this.pageViewUpdatedListeners.push(e)}addCheckSessionsListener(e){this.checkSessionsListeners.push(e)}setupExtensionApiTriggers(){ce.webNavigation.onCompleted.addListener(async e=>{e.frameId>0||await this.basicTrigger("webNavigation.onCompleted",Math.floor(e.timeStamp))}),ce.tabs.onCreated.addListener(()=>this.basicTrigger("tabs.onCreated")),ce.tabs.onUpdated.addListener(()=>this.basicTrigger("tabs.onUpdated")),ce.tabs.onActivated.addListener(()=>this.basicTrigger("tabs.onActivated")),ce.tabs.onRemoved.addListener(()=>this.basicTrigger("tabs.onRemoved")),ce.windows.onCreated.addListener(()=>this.basicTrigger("windows.onCreated")),ce.windows.onFocusChanged.addListener(()=>this.basicTrigger("windows.onFocusChanged")),ce.windows.onRemoved.addListener(()=>this.basicTrigger("windows.onRemoved")),this.onWindowStateChanged(e=>this.basicTrigger("SessionMonitor.onWindowStateChanged",e))}setupIdleTriggers(){}setupStartupTriggers(){const e=Date.now();this.config.isOnStartupAvailable()?(ce.runtime.onStartup.addListener(()=>{this.wakeUpTimeoutDisabled=!0,this.startupFlow({cleanupSessions:!0,trigger:"runtime.onStartup",timestamp:e})}),setTimeout(()=>{this.wakeUpTimeoutDisabled||this.startupFlow({cleanupSessions:!1,trigger:"setTimeout",timestamp:e})},yt.ALWAYS_STARTUP_AFTER_MS)):(ce.alarms.clear("ping-last-alive-at"),ce.alarms.create("ping-last-alive-at",{delayInMinutes:yt.LAST_ALIVE_AT_INTERVAL_MS/Un,periodInMinutes:yt.LAST_ALIVE_AT_INTERVAL_MS/Un}),ce.alarms.onAlarm.addListener(n=>{if(n.name==="ping-last-alive-at")return this.pingLastAliveAt()}),this.getLastAliveAt().then(n=>{this.wakeUpTimeoutDisabled=!0;const i=n!=null&&Date.now()-n>2*yt.LAST_ALIVE_AT_INTERVAL_MS;this.startupFlow({cleanupSessions:i,trigger:i?"time since last alive at > 2 * lastAliveInterval":"time since last alive at <= 2 * lastAliveInterval",timestamp:e})})),ce.runtime.onInstalled.addListener(n=>{this.wakeUpTimeoutDisabled=!0,this.startupFlow({cleanupSessions:n.reason!=="install",trigger:"runtime.onInstalled",timestamp:e})});const{onSuspend:t}=ce.runtime;t==null||t.addListener(()=>this.endAllActiveSessions(Date.now()))}basicTrigger(e,t=Date.now()){var n;const i=this.latestTriggerId++;return(n=this.logger)==null||n.log(`[update-sessions] [${i}] Queued by ${e} @ ${new Date(t).toLocaleTimeString()}`),this.updateSessions({timestamp:t,triggerId:i,triggeredBy:e})}onWindowStateChanged(e){let t={};this.getWindowStates().then(n=>{t=n}),setInterval(async()=>{const n=Date.now(),i=await this.getWindowStates();wh(t,i)||(e(n),t=i)},yt.WINDOW_STATE_POLLING_INTERVAL_MS)}async getWindowStates(){return(await ce.windows.getAll()).reduce((e,t)=>(t.id!=null&&(e[t.id]=t.state),e),{})}async startupFlow({cleanupSessions:e,trigger:t,timestamp:n}){e&&await this.cleanupActiveSessionsOnStartup(n),await this.pingLastAliveAt(),await Ld().then(()=>this.allowSessionUpdates()),await this.basicTrigger(t,n)}async cleanupActiveSessionsOnStartup(e){var t,n,i,r;const s=await this.getLastAliveAt();if((t=this.logger)==null||t.debug("[on-startup] onStartup()",{lastActivity:s&&new Date(s).toISOString(),now:new Date(e).toISOString()}),s==null)throw Error("lastActivity was not set yet");(n=this.logger)==null||n.log("[on-startup] Ending sessions after quit...");const a=s+yt.LAST_ALIVE_AT_POLL_INTERVAL_MS,l=Math.min(e,a);(i=this.logger)==null||i.log("[on-startup] Timing details:",{lastActivity:new Date(s).toISOString(),now:new Date(e).toISOString(),quitAt:new Date(a).toISOString(),endAt:new Date(l).toISOString()}),await this.endAllActiveSessions(l),(r=this.logger)==null||r.log("[on-startup] Startup finished!")}async getComputeDependencies(){const[e,t]=await Promise.all([ce.windows.getAll(),ce.tabs.query({})]),n=await this.sessionsRepo.getActiveSessions(),i=await this.pageViewsRepo.getActivePageViews();return{isTabActiveWhenPlayingAudio:await this.config.isTabActiveWhenPlayingAudio(),hostnameToTabsMap:t.reduce((r,s)=>{var a,l;const o=(a=Xs(s.url))==null?void 0:a.hostname;return o&&(r[o]!=null||(r[o]=[]),(l=r[o])==null||l.push(s)),r},{}),allActiveSessions:n,allActivePageViews:i,appIdToActiveSessionMap:Nd(n??[],"appId"),windowIdToWindowMap:Ud(e,"id"),processedActiveSessionCache:new ea,processedActivePageViewCache:new ea}}findSessionChanges(e,t){var n,i,r;const s=[],a=[];for(const[l,o]of Object.entries(t.hostnameToTabsMap))if(l)try{if(!(o!=null&&o.length))throw Error("This shouldn't be possible");const c=t.appIdToActiveSessionMap[l],u=!!(c!=null&&c.length),p=!!o.find(d=>this.isTabActive(d,t));!u&&p?s.push({appId:l,startedAt:e.timestamp}):u&&!p&&a.push(...c),u&&t.processedActiveSessionCache.markAsProcessed(c)}catch(c){(n=this.logger)==null||n.error(`[update-sessions] Failed find sessions to change for ${l}:`,c)}return((r=(i=t.allActiveSessions)==null?void 0:i.filter(l=>!t.processedActiveSessionCache.isProcessed(l)))!=null?r:[]).forEach(l=>a.push(l)),{toStart:s,toEnd:a,count:s.length+a.length}}async findPageViewChanges(e,t){var n;const i=Object.values(t.hostnameToTabsMap).flat().filter(a=>!!a&&this.isTabActive(a,t)),r=[],s=[...t.allActivePageViews];for(const a of i){const l=Xs(a.url);if(l==null)continue;const o=t.allActivePageViews.filter(c=>c.appId===(l==null?void 0:l.hostname)&&c.path===l.path);if(o.length>0)for(const c of o){const u=s.findIndex(p=>p.id===c.id);u>=0&&s.splice(u,1)}else r.push({appId:l.hostname,path:l.path,startedAt:e.timestamp,referrer:await((n=this.referrers)==null?void 0:n.getReferrerFor(a.id,a.url))})}return{toStart:r,toEnd:s,count:r.length+s.length}}async saveSessionChanges(e,t){const n=t.toEnd.map(a=>{var l;const o=new Date(e).toLocaleTimeString();return(l=this.logger)==null||l.log(`[change-session] Stop session ${a.appId} @ ${o} (${e-a.startedAt}ms)`),this.sessionsRepo.endSession(a,e)}),i=t.toStart.map(a=>{var l;return(l=this.logger)==null||l.log(`[change-session] Start session ${a.appId} @ ${new Date(a.startedAt).toLocaleTimeString()}`,{session:a}),this.sessionsRepo.startSession(a)}),r=await Promise.allSettled(n),s=await Promise.allSettled(i);this.logSettledErrors("sessions","ending",r),this.logSettledErrors("sessions","starting",s),t.count>0&&this.invokeSessionUpdatedListeners()}async savePageViewChanges(e,t){const n=t.toEnd.map(a=>{var l;const o=new Date(e).toLocaleTimeString();return(l=this.logger)==null||l.log(`[change-session] Stop page view ${a.appId}${a.path} @ ${o} (${e-a.startedAt}ms)`),this.pageViewsRepo.endPageView(a,e)}),i=t.toStart.map(a=>{var l;return(l=this.logger)==null||l.log(`[change-session] Start page view ${a.appId}${a.path} @ ${new Date(a.startedAt).toLocaleTimeString()}`,{session:a}),this.pageViewsRepo.startPageView(a)}),r=await Promise.allSettled(n),s=await Promise.allSettled(i);this.logSettledErrors("page views","ending",r),this.logSettledErrors("page views","starting",s),t.count>0&&this.invokePageViewUpdatedListeners()}logSettledErrors(e,t,n){var i;const r=n.map(s=>{if(s.status==="rejected")return s.reason}).filter(s=>s!=null);r.length>0&&((i=this.logger)==null||i.warn(`[update-sessions] ${r.length}/${n.length} transactions failed when ${t} ${e}`,r))}isTabActive(e,t){var n;if(e.windowId==null)return(n=this.logger)==null||n.warn("[update-sessions] Checking if tab without a windowId is active"),!1;const i=t.windowIdToWindowMap[e.windowId];return!!i&&Wd(e,i,this.hasRecentUserActivity,t.isTabActiveWhenPlayingAudio)}async endAllActiveSessions(e){var t,n,i;const r=await this.sessionsRepo.getActiveSessions();if(r.length===0){(t=this.logger)==null||t.log("[stop-active-sessions] No active sessions to stop");return}(n=this.logger)==null||n.log("[stop-active-sessions] Stopping all active sessions:",{activeSessions:r,timestamp:e}),await this.saveSessionChanges(e,{toStart:[],toEnd:r,count:r.length}),(i=this.logger)==null||i.log("[stop-active-sessions] All active sessions stopped!")}async pingLastAliveAt(){var e;const t=Date.now();(e=this.logger)==null||e.debug("[SessionMonitor] Updating last time browser was known to be open",t),await ci(yt.LAST_ALIVE_AT_KEY,t),clearTimeout(this.lastAlivePing),this.lastAlivePing=setTimeout(()=>this.pingLastAliveAt(),yt.LAST_ALIVE_AT_POLL_INTERVAL_MS)}getLastAliveAt(){return ps(yt.LAST_ALIVE_AT_KEY)}invokeCheckSessionsListeners(){this.checkSessionsListeners.forEach(e=>e())}invokeSessionUpdatedListeners(){this.sessionUpdatedListeners.forEach(e=>e())}invokePageViewUpdatedListeners(){this.pageViewUpdatedListeners.forEach(e=>e())}setHasRecentUserActivity(e){this.hasRecentUserActivity=e}};let jn=yt;jn.LAST_ALIVE_AT_KEY="last-activity-time-ms";jn.LAST_ALIVE_AT_INTERVAL_MS=gs;jn.LAST_ALIVE_AT_POLL_INTERVAL_MS=30*Un;jn.ALWAYS_STARTUP_AFTER_MS=5*Un;jn.WINDOW_STATE_POLLING_INTERVAL_MS=5*Un;function Ah(e){const t=new jn(e.db,e);return t.setupTriggers(),{sessionMonitor:t}}var ta=1/0,io=9007199254740991,Sh=17976931348623157e292,na=0/0,_h="[object Function]",Th="[object GeneratorFunction]",xh="[object Symbol]",Eh=/^\s+|\s+$/g,Ch=/^[-+]0x[0-9a-f]+$/i,Oh=/^0b[01]+$/i,Ih=/^0o[0-7]+$/i,Dh=/^(?:0|[1-9]\d*)$/,kh=parseInt,Ph=Object.prototype,ro=Ph.toString,Mh=Math.ceil,Lh=Math.max;function Rh(e,t,n){var i=-1,r=e.length;t<0&&(t=-t>r?0:r+t),n=n>r?r:n,n<0&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(r);++i<r;)s[i]=e[i+t];return s}function Nh(e,t){return t=t??io,!!t&&(typeof e=="number"||Dh.test(e))&&e>-1&&e%1==0&&e<t}function Uh(e,t,n){if(!ur(n))return!1;var i=typeof t;return(i=="number"?Wh(n)&&Nh(t,n.length):i=="string"&&t in n)?jh(n[t],e):!1}function Bh(e,t,n){(n?Uh(e,t,n):t===void 0)?t=1:t=Lh(Hh(t),0);var i=e?e.length:0;if(!i||t<1)return[];for(var r=0,s=0,a=Array(Mh(i/t));r<i;)a[s++]=Rh(e,r,r+=t);return a}function jh(e,t){return e===t||e!==e&&t!==t}function Wh(e){return e!=null&&$h(e.length)&&!Fh(e)}function Fh(e){var t=ur(e)?ro.call(e):"";return t==_h||t==Th}function $h(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=io}function ur(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Vh(e){return!!e&&typeof e=="object"}function Gh(e){return typeof e=="symbol"||Vh(e)&&ro.call(e)==xh}function qh(e){if(!e)return e===0?e:0;if(e=zh(e),e===ta||e===-ta){var t=e<0?-1:1;return t*Sh}return e===e?e:0}function Hh(e){var t=qh(e),n=t%1;return t===t?n?t-n:t:0}function zh(e){if(typeof e=="number")return e;if(Gh(e))return na;if(ur(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ur(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(Eh,"");var n=Oh.test(e);return n||Ih.test(e)?kh(e.slice(2),n?2:8):Ch.test(e)?na:+e}var Zh=Bh;const Yh=100;function Kh(e){const t=e.logger===void 0?console:e.logger;async function n(){var s;const[a,l,o]=await Promise.all([e.getAppId(),e.getInstallId(),(s=e.getBirthYear)==null?void 0:s.call(e)]);return{appId:a,installId:l,birthYear:o}}async function i(s,a){var l,o;let c;try{t==null||t.log(`[${s.label}-uploader] Beginning upload @ ${new Date(a).toISOString()}`);const[u,p,d]=await Promise.all([s.getLastUploadedAt(),e.db,e.enabled()]);if(!d){t==null||t.log(`[${s.label}-uploader] Uploads are disabled`);return}const f=await s.getModelsToUpload({db:p,lastUploadedAt:u,uploadStartedAt:a}),g=(o=await((l=e.getUploadBatchSize)==null?void 0:l.call(e)))!=null?o:Yh,m=Zh(f,g),v=await n();c={models:f,batches:m,body:v},t==null||t.debug(`[${s.label}-uploader] Data`,c);for(const U of m){t==null||t.debug(`[${s.label}-uploader] Uploading`,{batch:U,requestSkipped:!!e.dev}),e.dev||await s.upload(v,U);const E=U[U.length-1];(E==null?void 0:E.endedAt)!=null&&await s.setLastUploadedAt(E.endedAt)}await s.setLastUploadedAt(a);const D=(Date.now()-a)/1e3;t==null||t.log(`[${s.label}-uploader] Uploaded ${f.length} items in ${m.length} batches in ${D}s`),s.onSuccess({total:f.length,batches:m.length,batchSize:g,durationInSec:D})}catch(u){t==null||t.error(`[${s.label}-uploader] Failed to upload`,u,c),s.onFailure(u)}}async function r(){const s=Date.now();await Promise.allSettled(e.uploaders.map(a=>i(a,s)))}return{uploadAll:r}}function Qh({api:e,onSuccess:t,onFailure:n,lastUploadedAtStorageKey:i}){return{label:"sessions",onSuccess:t,onFailure:n,async getLastUploadedAt(){const r=await ps(i);return r??1},setLastUploadedAt(r){return ci(i,r)},async getModelsToUpload({db:r,lastUploadedAt:s,uploadStartedAt:a}){return(await r.sessionsRepo.findSessionsByEndedAt(s,a)).filter(l=>!l.imported)},async upload(r,s){const a=s.reduce((l,o)=>{var c;if(o.endedAt==null)throw Error("Cannot upload a session that is in progress");const u={duration:lr(o.endedAt-o.startedAt),timestamp:lr(o.startedAt)};return u.duration>0&&(l[c=o.appId]!=null||(l[c]={sessions:[]}),l[o.appId].sessions.push(u)),l},{});await e.uploadSessions({...r,websites:a})}}}var Jh=so;function so(e,t,n){e instanceof RegExp&&(e=ia(e,n)),t instanceof RegExp&&(t=ia(t,n));var i=ao(e,t,n);return i&&{start:i[0],end:i[1],pre:n.slice(0,i[0]),body:n.slice(i[0]+e.length,i[1]),post:n.slice(i[1]+t.length)}}function ia(e,t){var n=t.match(e);return n?n[0]:null}so.range=ao;function ao(e,t,n){var i,r,s,a,l,o=n.indexOf(e),c=n.indexOf(t,o+1),u=o;if(o>=0&&c>0){if(e===t)return[o,c];for(i=[],s=n.length;u>=0&&!l;)u==o?(i.push(u),o=n.indexOf(e,u+1)):i.length==1?l=[i.pop(),c]:(r=i.pop(),r<s&&(s=r,a=c),c=n.indexOf(t,u+1)),u=o<c&&o>=0?o:c;i.length&&(l=[s,a])}return l}var oo=Jh,Xh=ng,co="\0SLASH"+Math.random()+"\0",lo="\0OPEN"+Math.random()+"\0",ys="\0CLOSE"+Math.random()+"\0",uo="\0COMMA"+Math.random()+"\0",ho="\0PERIOD"+Math.random()+"\0";function Ur(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function eg(e){return e.split("\\\\").join(co).split("\\{").join(lo).split("\\}").join(ys).split("\\,").join(uo).split("\\.").join(ho)}function tg(e){return e.split(co).join("\\").split(lo).join("{").split(ys).join("}").split(uo).join(",").split(ho).join(".")}function go(e){if(!e)return[""];var t=[],n=oo("{","}",e);if(!n)return e.split(",");var i=n.pre,r=n.body,s=n.post,a=i.split(",");a[a.length-1]+="{"+r+"}";var l=go(s);return s.length&&(a[a.length-1]+=l.shift(),a.push.apply(a,l)),t.push.apply(t,a),t}function ng(e){return e?(e.substr(0,2)==="{}"&&(e="\\{\\}"+e.substr(2)),ni(eg(e),!0).map(tg)):[]}function ig(e){return"{"+e+"}"}function rg(e){return/^-?0\d/.test(e)}function sg(e,t){return e<=t}function ag(e,t){return e>=t}function ni(e,t){var n=[],i=oo("{","}",e);if(!i)return[e];var r=i.pre,s=i.post.length?ni(i.post,!1):[""];if(/\$$/.test(i.pre))for(var a=0;a<s.length;a++){var l=r+"{"+i.body+"}"+s[a];n.push(l)}else{var o=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),c=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),u=o||c,p=i.body.indexOf(",")>=0;if(!u&&!p)return i.post.match(/,.*\}/)?(e=i.pre+"{"+i.body+ys+i.post,ni(e)):[e];var d;if(u)d=i.body.split(/\.\./);else if(d=go(i.body),d.length===1&&(d=ni(d[0],!1).map(ig),d.length===1))return s.map(function(C){return i.pre+d[0]+C});var f;if(u){var g=Ur(d[0]),m=Ur(d[1]),v=Math.max(d[0].length,d[1].length),D=d.length==3?Math.abs(Ur(d[2])):1,U=sg,E=m<g;E&&(D*=-1,U=ag);var O=d.some(rg);f=[];for(var B=g;U(B,m);B+=D){var T;if(c)T=String.fromCharCode(B),T==="\\"&&(T="");else if(T=String(B),O){var P=v-T.length;if(P>0){var w=new Array(P+1).join("0");B<0?T="-"+w+T.slice(1):T=w+T}}f.push(T)}}else{f=[];for(var _=0;_<d.length;_++)f.push.apply(f,ni(d[_],!1))}for(var _=0;_<f.length;_++)for(var a=0;a<s.length;a++){var l=r+f[_]+s[a];(!t||u||l)&&n.push(l)}}return n}const og=1024*64,dr=e=>{if(typeof e!="string")throw new TypeError("invalid pattern");if(e.length>og)throw new TypeError("pattern is too long")},cg={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Xn=e=>e.replace(/[[\]\\-]/g,"\\$&"),lg=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),ra=e=>e.join(""),ug=(e,t)=>{const n=t;if(e.charAt(n)!=="[")throw new Error("not in a brace expression");const i=[],r=[];let s=n+1,a=!1,l=!1,o=!1,c=!1,u=n,p="";e:for(;s<e.length;){const g=e.charAt(s);if((g==="!"||g==="^")&&s===n+1){c=!0,s++;continue}if(g==="]"&&a&&!o){u=s+1;break}if(a=!0,g==="\\"&&!o){o=!0,s++;continue}if(g==="["&&!o){for(const[m,[v,D,U]]of Object.entries(cg))if(e.startsWith(m,s)){if(p)return["$.",!1,e.length-n,!0];s+=m.length,U?r.push(v):i.push(v),l=l||D;continue e}}if(o=!1,p){g>p?i.push(Xn(p)+"-"+Xn(g)):g===p&&i.push(Xn(g)),p="",s++;continue}if(e.startsWith("-]",s+1)){i.push(Xn(g+"-")),s+=2;continue}if(e.startsWith("-",s+1)){p=g,s+=2;continue}i.push(Xn(g)),s++}if(u<s)return["",!1,0,!1];if(!i.length&&!r.length)return["$.",!1,e.length-n,!0];if(r.length===0&&i.length===1&&/^\\?.$/.test(i[0])&&!c){const g=i[0].length===2?i[0].slice(-1):i[0];return[lg(g),!1,u-n,!1]}const d="["+(c?"^":"")+ra(i)+"]",f="["+(c?"":"^")+ra(r)+"]";return[i.length&&r.length?"("+d+"|"+f+")":i.length?d:f,l,u-n,!0]},li=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/\[([^\/\\])\]/g,"$1"):e.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),dg=new Set(["!","?","+","*","@"]),sa=e=>dg.has(e),hg="(?!\\.\\.?(?:$|/))",Br="(?!\\.)",gg=new Set(["[","."]),pg=new Set(["..","."]),fg=new Set("().*{}+?[]^$\\!"),mg=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),ws="[^/]",po=ws+"*?",fo=ws+"+?";var Ee,Pe,Wt,he,Ae,en,On,nn,gt,xn,hr,Kr,mo,ii,zi,Qr,yo;const Ke=class{constructor(t,n,i={}){He(this,Kr),xe(this,"type"),He(this,Ee,void 0),He(this,Pe,void 0),He(this,Wt,!1),He(this,he,[]),He(this,Ae,void 0),He(this,en,void 0),He(this,On,void 0),He(this,nn,!1),He(this,gt,void 0),He(this,xn,void 0),He(this,hr,!1),this.type=t,t&&ve(this,Pe,!0),ve(this,Ae,n),ve(this,Ee,I(this,Ae)?I(I(this,Ae),Ee):this),ve(this,gt,I(this,Ee)===this?i:I(I(this,Ee),gt)),ve(this,On,I(this,Ee)===this?[]:I(I(this,Ee),On)),t==="!"&&!I(I(this,Ee),nn)&&I(this,On).push(this),ve(this,en,I(this,Ae)?I(I(this,Ae),he).length:0)}get hasMagic(){if(I(this,Pe)!==void 0)return I(this,Pe);for(const t of I(this,he))if(typeof t!="string"&&(t.type||t.hasMagic))return ve(this,Pe,!0);return I(this,Pe)}toString(){return I(this,xn)!==void 0?I(this,xn):this.type?ve(this,xn,this.type+"("+I(this,he).map(t=>String(t)).join("|")+")"):ve(this,xn,I(this,he).map(t=>String(t)).join(""))}push(...t){for(const n of t)if(n!==""){if(typeof n!="string"&&!(n instanceof Ke&&I(n,Ae)===this))throw new Error("invalid part: "+n);I(this,he).push(n)}}toJSON(){var t;const n=this.type===null?I(this,he).slice().map(i=>typeof i=="string"?i:i.toJSON()):[this.type,...I(this,he).map(i=>i.toJSON())];return this.isStart()&&!this.type&&n.unshift([]),this.isEnd()&&(this===I(this,Ee)||I(I(this,Ee),nn)&&((t=I(this,Ae))==null?void 0:t.type)==="!")&&n.push({}),n}isStart(){var t;if(I(this,Ee)===this)return!0;if(!((t=I(this,Ae))!=null&&t.isStart()))return!1;if(I(this,en)===0)return!0;const n=I(this,Ae);for(let i=0;i<I(this,en);i++){const r=I(n,he)[i];if(!(r instanceof Ke&&r.type==="!"))return!1}return!0}isEnd(){var t,n,i;if(I(this,Ee)===this||((t=I(this,Ae))==null?void 0:t.type)==="!")return!0;if(!((n=I(this,Ae))!=null&&n.isEnd()))return!1;if(!this.type)return(i=I(this,Ae))==null?void 0:i.isEnd();const r=I(this,Ae)?I(I(this,Ae),he).length:0;return I(this,en)===r-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){const n=new Ke(this.type,t);for(const i of I(this,he))n.copyIn(i);return n}static fromGlob(t,n={}){var i;const r=new Ke(null,void 0,n);return si(i=Ke,ii,zi).call(i,t,r,0,n),r}toMMPattern(){if(this!==I(this,Ee))return I(this,Ee).toMMPattern();const t=this.toString(),[n,i,r,s]=this.toRegExpSource();if(!(r||I(this,Pe)||I(this,gt).nocase&&!I(this,gt).nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return i;const a=(I(this,gt).nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${n}$`,a),{_src:n,_glob:t})}toRegExpSource(){var t;if(I(this,Ee)===this&&si(this,Kr,mo).call(this),!this.type){const s=this.isStart()&&this.isEnd(),a=I(this,he).map(c=>{var u;const[p,d,f,g]=typeof c=="string"?si(u=Ke,Qr,yo).call(u,c,I(this,Pe),s):c.toRegExpSource();return ve(this,Pe,I(this,Pe)||f),ve(this,Wt,I(this,Wt)||g),p}).join("");let l="";if(this.isStart()&&typeof I(this,he)[0]=="string"&&!(I(this,he).length===1&&pg.has(I(this,he)[0]))){const c=gg,u=I(this,gt).dot&&c.has(a.charAt(0))||a.startsWith("\\.")&&c.has(a.charAt(2))||a.startsWith("\\.\\.")&&c.has(a.charAt(4)),p=!I(this,gt).dot&&c.has(a.charAt(0));l=u?hg:p?Br:""}let o="";return this.isEnd()&&I(I(this,Ee),nn)&&((t=I(this,Ae))==null?void 0:t.type)==="!"&&(o="(?:$|\\/)"),[l+a+o,li(a),ve(this,Pe,!!I(this,Pe)),I(this,Wt)]}const n=this.type==="!"?"(?:(?!(?:":"(?:",i=I(this,he).map(s=>{if(typeof s=="string")throw new Error("string type in extglob ast??");const[a,l,o,c]=s.toRegExpSource();return ve(this,Wt,I(this,Wt)||c),a}).filter(s=>!(this.isStart()&&this.isEnd())||!!s).join("|");if(this.isStart()&&this.isEnd()&&!i&&this.type!=="!"){const s=this.toString();return ve(this,he,[s]),this.type=null,ve(this,Pe,void 0),[s,li(this.toString()),!1,!1]}let r="";if(this.type==="!"&&I(this,hr))r=(this.isStart()&&!I(this,gt).dot?Br:"")+fo;else{const s=this.type==="!"?"))"+(this.isStart()&&!I(this,gt).dot?Br:"")+po+")":this.type==="@"?")":`)${this.type}`;r=n+i+s}return[r,li(i),ve(this,Pe,!!I(this,Pe)),I(this,Wt)]}};let gr=Ke;Ee=new WeakMap,Pe=new WeakMap,Wt=new WeakMap,he=new WeakMap,Ae=new WeakMap,en=new WeakMap,On=new WeakMap,nn=new WeakMap,gt=new WeakMap,xn=new WeakMap,hr=new WeakMap,Kr=new WeakSet,mo=function(){if(this!==I(this,Ee))throw new Error("should only call on root");if(I(this,nn))return this;this.toString(),ve(this,nn,!0);let e;for(;e=I(this,On).pop();){if(e.type!=="!")continue;let t=e,n=I(t,Ae);for(;n;){for(let i=I(t,en)+1;!n.type&&i<I(n,he).length;i++)for(const r of I(e,he)){if(typeof r=="string")throw new Error("string part in extglob AST??");r.copyIn(I(n,he)[i])}t=n,n=I(t,Ae)}}return this},ii=new WeakSet,zi=function(e,t,n,i){var r,s;let a=!1,l=!1,o=-1,c=!1;if(t.type===null){let g=n,m="";for(;g<e.length;){const v=e.charAt(g++);if(a||v==="\\"){a=!a,m+=v;continue}if(l){g===o+1?(v==="^"||v==="!")&&(c=!0):v==="]"&&!(g===o+2&&c)&&(l=!1),m+=v;continue}else if(v==="["){l=!0,o=g,c=!1,m+=v;continue}if(!i.noext&&sa(v)&&e.charAt(g)==="("){t.push(m),m="";const D=new Ke(v,t);g=si(r=Ke,ii,zi).call(r,e,D,g,i),t.push(D);continue}m+=v}return t.push(m),g}let u=n+1,p=new Ke(null,t);const d=[];let f="";for(;u<e.length;){const g=e.charAt(u++);if(a||g==="\\"){a=!a,f+=g;continue}if(l){u===o+1?(g==="^"||g==="!")&&(c=!0):g==="]"&&!(u===o+2&&c)&&(l=!1),f+=g;continue}else if(g==="["){l=!0,o=u,c=!1,f+=g;continue}if(sa(g)&&e.charAt(u)==="("){p.push(f),f="";const m=new Ke(g,p);p.push(m),u=si(s=Ke,ii,zi).call(s,e,m,u,i);continue}if(g==="|"){p.push(f),f="",d.push(p),p=new Ke(null,t);continue}if(g===")")return f===""&&I(t,he).length===0&&ve(t,hr,!0),p.push(f),f="",t.push(...d,p),u;f+=g}return t.type=null,ve(t,Pe,void 0),ve(t,he,[e.substring(n-1)]),u},Qr=new WeakSet,yo=function(e,t,n=!1){let i=!1,r="",s=!1;for(let a=0;a<e.length;a++){const l=e.charAt(a);if(i){i=!1,r+=(fg.has(l)?"\\":"")+l;continue}if(l==="\\"){a===e.length-1?r+="\\\\":i=!0;continue}if(l==="["){const[o,c,u,p]=ug(e,a);if(u){r+=o,s=s||c,a+=u-1,t=t||p;continue}}if(l==="*"){n&&e==="*"?r+=fo:r+=po,t=!0;continue}if(l==="?"){r+=ws,t=!0;continue}r+=mg(l)}return[r,li(e),!!t,s]},He(gr,ii),He(gr,Qr);const yg=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/[?*()[\]]/g,"[$&]"):e.replace(/[?*()[\]\\]/g,"\\$&"),Be=(e,t,n={})=>(dr(t),!n.nocomment&&t.charAt(0)==="#"?!1:new br(t,n).match(e)),wg=/^\*+([^+@!?\*\[\(]*)$/,vg=e=>t=>!t.startsWith(".")&&t.endsWith(e),bg=e=>t=>t.endsWith(e),Ag=e=>(e=e.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(e)),Sg=e=>(e=e.toLowerCase(),t=>t.toLowerCase().endsWith(e)),_g=/^\*+\.\*+$/,Tg=e=>!e.startsWith(".")&&e.includes("."),xg=e=>e!=="."&&e!==".."&&e.includes("."),Eg=/^\.\*+$/,Cg=e=>e!=="."&&e!==".."&&e.startsWith("."),Og=/^\*+$/,Ig=e=>e.length!==0&&!e.startsWith("."),Dg=e=>e.length!==0&&e!=="."&&e!=="..",kg=/^\?+([^+@!?\*\[\(]*)?$/,Pg=([e,t=""])=>{const n=wo([e]);return t?(t=t.toLowerCase(),i=>n(i)&&i.toLowerCase().endsWith(t)):n},Mg=([e,t=""])=>{const n=vo([e]);return t?(t=t.toLowerCase(),i=>n(i)&&i.toLowerCase().endsWith(t)):n},Lg=([e,t=""])=>{const n=vo([e]);return t?i=>n(i)&&i.endsWith(t):n},Rg=([e,t=""])=>{const n=wo([e]);return t?i=>n(i)&&i.endsWith(t):n},wo=([e])=>{const t=e.length;return n=>n.length===t&&!n.startsWith(".")},vo=([e])=>{const t=e.length;return n=>n.length===t&&n!=="."&&n!==".."},bo=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&{}.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",aa={win32:{sep:"\\"},posix:{sep:"/"}},Ng=bo==="win32"?aa.win32.sep:aa.posix.sep;Be.sep=Ng;const st=Symbol("globstar **");Be.GLOBSTAR=st;const Ug="[^/]",Bg=Ug+"*?",jg="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Wg="(?:(?!(?:\\/|^)\\.).)*?",Fg=(e,t={})=>n=>Be(n,e,t);Be.filter=Fg;const nt=(e,t={})=>Object.assign({},e,t),$g=e=>{if(!e||typeof e!="object"||!Object.keys(e).length)return Be;const t=Be;return Object.assign((n,i,r={})=>t(n,i,nt(e,r)),{Minimatch:class extends t.Minimatch{constructor(n,i={}){super(n,nt(e,i))}static defaults(n){return t.defaults(nt(e,n)).Minimatch}},AST:class extends t.AST{constructor(n,i,r={}){super(n,i,nt(e,r))}static fromGlob(n,i={}){return t.AST.fromGlob(n,nt(e,i))}},unescape:(n,i={})=>t.unescape(n,nt(e,i)),escape:(n,i={})=>t.escape(n,nt(e,i)),filter:(n,i={})=>t.filter(n,nt(e,i)),defaults:n=>t.defaults(nt(e,n)),makeRe:(n,i={})=>t.makeRe(n,nt(e,i)),braceExpand:(n,i={})=>t.braceExpand(n,nt(e,i)),match:(n,i,r={})=>t.match(n,i,nt(e,r)),sep:t.sep,GLOBSTAR:st})};Be.defaults=$g;const Ao=(e,t={})=>(dr(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:Xh(e));Be.braceExpand=Ao;const Vg=(e,t={})=>new br(e,t).makeRe();Be.makeRe=Vg;const Gg=(e,t,n={})=>{const i=new br(t,n);return e=e.filter(r=>i.match(r)),i.options.nonull&&!e.length&&e.push(t),e};Be.match=Gg;const oa=/[?*]|[+@!]\(.*?\)|\[|\]/,qg=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class br{constructor(t,n={}){xe(this,"options"),xe(this,"set"),xe(this,"pattern"),xe(this,"windowsPathsNoEscape"),xe(this,"nonegate"),xe(this,"negate"),xe(this,"comment"),xe(this,"empty"),xe(this,"preserveMultipleSlashes"),xe(this,"partial"),xe(this,"globSet"),xe(this,"globParts"),xe(this,"nocase"),xe(this,"isWindows"),xe(this,"platform"),xe(this,"windowsNoMagicRoot"),xe(this,"regexp"),dr(t),n=n||{},this.options=n,this.pattern=t,this.platform=n.platform||bo,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!n.windowsPathsNoEscape||n.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!n.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!n.nonegate,this.comment=!1,this.empty=!1,this.partial=!!n.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=n.windowsNoMagicRoot!==void 0?n.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const n of t)if(typeof n!="string")return!0;return!1}debug(...t){}make(){const t=this.pattern,n=this.options;if(!n.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],n.debug&&(this.debug=(...s)=>console.error(...s)),this.debug(this.pattern,this.globSet);const i=this.globSet.map(s=>this.slashSplit(s));this.globParts=this.preprocess(i),this.debug(this.pattern,this.globParts);let r=this.globParts.map((s,a,l)=>{if(this.isWindows&&this.windowsNoMagicRoot){const o=s[0]===""&&s[1]===""&&(s[2]==="?"||!oa.test(s[2]))&&!oa.test(s[3]),c=/^[a-z]:/i.test(s[0]);if(o)return[...s.slice(0,4),...s.slice(4).map(u=>this.parse(u))];if(c)return[s[0],...s.slice(1).map(u=>this.parse(u))]}return s.map(o=>this.parse(o))});if(this.debug(this.pattern,r),this.set=r.filter(s=>s.indexOf(!1)===-1),this.isWindows)for(let s=0;s<this.set.length;s++){const a=this.set[s];a[0]===""&&a[1]===""&&this.globParts[s][2]==="?"&&typeof a[3]=="string"&&/^[a-z]:$/i.test(a[3])&&(a[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let i=0;i<t.length;i++)for(let r=0;r<t[i].length;r++)t[i][r]==="**"&&(t[i][r]="*");const{optimizationLevel:n=1}=this.options;return n>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):n>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(n=>{let i=-1;for(;(i=n.indexOf("**",i+1))!==-1;){let r=i;for(;n[r+1]==="**";)r++;r!==i&&n.splice(i,r-i)}return n})}levelOneOptimize(t){return t.map(n=>(n=n.reduce((i,r)=>{const s=i[i.length-1];return r==="**"&&s==="**"?i:r===".."&&s&&s!==".."&&s!=="."&&s!=="**"?(i.pop(),i):(i.push(r),i)},[]),n.length===0?[""]:n))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let n=!1;do{if(n=!1,!this.preserveMultipleSlashes){for(let r=1;r<t.length-1;r++){const s=t[r];r===1&&s===""&&t[0]===""||(s==="."||s==="")&&(n=!0,t.splice(r,1),r--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(n=!0,t.pop())}let i=0;for(;(i=t.indexOf("..",i+1))!==-1;){const r=t[i-1];r&&r!=="."&&r!==".."&&r!=="**"&&(n=!0,t.splice(i-1,2),i-=2)}}while(n);return t.length===0?[""]:t}firstPhasePreProcess(t){let n=!1;do{n=!1;for(let i of t){let r=-1;for(;(r=i.indexOf("**",r+1))!==-1;){let a=r;for(;i[a+1]==="**";)a++;a>r&&i.splice(r+1,a-r);let l=i[r+1];const o=i[r+2],c=i[r+3];if(l!==".."||!o||o==="."||o===".."||!c||c==="."||c==="..")continue;n=!0,i.splice(r,1);const u=i.slice(0);u[r]="**",t.push(u),r--}if(!this.preserveMultipleSlashes){for(let a=1;a<i.length-1;a++){const l=i[a];a===1&&l===""&&i[0]===""||(l==="."||l==="")&&(n=!0,i.splice(a,1),a--)}i[0]==="."&&i.length===2&&(i[1]==="."||i[1]==="")&&(n=!0,i.pop())}let s=0;for(;(s=i.indexOf("..",s+1))!==-1;){const a=i[s-1];if(a&&a!=="."&&a!==".."&&a!=="**"){n=!0;const l=s===1&&i[s+1]==="**"?["."]:[];i.splice(s-1,2,...l),i.length===0&&i.push(""),s-=2}}}}while(n);return t}secondPhasePreProcess(t){for(let n=0;n<t.length-1;n++)for(let i=n+1;i<t.length;i++){const r=this.partsMatch(t[n],t[i],!this.preserveMultipleSlashes);!r||(t[n]=r,t[i]=[])}return t.filter(n=>n.length)}partsMatch(t,n,i=!1){let r=0,s=0,a=[],l="";for(;r<t.length&&s<n.length;)if(t[r]===n[s])a.push(l==="b"?n[s]:t[r]),r++,s++;else if(i&&t[r]==="**"&&n[s]===t[r+1])a.push(t[r]),r++;else if(i&&n[s]==="**"&&t[r]===n[s+1])a.push(n[s]),s++;else if(t[r]==="*"&&n[s]&&(this.options.dot||!n[s].startsWith("."))&&n[s]!=="**"){if(l==="b")return!1;l="a",a.push(t[r]),r++,s++}else if(n[s]==="*"&&t[r]&&(this.options.dot||!t[r].startsWith("."))&&t[r]!=="**"){if(l==="a")return!1;l="b",a.push(n[s]),r++,s++}else return!1;return t.length===n.length&&a}parseNegate(){if(this.nonegate)return;const t=this.pattern;let n=!1,i=0;for(let r=0;r<t.length&&t.charAt(r)==="!";r++)n=!n,i++;i&&(this.pattern=t.slice(i)),this.negate=n}matchOne(t,n,i=!1){const r=this.options;if(this.isWindows){const m=t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),v=n[0]===""&&n[1]===""&&n[2]==="?"&&typeof n[3]=="string"&&/^[a-z]:$/i.test(n[3]);if(m&&v){const D=t[3],U=n[3];D.toLowerCase()===U.toLowerCase()&&(t[3]=U)}else if(v&&typeof t[0]=="string"){const D=n[3],U=t[0];D.toLowerCase()===U.toLowerCase()&&(n[3]=U,n=n.slice(3))}else if(m&&typeof n[0]=="string"){const D=t[3];D.toLowerCase()===n[0].toLowerCase()&&(n[0]=D,t=t.slice(3))}}const{optimizationLevel:s=1}=this.options;s>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:n}),this.debug("matchOne",t.length,n.length);for(var a=0,l=0,o=t.length,c=n.length;a<o&&l<c;a++,l++){this.debug("matchOne loop");var u=n[l],p=t[a];if(this.debug(n,u,p),u===!1)return!1;if(u===st){this.debug("GLOBSTAR",[n,u,p]);var d=a,f=l+1;if(f===c){for(this.debug("** at the end");a<o;a++)if(t[a]==="."||t[a]===".."||!r.dot&&t[a].charAt(0)===".")return!1;return!0}for(;d<o;){var g=t[d];if(this.debug(`
globstar while`,t,d,n,f,g),this.matchOne(t.slice(d),n.slice(f),i))return this.debug("globstar found match!",d,o,g),!0;if(g==="."||g===".."||!r.dot&&g.charAt(0)==="."){this.debug("dot detected!",t,d,n,f);break}this.debug("globstar swallow a segment, and continue"),d++}return!!(i&&(this.debug(`
>>> no match, partial?`,t,d,n,f),d===o))}let m;if(typeof u=="string"?(m=p===u,this.debug("string match",u,p,m)):(m=u.test(p),this.debug("pattern match",u,p,m)),!m)return!1}if(a===o&&l===c)return!0;if(a===o)return i;if(l===c)return a===o-1&&t[a]==="";throw new Error("wtf?")}braceExpand(){return Ao(this.pattern,this.options)}parse(t){dr(t);const n=this.options;if(t==="**")return st;if(t==="")return"";let i,r=null;(i=t.match(Og))?r=n.dot?Dg:Ig:(i=t.match(wg))?r=(n.nocase?n.dot?Sg:Ag:n.dot?bg:vg)(i[1]):(i=t.match(kg))?r=(n.nocase?n.dot?Mg:Pg:n.dot?Lg:Rg)(i):(i=t.match(_g))?r=n.dot?xg:Tg:(i=t.match(Eg))&&(r=Cg);const s=gr.fromGlob(t,this.options).toMMPattern();return r?Object.assign(s,{test:r}):s}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const n=this.options,i=n.noglobstar?Bg:n.dot?jg:Wg,r=new Set(n.nocase?["i"]:[]);let s=t.map(o=>{const c=o.map(u=>{if(u instanceof RegExp)for(const p of u.flags.split(""))r.add(p);return typeof u=="string"?qg(u):u===st?st:u._src});return c.forEach((u,p)=>{const d=c[p+1],f=c[p-1];u!==st||f===st||(f===void 0?d!==void 0&&d!==st?c[p+1]="(?:\\/|"+i+"\\/)?"+d:c[p]=i:d===void 0?c[p-1]=f+"(?:\\/|"+i+")?":d!==st&&(c[p-1]=f+"(?:\\/|\\/"+i+"\\/)"+d,c[p+1]=st))}),c.filter(u=>u!==st).join("/")}).join("|");const[a,l]=t.length>1?["(?:",")"]:["",""];s="^"+a+s+l+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...r].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,n=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&n)return!0;const i=this.options;this.isWindows&&(t=t.split("\\").join("/"));const r=this.slashSplit(t);this.debug(this.pattern,"split",r);const s=this.set;this.debug(this.pattern,"set",s);let a=r[r.length-1];if(!a)for(let l=r.length-2;!a&&l>=0;l--)a=r[l];for(let l=0;l<s.length;l++){const o=s[l];let c=r;if(i.matchBase&&o.length===1&&(c=[a]),this.matchOne(c,o,n))return i.flipNegate?!0:!this.negate}return i.flipNegate?!1:this.negate}static defaults(t){return Be.defaults(t).Minimatch}}Be.AST=gr;Be.Minimatch=br;Be.escape=yg;Be.unescape=li;function Hg({api:e,onSuccess:t,onFailure:n,lastUploadedAtStorageKey:i,getUploadAllowlist:r}){return{label:"page-views",onSuccess:t,onFailure:n,async getLastUploadedAt(){const s=(await ce.storage.local.get(i))[i];return s??1},setLastUploadedAt(s){return ce.storage.local.set({[i]:s})},async getModelsToUpload({db:s,lastUploadedAt:a,uploadStartedAt:l}){var o;const c=await s.pageViewsRepo.findPageViewsByEndedAt(a,l),u=(o=await r())!=null?o:[];return c.filter(p=>p.imported?!1:!!u.find(d=>Be(p.appId+p.path,d)))},async upload(s,a){const l=a.reduce((o,c)=>{var u,p,d;if(c.endedAt==null)throw Error("Cannot upload a page view that is in progress");const f={duration:lr(c.endedAt-c.startedAt),timestamp:lr(c.startedAt),referrer:c.referrer};return f.duration>0&&(o[u=c.appId]!=null||(o[u]={}),(p=o[c.appId])[d=c.path]!=null||(p[d]={page_views:[]}),o[c.appId][c.path].page_views.push(f)),o},{});await e.uploadPageViews({...s,websites:l})}}}function zg(e){const t=Qh({api:e.api,...e.sessions}),n=Hg({api:e.api,...e.pageViews});return Kh({...e,uploaders:[t,n]})}const Jr={APP_ID:"laankejkbhbdhmipfmgcngdelahlfoji",INSTALL_ID_KEY:"install-id"};var Zg=Object.defineProperty,Yg=(e,t,n)=>t in e?Zg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Dn=(e,t,n)=>(Yg(e,typeof t!="symbol"?t+"":t,n),n);const Kg='"use strict";(()=>{var Pe=Object.create;var Ht=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var Oe=Object.getOwnPropertyNames;var Fe=Object.getPrototypeOf,Ue=Object.prototype.hasOwnProperty;var Le=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var De=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Oe(t))!Ue.call(e,s)&&s!==r&&Ht(e,s,{get:()=>t[s],enumerable:!(o=Me(t,s))||o.enumerable});return e};var Vt=(e,t,r)=>(r=e!=null?Pe(Fe(e)):{},De(t||!e||!e.__esModule?Ht(r,"default",{value:e,enumerable:!0}):r,e));var vt=Le((Bt,Wt)=>{"use strict";(function(e){if(typeof Bt=="object")Wt.exports=e();else if(typeof define=="function"&&define.amd)define(e);else{var t;try{t=window}catch{t=self}t.SparkMD5=e()}})(function(e){"use strict";var t=function(d,l){return d+l&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function o(d,l,i,n,c,a){return l=t(t(l,d),t(n,a)),t(l<<c|l>>>32-c,i)}function s(d,l){var i=d[0],n=d[1],c=d[2],a=d[3];i+=(n&c|~n&a)+l[0]-680876936|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[1]-389564586|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[2]+606105819|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[3]-1044525330|0,n=(n<<22|n>>>10)+c|0,i+=(n&c|~n&a)+l[4]-176418897|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[5]+1200080426|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[6]-1473231341|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[7]-45705983|0,n=(n<<22|n>>>10)+c|0,i+=(n&c|~n&a)+l[8]+1770035416|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[9]-1958414417|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[10]-42063|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[11]-1990404162|0,n=(n<<22|n>>>10)+c|0,i+=(n&c|~n&a)+l[12]+1804603682|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[13]-40341101|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[14]-1502002290|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[15]+1236535329|0,n=(n<<22|n>>>10)+c|0,i+=(n&a|c&~a)+l[1]-165796510|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[6]-1069501632|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[11]+643717713|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[0]-373897302|0,n=(n<<20|n>>>12)+c|0,i+=(n&a|c&~a)+l[5]-701558691|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[10]+38016083|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[15]-660478335|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[4]-405537848|0,n=(n<<20|n>>>12)+c|0,i+=(n&a|c&~a)+l[9]+568446438|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[14]-1019803690|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[3]-187363961|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[8]+1163531501|0,n=(n<<20|n>>>12)+c|0,i+=(n&a|c&~a)+l[13]-1444681467|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[2]-51403784|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[7]+1735328473|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[12]-1926607734|0,n=(n<<20|n>>>12)+c|0,i+=(n^c^a)+l[5]-378558|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[8]-2022574463|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[11]+1839030562|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[14]-35309556|0,n=(n<<23|n>>>9)+c|0,i+=(n^c^a)+l[1]-1530992060|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[4]+1272893353|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[7]-155497632|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[10]-1094730640|0,n=(n<<23|n>>>9)+c|0,i+=(n^c^a)+l[13]+681279174|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[0]-358537222|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[3]-722521979|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[6]+76029189|0,n=(n<<23|n>>>9)+c|0,i+=(n^c^a)+l[9]-640364487|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[12]-421815835|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[15]+530742520|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[2]-995338651|0,n=(n<<23|n>>>9)+c|0,i+=(c^(n|~a))+l[0]-198630844|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[7]+1126891415|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[14]-1416354905|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[5]-57434055|0,n=(n<<21|n>>>11)+c|0,i+=(c^(n|~a))+l[12]+1700485571|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[3]-1894986606|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[10]-1051523|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[1]-2054922799|0,n=(n<<21|n>>>11)+c|0,i+=(c^(n|~a))+l[8]+1873313359|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[15]-30611744|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[6]-1560198380|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[13]+1309151649|0,n=(n<<21|n>>>11)+c|0,i+=(c^(n|~a))+l[4]-145523070|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[11]-1120210379|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[2]+718787259|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[9]-343485551|0,n=(n<<21|n>>>11)+c|0,d[0]=i+d[0]|0,d[1]=n+d[1]|0,d[2]=c+d[2]|0,d[3]=a+d[3]|0}function u(d){var l=[],i;for(i=0;i<64;i+=4)l[i>>2]=d.charCodeAt(i)+(d.charCodeAt(i+1)<<8)+(d.charCodeAt(i+2)<<16)+(d.charCodeAt(i+3)<<24);return l}function h(d){var l=[],i;for(i=0;i<64;i+=4)l[i>>2]=d[i]+(d[i+1]<<8)+(d[i+2]<<16)+(d[i+3]<<24);return l}function f(d){var l=d.length,i=[1732584193,-271733879,-1732584194,271733878],n,c,a,x,O,L;for(n=64;n<=l;n+=64)s(i,u(d.substring(n-64,n)));for(d=d.substring(n-64),c=d.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<c;n+=1)a[n>>2]|=d.charCodeAt(n)<<(n%4<<3);if(a[n>>2]|=128<<(n%4<<3),n>55)for(s(i,a),n=0;n<16;n+=1)a[n]=0;return x=l*8,x=x.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(x[2],16),L=parseInt(x[1],16)||0,a[14]=O,a[15]=L,s(i,a),i}function p(d){var l=d.length,i=[1732584193,-271733879,-1732584194,271733878],n,c,a,x,O,L;for(n=64;n<=l;n+=64)s(i,h(d.subarray(n-64,n)));for(d=n-64<l?d.subarray(n-64):new Uint8Array(0),c=d.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<c;n+=1)a[n>>2]|=d[n]<<(n%4<<3);if(a[n>>2]|=128<<(n%4<<3),n>55)for(s(i,a),n=0;n<16;n+=1)a[n]=0;return x=l*8,x=x.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(x[2],16),L=parseInt(x[1],16)||0,a[14]=O,a[15]=L,s(i,a),i}function m(d){var l="",i;for(i=0;i<4;i+=1)l+=r[d>>i*8+4&15]+r[d>>i*8&15];return l}function g(d){var l;for(l=0;l<d.length;l+=1)d[l]=m(d[l]);return d.join("")}g(f("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(t=function(d,l){var i=(d&65535)+(l&65535),n=(d>>16)+(l>>16)+(i>>16);return n<<16|i&65535}),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function d(l,i){return l=l|0||0,l<0?Math.max(l+i,0):Math.min(l,i)}ArrayBuffer.prototype.slice=function(l,i){var n=this.byteLength,c=d(l,n),a=n,x,O,L,Dt;return i!==e&&(a=d(i,n)),c>a?new ArrayBuffer(0):(x=a-c,O=new ArrayBuffer(x),L=new Uint8Array(O),Dt=new Uint8Array(this,c,x),L.set(Dt),O)}}();function w(d){return/[\\u0080-\\uFFFF]/.test(d)&&(d=unescape(encodeURIComponent(d))),d}function v(d,l){var i=d.length,n=new ArrayBuffer(i),c=new Uint8Array(n),a;for(a=0;a<i;a+=1)c[a]=d.charCodeAt(a);return l?c:n}function R(d){return String.fromCharCode.apply(null,new Uint8Array(d))}function b(d,l,i){var n=new Uint8Array(d.byteLength+l.byteLength);return n.set(new Uint8Array(d)),n.set(new Uint8Array(l),d.byteLength),i?n:n.buffer}function q(d){var l=[],i=d.length,n;for(n=0;n<i-1;n+=2)l.push(parseInt(d.substr(n,2),16));return String.fromCharCode.apply(String,l)}function A(){this.reset()}return A.prototype.append=function(d){return this.appendBinary(w(d)),this},A.prototype.appendBinary=function(d){this._buff+=d,this._length+=d.length;var l=this._buff.length,i;for(i=64;i<=l;i+=64)s(this._hash,u(this._buff.substring(i-64,i)));return this._buff=this._buff.substring(i-64),this},A.prototype.end=function(d){var l=this._buff,i=l.length,n,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a;for(n=0;n<i;n+=1)c[n>>2]|=l.charCodeAt(n)<<(n%4<<3);return this._finish(c,i),a=g(this._hash),d&&(a=q(a)),this.reset(),a},A.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},A.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},A.prototype.setState=function(d){return this._buff=d.buff,this._length=d.length,this._hash=d.hash,this},A.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},A.prototype._finish=function(d,l){var i=l,n,c,a;if(d[i>>2]|=128<<(i%4<<3),i>55)for(s(this._hash,d),i=0;i<16;i+=1)d[i]=0;n=this._length*8,n=n.toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(n[2],16),a=parseInt(n[1],16)||0,d[14]=c,d[15]=a,s(this._hash,d)},A.hash=function(d,l){return A.hashBinary(w(d),l)},A.hashBinary=function(d,l){var i=f(d),n=g(i);return l?q(n):n},A.ArrayBuffer=function(){this.reset()},A.ArrayBuffer.prototype.append=function(d){var l=b(this._buff.buffer,d,!0),i=l.length,n;for(this._length+=d.byteLength,n=64;n<=i;n+=64)s(this._hash,h(l.subarray(n-64,n)));return this._buff=n-64<i?new Uint8Array(l.buffer.slice(n-64)):new Uint8Array(0),this},A.ArrayBuffer.prototype.end=function(d){var l=this._buff,i=l.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c,a;for(c=0;c<i;c+=1)n[c>>2]|=l[c]<<(c%4<<3);return this._finish(n,i),a=g(this._hash),d&&(a=q(a)),this.reset(),a},A.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},A.ArrayBuffer.prototype.getState=function(){var d=A.prototype.getState.call(this);return d.buff=R(d.buff),d},A.ArrayBuffer.prototype.setState=function(d){return d.buff=v(d.buff,!0),A.prototype.setState.call(this,d)},A.ArrayBuffer.prototype.destroy=A.prototype.destroy,A.ArrayBuffer.prototype._finish=A.prototype._finish,A.ArrayBuffer.hash=function(d,l){var i=p(new Uint8Array(d)),n=g(i);return l?q(n):n},A})});var T=class e{constructor(t,r){this.operation=t;this.data=r}static NONCE="z3ZCw_12v";nonce=e.NONCE;static fromObject(t){return!t||t.nonce!==e.NONCE?null:new e(t.operation,t.data)}validate(){return this.nonce===e.NONCE}};var X=class{crawlId;installId;zys;dateCrawlStarted;dateCrawled;crawlUrl;fragmentIndex;youTubeChannelId;youTubeChannelName;youTubeVideoId;constructor(t,r,o,s,u,h,f,p){this.crawlId=t,this.installId=r,this.zys=o,this.dateCrawlStarted=s,this.dateCrawled=u,this.crawlUrl=h,this.fragmentIndex=f,Object.assign(this,p)}get ads(){return this.zys}set ads(t){this.zys=t}};var ct=Vt(vt(),1);var _=class{x;y;width;height;text;sourceUrls;hash;hashOverride;type;typeOverride;canvases;svgs;depth;adRuleId;dedupeKey;duration;language;youTubeId;netflixData;twitterData;vastData;outerHtml;static minWidth=120;static minHeight=28;static minimumVideoToAdAreaRatio=.5;static minimumImageToAdAreaRatio=.05;constructor(t){this.x=t.x??0,this.y=t.y??0,this.width=t.width,this.height=t.height,this.text=t.text??"",this.sourceUrls=t.sourceUrls??[],this.hash=t.hash??"",this.type=t.type,this.canvases=[],this.svgs=[],this.depth=0,this.adRuleId=t.adRuleId,this.duration=t.duration,this.language=t.language,this.youTubeId=t.youTubeId,this.netflixData=t.netflixData,this.twitterData=t.twitterData,this.vastData=t.vastData}};var y=class e{u;t;h;d;width;height;constructor(t){this.u=e.qualifyURL(t.url,t.doc),this.t=t.urlType,this.d=t.depth,this.width=t.width,this.height=t.height}get url(){return this.u}set url(t){this.u=t}get urlType(){return this.t}set urlType(t){this.t=t}get depth(){return this.d}set depth(t){this.d=t}get hash(){return this.h}set hash(t){this.h=t}static SourceUrlTags=new Set(["A","DIV","IFRAME","IMG","LINK","SCRIPT","SPAN","VIDEO"]);static qualifyURL(t,r){if(!t||new RegExp("^(?:\\\\w+-extension)|(?:about)|(?:blob)|(?:javascript):").test(t))return"";r=r||document;let o=r.createElement("a");return o.href=t,o.href}};async function Q(e,t){if(!e)return[];let r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,u=>y.SourceUrlTags.has(u.nodeName)||u?.shadowRoot?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP),o=[],s=r.currentNode;for(;s;){o.push(...await He(s,t));let u=s?.shadowRoot;u&&o.push(...await Q(u?.firstElementChild,t)),s=r.nextNode()}return o.filter(u=>u.url)}async function He(e,t){if(!e||!y.SourceUrlTags.has(e.nodeName))return[];if(e.nodeName=="IMG")return[await qt(e,t)];if(e.nodeName=="DIV"||e.nodeName=="SPAN"){let s=/url\\([\'"]?([^\'"]+)[\'"]?\\)/gi,u=getComputedStyle(e).getPropertyValue("background-image");return Promise.all(Array.from(u.matchAll(s)).filter(h=>h).map(h=>h[1]).map(async h=>{try{let f=new Image;return f.src=h,await f.decode(),qt(f,t)}catch{return new y({url:h,urlType:7,depth:t,doc:e?.ownerDocument})}}))}if(e.nodeName==="VIDEO"){if(e=e.hasAttribute("src")?e:e.querySelector("source"),!e)return[];let s=e.getBoundingClientRect(),u=Math.round(s.width),h=Math.round(s.height);return[new y({url:e.getAttribute("src"),urlType:4,depth:t,width:u,height:h,doc:e.ownerDocument})]}if(e.nodeName==="IFRAME")return[new y({url:e.getAttribute("src"),urlType:1,depth:t,width:e.offsetWidth,height:e.offsetHeight,doc:e.ownerDocument})];let r=null,o=0;switch(e.nodeName){case"SCRIPT":r=e.getAttribute("src"),o=6;break;case"LINK":r=e.getAttribute("href"),o=6;break;case"A":r=e.getAttribute("href"),o=8;break}return[new y({url:r,urlType:o,depth:t,doc:e.ownerDocument})]}async function qt(e,t){let r=e.getAttribute("src"),o=e.getBoundingClientRect(),s=Math.round(e.naturalWidth||o.width),u=Math.round(e.naturalHeight||o.height);if(!(s||u)&&r)try{let f=new Image;f.src=r,await f.decode(),s=f.naturalWidth,u=f.naturalHeight}catch{}let h=0;return(o.width||s)<2&&(o.height||u)<2||s===43&&u===22||o.y+window.scrollY<5&&(o.width||s)<85&&(o.height||u)<=20?h=7:h=3,new y({url:r,urlType:h,depth:t,width:o.width||s,height:o.height||u,doc:e.ownerDocument})}async function ut(e,t){e.sourceUrls=lt(e.sourceUrls,h=>h.u);let r=e.sourceUrls.filter(h=>h.t===3||h.t===4),s=r.filter(h=>h.t===3).sort((h,f)=>(h.width||0)*(h.height||0)-(f.width||0)*(f.height||0)).pop(),u=r.filter(h=>h.t===4);if(e.type=e.typeOverride??(r.length===1&&(r[0].width||0)>=e.width-2&&(r[0].height||0)>=e.height-2?r[0].t===3?1:3:u.length===1&&(u[0].width||0)*(u[0].height||0)>=e.width*e.height*_.minimumVideoToAdAreaRatio?3:7),e.hashOverride)return e.hash=e.hashOverride;if(e.type===7&&!u.length&&(s?.width||0)*(s?.height||0)<e.width*e.height*_.minimumImageToAdAreaRatio)return e.hash="";for(let h of r)h.h=await j(h.u||"",t);if(e.hash=r.filter(h=>h.h).reduce((h,f)=>z(h,f.h),"")||"",e.type===3&&!e.hash&&(e.hash=k(r[0].u??"",!0)),e.type===7&&e.text){let h=k(e.text.toLowerCase(),!0);e.hash=z(e.hash,h)}if(e.hash||(e.canvases?.length&&(e.hash=e.canvases.reduce((h,f)=>z(k(f),h),e.hash)),e.svgs?.length&&(e.hash=e.svgs.reduce((h,f)=>z(k(f),h),e.hash))),e.type===7&&e.hash){let h=k(Be(kt(Math.round(e.height)),kt(Math.round(e.width))),!0);e.hash=z(e.hash,h)}r.forEach(h=>{h.h&&(h.h=btoa(h.h))}),e.hash=btoa(e.hash)}async function j(e,t){try{return k(await t(e))}catch(r){return S(r),""}}function k(e,t){if(Ve(e)==="arraybuffer"){let r=e;return r.byteLength===0?"":ct.default.ArrayBuffer.hash(r,!0)}else{let r=e;return t?ct.default.hash(r,!0):ct.default.hashBinary(r,!0)}}function Ve(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}function z(e,t){if(!t)return e||"";if(!e)return t;if(e.length<t.length){let u=e;e=t,t=u}let r=e.length,o=t.length,s="";for(let u=0;u<o;u++)s+=String.fromCharCode(e.charCodeAt(u)^t.charCodeAt(u));for(let u=o;u<r;u++)s+=String.fromCharCode(e.charCodeAt(u));return s}function kt(e){let t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e,!0),t}function Be(e,t){let r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}var V=3e3;var Et="pc",Ct="ca",et=72e5,Z=null;function S(...e){Z&&(e=e||[],e=e.map(t=>t?.stack&&t.message?{error:t.message,stack:t.stack}:t),e=e.map(t=>typeof t!="object"||t instanceof String?t:JSON.stringify(t)),e.length==1?Z(e[0]):Z(e))}function Jt(e){Z=e||Z}var ht=class{constructor(t,r,o,s){let u=Xt(t);u==="object"?(this.left=0,Object.assign(this,t)):u==="number"&&(this.left=Math.round(Math.max(t||0,0))||0,this.top=Math.round(Math.max(r||0,0))||0,this.width=Math.round(Math.max(o||0,0))||0,this.height=Math.round(Math.max(s||0,0))||0)}get bottom(){return this.top+this.height}get right(){return this.left+this.width}toString(){return`${this.width}x${this.height}@${this.left},${this.top}`}};function We(){return([1e7]+-1e3+-1e3+-1e3+-1e11).replace(/[01]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function Xt(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}function qe(e,t){let r={},o=Object.keys(t);for(let s=0,u=o.length;s<u;s++){let h=o[s];if(t.hasOwnProperty(h)){let f=t[h];if(f==null||f===""&&e[h]||f instanceof Array&&!f.length&&e[h]?.length||(h==="top"||h==="left"||h==="X"||h==="Y")&&e[h]>0)continue;r[h]=t[h]}}return Object.assign(e,t)}function E(e){try{return e()}catch{return null}}var $r=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789").map(e=>e.charCodeAt(0));function zt(e){return e.tagName?.toUpperCase?.()||E(()=>e.outerHTML.substr(1,e.outerHTML.indexOf(" ")-1).toUpperCase())||""}function jt(e){let t=0,r="",o={" ":1,"\\f":1,"\\n":1,"\\r":1,"	":1,"\\v":1,"\\xA0":1,"\\u2028":1,"\\u2029":1};for(let s=0,u=e.length;s<u;s++)o[e.charAt(s)]?(t||(r+=" "),t=1):(t=0,r+=e.charAt(s));return r.trim()}function F(){return ke(C.location.hostname)}function ke(e){return e.split(".").slice(e.endsWith(".uk")||e.endsWith(".jp")?-3:-2).join(".")}function pt(){let e=new Set(["aarp.org","abc.com","aol.com","attn.com","atttvnow.com","brainly.com","bravotv.com","cartoonnetwork.com","cbs.com","cbssports.com","chron.com","citationmachine.net","cnet.com","cnn.com","crunchyroll.com","dailymail.co.uk","delish.com","discoveryplus.com","easybib.com","espn.com","fandom.com","foxbusiness.com","foxnews.com","fubo.tv","genius.com","go.cnn.com","go.com","goodhousekeeping.com","happykids.tv","hulu.com","imdb.com","investigationdiscovery.com","linkedin.com","locast.org","mlb.com","msn.com","music.amazon.com","music.apple.com","music.youtube.com","mytuner-radio.com","nexusmods.com","nfl.com","nhl.com","nypost.com","nytimes.com","paramountplus.com","pch.com","philo.com","playstation.com","pluto.tv","rawstory.com","realtor.com","refinery29.com","seattlepi.com","sfgate.com","sling.com","spanishdict.com","sporcle.com","steampowered.com","tablotv.com","therokuchannel.roku.com","try.frndlytv.com","tubitv.com","tv.apple.com","tv.youtube.com","twitch.tv","uproxx.com","usatoday.com","vudu.com","washingtonpost.com","watch.hgtv.com","watch.spectrum.net","weather.com","www3.nhk.or.jp","xbox.com","xfinity.com","yahoo.com","yelp.com","youtubekids.com"]);return I&&(e.has(C.location.hostname)||e.has(F()))}function U(e){e.documentElement&&(e=e.documentElement);let t=zt(e);if(e.offsetParent===null&&t!=="BODY"&&t!=="HTML"&&t!=="FRAME")return new ht;let o=(e.ownerDocument||document).defaultView||C,s=e.getBoundingClientRect();return new ht(s.left+o.scrollX,s.top+o.scrollY,s.width,s.height)}var Gt=["background-image","display","visibility","z-index","border-top-width","border-left-width","border-bottom-width","border-right-width","padding-top","padding-left","padding-bottom","padding-right","position","width","height","top","bottom","left","right","font-size"];function je(e){if(e._pm_st)return e.style&&(e._pm_st=qe(e._pm_st,JSON.parse(JSON.stringify(e.style,Gt)))),e._pm_st;let t=e.ownerDocument?.defaultView;typeof window<"u"&&(!t||!t.opener)&&(t=window);let r=JSON.parse(JSON.stringify(t.getComputedStyle(e),Gt));return e._pm_st=r,r}function Kt(e,t){let r=e.nodeName,o=je(e),s=U(e);if(o?.display!=="none"&&s&&s.width>20&&s.height>20)if(r==="CANVAS"&&!e.matches(".__pm_marker"))try{t.canvases.push(e.toDataURL("image/jpeg",.2))}catch{}else r==="SVG"&&t.svgs.push(e.outerHTML)}function mt(e){if(!e)return"";let t=e?.ownerDocument||document,r=t.defaultView.NodeFilter;if(Xt(e)==="htmldocument"&&e.body&&(e=e.body),!e)return"";let o={SCRIPT:1,NOSCRIPT:1,STYLE:1},s=zt(e);if(s==="HTML"&&(e=e.querySelector("body")),!e)return"";let u=function(m){try{return m.nodeType===3?r.FILTER_ACCEPT:!m.tagName||o[m.tagName]||m.offsetParent===null?r.FILTER_REJECT:r.FILTER_ACCEPT}catch{return r.FILTER_REJECT}};if(e.nodeType!==3&&(!s||o[s]))return"";let h=t.createTreeWalker(e,r.SHOW_ELEMENT|r.SHOW_TEXT,{acceptNode:u},!0),f={"LEARN MORE":1,REPLAY:1},p=[];for(;e;){if(e.nodeType===3){let m=jt(e.nodeValue||"");!f[m.toUpperCase()]&&!p.includes(m)&&p.push(m)}e=h.nextNode()}return p.length?jt(p.join(" ")):""}function P(e,t){return C.requestIdleCallback?{id:C.requestIdleCallback(e,{timeout:t}),isIdleCallback:!0}:{id:setTimeout(e,t),isIdleCallback:!1}}var tt=null;function G(e){tt=e||tt}function It(){tt=null}function Yt(){if(typeof window>"u")return;let e=function(f,p,m,g){P(()=>{!tt||!f||tt(f,p,m,g)},1e4)},t=f=>new TextDecoder("utf-8").decode(new Uint8Array(f)),r=function(f,p){try{if(p=f.currentTarget||p,p=p._datadog_xhr||p,p.readyState===4&&p.status>=200&&p.status<=210){let m=E(()=>p.responseXML),g=E(()=>p.responseText)||E(()=>t(p.response))||E(()=>m.documentElement.outerHTML);(g||m)&&e(g,m,p.reponseType==="json",p.responseURL)}}catch{}},o=XMLHttpRequest.prototype.send;function s(){let f=this.onreadystatechange,p=arguments;this.onreadystatechange=function(m){return r(m,this),f?.apply?.(this,arguments)},o.apply(this,p)}XMLHttpRequest.prototype.send=s;let u=C.fetch,h=function(){return u.apply(this,arguments).then(f=>{let p=f.headers.get("Content-Type");if(p&&(p.includes("text")||p.includes("json")||p.includes("xml")||p.includes("javascript"))){let m=f.clone();P(()=>{m.text().then(g=>e(g,null,p.includes("json"),f.url))},5e3)}return f})};C.fetch=h}function Tt(e){if(!e)return null;let t=null;return e=(e+"").trim(),e=="start"?t=0:e.indexOf(":")>=0?t=E(()=>Math.round(e.split(":").reduce((r,o,s,u)=>r+parseFloat(o)*Math.pow(60,u.length-s-1),0)))||t:isNaN(e)||(t=Math.round(parseFloat(e))),t}var Qt,$,Zt,St,H,dt,ft;function te(e){H[e.dedupeKey]?.depth>e.depth||H[e.dedupeKey]?.depth===e.depth&&H[e.dedupeKey].adRuleId<e.adRuleId||(H[e.dedupeKey]=e)}function Ge(){let e=C.location;return e.href.indexOf("youtube.com/watch")===-1?e.origin+e.pathname:e.href}async function $e(e){await Promise.all(e.map(t=>ut(t,M)))}async function Je(){let e=Object.values(H),t=Object.values(dt);return H={},dt={},await $e(e),new X(Qt,gt,e.concat(t).filter(r=>r.hash),$-(D?.TimeOffset||0),Date.now()-(D?.TimeOffset||0),St,Zt++,ft)}function N(e,t){if(!I){W(top,new T(Et,[e,t]));return}e.forEach(r=>dt[r.hash]=r),ft=t||ft,B()}var $t=0;async function B(){let e=Date.now();if(e-$t>V){$t=e;let t=await Je();Nt?.(JSON.stringify(t))}}function ee(){if(!I)return;Qt=We(),$=Date.now(),Zt=0;let e=D?.ParsedSiteConfigs[F()];if(e){let t=new RegExp(e).exec(location.href);St=t?t.slice(1).join(""):location.protocol+"://"+location.hostname}else St=Ge();H={},dt={},ft=void 0}function Xe(e,t){return e.reduce(function(r,o){return(r[t(o)]=r[t(o)]||[]).push(o),r},{})}function lt(e,t){return Object.values(Xe(e,t)).map(r=>r[0])}function W(e,t){e.postMessage(t,"*")}var re=null;function ne(){let e=document.querySelector("video.ad-video-player,video#ad-video-player"),t=document.querySelector(".AdUnitView a"),r=e&&e.src;if(e&&t&&r&&re!==r&&r.endsWith(".mp4")&&r.indexOf("bumper")===-1&&(r.indexOf("ads")>=0||r.indexOf("Ads")>=0)){if(!e.duration||isNaN(e.duration))return;re=r,P(()=>{j(r,M).then(o=>N([new _({width:1920,height:1080,sourceUrls:[new y({url:r,urlType:4}),new y({url:t.href,urlType:8})],hash:btoa(o),type:3,duration:Math.round(e.duration)})]))});return}}var yt={},ie=!1;function oe(){if(S("NETFLIX AD CAPTURE"),!(typeof window>"u")){if(!ie){let e=Object.defineProperty;Object.defineProperty=function(r,o,s){return Date.now()-$<et&&P(()=>{if(Object.hasOwn(r,"isAd")&&r.isAd){let u=ze(r);u&&(yt[u.hash]=u)}}),e(r,o,s)},ie=!0}N(Object.values(yt)),yt={}}}function ze(e){let t=e.movieId;if(!t||yt[t])return;let r=e.video_tracks[0].streams[0],o=r.res_w,s=r.res_h,u=e.audio_tracks[0].streams[0];return new _({hash:("n+++"+t).padEnd(t.length+4+(t.length+4)*6%8/2,"=").replace("===","A=="),type:3,sourceUrls:[new y({url:r.urls[0].url,urlType:4,width:o,height:s}),new y({url:u.urls[0].url,urlType:9})],width:o,height:s,duration:e.duration,language:u.language,netflixData:{id:t}})}var rt=[];async function Rt(){S("TWITTER AD CAPTURE"),G((e,t,r,o)=>{try{if(!o||!o.includes("HomeTimeline")&&!(o.includes("/conversation/")&&o.includes("/"+/\\d+$/.exec(window.location.pathname)[0]+".json")))return;let s=Ke(e);rt=rt.concat(s)}catch{}}),await Ye()}function Ke(e){let t=JSON.parse(e);return([].concat.apply([],t?.data?.home?.home_timeline_urt?.instructions?.filter?.(s=>s?.type=="TimelineAddEntries")?.map?.(s=>s.entries))||[]).map(s=>s.content?.itemContent).filter(s=>s?.promotedMetadata).map(s=>{let u=s.tweet_results?.result?.card?.legacy?.binding_values?.filter?.(f=>f?.key=="unified_card")?.map?.(f=>JSON.parse(f.value?.string_value))?.[0],h=u?.destination_objects?.browser_1?.data?.url_data?.url||u?.destination_objects?.browser_with_docked_media_1?.url_data?.url;return{id_str:s?.tweet_results?.result?.rest_id,screen_name:s?.tweet_results?.result?.core?.user_results?.result?.legacy?.screen_name,cardDestination:h,advertiserId:s?.promotedMetadata?.advertiser_results?.result?.rest_id,user_id_str:s?.tweet_results?.result?.legacy?.user_id_str}}).filter(s=>s.id_str&&s.screen_name)}async function Ye(){if(!nt)return;let e=await Qe(document,rt),t=e.map(r=>r.twitterData.tid);rt=rt.filter(r=>!t.includes(r.id_str)),N(e)}async function Qe(e,t){let r="div.tweet.promoted-tweet",o=Array.from(e.querySelectorAll(r));o.length||(o=Array.from(e.querySelectorAll("article div>svg")).map(u=>u.parentElement.querySelector("span")).filter(u=>u?.textContent&&u.textContent.length<50).map(u=>u.closest("article"))),o.length||(o=Array.from(document.querySelectorAll("span")).filter(u=>u.textContent==="Ad").map(u=>u.closest("article")));let s=[];for(let u=0;u<o.length;u++){let h=o[u],f=Array.from(h.querySelectorAll("div>span,a span")).map(b=>b.textContent).filter(b=>b?.startsWith("@"))[0];f=f.startsWith("@")?f.substring(1):f;let p=null,m=null;for(m of t)if(m.screen_name==f&&(p=m.id_str,p))break;if(!p)continue;let g=mt(h);g&&(g=g.replace(new RegExp("# (\\\\w)","gi"),"#$1"));let w=U(h),v=new _({x:w.left,y:w.top,width:w.width,height:w.height,text:g,sourceUrls:(await Q(h.querySelector(".tweet-details-fixer")||h)).concat([new y({url:m.cardDestination,urlType:8})]).filter(b=>b.url&&!b.url.includes("/profile_images/")&&!b.url.includes(p+"/retweets")&&!b.url.includes(p+"/likes")&&!b.url.includes("/using-twitter/how-to")),hash:("t+++"+p).padEnd(p.length+4+(p.length+4)*6%8/2,"=").replace("===","A=="),type:h.querySelector("video")||h.querySelector(".PlayableMedia")?105:Array.from(h.querySelectorAll("img")).filter(b=>b.naturalWidth>200&&b.naturalHeight>40).length?104:h.querySelector("iframe")?102:103,twitterData:{taid:m.advertiserId||m.user_id_str||0,tid:p,tsn:f}}),R=(v.sourceUrls||[]).filter(b=>b?.url);v.sourceUrls=lt(R,b=>b.url),s.push(v)}return s}function Pt(){S("VAST AD CAPTURE"),G((e,t,r)=>{try{let o=e.substring(0,500),s=o.indexOf(\'"ad_id":\')>=0||o.indexOf(\'"ad_type"\')>=0,u=[];if(r||s)Ze(e,u);else if(o.indexOf("<VAST ")>=0||o.indexOf("<vmap:AdBreak ")>=0){let h=E(()=>t?.documentElement||e&&new DOMParser().parseFromString(e,"application/xml").documentElement);tr(h,u)}else return;Promise.allSettled(u).then(h=>{S("Ads found.",h.map(f=>f.value)),N(h.map(f=>f.value).filter(f=>f))})}catch(o){S(o)}})}function Ze(e,t){let r=E,o=r(()=>e&&JSON.parse(e)),s=r(()=>o.items);s?.length&&Array.from(s).forEach(u=>{let h=r(()=>u.media.streamurl);if(!h)return;let f=r(()=>u.clickthrough),p=r(()=>u.media.duration),m=r(()=>u.ad_id||u.ad_video_id),g=r(()=>u.title);m&&F()==="peacocktv.com"&&(m=m.split(".")[0]);let w=r(()=>u.system);t.push(j(h,M).then(v=>new _({width:1920,height:1080,sourceUrls:[new y({url:h,urlType:4}),new y({url:f,urlType:8}),new y({url:"http://"+w,urlType:1})].filter(b=>b.url),hash:btoa(v)||m,type:3,duration:Math.round(p),vastData:{Id:m,Title:g,System:w}})))})}function tr(e,t){let r=E,o=r(()=>e?.querySelectorAll("VAST Ad"));o&&Array.from(o).forEach(s=>{let u=s.querySelector("Creatives Creative");if(!u)return;let h=u.querySelector("MediaFiles");if(!h)return;let f=r(()=>u.querySelector("VideoClicks ClickThrough").textContent.trim())||r(()=>document.querySelector(".AdUnitView a").href.trim()),p=r(()=>Tt(u.querySelector("Duration").textContent)),m=r(()=>h.querySelector("MediaFile[type=\'video/mp4\'],MediaFile[type=\'application/dash+xml\'],MediaFile[type=\'video/mpd\']").textContent.trim());if(!m){let l=u.querySelector("AdParameters"),i={},n,c=new RegExp("<(\\\\w+)>([^<]+)</\\\\1>","gi");for(;(n=c.exec(l.textContent))!==null;)i[n[1]]=n[2];p=r(()=>Tt(i.adDuration)),f=r(()=>i.clickUrl);let a=i.JsParameters;if(!a)return;let x=JSON.parse(a);m=r(()=>x.videos[0].url),m&&(p=p||x.duration,f=f||x.clickThruUrl||x.clickThroughUrl)}if(!m)return;let g=u.getAttribute("AdID")||u.getAttribute("AdId")||u.getAttribute("adid")||s.getAttribute("id");if(!g)return;F()==="peacocktv.com"&&(g=g.split(".")[0]);let w=r(()=>s.querySelector("AdTitle").textContent.trim()),v=r(()=>s.querySelector("AdSystem").textContent.trim()),R=s.querySelector("Extension"),b=r(()=>R.querySelector("CreativeParameter[name=\'_fw_advertiser_name\']").textContent.trim())||r(()=>R.querySelector("CreativeParameter[name=\'fw_advertiser_name\']").textContent.trim())||r(()=>R.querySelector("CreativeParameter[name=\'fw_advertiser\']").textContent.trim()),q=r(()=>R.querySelector("CreativeParameter[name=\'fw_brand\']").textContent.trim()),A=r(()=>R.querySelector("CreativeParameter[name=\'industry\']").textContent.trim()),d=r(()=>R.querySelector("CreativeParameter[name=\'ccr_measurement\']").textContent.trim());t.push(j(m,M).then(l=>new _({width:1920,height:1080,sourceUrls:[new y({url:m,urlType:4}),new y({url:f,urlType:8}),new y({url:d,urlType:0})].filter(i=>i.url),hash:btoa(l)||g,type:3,duration:Math.round(p),vastData:{Id:g,Adv:b,Brand:q,Cat:A,Title:w,System:v}})))})}var ae=Vt(vt(),1);function er(e){return e?new URL(e).searchParams.get("v"):null}var Mt;function wt(){return Mt||(Mt=document.querySelector("#movie_player")),Mt}function rr(){return E(()=>{let e=JSON.parse(wt().getDebugText());return e.ad_debug_videoId||e.addebug_videoId||e.ad_videoId})}function nr(){return E(()=>{let e=document.querySelector("#upload-info a.yt-simple-endpoint"),t=e.href.split("/");return{youTubeChannelId:t[t.length-1],youTubeChannelName:e.textContent.trim(),youTubeVideoId:E(()=>er(window.location.href))}})}function ir(){let e=E(()=>document.querySelector(".ytp-ad-player-overlay-instream-info .ytp-ad-button-text").textContent);if(e&&ar.test(e)){let t=e.indexOf("http://")===0||e.indexOf("https://")===0?e:"https://"+e.toLowerCase();return new y({url:t,urlType:8})}return null}function or(e){return e?btoa(ae.default.hash("YouTube+"+e,!0)):null}function sr(){return E(()=>wt().getAdState()>0||JSON.parse(wt().getDebugText()).addebug_videoId)}var ar=new RegExp("^(?:https?://)?[a-z0-9.-]+(\\\\.[a-z]+)+(?:$|/)"),ce={};function se(e){[e?.playerAds??[],e?.adPlacements??[]].flat().map(t=>(t.adPlacementRenderer?.renderer?.linearAdSequenceRenderer?.linearAds?.map(r=>r?.instreamVideoAdRenderer)??[]).concat([t.adPlacementRenderer?.renderer?.instreamVideoAdRenderer])).flat().filter(t=>t).map(function(t){let r=t?.playerOverlay?.instreamAdPlayerOverlayRenderer?.visitAdvertiserRenderer?.buttonRenderer?.navigationEndpoint?.urlEndpoint?.url;return r?{videoId:t.externalVideoId,lp:r}:null}).filter(t=>t).reduce((t,r)=>Object.assign(t,{[r.videoId]:new y({url:r.lp,urlType:8})}),ce)}function ue(){try{if(G((p,m,g,w)=>{try{if(!w||!w.includes("/ad_break?")&&!w.includes("/player?"))return;se(JSON.parse(p))}catch(v){S(v)}}),!sr())return B();se(window.ytInitialPlayerResponse);let e=0,t=640,r=360,o=0,s=0,u=wt(),h=u.querySelector("a.ytp-title-link"),f=u.querySelector("video");if(f){e=f.duration||0;let p=U(f);t=p?.width||t,r=p?.height||r,o=p?.left||o,s=p?.top||s}P(()=>{let p=rr()||void 0,m=ce[p]??ir(),g=nr(),w=m?[m]:[],v=new _({x:o,y:s,width:t,height:r,text:h?.textContent,sourceUrls:w,hash:or(p),type:3,duration:Math.round(e),youTubeId:p});N([v],g)})}catch(e){S(e)}}var it=class{constructor(t=null){this.log=t,this.#t.log=t??(()=>{})}simplifyTree(t){let r;for(;;){if(r=this.#t[t.r],!r)throw new Error(`Rule ${t.r} not implemented.`);if(r!==this.#t.PassOn||!t.c||!t.c.length)break;t=t.c[0]}return t.c&&t.c.length&&(t.c=t.c.map(o=>this.simplifyTree(o))),t}debugPrintParseTree(t,r=0){this.log(`${" ".repeat(r*2)}${t.r}: ${this.#t.GetText(t)}`),t.c&&t.c.length&&t.c.forEach(o=>this.debugPrintParseTree(o,r+1))}isValidRuleName(t){return t.indexOf("TerminalNode")===0||!!this.#t[t]}evaluate(t,r){return this.#t.evaluate(t,r)}#t=class{static#s=0;static evaluate(t,r,o){try{if(!this[t.r])throw new Error(t.r+" is not a parser rule function.");return this[t.r](t,r,o)}catch(s){this.log("Error "+t.r+\' at "\'+this.GetText(t)+\'": \'+s)}}static#i=new RegExp(`(?:^[\'"])|(?:[\'"]$)`,"g");static#o=new RegExp("\\\\s+","g");static#a=this;static PassOn(t,r){return this.evaluate(t.c[0],r)}static NoOp(t){this.log(`Unimplemented rule: ${t.r} at "${this.GetText(t.t)}".`)}static ExpStmt=this.PassOn;static ExpSequence=this.PassOn;static LitExp=this.PassOn;static Literal=this.PassOn;static ArrayLitExp=this.PassOn;static ArrayLit=this.PassOn;static ArrowFuncBody=this.PassOn;static ObjectLitExp=this.PassOn;static IdName=this.PassOn;static MultOperator=this.NoOp;static AdditionOperator=this.NoOp;static RelationalOperator=this.NoOp;static EqualityOperator=this.NoOp;static ReservedWord=this.NoOp;static AssignExp=this.NoOp;static VarModifier=this.NoOp;static FormalParameterList=this.NoOp;static FormalParameterArg=this.NoOp;static PropAssign=this.NoOp;static Exp=this.NoOp;static Assignable=this.NoOp;static AnonFunc=this.NoOp;static ArrowFuncParameters=this.NoOp;static PropName(t){return t.c?t.c[0].t:this.#r(t.t)}static ObjectLit(t,r){let o={};return t.c.forEach(s=>this.PropExpAssign(s,r,o)),o}static PropExpAssign(t,r,o){let s=this.evaluate(t.c[0],r),u=this.evaluate(t.c[1],r);o[s]=u}static#r(t){return t?.replaceAll(this.#i,"")}static StrLit(t){return this.#r(t?.t)}static NumLit(t){return Number.parseFloat(t?.t)}static IntLit(t){return Number.parseInt(t?.t)}static BoolLit(t){return t.t&&t.t=="true"}static NullLit(){return null}static IdExp(t,r){return this.evaluate(t.c[0],r)}static Id(t,r){return r[t.t]}static FuncExp(t,r){return this.evaluate(t.c[0],r)}static ArrowFunc(t,r){let o=t.c[0]?.c?.map(u=>this.#e(u)).flat(),s=this;return function(...u){o.forEach((f,p)=>{r[f]=u[p]});let h=s.evaluate(t.c[1],r);return o.forEach(f=>{delete r[f]}),h}}static AnonFuncDecl(t,r){let o=t.c[0]?.c?.map(u=>this.#e(u)).flat(),s=this;return function(...u){o.forEach((f,p)=>{r[f]=u[p]});let h=s.evaluate(t.c[1],r);return o.forEach(f=>{delete r[f]}),h}}static#e(t,r=null){return r=r??[],t.c?.forEach(o=>this.#e(o,r)),t.t&&r.push(t.t),r}static#c(t,r=0){this.log(`${"  ".repeat(r)}${t.r}: ${this.GetText(t)}`)}static GetText(t){return this.#e(t).join(" ")}static ElementList(t,r){return t.c.map(o=>this.evaluate(o,r))}static ArrayElem=this.PassOn;static ArgsExp(t,r){let o=t.c[0],s=this.evaluate(t.c[1],r),u=this.evaluate(o,r,s);return typeof u=="function"&&(u=u.apply(o._this??null,s)),delete o._this,u}static Args(t,r){return t.c.map(o=>this.evaluate(o,r))}static Arg(t,r){return this.evaluate(t.c[0],r)}static MemberDotExp(t,r,o){return this.#n(t,r,o,!0)}static MemberIndexExp(t,r,o){return this.#n(t,r,o)}static#n(t,r,o,s){let u=this.evaluate(t.c[0],r),h=s?t.c[1].t:this.evaluate(t.c[1],r);return this["_x_"+h]?this["_x_"+h](u,...o??[]):(t._this=u,u[h])}static ErrorNodeImpl(t){this.log(`Error parsing ${t.r} at ${t.t} (unexpected token?)`)}static AdditiveExp(t,r){switch(t.c[1].t){case"+":return this.evaluate(t.c[0],r)+this.evaluate(t.c[2],r);case"-":return this.evaluate(t.c[0],r)-this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static MultiplicativeExp(t,r){switch(t.c[1].t){case"*":return this.evaluate(t.c[0],r)*this.evaluate(t.c[2],r);case"/":return this.evaluate(t.c[0],r)/this.evaluate(t.c[2],r);case"%":return this.evaluate(t.c[0],r)%this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static RelationalExp(t,r){switch(t.c[1].t){case">":return this.evaluate(t.c[0],r)>this.evaluate(t.c[2],r);case"<":return this.evaluate(t.c[0],r)<this.evaluate(t.c[2],r);case">=":return this.evaluate(t.c[0],r)>=this.evaluate(t.c[2],r);case"<=":return this.evaluate(t.c[0],r)<=this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static EqualityExp(t,r){switch(t.c[1].t){case"==":return this.evaluate(t.c[0],r)==this.evaluate(t.c[2],r);case"!=":return this.evaluate(t.c[0],r)!=this.evaluate(t.c[2],r);case"===":return this.evaluate(t.c[0],r)===this.evaluate(t.c[2],r);case"!==":return this.evaluate(t.c[0],r)!==this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static TernaryExp(t,r){return this.evaluate(t.c[0],r)?this.evaluate(t.c[1],r):this.evaluate(t.c[2],r)}static CoalesceExp(t,r){return this.evaluate(t.c[0],r)??this.evaluate(t.c[1],r)}static InstanceofExp(t,r){return this.evaluate(t.c[0],r)instanceof this.evaluate(t.c[1],r)}static LogicalAndExp(t,r){return this.evaluate(t.c[0],r)&&this.evaluate(t.c[1],r)}static LogicalOrExp(t,r){return this.evaluate(t.c[0],r)||this.evaluate(t.c[1],r)}static UnaryPlusExp(t,r){return+this.evaluate(t.c[0],r)}static UnaryMinusExp(t,r){return-this.evaluate(t.c[0],r)}static BitNotExp(t,r){return~this.evaluate(t.c[0],r)}static NotExp(t,r){return!this.evaluate(t.c[0],r)}static ParenthesizedExp(t,r){return this.evaluate(t.c[0],r)}static Eos(){return null}static _x_query(t,r){return Array.from(t?.querySelectorAll(r)??[])}static _x_where(t,r){return t?.filter(r)}static _x_select(t,...r){let o=r.length;if(!r||o===0)throw new Error("Method \'select\' expects on or more arrow functions.");return t?.map((s,u)=>{if(o>1){let h=[];for(let f=0;f<o-1;f++)h[f]=r[f](s,...f==0?[u]:h);return r[o-1](s,...h)}else return r[0](s,u)})}static _x_width(t){return t?.offsetWidth}static _x_height(t){return t?.offsetHeight}static _x_text(t){return t?.textContent?.trim()?.replaceAll(this.#o," ")}static _x_parent(t){return t?.parentNode}static _x_matchRegExp(t,r,o){return t.match(new RegExp(r,o))}}};function Ot(e){if(e.checkVisibility&&!e.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}))return!1;let t=e.ownerDocument,r=t.defaultView,o=r?.getComputedStyle(e);if(o&&(o.opacity==="0"||o.visibility==="hidden"))return!1;let s=e.getBoundingClientRect();if(!s||s.width<=0||s.height<=0)return!1;let{top:u,left:h,right:f,bottom:p}=s;if(f<0||p<0)return!1;let m=r?.innerWidth||t.documentElement.clientWidth,g=r?.innerHeight||t.documentElement.clientHeight;if(u>g||h>m)return!1;let w=e.parentNode;if(w&&w instanceof Element&&getComputedStyle(w).overflow==="hidden"){let v=w.getBoundingClientRect();if(p<v.top||u>v.bottom||f<v.left||h>v.right)return!1}return!0}function le(e,t){return r=>new Promise(o=>{let s=e+"-response",u=Math.random(),h=p=>{let{type:m,payload:g,nonce:w}=p.data??{};m!==s||w!==u||(o(g),f())},f=()=>{window.removeEventListener("message",h)};window.addEventListener("message",h),s==="getFrameId-response"?r.postMessage(new T("getFrameId",u),"*"):window.postMessage({type:e,nonce:u,payload:r},"*"),t&&setTimeout(o,t)})}var de,fe,pe,J,_t=new Set,bt=new Set,Ft=new Set,at=!1,Ut=[],me=[],Nt,M,D,gt,nt,C=typeof window>"u"?{location:{hostname:""}}:window,I=C.top===C.self,cr=(Math.random()+1).toString(36).substring(2),ur=2e3,ge=7e3,lr=5*ge,hr=2e3;function st(e,t,...r){let o=setTimeout(e,t,...r);return _t.add(o),o}function ot(e,t,...r){let o=setInterval(e,t,...r);return bt.add(o),o}function Lt(e,t){let r=P(e,t);return r.isIdleCallback?Ft.add(r.id):_t.add(r.id),r}var dr={"hulu.com":[ne],"netflix.com":[oe],"twitter.com":[Rt],"x.com":[Rt],"youtube.com":[ue]};at||(typeof F<"u"&&(J=F()),typeof pt<"u"&&(pt()||ye())&&Yt());function ye(){return dr[J]}function fr(){if(!I||!nt)return;if(pt()){Pt();let s=new Set,u=()=>{let h=Array.from(C.frames).concat(Array.from(document.querySelectorAll("frame,iframe")).map(f=>E(f.contentWindow)).filter(f=>f));for(let f=0;f<h.length;f++)try{let p=h[f];if(!p||s.has(p))continue;W(p,new T(Ct,et-(Date.now()-$))),s.add(p)}catch(p){S(p)}};u(),ot(u,5e3)}let e=Date.now(),t=ye(),r=function(s){e=Date.now(),Lt(async()=>{for(let u=0,h=t?.length;t&&u<h;u++)await t[u].call();I&&(t||s)&&B()},V-500)},o=ot(r,V);r(!0),ot(()=>{Date.now()-e>V*5&&(clearInterval(o),bt.delete(o),o=ot(r,V),r(!0))},V)}function we(){I&&(J=F(),_t=new Set,bt=new Set,Ft=new Set,ee(),B())}function pr(){if(!I)return;let e=D.AdRules.filter(o=>!o.Hostnames||o.Hostnames.startsWith("^")&&!o.Hostnames.includes(J)),t=D.AdRules.filter(o=>o.Hostnames&&!o.Hostnames.startsWith("^")&&o.Hostnames.includes(J)),r=e.concat(t);st(()=>{Pr();let o=ot(()=>{he(r)},ge);he(r),st(()=>{t.length?r=t:clearInterval(o)},lr)},ur)}var mr=new Set(["facebook.com","hulu.com","netflix.com","twitter.com","x.com"]);function Ae(){fr(),mr.has(J)||pr(),st(wr,et)}function gr(e){if(!I)return;let t=C.location.href.split("#")[0];setInterval(()=>{let r=C.location.href.split("#")[0];r!==t&&(t=r,e())},1e3)}function _e(){_t.forEach(e=>clearTimeout(e)),bt.forEach(e=>clearInterval(e)),Ft.forEach(e=>cancelIdleCallback(e))}function yr(){_e(),we(),Ae()}function wr(){It(),_e()}function Ar(e){at?ut(e,M).then(()=>window.dispatchEvent(new CustomEvent("displayAdFound",{detail:e}))):te(e)}async function _r(e){try{let t=T.fromObject(e.data);if(!t)return;let r=t.data;switch(t.operation){case Ct:r>0&&(Pt(),st(It,r));break;case Et:N(r[0],r[1]);break;case"extractDisplayAd":I||await At(document.documentElement,r);break;case"displayAdFound":I&&Ar(r);break;case"getFrameId":W(e.source,{type:"getFrameId-response",payload:cr,nonce:r});break}}catch(t){S(t);return}}function br(){function e(){C.addEventListener("message",_r,!0)}e();let t=setInterval(e,200);setTimeout(clearInterval,1e4,t)}function xr(e){fe=e.getInstallId,at=e.isRuleEditor,Nt=e.sendData,M=e.fetchHttpResponse,de=e.getExternalConfiguration?t=>e.getExternalConfiguration(t):null,Jt(e.pm_log)}function be(e){pe=le("getFrameId",1e3),M=e.fetchHttpResponse,br(),I&&(xr(e),fe().then(t=>gt=t).then(t=>de()).then(t=>D=t||{EnabledPct:0}).then(t=>{nt=Array.from(gt).map(r=>r.charCodeAt(0)).reduce((r,o)=>r+o,0)%100<D.EnabledPct,nt&&(we(),Ae(),gr(yr))}))}async function vr(e,t){at||(I||(t.dedupeKey=await pe(e.ownerDocument.defaultView)),t.dedupeKey??=`${t.width}x${t.height} @ ${t.x},${t.y}`),W(top,new T("displayAdFound",t))}async function Sr(e,t){if(e){let r=U(e);(t.isFromIFrame||e.nodeName!=="IFRAME")&&(t.x+=r.left,t.y+=r.top),t.sourceUrls.push(...await Q(e,t.depth)),t.text+=mt(e)+" ";let o=Array.from(e.querySelectorAll("canvas, svg"));o.length&&o.forEach(s=>Kt(s,t))}}async function At(e,t){if(await Sr(e,t),e.nodeName==="IFRAME"){t.depth++,t.outerHtml=e.outerHTML;try{await At(e.contentWindow.document.documentElement,t)}catch{W(e.contentWindow,new T("extractDisplayAd",t));try{var r=e.contentWindow.frames;for(let s=0,u=r.length;s<u;s++)try{W(r[s],new T("extractDisplayAd",t))}catch(h){S(h)}}catch(s){S(s)}}}else{e.nodeName==="HTML"&&(t.outerHtml+=`<!-- IFRAME Content -->${e.outerHTML}`);let o;if(t.isFromIFrame){if(e.scrollWidth<=t.width-5||e.scrollHeight<=t.height-5)return;o=Array.from(e.querySelectorAll("iframe")).filter(s=>(s.scrollWidth>=t.width||s.scrollHeight>=t.height)&&s.scrollWidth>=_.minWidth&&s.scrollHeight>=_.minHeight&&Ot(s))}else o=Array.from(e.querySelectorAll("iframe")).filter(s=>Ot(s)).sort((s,u)=>s.scrollWidth*s.scrollHeight-u.scrollWidth*u.scrollHeight).slice(0,1);o?.length?await Promise.allSettled(o.map(s=>{let u={...t,width:Math.min(t.width,s.offsetWidth),height:Math.min(t.height,s.offsetHeight),sourceUrls:t.sourceUrls.map(h=>h)};return At(s,u)})):(t.text=t.textOverride??t.text.trim(),vr(e,t))}}function Er(e,t,r){try{let o=new it,s=o.evaluate(t,{doc:document});Ut.forEach(u=>s.push(...o.evaluate(t,{doc:u}))),me.forEach(u=>{u.doc.defaultView&&s.push(...o.evaluate(t,{doc:u.doc}).map(h=>xe(h)?(h.x??=u.x,h.y??=u.y,h.depth??=u.depth,h):{element:h,x:u.x,y:u.y,depth:u.depth}))}),s&&s.forEach(async u=>await Ir(e,u,r))}catch{}}function Cr(e){e.forEach(t=>Er(t.Id,t.ParseTree))}async function Ir(e,t,r){let o={};xe(t)&&(o=t,t=t.element,delete o.element);let s=new _({width:t.offsetWidth,height:t.offsetHeight,adRuleId:e});s.isFromIFrame=t.nodeName==="IFRAME",at&&(s.adRuleName=r,s.tabUrl=location.href),Object.assign(s,o),await At(t,s)}function he(e){I&&Lt(t=>{t.didTimeout||(Cr(e),st(B,hr))},4e3)}function Tr(e){let t=Date.now(),r=null;for(;r=e[0];){for(var o=null;o=r.nextNode();)if(o.shadowRoot&&(e.push(document.createTreeWalker(o.shadowRoot,NodeFilter.SHOW_ELEMENT)),Ut.push(o.shadowRoot)),Date.now()-t>50)return!1;e.shift()}return!0}function Nr(){Ut=[];let e=[];try{e.push(document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT))}catch{}let t=!1,r=0;for(;!t&&r++<100;)Lt(()=>t||=Tr(e))}function Rr(){me=Array.from(document.querySelectorAll("iframe")).filter(e=>e.src&&new URL(e.src).origin==top.location.origin&&e.offsetWidth>=_.minWidth&&e.offsetHeight>=_.minHeight).map(e=>{try{let t=e.contentWindow,r=U(e),o=r.left,s=r.top,u=1;for(;t?.parent&&t.parent!==top;)t=t.parent,r=U(t.frameElement),o+=r.left,s+=r.top,u++;return{doc:e.contentDocument,x:o,y:s,depth:u}}catch{return null}}).filter(e=>e)}function Pr(){Nr(),Rr()}function xe(e){return!(e instanceof Node)&&e.element}function ve(...e){console.log("[injected-script]",...Array.isArray(e)?e:[e])}function xt(e,t){return r=>new Promise(o=>{let s=t+"-response",u=Math.random(),h=p=>{let{type:m,payload:g,nonce:w}=p.data??{};m!==s||w!==u||(e?.("Got response:",{name:t,payload:r,response:g}),o(g),f())},f=()=>{window.removeEventListener("message",h)};window.addEventListener("message",h),e?.("Sending message:",{name:t,payload:r}),window.postMessage({type:t,payload:r,nonce:u},"*")})}function Se(e,t){return r=>{e?.("Sending message:",{type:t,payload:r}),window.postMessage({type:t,payload:r},"*")}}var Ee="ads#INIT",Ce="ads#SEND_DATA",Ie="ads#GET_INSTALL_ID",Te="ads#GET_EXTERNAL_CONFIG",Ne="ads#FETCH_HTTP_RESPONSE";function Re(e){let t=e.enableLogs?ve:void 0;t?.("Recieved init event",{config:e});let r=Se(t,Ce),o=xt(t,Ie),s=xt(t,Te),u=xt(t,Ne);be({getInstallId:o,fetchHttpResponse:u,sendData:r,pm_log:t,getExternalConfiguration:s})}function Mr(){window.addEventListener("message",({data:e})=>{e?.type===Ee&&Re(e.payload)})}Mr();})();\n';var So=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var _o={exports:{}};(function(e,t){(function(n,i){i(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:So,function(n){var i,r;if(!((r=(i=globalThis.chrome)==null?void 0:i.runtime)!=null&&r.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const s="The message port closed before a response was received.",a=l=>{const o={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(o).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class c extends WeakMap{constructor(_,C=void 0){super(C),this.createItem=_}get(_){return this.has(_)||this.set(_,this.createItem(_)),super.get(_)}}const u=w=>w&&typeof w=="object"&&typeof w.then=="function",p=(w,_)=>(...C)=>{l.runtime.lastError?w.reject(new Error(l.runtime.lastError.message)):_.singleCallbackArg||C.length<=1&&_.singleCallbackArg!==!1?w.resolve(C[0]):w.resolve(C)},d=w=>w==1?"argument":"arguments",f=(w,_)=>function(C,...M){if(M.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${d(_.minArgs)} for ${w}(), got ${M.length}`);if(M.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${d(_.maxArgs)} for ${w}(), got ${M.length}`);return new Promise((Z,b)=>{if(_.fallbackToNoCallback)try{C[w](...M,p({resolve:Z,reject:b},_))}catch(L){console.warn(`${w} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,L),C[w](...M),_.fallbackToNoCallback=!1,_.noCallback=!0,Z()}else _.noCallback?(C[w](...M),Z()):C[w](...M,p({resolve:Z,reject:b},_))})},g=(w,_,C)=>new Proxy(_,{apply(M,Z,b){return C.call(Z,w,...b)}});let m=Function.call.bind(Object.prototype.hasOwnProperty);const v=(w,_={},C={})=>{let M=Object.create(null),Z={has(L,A){return A in w||A in M},get(L,A,G){if(A in M)return M[A];if(!(A in w))return;let W=w[A];if(typeof W=="function")if(typeof _[A]=="function")W=g(w,w[A],_[A]);else if(m(C,A)){let ie=f(A,C[A]);W=g(w,w[A],ie)}else W=W.bind(w);else if(typeof W=="object"&&W!==null&&(m(_,A)||m(C,A)))W=v(W,_[A],C[A]);else if(m(C,"*"))W=v(W,_[A],C["*"]);else return Object.defineProperty(M,A,{configurable:!0,enumerable:!0,get(){return w[A]},set(ie){w[A]=ie}}),W;return M[A]=W,W},set(L,A,G,W){return A in M?M[A]=G:w[A]=G,!0},defineProperty(L,A,G){return Reflect.defineProperty(M,A,G)},deleteProperty(L,A){return Reflect.deleteProperty(M,A)}},b=Object.create(w);return new Proxy(b,Z)},D=w=>({addListener(_,C,...M){_.addListener(w.get(C),...M)},hasListener(_,C){return _.hasListener(w.get(C))},removeListener(_,C){_.removeListener(w.get(C))}}),U=new c(w=>typeof w!="function"?w:function(_){const C=v(_,{},{getContent:{minArgs:0,maxArgs:0}});w(C)}),E=new c(w=>typeof w!="function"?w:function(_,C,M){let Z=!1,b,L=new Promise(ie=>{b=function(Q){Z=!0,ie(Q)}}),A;try{A=w(_,C,b)}catch(ie){A=Promise.reject(ie)}const G=A!==!0&&u(A);return A!==!0&&!G&&!Z?!1:((ie=>{ie.then(Q=>{M(Q)},Q=>{let Se;Q&&(Q instanceof Error||typeof Q.message=="string")?Se=Q.message:Se="An unexpected error occurred",M({__mozWebExtensionPolyfillReject__:!0,message:Se})}).catch(Q=>{console.error("Failed to send onMessage rejected reply",Q)})})(G?A:L),!0)}),O=({reject:w,resolve:_},C)=>{l.runtime.lastError?l.runtime.lastError.message===s?_():w(new Error(l.runtime.lastError.message)):C&&C.__mozWebExtensionPolyfillReject__?w(new Error(C.message)):_(C)},B=(w,_,C,...M)=>{if(M.length<_.minArgs)throw new Error(`Expected at least ${_.minArgs} ${d(_.minArgs)} for ${w}(), got ${M.length}`);if(M.length>_.maxArgs)throw new Error(`Expected at most ${_.maxArgs} ${d(_.maxArgs)} for ${w}(), got ${M.length}`);return new Promise((Z,b)=>{const L=O.bind(null,{resolve:Z,reject:b});M.push(L),C.sendMessage(...M)})},T={devtools:{network:{onRequestFinished:D(U)}},runtime:{onMessage:D(E),onMessageExternal:D(E),sendMessage:B.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:B.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},P={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return o.privacy={network:{"*":P},services:{"*":P},websites:{"*":P}},v(l,T,o)};n.exports=a(chrome)}else n.exports=globalThis.browser})})(_o);var Qg=_o.exports;const Bn=vs(Qg);var bs={exports:{}};bs.exports;(function(e){var t=function(){var n=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function a(o,c){if(!s[o]){s[o]={};for(var u=0;u<o.length;u++)s[o][o.charAt(u)]=u}return s[o][c]}var l={compressToBase64:function(o){if(o==null)return"";var c=l._compress(o,6,function(u){return i.charAt(u)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(o){return o==null?"":o==""?null:l._decompress(o.length,32,function(c){return a(i,o.charAt(c))})},compressToUTF16:function(o){return o==null?"":l._compress(o,15,function(c){return n(c+32)})+" "},decompressFromUTF16:function(o){return o==null?"":o==""?null:l._decompress(o.length,16384,function(c){return o.charCodeAt(c)-32})},compressToUint8Array:function(o){for(var c=l.compress(o),u=new Uint8Array(c.length*2),p=0,d=c.length;p<d;p++){var f=c.charCodeAt(p);u[p*2]=f>>>8,u[p*2+1]=f%256}return u},decompressFromUint8Array:function(o){if(o==null)return l.decompress(o);for(var c=new Array(o.length/2),u=0,p=c.length;u<p;u++)c[u]=o[u*2]*256+o[u*2+1];var d=[];return c.forEach(function(f){d.push(n(f))}),l.decompress(d.join(""))},compressToEncodedURIComponent:function(o){return o==null?"":l._compress(o,6,function(c){return r.charAt(c)})},decompressFromEncodedURIComponent:function(o){return o==null?"":o==""?null:(o=o.replace(/ /g,"+"),l._decompress(o.length,32,function(c){return a(r,o.charAt(c))}))},compress:function(o){return l._compress(o,16,function(c){return n(c)})},_compress:function(o,c,u){if(o==null)return"";var p,d,f={},g={},m="",v="",D="",U=2,E=3,O=2,B=[],T=0,P=0,w;for(w=0;w<o.length;w+=1)if(m=o.charAt(w),Object.prototype.hasOwnProperty.call(f,m)||(f[m]=E++,g[m]=!0),v=D+m,Object.prototype.hasOwnProperty.call(f,v))D=v;else{if(Object.prototype.hasOwnProperty.call(g,D)){if(D.charCodeAt(0)<256){for(p=0;p<O;p++)T=T<<1,P==c-1?(P=0,B.push(u(T)),T=0):P++;for(d=D.charCodeAt(0),p=0;p<8;p++)T=T<<1|d&1,P==c-1?(P=0,B.push(u(T)),T=0):P++,d=d>>1}else{for(d=1,p=0;p<O;p++)T=T<<1|d,P==c-1?(P=0,B.push(u(T)),T=0):P++,d=0;for(d=D.charCodeAt(0),p=0;p<16;p++)T=T<<1|d&1,P==c-1?(P=0,B.push(u(T)),T=0):P++,d=d>>1}U--,U==0&&(U=Math.pow(2,O),O++),delete g[D]}else for(d=f[D],p=0;p<O;p++)T=T<<1|d&1,P==c-1?(P=0,B.push(u(T)),T=0):P++,d=d>>1;U--,U==0&&(U=Math.pow(2,O),O++),f[v]=E++,D=String(m)}if(D!==""){if(Object.prototype.hasOwnProperty.call(g,D)){if(D.charCodeAt(0)<256){for(p=0;p<O;p++)T=T<<1,P==c-1?(P=0,B.push(u(T)),T=0):P++;for(d=D.charCodeAt(0),p=0;p<8;p++)T=T<<1|d&1,P==c-1?(P=0,B.push(u(T)),T=0):P++,d=d>>1}else{for(d=1,p=0;p<O;p++)T=T<<1|d,P==c-1?(P=0,B.push(u(T)),T=0):P++,d=0;for(d=D.charCodeAt(0),p=0;p<16;p++)T=T<<1|d&1,P==c-1?(P=0,B.push(u(T)),T=0):P++,d=d>>1}U--,U==0&&(U=Math.pow(2,O),O++),delete g[D]}else for(d=f[D],p=0;p<O;p++)T=T<<1|d&1,P==c-1?(P=0,B.push(u(T)),T=0):P++,d=d>>1;U--,U==0&&(U=Math.pow(2,O),O++)}for(d=2,p=0;p<O;p++)T=T<<1|d&1,P==c-1?(P=0,B.push(u(T)),T=0):P++,d=d>>1;for(;;)if(T=T<<1,P==c-1){B.push(u(T));break}else P++;return B.join("")},decompress:function(o){return o==null?"":o==""?null:l._decompress(o.length,32768,function(c){return o.charCodeAt(c)})},_decompress:function(o,c,u){var p=[],d=4,f=4,g=3,m="",v=[],D,U,E,O,B,T,P,w={val:u(0),position:c,index:1};for(D=0;D<3;D+=1)p[D]=D;for(E=0,B=Math.pow(2,2),T=1;T!=B;)O=w.val&w.position,w.position>>=1,w.position==0&&(w.position=c,w.val=u(w.index++)),E|=(O>0?1:0)*T,T<<=1;switch(E){case 0:for(E=0,B=Math.pow(2,8),T=1;T!=B;)O=w.val&w.position,w.position>>=1,w.position==0&&(w.position=c,w.val=u(w.index++)),E|=(O>0?1:0)*T,T<<=1;P=n(E);break;case 1:for(E=0,B=Math.pow(2,16),T=1;T!=B;)O=w.val&w.position,w.position>>=1,w.position==0&&(w.position=c,w.val=u(w.index++)),E|=(O>0?1:0)*T,T<<=1;P=n(E);break;case 2:return""}for(p[3]=P,U=P,v.push(P);;){if(w.index>o)return"";for(E=0,B=Math.pow(2,g),T=1;T!=B;)O=w.val&w.position,w.position>>=1,w.position==0&&(w.position=c,w.val=u(w.index++)),E|=(O>0?1:0)*T,T<<=1;switch(P=E){case 0:for(E=0,B=Math.pow(2,8),T=1;T!=B;)O=w.val&w.position,w.position>>=1,w.position==0&&(w.position=c,w.val=u(w.index++)),E|=(O>0?1:0)*T,T<<=1;p[f++]=n(E),P=f-1,d--;break;case 1:for(E=0,B=Math.pow(2,16),T=1;T!=B;)O=w.val&w.position,w.position>>=1,w.position==0&&(w.position=c,w.val=u(w.index++)),E|=(O>0?1:0)*T,T<<=1;p[f++]=n(E),P=f-1,d--;break;case 2:return v.join("")}if(d==0&&(d=Math.pow(2,g),g++),p[P])m=p[P];else if(P===f)m=U+U.charAt(0);else return null;v.push(m),p[f++]=U+m.charAt(0),d--,U=m,d==0&&(d=Math.pow(2,g),g++)}}};return l}();e!=null&&(e.exports=t)})(bs);var Jg=bs.exports;const As=vs(Jg);function Xg(e){const t=As.decompressFromUint8Array(new Uint8Array(e));if(t==null)throw Error("Failed to convert string to ArrayBuffer");return t}async function ca(e){if(!e.byteLength)return"";const t=new Blob([e]),n=await new Promise((i,r)=>{const s=new FileReader;s.onload=()=>{typeof s.result=="string"&&i(s.result),r(Error("Failed to read buffer as string, got "+typeof s.result))},s.onerror=()=>r(s.error),s.onabort=()=>r("FileReader aborted"),s.readAsDataURL(t)});return(n==null?void 0:n.split(",").pop())||""}function ep(e){if(!e)return Promise.resolve(new ArrayBuffer(0));try{const t="data:application/octet-binary;base64,"+e;return fetch(t).then(n=>n.arrayBuffer(),()=>new ArrayBuffer(0))}catch{return Promise.resolve(new ArrayBuffer(0))}}var sn=(e=>(e.UPLOAD_CRAWL="ads#CRAWL",e.GET_PM_EXTERNAL_CONFIG="ads#GET_EXTERNAL_CONFIGURATION",e.FETCH_HTTP_RESPONSE="ads#FETCH_HTTP_RESPONSE",e))(sn||{});function pr(e){try{return JSON.parse(e)}catch{return}}async function tp(e){return(await Bn.storage.local.get(e))[e]}async function To(e,t){const n={};n[e]=t,await Bn.storage.local.set(n)}async function la(e,t,n){let i=await(n?null:tp(e));return i==null&&(i=await t(),await To(e,i)),i}function xo(e){return e.split(".").slice(e.endsWith(".uk")||e.endsWith(".jp")?-3:-2).join(".")}async function ua(e){const t=await la("configTs",Date.now),n=Date.now()-t>18e5;return la("config",async()=>{const i=await e({type:sn.GET_PM_EXTERNAL_CONFIG,payload:void 0}),r=pr(i);if(r!=null)return r.TimeOffset=r.Now&&Date.now()-r.Now||0,np(r),ip(r),rp(r),To("configTs",Date.now()),r},n)}function np(e){var t;(t=e.AdRules)==null||t.filter(n=>{const i=As.decompressFromUTF16(n.ParseTreeString||"")??"";return n.ParseTree=pr(i),n.ParseTree==null?!1:(delete n.ParseTreeString,!0)})}function ip(e){var t;e.ParsedSiteConfigs=(t=e.SiteConfigs)==null?void 0:t.reduce((n,i)=>(n[i.d]=i.r,n),{}),delete e.SiteConfigs}function rp(e){var t;e.ParsedUrlBlackList=(t=e.UrlBlackList)==null?void 0:t.filter(n=>n.BlockAllAds).reduce((n,i)=>{var r;return(n[r=xo(i.Hostname)]??(n[r]=[])).push(i.UrlRegex),n},{}),delete e.UrlBlackList}function da(){return window.self===window.top}class sp{constructor(t){this.config=t}async inject(t){return new Promise((n,i)=>{const r=this.defineOnCspError(i),s=()=>{var a,l;try{document.addEventListener("securitypolicyviolation",r);const o=document.createElement(t),c=()=>{var d,f;this.config.keepInDom||o.remove(),(f=(d=this.config).onInjected)==null||f.call(d)},u=this.getManifestVersion();u===3?o.onload=c:setTimeout(c),this.setSrc(o,u),(a=this.config.logger)==null||a.log(o);const p=(l=document.documentElement)==null?void 0:l.firstElementChild;p==null||p.insertBefore(o,p.firstChild),document.removeEventListener("securitypolicyviolation",r),n()}catch(o){i(o)}finally{document.removeEventListener("DOMContentLoaded",s)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s()})}defineOnCspError(t){return n=>{t==null||t(Error("Blocked by CSP: "+JSON.stringify({host:window.location.hostname,blockedUri:n.blockedURI,violatedDirective:n.violatedDirective,originalPolicy:n.originalPolicy})))}}getManifestVersion(){return 3}setSrc(t,n){if(n===3){if(!this.config.mv3Path)throw Error("mv3Path config must be passed for Manifest V3 extensions");t.src=Bn.runtime.getURL(this.config.mv3Path)}else if(n===2){if(!this.config.mv2Content)throw Error("mv2Content config must be passed for Manifest V2 extensions");t.innerHTML=this.config.mv2Content}else throw Error(`Unsupported manifest version ${n}`)}}class ap{constructor(t){this.config=t}sendMessage(t,n,i,r){const s={type:t,payload:n,nonce:r};window.postMessage(s,"*",i)}onMessage(t,n){window.addEventListener("message",async i=>{var r,s;const{type:a,payload:l,nonce:o}=i.data??{};if(a!==t)return;(r=this.config.logger)==null||r.debug("[ad-finder-custom-event] Recieved message:",{type:a,payload:l});const c=await n(l);if(c===void 0)return;const{response:u,transferables:p}=c;(s=this.config.logger)==null||s.debug("[ad-finder-custom-event] Sending response:",{name:a,payload:l,response:u}),this.sendMessage(a+this.config.responseSuffix,u,p,o)})}}const op="ads#INIT",cp="ads#SEND_DATA",lp="ads#GET_INSTALL_ID",up="ads#GET_EXTERNAL_CONFIG",dp="ads#FETCH_HTTP_RESPONSE",jr=class Zi{constructor(t){Dn(this,"injector"),Dn(this,"messenger"),this.config=t,this.injector=new sp({logger:t.logger,keepInDom:t.keepPathmaticsInDom,mv2Content:Kg,mv3Path:t.mv3PathmaticsPath,onInjected:this.initPathmaticsScript.bind(this)}),this.messenger=new ap({logger:t.logger,responseSuffix:Zi.MESSENGER_SUFFIX})}async isSupportedSite(){var t,n;const i=xo(location.hostname);if(!da())return!(location.hostname===Zi.GOOGLE_AUTH_HOSTNAME||Zi.SUBFRAME_DOMAIN_BLOCKLIST.has(i));const r=await ua(this.config.sendMessageToBackground);return r!=null?!((n=(t=r.ParsedUrlBlackList)==null?void 0:t[i])!=null&&n.some(s=>new RegExp(s).test(location.href))):!1}async start(){var t,n,i,r,s,a;if(!document.documentElement){(t=this.config.logger)==null||t.log("Page is blank, stopping pathmatics",window.location.hostname);return}const l=await this.isSupportedSite();if((n=this.config.logger)==null||n.log("Is supported site?",l),!l){(i=this.config.logger)==null||i.log("Not supported site, stopping pathmatics",window.location.hostname);return}try{(r=this.config.logger)==null||r.log("Starting Pathmatics ad-finder...",{url:window.location.href}),this.setupMessageListeners(),await this.injector.inject("script"),(s=this.config.logger)==null||s.log("Pathmatics ad-finder injected!")}catch(o){(a=this.config.logger)==null||a.error("Failed to start Pathmatics ad-finder",o)}}setupMessageListeners(){if(Bn.storage==null)throw Error("The storage permission is required for pathmatics' ad-finder");this.messenger.onMessage(dp,async t=>{const n=await this.config.sendMessageToBackground({type:sn.FETCH_HTTP_RESPONSE,payload:t}),i=await ep(n);return{response:i,transferables:[i]}}),da()&&(this.messenger.onMessage(lp,async()=>({response:await this.config.getInstallId()})),this.messenger.onMessage(cp,async t=>{var n,i,r,s,a;const l=pr(t);if(l==null)return;const o=l.crawlId;let c=l.zys??[];if(typeof c=="string"&&(c=pr(c)),c==null)return;const u=Date.now();for(const p of c){const d={id:`${o}-${p.hash}`,type:"pathmatics",timestamp:u,details:p};(n=this.config.logger)==null||n.log("Ad detected",d);try{await((r=(i=this.config).onAdDetected)==null?void 0:r.call(i,d))}catch(f){(s=this.config.logger)==null||s.error("onAdDetected failed",{err:f})}}await this.config.sendMessageToBackground({type:sn.UPLOAD_CRAWL,payload:l}).catch((a=this.config.logger)==null?void 0:a.error)}),this.messenger.onMessage(up,async()=>({response:await ua(this.config.sendMessageToBackground)})))}initPathmaticsScript(){var t;(t=this.config.logger)==null||t.log("Initializing script");const n={enableLogs:this.config.enablePathmaticsLogs??!1};this.messenger.sendMessage(op,n)}};Dn(jr,"MESSENGER_SUFFIX","-response"),Dn(jr,"SUBFRAME_DOMAIN_BLOCKLIST",new Set(["google.com","okta.com","amazon.com"])),Dn(jr,"GOOGLE_AUTH_HOSTNAME","accounts.youtube.com");function hp(e){return{...e,logger:e.logger===void 0?console:e.logger??void 0}}var Eo={exports:{}};(function(e,t){(function(n,i){e.exports=i()})(So,function(){var n=function(s,a){if(a=a||{},typeof s!="function")throw new r("fetch must be a function");if(typeof a!="object")throw new r("defaults must be an object");if(a.retries!==void 0&&!i(a.retries))throw new r("retries must be a positive integer");if(a.retryDelay!==void 0&&!i(a.retryDelay)&&typeof a.retryDelay!="function")throw new r("retryDelay must be a positive integer or a function returning a positive integer");if(a.retryOn!==void 0&&!Array.isArray(a.retryOn)&&typeof a.retryOn!="function")throw new r("retryOn property expects an array or function");var l={retries:3,retryDelay:1e3,retryOn:[]};return a=Object.assign(l,a),function(o,c){var u=a.retries,p=a.retryDelay,d=a.retryOn;if(c&&c.retries!==void 0)if(i(c.retries))u=c.retries;else throw new r("retries must be a positive integer");if(c&&c.retryDelay!==void 0)if(i(c.retryDelay)||typeof c.retryDelay=="function")p=c.retryDelay;else throw new r("retryDelay must be a positive integer or a function returning a positive integer");if(c&&c.retryOn)if(Array.isArray(c.retryOn)||typeof c.retryOn=="function")d=c.retryOn;else throw new r("retryOn property expects an array or function");return new Promise(function(f,g){var m=function(D){var U=typeof Request<"u"&&o instanceof Request?o.clone():o;s(U,c).then(function(E){if(Array.isArray(d)&&d.indexOf(E.status)===-1)f(E);else if(typeof d=="function")try{return Promise.resolve(d(D,null,E)).then(function(O){O?v(D,null,E):f(E)}).catch(g)}catch(O){g(O)}else D<u?v(D,null,E):f(E)}).catch(function(E){if(typeof d=="function")try{Promise.resolve(d(D,E,null)).then(function(O){O?v(D,E,null):g(E)}).catch(function(O){g(O)})}catch(O){g(O)}else D<u?v(D,E,null):g(E)})};function v(D,U,E){var O=typeof p=="function"?p(D,U,E):p;setTimeout(function(){m(++D)},O)}m(0)})}};function i(s){return Number.isInteger(s)&&s>=0}function r(s){this.name="ArgumentError",this.message=s}return n})})(Eo);var gp=Eo.exports;const pp=vs(gp);function fp(e){return Math.random()*e+e/2}function mp(e){return pp(fetch,{retryOn(t,n,i){var r;if(n!==null||i.status>=500)return(r=e.logger)==null||r.log(`retrying, attempt number ${t+1}`),!0},retries:5,retryDelay(t){const n=Math.pow(2,t)*500;return fp(n)}})}class yp{constructor(t){Dn(this,"fetch"),this.config=t,this.fetch=mp(t)}async upload(t){var n,i,r;if(!await this.config.isEnabled())return;const s=this.prepareData(t);(n=this.config.logger)==null||n.log("Uploading data:",s);const a=await this.fetch(this.config.crawlUploadUrl,{method:"POST",body:As.compressToUint8Array(JSON.stringify(s)),headers:{"Content-Type":"application/octet-stream"}}).then(l=>{var o;return(o=this.config.logger)==null?void 0:o.log({status:l.status})}).catch((i=this.config.logger)==null?void 0:i.error);(r=this.config.logger)==null||r.log("Response:",a)}prepareData(t){return{...t,PartnerVersion:Bn.runtime.getManifest().version,ExtensionId:Bn.runtime.id,ExtensionVersion:this.config.extensionVersion,UserAgent:navigator.userAgent,BrowserLanguage:navigator.language,BlankZys:null,PanelPartnerId:this.config.panelPartnerId}}}async function wp(e){const t=await fetch(e).then(n=>n.arrayBuffer());return Xg(t)}function vp(e){const t=hp(e),n=new yp(t);return{async processAdFinderMessage(i){const r=s=>{var a;throw(a=t.logger)==null||a.error("Error handling message from ad-finder: "+JSON.stringify(i),s),s};switch(i.type){case sn.UPLOAD_CRAWL:return n.upload(i.payload).catch(r);case sn.GET_PM_EXTERNAL_CONFIG:return wp(`${e.pmExternalConfigUrl}?installId=${await e.getInstallId()}`).catch(r);case sn.FETCH_HTTP_RESPONSE:return fetch(i.payload).then(s=>{const a=parseInt(s.headers.get("Content-Length")??"");return!isNaN(a)&&a>1<<25?new ArrayBuffer(0):s.arrayBuffer()}).then(s=>s.byteLength>1<<25?ca(new ArrayBuffer(0)):ca(s))}}}}const Wi=Le.createScopedLog("WebUsage");let An;const bp="https://api-pm.stayfocusd.st-panel-api.com/Ajax0001/IPD",Ap="https://api-pm.stayfocusd.st-panel-api.com/Ajax0001/Config",Sp=33,_p={initialized:null,usageDatabase:null,initAPI(e){return An=e,An.mixin("WebUsage",{init:this.init.bind(this),getUsageDatabase:this.getUsageDatabase.bind(this)})},async init(){if(this.initialized!=null)Wi("init","WebUsage already initialized",{sessionId:""},"DEBUG");else{const e=async()=>await An.Storage.get("hasAcceptedToS",!0)??!1,t=An.Storage.get("install-id",!0),{promise:n,resolve:i}=An.Utils.getDecoupledPromise();this.initialized=n,this.usageDatabase=yh({getInstallId:()=>t}),Ah({db:this.usageDatabase,enabled:e,isOnStartupAvailable:()=>!0,isTabActiveWhenPlayingAudio:()=>!0,logger:null}),i(),Wi==null||Wi("init","Initialized WebUsage",this,"INFO");const{processAdFinderMessage:r}=await vp({isEnabled:e,getInstallId:()=>t,extensionVersion:An.Chrome.Extension.getVersion(),extensionId:Jr.APP_ID,crawlUploadUrl:bp,pmExternalConfigUrl:Ap,panelPartnerId:Sp});chrome.runtime.onConnect.addListener(s=>{s.name=="ad-finder"&&s.onMessage.addListener(async a=>{var l,o,c,u;if(a.message=="forward-message.request"){const p=await r(a.payload);s.postMessage({message:"forward-message.response",payload:p,nonce:a.nonce})}if(a.message=="ad-found"){const p=iu(a.payload.hostname);if(!p)return;const d=a.payload.ad,f=await((o=(l=this.usageDatabase)==null?void 0:l.sessionsRepo)==null?void 0:o.getActiveSessions()),g=f==null?void 0:f.find(m=>m.appId===p.hostname);if(!g)return;await((u=(c=this.usageDatabase)==null?void 0:c.adsRepo)==null?void 0:u.upsertAd({...d,sessionId:g.id}))}})})}},async getUsageDatabase(){if(await this.initialized,this.usageDatabase==null)throw Error("WebUsage not initialized");return this.usageDatabase}},Tp=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,xp=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Ep=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Cp(e,t){if(e==="__proto__"||e==="constructor"&&t&&typeof t=="object"&&"prototype"in t){Op(e);return}return t}function Op(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function Ip(e,t={}){if(typeof e!="string")return e;const n=e.trim();if(e[0]==='"'&&e.endsWith('"')&&!e.includes("\\"))return n.slice(1,-1);if(n.length<=9){const i=n.toLowerCase();if(i==="true")return!0;if(i==="false")return!1;if(i==="undefined")return;if(i==="null")return null;if(i==="nan")return Number.NaN;if(i==="infinity")return Number.POSITIVE_INFINITY;if(i==="-infinity")return Number.NEGATIVE_INFINITY}if(!Ep.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(Tp.test(e)||xp.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,Cp)}return JSON.parse(e)}catch(i){if(t.strict)throw i;return e}}const Dp=/#/g,kp=/&/g,Pp=/\//g,Mp=/=/g,Ss=/\+/g,Lp=/%5e/gi,Rp=/%60/gi,Np=/%7c/gi,Up=/%20/gi;function Bp(e){return encodeURI(""+e).replace(Np,"|")}function Xr(e){return Bp(typeof e=="string"?e:JSON.stringify(e)).replace(Ss,"%2B").replace(Up,"+").replace(Dp,"%23").replace(kp,"%26").replace(Rp,"`").replace(Lp,"^").replace(Pp,"%2F")}function Wr(e){return Xr(e).replace(Mp,"%3D")}function Co(e=""){try{return decodeURIComponent(""+e)}catch{return""+e}}function jp(e){return Co(e.replace(Ss," "))}function Wp(e){return Co(e.replace(Ss," "))}function Fp(e=""){const t={};e[0]==="?"&&(e=e.slice(1));for(const n of e.split("&")){const i=n.match(/([^=]+)=?(.*)/)||[];if(i.length<2)continue;const r=jp(i[1]);if(r==="__proto__"||r==="constructor")continue;const s=Wp(i[2]||"");t[r]===void 0?t[r]=s:Array.isArray(t[r])?t[r].push(s):t[r]=[t[r],s]}return t}function $p(e,t){return(typeof t=="number"||typeof t=="boolean")&&(t=String(t)),t?Array.isArray(t)?t.map(n=>`${Wr(e)}=${Xr(n)}`).join("&"):`${Wr(e)}=${Xr(t)}`:Wr(e)}function Vp(e){return Object.keys(e).filter(t=>e[t]!==void 0).map(t=>$p(t,e[t])).filter(Boolean).join("&")}const Gp=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,qp=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,Hp=/^([/\\]\s*){2,}[^/\\]/,zp=/\/$|\/\?|\/#/,Zp=/^\.?\//;function Oo(e,t={}){return typeof t=="boolean"&&(t={acceptRelative:t}),t.strict?Gp.test(e):qp.test(e)||(t.acceptRelative?Hp.test(e):!1)}function es(e="",t){return t?zp.test(e):e.endsWith("/")}function Yp(e="",t){if(!t)return(es(e)?e.slice(0,-1):e)||"/";if(!es(e,!0))return e||"/";let n=e,i="";const r=e.indexOf("#");r>=0&&(n=e.slice(0,r),i=e.slice(r));const[s,...a]=n.split("?");return((s.endsWith("/")?s.slice(0,-1):s)||"/")+(a.length>0?`?${a.join("?")}`:"")+i}function Kp(e="",t){if(!t)return e.endsWith("/")?e:e+"/";if(es(e,!0))return e||"/";let n=e,i="";const r=e.indexOf("#");if(r>=0&&(n=e.slice(0,r),i=e.slice(r),!n))return i;const[s,...a]=n.split("?");return s+"/"+(a.length>0?`?${a.join("?")}`:"")+i}function Qp(e,t){if(Xp(t)||Oo(e))return e;const n=Yp(t);return e.startsWith(n)?e:tf(n,e)}function Jp(e,t){const n=Do(e),i={...Fp(n.search),...t};return n.search=Vp(i),nf(n)}function Xp(e){return!e||e==="/"}function ef(e){return e&&e!=="/"}function tf(e,...t){let n=e||"";for(const i of t.filter(r=>ef(r)))if(n){const r=i.replace(Zp,"");n=Kp(n)+r}else n=i;return n}const Io=Symbol.for("ufo:protocolRelative");function Do(e="",t){const n=e.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(n){const[,p,d=""]=n;return{protocol:p.toLowerCase(),pathname:d,href:p+d,auth:"",host:"",search:"",hash:""}}if(!Oo(e,{acceptRelative:!0}))return t?Do(t+e):ha(e);const[,i="",r,s=""]=e.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[],[,a="",l=""]=s.match(/([^#/?]*)(.*)?/)||[],{pathname:o,search:c,hash:u}=ha(l.replace(/\/(?=[A-Za-z]:)/,""));return{protocol:i.toLowerCase(),auth:r?r.slice(0,Math.max(0,r.length-1)):"",host:a,pathname:o,search:c,hash:u,[Io]:!i}}function ha(e=""){const[t="",n="",i=""]=(e.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:t,search:n,hash:i}}function nf(e){const t=e.pathname||"",n=e.search?(e.search.startsWith("?")?"":"?")+e.search:"",i=e.hash||"",r=e.auth?e.auth+"@":"",s=e.host||"";return(e.protocol||e[Io]?(e.protocol||"")+"//":"")+r+s+t+n+i}class rf extends Error{constructor(t,n){super(t,n),this.name="FetchError",n!=null&&n.cause&&!this.cause&&(this.cause=n.cause)}}function sf(e){var o,c,u,p,d;const t=((o=e.error)==null?void 0:o.message)||((c=e.error)==null?void 0:c.toString())||"",n=((u=e.request)==null?void 0:u.method)||((p=e.options)==null?void 0:p.method)||"GET",i=((d=e.request)==null?void 0:d.url)||String(e.request)||"/",r=`[${n}] ${JSON.stringify(i)}`,s=e.response?`${e.response.status} ${e.response.statusText}`:"<no response>",a=`${r}: ${s}${t?` ${t}`:""}`,l=new rf(a,e.error?{cause:e.error}:void 0);for(const f of["request","options","response"])Object.defineProperty(l,f,{get(){return e[f]}});for(const[f,g]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(l,f,{get(){return e.response&&e.response[g]}});return l}const af=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function ga(e="GET"){return af.has(e.toUpperCase())}function of(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}const cf=new Set(["image/svg","application/xml","application/xhtml","application/html"]),lf=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function uf(e=""){if(!e)return"json";const t=e.split(";").shift()||"";return lf.test(t)?"json":cf.has(t)||t.startsWith("text/")?"text":"blob"}function df(e,t,n=globalThis.Headers){const i={...t,...e};if(t!=null&&t.params&&(e!=null&&e.params)&&(i.params={...t==null?void 0:t.params,...e==null?void 0:e.params}),t!=null&&t.query&&(e!=null&&e.query)&&(i.query={...t==null?void 0:t.query,...e==null?void 0:e.query}),t!=null&&t.headers&&(e!=null&&e.headers)){i.headers=new n((t==null?void 0:t.headers)||{});for(const[r,s]of new n((e==null?void 0:e.headers)||{}))i.headers.set(r,s)}return i}const hf=new Set([408,409,425,429,500,502,503,504]),gf=new Set([101,204,205,304]);function ko(e={}){const{fetch:t=globalThis.fetch,Headers:n=globalThis.Headers,AbortController:i=globalThis.AbortController}=e;async function r(l){const o=l.error&&l.error.name==="AbortError"&&!l.options.timeout||!1;if(l.options.retry!==!1&&!o){let u;typeof l.options.retry=="number"?u=l.options.retry:u=ga(l.options.method)?0:1;const p=l.response&&l.response.status||500;if(u>0&&(Array.isArray(l.options.retryStatusCodes)?l.options.retryStatusCodes.includes(p):hf.has(p))){const d=l.options.retryDelay||0;return d>0&&await new Promise(f=>setTimeout(f,d)),s(l.request,{...l.options,retry:u-1})}}const c=sf(l);throw Error.captureStackTrace&&Error.captureStackTrace(c,s),c}const s=async function(o,c={}){var f;const u={request:o,options:df(c,e.defaults,n),response:void 0,error:void 0};u.options.method=(f=u.options.method)==null?void 0:f.toUpperCase(),u.options.onRequest&&await u.options.onRequest(u),typeof u.request=="string"&&(u.options.baseURL&&(u.request=Qp(u.request,u.options.baseURL)),(u.options.query||u.options.params)&&(u.request=Jp(u.request,{...u.options.params,...u.options.query}))),u.options.body&&ga(u.options.method)&&(of(u.options.body)?(u.options.body=typeof u.options.body=="string"?u.options.body:JSON.stringify(u.options.body),u.options.headers=new n(u.options.headers||{}),u.options.headers.has("content-type")||u.options.headers.set("content-type","application/json"),u.options.headers.has("accept")||u.options.headers.set("accept","application/json")):("pipeTo"in u.options.body&&typeof u.options.body.pipeTo=="function"||typeof u.options.body.pipe=="function")&&("duplex"in u.options||(u.options.duplex="half")));let p;if(!u.options.signal&&u.options.timeout){const g=new i;p=setTimeout(()=>g.abort(),u.options.timeout),u.options.signal=g.signal}try{u.response=await t(u.request,u.options)}catch(g){return u.error=g,u.options.onRequestError&&await u.options.onRequestError(u),await r(u)}finally{p&&clearTimeout(p)}if(u.response.body&&!gf.has(u.response.status)&&u.options.method!=="HEAD"){const g=(u.options.parseResponse?"json":u.options.responseType)||uf(u.response.headers.get("content-type")||"");switch(g){case"json":{const m=await u.response.text(),v=u.options.parseResponse||Ip;u.response._data=v(m);break}case"stream":{u.response._data=u.response.body;break}default:u.response._data=await u.response[g]()}}return u.options.onResponse&&await u.options.onResponse(u),!u.options.ignoreResponseError&&u.response.status>=400&&u.response.status<600?(u.options.onResponseError&&await u.options.onResponseError(u),await r(u)):u.response},a=async function(o,c){return(await s(o,c))._data};return a.raw=s,a.native=(...l)=>t(...l),a.create=(l={})=>ko({...e,defaults:{...e.defaults,...l}}),a}const _s=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),pf=_s.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),ff=_s.Headers,mf=_s.AbortController,yf=ko({fetch:pf,Headers:ff,AbortController:mf});var wf=(e=>(e.Notification="notification",e.Block="block",e.Popup="popup",e))(wf||{}),vf=(e=>(e.UsageTime="usage-time",e.SessionCount="session-count",e))(vf||{}),bf=(e=>(e.Android="android",e.Windows="windows",e.Mac="mac",e.Linux="linux",e.Web="web",e.Category="category",e.Brand="brand",e))(bf||{}),Af=class extends Error{constructor(){super("Invalid code entered")}},Sf=class extends Error{constructor(){super("Both devices already belong to a device group")}},_f=class extends Error{constructor(){super("Forbidden")}},an,Fi=(an=class extends Error{static matchesMessage(t){return t instanceof Error?t.message===an.message:!1}constructor(){super(an.message)}},wn(an,"message","Not in a device group"),an);function ei(e,t){return Object.entries(e).flatMap(([n,i])=>i.sessions.map(r=>({appId:n,startedAt:r.timestamp*1e3,endedAt:(r.timestamp+r.duration)*1e3,installId:r.install_id,platform:t})))}function pa(e){return new Date(e).toISOString()}function Tf(e){let t=yf.create({retry:3,...e==null?void 0:e.ofetchDefaults}),n=(e==null?void 0:e.formatDeviceName)??(b=>b),i=e==null?void 0:e.logger;function r(b){return t("/v1/android/apps",{query:{app_ids:b.appIds.join(",")}})}async function s(b){let L=await t("/v1/sync/pairing/generate",{method:"POST",retry:0,query:{install_id:b.installId}});return{code:L.code,expiration:new Date(L.expiration*1e3).getTime()}}function a(b){return t("/v1/sync/pairing/validate",{method:"POST",retry:0,query:{install_id:b.installId,code:b.code}}).catch(L=>{var A;let G=(A=L.response)==null?void 0:A.status;throw G===403?new Sf:G===404?new Af:L})}function l(b){return t("/v1/sync/pairing/check",{query:{install_id:b.installId}}).catch(L=>{var A;if(((A=L.response)==null?void 0:A.status)!==404)throw L})}async function o(b){return t("/v1/sync/devices",{query:{key:b.deviceGroupKey}}).catch(L=>{var A;throw((A=L.response)==null?void 0:A.status)===404?new Fi:L})}async function c(b){await t("/v1/sync/devices/remove",{method:"POST",retry:0,query:{key:b.deviceGroupKey,install_id:b.installIdToRemove}})}async function u(b){return(await t.raw("/v1/sync/devices/sessions",{method:"HEAD",query:{key:b.deviceGroupKey,install_id:b.installId}}).catch(L=>{var A;throw((A=L.response)==null?void 0:A.status)===404?new Fi:L})).headers.get("Last-Modified")??void 0}async function p(b){return t("/v1/analytics/avg_usage",{query:{app_ids:b.appIds.join(","),gender:b.gender,country_code:b.countryCode}})}async function d(b){return t("/v1/analytics/avg_web_usage",{query:{websites:b.appIds.join(","),gender:b.gender,country_code:b.countryCode}})}async function f(b){var L;let{android_apps:A,websites:G,windows_apps:W,mac_apps:ie,linux_apps:Q}=await t("/v1/sync/devices/sessions",{query:{key:b.deviceGroupKey,install_id:b.installId,start_time:pa(b.startTime),end_time:pa(b.endTime),app_ids:(L=b.appIds)==null?void 0:L.join(",")}}).catch(Se=>{var At;throw((At=Se.response)==null?void 0:At.status)===404?new Fi:Se});return[...ei(A,"android"),...ei(W??{},"windows"),...ei(ie??{},"mac"),...ei(Q??{},"linux"),...ei(G,"web")].sort((Se,At)=>Se.startedAt-At.startedAt)}async function g(b){var L;if(!b.appId.trim()){let{websites:W,diffPrivateWebsites:ie,...Q}=b;throw i==null||i.error("Missing required parameter 'appId'",Q),Error("Missing required parameter 'appId'")}if(!b.installId.trim()){let{websites:W,diffPrivateWebsites:ie,...Q}=b;throw i==null||i.error("Missing required parameter 'installId'",Q),Error("Missing required parameter 'installId'")}let A=Vr(navigator==null?void 0:navigator.userAgent),G={app_id:b.appId,install_id:b.installId,time_zone:Jn(),country_code:Ri(),device_name:n((L=A.browser)==null?void 0:L.name),device_type:A.os.name,birth_year:b.birthYear,websites:b.websites,diff_private_websites:b.diffPrivateWebsites};await t("/v1/web/upload",{method:"POST",retry:0,body:G})}async function m(b){var L;if(!b.appId.trim()){let{websites:W,diffPrivateWebsites:ie,...Q}=b;throw i==null||i.error("Missing required parameter 'appId'",Q),Error("Missing required parameter 'appId'")}if(!b.installId.trim()){let{websites:W,diffPrivateWebsites:ie,...Q}=b;throw i==null||i.error("Missing required parameter 'installId'",Q),Error("Missing required parameter 'installId'")}let A=Vr(navigator==null?void 0:navigator.userAgent),G={app_id:b.appId,install_id:b.installId,time_zone:Jn(),country_code:Ri(),device_name:n((L=A.browser)==null?void 0:L.name),device_type:A.os.name,birth_year:b.birthYear,websites:b.websites,diff_private_websites:b.diffPrivateWebsites};await t("/v1/page_views/upload",{method:"POST",retry:0,body:G})}async function v(b){if(!b.appId.trim()){let{apps:A,...G}=b;throw i==null||i.error("Missing required parameter 'appId'",G),Error("Missing required parameter 'appId'")}if(!b.installId.trim()){let{apps:A,...G}=b;throw i==null||i.error("Missing required parameter 'installId'",G),Error("Missing required parameter 'installId'")}let L={app_id:b.appId,install_id:b.installId,time_zone:Jn(),country_code:Ri(),device_name:n("App"),device_type:b.platform,birth_year:b.birthYear,apps:b.apps};await t("/v1/desktop/upload",{method:"POST",retry:0,body:L})}function D(b){return g({appId:b.appId,installId:b.installId,websites:{}})}function U(b){return v({appId:b.appId,installId:b.installId,platform:b.platform})}function E(b){return t("/v1/brands",{query:{install_id:b.installId}}).catch(L=>{var A;throw((A=L.response)==null?void 0:A.status)===403?new _f:L})}function O(b){return t("/v1/sync/config",{query:{key:b.deviceGroupKey}}).catch(L=>{var A;throw((A=L.response)==null?void 0:A.status)===404?new Fi:L})}async function B(b){await t("/v1/sync/config/reset_time",{method:"POST",retry:0,body:b})}async function T(b){await t("/v1/sync/config/ignore_list/remove",{method:"POST",retry:0,body:b})}async function P(b){await t("/v1/sync/config/ignore_list/add",{method:"POST",retry:0,body:b})}async function w(b){await t("/v1/sync/config/usage_limit/add",{method:"POST",retry:0,body:b})}async function _(b){let L={key:b.key,limit_ids:b.limitIds};await t("/v1/sync/config/usage_limit/remove",{method:"POST",retry:0,body:L})}async function C(b){let L={app_id:b.appId,install_id:b.installId,time_zone:Jn(),country_code:Ri(),ads:b.ads};await t("/v1/desktop/retail/"+b.website,{method:"POST",retry:0,body:L})}async function M(b){let L={app_id:b.appId,country_code:b.countryCode,time_zone:Jn(),prompts:b.prompts};await t("/v1/ai/analytics",{method:"POST",retry:0,body:L})}async function Z(b){let L={app_id:b.appId,service:b.service,install_id:b.installId,status:b.status,country_code:b.countryCode,timestamp:Math.round(Date.now()/1e3)};await t("/v1/subscriptions/status",{method:"POST",retry:0,body:L})}return{getAndroidAppInfo:r,createPairingCode:s,validatePairingCode:a,getMyDeviceGroup:l,getSessionsLastUploadedAt:u,getAverageAppUsage:p,getAverageWebUsage:d,listDeviceGroupDevices:o,removeDeviceFromDeviceGroup:c,listDeviceGroupSessions:f,uploadSessions:g,uploadPageViews:m,uploadDesktopUsage:v,createDevice:D,createDesktopDevice:U,getBrandMapping:E,getGroupConfig:O,setResetTime:B,removeFromIgnoreList:T,addToIgnoreList:P,addUsageLimit:w,removeUsageLimit:_,uploadRetailAds:C,uploadPrompts:M,uploadSubscriptionStatus:Z}}const xf=Le.createScopedLog("ScheduleJobs");let We;const fa={UploadWebUsage:"@alarm/upload-web-usage"},Ef="@stayfocusd/sessions-last-uploaded-at-key",Cf="@stayfocusd/page-views-last-uploaded-at-key",Of={initAPI(e){return We=e,We.mixin("ScheduleJobs",{init:this.init.bind(this)})},init(){We.Chrome.Alarms.addListener("onAlarm",async e=>{e.name===fa.UploadWebUsage&&(xf("Alarm fired",e.name),await this.uploadWebUsageJob())}),We.Chrome.Alarms.ensure(fa.UploadWebUsage,{periodInMinutes:mr/cn})},async uploadWebUsageJob(){const e=await We.WebUsage.getUsageDatabase(),t=Tf({ofetchDefaults:{baseURL:"https://stayfocusd.st-panel-api.com"}});await zg({db:e,enabled:async()=>{const i=await We.RemoteConfig.get("uploadWebUsage"),r=await We.Storage.get("hasAcceptedPrivacyPolicy",!0);return i&&r},getAppId:()=>Jr.APP_ID,dev:!1,getInstallId:()=>We.Storage.get(Jr.INSTALL_ID_KEY),getBirthYear:()=>We.Settings.get("age")??void 0,logger:null,getUploadBatchSize:()=>We.RemoteConfig.get("usageUploadBatchSize"),api:t,sessions:{lastUploadedAtStorageKey:Ef,onFailure:()=>We.Analytics.event("WEB_USAGE_UPLOAD_FAILED"),onSuccess:i=>We.Analytics.event("WEB_USAGE_UPLOAD_COMPLETED",i)},pageViews:{lastUploadedAtStorageKey:Cf,onFailure:()=>We.Analytics.event("PAGE_VIEWS_UPLOAD_FAILED"),onSuccess:i=>We.Analytics.event("PAGE_VIEWS_UPLOAD_COMPLETED",i),getUploadAllowlist:()=>We.RemoteConfig.get("pageViewAllowlist")}}).uploadAll()}};/** @license DropletJS.PubSub | MIT License | https://github.com/wmbenedetto/DropletJS.PubSub#mit-license */const Po=function(e,t){var n,n=function(){};typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(o){var c=this;return function(){return c.apply(o,arguments)}});var i=function(o){return typeof o=="object"&&o!==null&&typeof o.length=="number"},r=function(o){return typeof o=="object"&&o!==null&&typeof o.length!="number"},s=function(o,c){try{delete o[c]}catch{o[c]=t}},a=function(c){if(this.namespace=this.DEFAULT_NS,c.indexOf(":")>-1&&(this.namespace=c.substr(0,c.indexOf(":")),c=c.substr(c.indexOf(":")+1,c.length)),c.indexOf(".")>-1){var u=c.split(".");this.msgArray=[u[0]||"*",u[1]||"*",u[2]||"*",u[3]||"*"],this.msgString=this.msgArray.join(".")}else this.msgArray=[c],this.msgString=c};a.prototype={DEFAULT_NS:"__default",matches:function(o){if(this.msgString===o)return!0;var c=this.msgArray,u=o.split(".");if(c.length!==u.length)return!1;for(var p="",d="",f=c.length>=u.length?c.length:u.length,g=0;g<f;g++){if(c[g]!=="*"&&u[g]!=="*"&&c[g]!==u[g])return!1;p+=c[g]==="*"?"0":"1",d+=u[g]==="*"?"0":"1"}return p>=d},toString:function(){return this.msgString}};var l={handlers:{},subscribers:{before:[],after:[]},getAPI:function(){return{clear:this.clear.bind(this),listen:this.listen.bind(this),once:this.once.bind(this),publish:this.publish.bind(this),stop:this.stop.bind(this),subscribe:this.subscribe.bind(this),unsubscribe:this.unsubscribe.bind(this)}},listen:function(){var o=this.processListenArgs(Array.prototype.slice.call(arguments));if(this.log("listen","Adding listener",o),i(o.message))return this.each(o,this.listen.bind(this)),null;this.addHandler(o)},once:function(){var o=this.processListenArgs(Array.prototype.slice.call(arguments));if(o.limit=1,this.log("once","Adding one-time listener",o),i(o.message))return this.each(o,this.once.bind(this)),null;this.addHandler(o)},stop:function(o){if(o)throw new Error("Message(s) must be passed to stop()");var c={message:this.toMessage(o)};if(this.log("stop","Stopping listener",c),i(c.message))return this.each(c,this.stop.bind(this)),null;this.removeHandlers(c)},subscribe:function(){var o=this.processSubscribeArgs(Array.prototype.slice.call(arguments)),c=o.phase;this.log("subscribe","Adding subscriber",o),this.subscribers[c]=this.subscribers[c]||[],this.subscribers[c].push(o)},unsubscribe:function(){var o=this.processUnsubscribeArgs(Array.prototype.slice.call(arguments));if(!o.phase)return this.unsubscribe(o.namespace,"before"),this.unsubscribe(o.namespace,"after"),null;var c=o.namespace,u=o.phase,p=this.subscribers[u];if(this.log("unsubscribe","Unsubscribe from "+u+" phase"+(c?" in "+c+" namespace":""),o),i(p))for(var d=0;d<p.length;d++)(!c||p[d].namespace===c)&&p.splice(d,1)},publish:function(){var o=this.processPublishArgs(Array.prototype.slice.call(arguments));if(i(o.message)){var c=o.onComplete;return o.onComplete=null,this.each(o,this.publish.bind(this),c),null}var u=o.message.toString();this.log("publish","# START publishing "+u,o);for(var p=o.message,d=o.payload,f=o.onPublish,g=this.subscribers.before.concat(this.getHandlers(p)).concat(this.subscribers.after),m=0;m<g.length;m++){if(g[m].limit===null||g[m].count<g[m].limit){var v=g[m].async?g[m].handler(p,d,f):g[m].handler(p,d);g[m].async!==!0&&typeof f=="function"&&f(v),g[m].count+=1}typeof g[m].limit=="number"&&g[m].count===g[m].limit&&this.removeHandlers(o,m)}this.log("publish","# END publishing "+u,o),typeof o.onComplete=="function"&&o.onComplete()},getHandlers:function(o){var c=[];for(var u in this.handlers)this.handlers.hasOwnProperty(u)&&o.matches(u)&&(c=c.concat(this.handlers[u]));return c},clear:function(){this.log("clear","Clearing PubSub"),this.handlers={},this.subscribers={before:[],after:[]}},each:function(o,c,u){for(var p=0;p<o.message.length;p++){var d={};for(var f in o)o.hasOwnProperty(f)&&f!=="message"&&(d[f]=o[f]);d.message=o.message[p],c(d)}typeof u=="function"&&u()},addHandler:function(o){var c=o.message.toString();this.log("addHandler","Adding handler for "+c+" message",null,"TRACE"),this.handlers[c]=this.handlers[c]||[],this.handlers[c].push({namespace:o.message.namespace,handler:o.handler,async:o.async,limit:typeof o.limit=="number"?o.limit:null,count:0})},removeHandlers:function(o,c){var u=o.message.toString(),p=o.message.namespace,d=this.handlers;if(d&&d[u]){var f="Removing handler for "+u+" message";if(f+=p!==o.message.DEFAULT_NS?" in "+p+" namespace":"",this.log("removeHandlers",f,null,"TRACE"),typeof c=="number")d[u][c].namespace===p&&d[u].splice(c,1);else for(var g=0;g<d[u].length;g++)d[u][g].namespace===p&&d[u].splice(g,1);d[u].length===0&&s(d,u)}},processListenArgs:function(o){var c={};if(r(o[0])?c=o[0]:(c.message=typeof o[0]=="string"||i(o[0])?o[0]:null,c.handler=typeof o[1]=="function"?o[1]:null),!c.message||typeof c.handler!="function")throw new Error("Message(s) and handler function must be passed to listen() and/or once()");return c.message=this.toMessage(c.message),c},processSubscribeArgs:function(o){var c={};if(r(o[0])?c=o[0]:c.handler=typeof o[0]=="function"?o[0]:null,typeof c.handler!="function")throw new Error("Handler must be passed to subscribe()");if(c.phase=c.phase||"after",c.limit=null,c.count=0,c.phase&&!(c.phase in{before:1,after:1}))throw new Error(c.phase+" is not a valid phase for subscribe().");return c},processUnsubscribeArgs:function(o){var c={};if(r(o[0])?c=o[0]:(c.namespace=typeof o[0]=="string"?o[0]:null,c.phase=typeof o[1]=="string"?o[1]:null),c.phase&&!(c.phase in{before:1,after:1}))throw new Error(c.phase+" is not a valid phase for unsubscribe().");return c},processPublishArgs:function(o){var c={};if(r(o[0])?c=o[0]:(c.message=typeof o[0]=="string"||i(o[0])?o[0]:null,c.payload=typeof o[1]<"u"?o[1]:null),!c.message)throw new Error("Message(s) must be passed to publish()");return c.message=this.toMessage(c.message),c.async&&typeof c.onPublish!="function"&&(c.onPublish=function(){}),c},toMessage:function(o){if(i(o)){for(var c=[],u=0;u<o.length;u++)o[u]instanceof a||(c[u]=new a(o[u]));o=c}else o&&!(o instanceof a)&&(o=new a(o));return o},log:function(o,c,u,p){n("DropletJS.PubSub."+o,c,u,p)},setLogLevel:function(o){}};return l}(),$i=Le.createScopedLog("Notification");let ut;const kn={settings:[300,60,10],NOTIFICATION_TTL:5e3,initAPI:function(e){return ut=e,ut.mixin("Notification",{initAsync:this.initAsync.bind(this),get:this.get.bind(this),saveSettings:this.saveSettings.bind(this)})},init:function(e){$i("init","Initializing Notification",null,"DEBUG"),this.loadSettings(),typeof e=="function"&&e()},initAsync(){return new Promise(e=>this.init(e))},get:function(){return this.settings},show:function(e){$i("show","Showing "+e+" notification");let t="",n="",i=0;e==="nuclear"?(i=ut.NuclearOption.getSecondsUntilActive(),t="/common/img/icon-nuclear-48.png",n=ut.Chrome.Translation.get("nuclearNotification")||"The Nuclear Option will start blocking sites in"):e==="block"&&(i=ut.StayFocusd.getTotalSecondsRemaining(),t="/common/img/icon-red-48.png",n=ut.Chrome.Translation.get("blockNotification")||"StayFocusd will start blocking your Blocked Sites in"),n+=i>60?" "+ut.Date.secondsToMinsAndSecs(i):" "+i+" seconds";const r={type:"basic",title:"StayFocusd",iconUrl:t,message:n};ut.Chrome.Notification.create("",r,s=>{s!=null&&setTimeout(()=>{ut.Chrome.Notification.clear(s)},this.NOTIFICATION_TTL)})},isset:function(e){return this.settings.inArray(e)},saveSettings:function(e){$i("saveSettings","Saving settings",e,"TRACE"),this.settings=e,ut.Settings.set({notificationSettings:e})},loadSettings:function(){$i("loadSettings","Loading settings",null,"TRACE");const e=ut.Settings.get("notificationSettings");e&&(this.settings=e)}};var ri=(e=>(e.RED="#FF0000",e.YELLOW="#FDD017",e.GREEN="#009933",e.BLACK="#000000",e))(ri||{}),En=(e=>(e.ONBOARDING="/common/img/icon-red-dot-24.png",e.ALLOWED="/common/img/icon-green-24.png",e.BLOCKED="/common/img/icon-red-24.png",e.DEFAULT="/common/img/icon-24.png",e.NUCLEAR="/common/img/icon-nuclear-24.png",e.DEACTIVATED="/common/img/icon-disabled-24.png",e))(En||{});const Vi=function(e,t,n,i){ts.log(`BadgeIcons.${e}`,t,n,i)};function Mo(){function e(a,l,o){const c=a||"",u=o||void 0;Vi("showBadge","Showing badge",{text:c,iconColor:l,tabID:u},"DEBUG"),l&&i(l,u),r(c,u)}function t(a){a=a||void 0,r("",a)}async function n(a,l){l=l||void 0,Vi("setIcon","Setting icon",a,"TRACE"),await s()?chrome.action.setIcon({tabId:l,path:"/common/img/icon-red-dot-24.png"}):chrome.action.setIcon({tabId:l,path:a})}function i(a,l){Vi("setBadgeColor","Setting badge color",a,"TRACE"),l=l||void 0,chrome.action.setBadgeBackgroundColor({tabId:l,color:a})}function r(a,l){Vi("setBadgeText","Setting badge text",a,"TRACE"),l=l||void 0,chrome.action.setBadgeText({tabId:l,text:a})}async function s(){return!1}return{showBadge:e,hideBadge:t,setIcon:n}}const If=Mo(),Tt=Le.createScopedLog("NuclearOption");let qe;const rt={timer:null,interval:1,settings:{},initialized:!1,initAPI:function(e){return qe=e,qe.mixin("NuclearOption",{init:this.init.bind(this),initAsync:this.initAsync.bind(this),activate:this.activate.bind(this),isActive:this.isActive.bind(this),getBlockLength:this.getBlockLength.bind(this),getBlockType:this.getBlockType.bind(this),getContentType:this.getContentType.bind(this),getExpiration:this.getExpiration.bind(this),getFrequency:this.getFrequency.bind(this),getSecondsUntilActive:this.getSecondsUntilActive.bind(this),getSmartBomb:this.getSmartBomb.bind(this),getStartAmPm:this.getStartAmPm.bind(this),getStartHour:this.getStartHour.bind(this),getStartMin:this.getStartMin.bind(this),getStartType:this.getStartType.bind(this),saveSettings:this.saveSettings.bind(this),updateActiveDays:this.updateActiveDays.bind(this)})},init:function(e){Tt("init","Initializing NuclearOption",null,"DEBUG"),this.loadSettings(),this.timer=setInterval(this.tick.bind(this),this.interval*1e3),this.initialized=!0,typeof e=="function"&&e(),qe.PubSub.listen("Settings.data.refreshed",(t,n)=>{n.changes.nuclearOptionSettings&&this.loadSettings()})},initAsync(){return new Promise(e=>this.init(e))},saveSettings:function(e){this.settings=e,e.activeDays=this.calculateActiveDays(e),Tt("saveSettings","Saving settings",e,"DEBUG"),qe.Settings.set({nuclearOptionSettings:e})},calculateActiveDays:function(e){let t=[];return e.frequency==="activeDays"?t=qe.StayFocusd.getActiveDays(!0):typeof e.frequency<"u"&&(t[0]=e.frequency==="everyDay",t[1]=e.frequency.indexOf("every")>-1,t[2]=e.frequency.indexOf("every")>-1,t[3]=e.frequency.indexOf("every")>-1,t[4]=e.frequency.indexOf("every")>-1,t[5]=e.frequency.indexOf("every")>-1,t[6]=e.frequency==="everyDay"),Tt("calculateActiveDays","Calculating active days",t,"DEBUG"),t},updateActiveDays:function(e){Tt("updateActiveDays","Updating active days",e,"DEBUG"),this.initialized||this.init(()=>{this.updateActiveDays(e)}),this.settings.activeDays=e,this.saveSettings(this.settings)},loadSettings:function(){Tt("loadSettings","Loading settings",this.settings,"DEBUG");const e=qe.Settings.get("nuclearOptionSettings");e&&(this.settings=e)},isActive:function(){this.isCurrentlyActive()?this.isExpired()&&this.deactivate():this.isStarted()&&this.activate();const e=this.isCurrentlyActive();return Tt("isActive","Is Nuclear Option active?",e?"YES":"NO","TRACE"),e},isActiveToday:function(){const e=this.getFrequency(),t=this.getLastActiveDate(),n=this.getLastExpiredDate(),i=new Date().toDateString();if(e==="todayOnly"&&(t===i||t===null)&&n!==i)return!0;const r=new Date().getDay(),s=this.getActiveDays();return s.length===0?!1:s[r]},isStarted:function(){const e=this.getStartType(),t=this.getLastActiveDate(),n=this.getLastExpiredDate(),i=new Date().toDateString();if(!this.isActiveToday()||n===i)if(e==="atScheduledTime"){const r=new Date(i+" "+this.getStartHour()+":"+this.getStartMin()+" "+this.getStartAmPm());if(new Date(this.getExpiration())>r)return!1}else return!1;if(e==="now")return t===i;if(this.isActiveToday()){if(e==="atScheduledTime")return qe.Date.hasTimePassed(this.getStartHour(),this.getStartMin(),this.getStartAmPm());if(e==="whenMaxTimeAllowedExceeded")return!!qe.BlockedAllWebsites.isMaxTimeAllowedExceeded()}return!1},activate:function(){qe.Analytics.event("TOGGLE_NUCLEAR_OPTION",{enabled:!0}),Tt("activate","Activating Nuclear Option");const e=this.hasScheduledTime()?qe.Date.getTodayDateObj(this.getStartHour(),this.getStartMin(),this.getStartAmPm()):new Date;this.settings.expiration=e.getTime()+this.getBlockLength(),this.settings.lastActiveDate=new Date().toDateString(),this.settings.lastExpiredDate=null,this.settings.isCurrentlyActive=!0,this.saveSettings(this.settings),If.hideBadge()},deactivate:function(){qe.Analytics.event("TOGGLE_NUCLEAR_OPTION",{enabled:!1}),Tt("deactivate","Deactivating Nuclear Option"),this.settings.lastExpiredDate=new Date().toDateString(),this.settings.isCurrentlyActive=!1,this.saveSettings(this.settings)},isExpired:function(){if(this.getExpiration()===null)return!0;const e=new Date;return new Date(this.getExpiration())<e},isBlockable:function(e,t){if(this.isActive()===!1)return!1;switch(this.getBlockType()){case"all":return!0;case"allExceptAllowed":return!t;case"blocked":return e&&!t;default:return!1}},hasScheduledTime:function(){return this.getStartType()==="atScheduledTime"},getSecondsUntilActive:function(){return qe.Date.secondsUntilTime(this.getStartHour(),this.getStartMin(),this.getStartAmPm())},hasSmartBomb:function(){return this.getContentType()==="smartBomb"},isCurrentlyActive:function(){return typeof this.settings.isCurrentlyActive>"u"?!1:this.settings.isCurrentlyActive},getSmartBomb:function(){return this.settings.smartBomb??{}},getContentType:function(){return typeof this.settings.contentType>"u"?"wholeSite":this.settings.contentType},getExpiration:function(){return typeof this.settings.expiration>"u"?null:Number(this.settings.expiration)},getLastActiveDate:function(){return typeof this.settings.lastActiveDate>"u"?null:this.settings.lastActiveDate},getLastExpiredDate:function(){return typeof this.settings.lastExpiredDate>"u"?null:this.settings.lastExpiredDate},getBlockType:function(){return typeof this.settings.blockType>"u"?"blocked":this.settings.blockType},getBlockLength:function(){if(typeof this.settings.blockLength>"u")return mr;{const e=this.settings.blockLength;return Number(e)===e&&e%1!==0||e<cn?Math.floor(e*60)*cn:e}},getStartType:function(){return typeof this.settings.startType>"u"?"now":this.settings.startType},getStartHour:function(){return this.settings.startHour??"00"},getStartMin:function(){return this.settings.startMin??"00"},getStartAmPm:function(){return this.settings.startAmPm??"am"},getFrequency:function(){return this.settings.frequency??null},getActiveDays:function(){return this.settings.activeDays??[]},tick:function(){if(this.hasScheduledTime()&&!this.isActive()){const e=this.getSecondsUntilActive();Tt("tick",e+" seconds until Nuclear Option",null,"TRACE"),kn.isset(e)&&kn.show("nuclear"),this.updateBadge()}else this.isActive()&&this.updatePopupTimer();return!0},updatePopupTimer(){qe.StayFocusd.postTimerUpdatedMessage()},updateBadge:function(){const e=this.getSecondsUntilActive();e>0&&e<60&&qe.StayFocusd.updateBadge(this.getSecondsUntilActive(),!0)}},Gi=Le.createScopedLog("WebUsage"),Df=1e3;let it;const kf={_timer:null,_isNewDay:null,_killPageAction:null,_updateBadgeAction:null,_postTimerUpdatedMessage:null,_showNotification:null,initAPI(e){return it=e,it.mixin("BlockedGroupsTimer",{init:this.init.bind(this),startCountdown:this.startCountdown.bind(this),stopCountdown:this.stopCountdown.bind(this),tick:this.tick.bind(this),isMaxTimeAllowedExceeded:this.isMaxTimeAllowedExceeded.bind(this),getTotalSecondsRemaining:this.getTotalSecondsRemaining.bind(this)})},async init(e,t,n,i,r){this._isNewDay=e,this._killPageAction=t,this._updateBadgeAction=n,this._postTimerUpdatedMessage=i,this._showNotification=r},startCountdown(e){if(this._timer&&this.stopCountdown(),!it.Settings.get("activated",!0)){Gi("startCountdown","Extension is not activated");return}Gi("startCountdown","Starting countdown"),this._timer=setInterval(async()=>await this.tick(e),Df)},stopCountdown(){Gi("stopCountdown","Stopping countdown"),this._timer&&clearInterval(this._timer),this._timer=null},async tick(e){var n;(n=this._isNewDay)!=null&&n.call(this)&&it.BlockedGroupsRepository.clearElapsedTime();const t=it.BlockedAllWebsites.getTime();if(t!=null)await it.Storage.set({blockAllWebsitesElapsedTime:t.elapsedTime+1}),this.actionsAfterCheckingTime(e,t.elapsedTime,t.allowedTime-t.elapsedTime);else{const i=it.BlockedGroupsRepository.getBlockedGroupByDomain(e);if(!i)return;await it.BlockedGroupsRepository.incrementElapsedTime(i.groupName);const r=i.maxTimeAllowed-i.elapsedTime;this.actionsAfterCheckingTime(e,i.elapsedTime,r)}},actionsAfterCheckingTime(e,t,n){var i,r,s,a;if(Gi("tick",`Elapsed time: ${t}. Time remaining: ${n}`,null,"DEBUG"),(i=this._showNotification)==null||i.call(this,n),n<=0){(r=this._killPageAction)==null||r.call(this,e);return}(s=this._postTimerUpdatedMessage)==null||s.call(this),(a=this._updateBadgeAction)==null||a.call(this,n)},isMaxTimeAllowedExceeded(e){const t=it.BlockedAllWebsites.isMaxTimeAllowedExceeded();if(t!=null)return t;{const n=it.BlockedGroupsRepository.getBlockedGroupByDomain(e);if(n)return n.elapsedTime>=n.maxTimeAllowed}return!1},getTotalSecondsRemaining(e){const t=it.BlockedAllWebsites.getTotalSecondsRemaining();if(t!=null)return t;{const n=it.BlockedGroupsRepository.getBlockedGroupByDomain(e);if(n!=null)return n.maxTimeAllowed-n.elapsedTime}}};let Sn;const Pf={initAPI(e){return Sn=e,Sn.mixin("BlockedAllWebsites",{getTime:this.getTime.bind(this),isMaxTimeAllowedExceeded:this.isMaxTimeAllowedExceeded.bind(this),getTotalSecondsRemaining:this.getTotalSecondsRemaining.bind(this),clearElapsedTime:this.clearElapsedTime.bind(this)})},getTime(){if(Sn.Settings.get("isBlockAllWebsites")??!1){const t=Sn.Settings.get("blockAllWebsitesAllowedTime")??Mn*10,n=Sn.Settings.get("blockAllWebsitesElapsedTime")??0;return{allowedTime:t,elapsedTime:n}}return null},isMaxTimeAllowedExceeded(){const e=this.getTime();return e!=null?e.elapsedTime>=e.allowedTime:null},getTotalSecondsRemaining(){const e=this.getTime();return e!=null?e.allowedTime-e.elapsedTime:null},async clearElapsedTime(){await Sn.Storage.set({blockAllWebsitesElapsedTime:0})}};function Hf(){const e=q.BlockedGroupsRepository.get();let t=[];return e.forEach(n=>{t=t.concat(n.websites)}),t}function zf(){return q.WhitelistRepository.getAll()}function Zf(e,t,n){const i=t==null?!0:t.some(s=>Pn(s,e)),r=n.some(s=>Pn(s,e));return i&&!r}function Pn(e,t){return q.Domain.isMoreGeneralURL(e,t)||q.Domain.matchesWildcard(e,t)}const mt="blockedGroups",ma="blacklist",ya="maxTimeAllowed",Fr="Default";let De,Fe=[];const Mf={initAPI(e){return De=e,De.mixin("BlockedGroupsRepository",{init:this.init.bind(this),add:this.add.bind(this),get:this.get.bind(this),getByName:this.getByName.bind(this),update:this.update.bind(this),updateWebsites:this.updateWebsites.bind(this),addWebsite:this.addWebsite.bind(this),clearElapsedTime:this.clearElapsedTime.bind(this),incrementElapsedTime:this.incrementElapsedTime.bind(this),delete:this.delete.bind(this),isBlockable:this.isBlockable.bind(this),getBlockedGroupByDomain:this.getBlockedGroupByDomain.bind(this),getBlockedGroupsByDomain:this.getBlockedGroupsByDomain.bind(this),migrate:this.migrate.bind(this),importBlockedsites:this.importBlockedsites.bind(this)})},async init(){if(q.Settings.get("disableSync")===!0){const n=!!(await De.Chrome.Storage.getSync(mt))[mt];await De.Storage.setBucket(mt,"LOCAL",!n)}else{const n=!!(await De.Chrome.Storage.getLocal(mt))[mt];await De.Storage.setBucket(mt,"SYNC",!n)}this.getGroups(),this.addListeners()},async getGroups(){const e=De.Settings.get(mt);Fe=e??[]},async add(e,t,n,i){if(Fe.find(s=>s.groupName==e)==null){const s={groupName:e,maxTimeAllowed:t,websites:n,elapsedTime:i??0};Fe.push(s),await this.saveChanges(),q.Analytics.event("CREATE_BLOCKED_GROUP")}},get(){return Fe},getByName(e){return Fe.find(t=>t.groupName==e)},async update(e,t,n,i){const r=Fe.find(s=>s.groupName==e);typeof r>"u"||(r.groupName!=t&&q.Analytics.event("UPDATE_BLOCKED_GROUP_NAME"),r.groupName!="Default"&&(r.groupName=t),r.maxTimeAllowed!=n&&q.Analytics.event("UPDATE_BLOCKED_GROUP_MAX_TIME_ALLOWED",{minutes:n/60}),r.maxTimeAllowed=n,r.websites=i,await this.saveChanges())},async updateWebsites(e,t){const n=Fe.find(i=>i.groupName==e);typeof n>"u"||(n.websites=t,await this.saveChanges())},async addWebsite(e,t){const n=Fe.find(i=>i.groupName==e);if(!(typeof n>"u"))return n.websites.find(i=>i==t)==null?(n.websites.push(t),await this.saveChanges(),!0):!1},async clearElapsedTime(){this.get().forEach(t=>t.elapsedTime=0),await this.saveChanges(),await De.BlockedAllWebsites.clearElapsedTime()},async delete(e){const t=Fe.findIndex(n=>n.groupName==e);t>-1&&(Fe.splice(t,1),await this.saveChanges(),q.Analytics.event("DELETE_BLOCKED_GROUP"))},isBlockable(e){return e=e.toLowerCase(),Fe.find(t=>t.websites.find(n=>Pn(n,e)))!=null},getBlockedGroupByDomain(e){return e==null?null:(e=e.toLowerCase(),Fe.find(t=>t.websites.find(n=>Pn(n,e))))},getBlockedGroupsByDomain(e){return Fe.filter(t=>t.websites.find(n=>Pn(n,e)))},async migrate(){if(this.needMigrate()){const e=De.Settings.get(ma);let t=De.Settings.get(ya);t==null?t=Vs:t=t*Mn;let n=await De.Storage.get("elapsedTime");if((isNaN(n)||n==null)&&(n=0),e!=null){const i=Object.keys(e);await this.add(Fr,t,i,n)}else await this.add(Fr,t,[],n)}},needMigrate(){return De.Settings.get(mt)==null},async importBlockedsites(){Fe=[];const e=De.Settings.get(ma);if(e!=null){const t=Object.keys(e);let n=De.Settings.get(ya);n==null?n=Vs:n=n*Mn,await this.add(Fr,n,t,0)}},async incrementElapsedTime(e){const t=this.getByName(e);t&&(t.elapsedTime+=1,await this.saveChanges())},async saveChanges(){await De.Storage.set({blockedGroups:Fe})},addListeners(){q.PubSub.listen("Settings.data.refreshed",async(e,t)=>{(t.changes.blockedGroups||t.changes.disableSync)&&(t.changes.disableSync&&(t.disableSync===!1?await De.Storage.setBucket(mt,"SYNC"):await De.Storage.setBucket(mt,"LOCAL")),this.getGroups())})}},qi=Le.createScopedLog("Message");class Lf{constructor(t){wn(this,"DEFAULT_NS","__default");wn(this,"msgArray",null);wn(this,"msgString",null);wn(this,"namespace",null);if(this.namespace=this.DEFAULT_NS,t.indexOf(":")>-1&&(this.namespace=t.substr(0,t.indexOf(":")),t=t.substr(t.indexOf(":")+1,t.length)),t.indexOf(".")>-1){const n=t.split(".");this.msgArray=[n[0]||"*",n[1]||"*",n[2]||"*",n[3]||"*"],this.msgString=this.msgArray.join(".")}else this.msgArray=[t],this.msgString=t}matches(t){if(this.msgString===t)return qi("matches",this.msgString+" matches "+t+"?","YES","TRACE"),!0;const n=this.msgArray,i=t.split(".");if((n==null?void 0:n.length)!==i.length)return qi("matches",this.msgString+" matches "+t+"?","NO","TRACE"),!1;let r="",s="";const a=n.length>=i.length?n.length:i.length;for(let l=0;l<a;l++){if(n[l]!=="*"&&i[l]!=="*"&&n[l]!==i[l])return qi("matches",this.msgString+" matches "+t+"?","NO","TRACE"),!1;r+=n[l]==="*"?"0":"1",s+=i[l]==="*"?"0":"1"}return qi("matches",this.msgString+" matches "+t+"?",r>=s?"YES":"NO","TRACE"),r>=s}toString(){return this.msgString}getOriginator(){var t,n;return((t=this.msgArray)==null?void 0:t[0])==="*"?null:(n=this.msgArray)==null?void 0:n[0]}getDescriptor(){var t,n;return((t=this.msgArray)==null?void 0:t[3])==="*"?null:(n=this.msgArray)==null?void 0:n[3]}}const oe=Le.createScopedLog("StayFocusd"),_n=Mo();let S;const wa="onboarding-opened-at",Rf={firstInstallAllowance:60,interval:1,timer:null,apiURL:"https://www.stayfocusd.com",redirectURL:"https://www.stayfocusd.com/blocked/",uninstallUrl:"https://www.stayfocusd.com/goodbye/",onboardingUrl:"https://www.stayfocusd.com/extension-get-started",currentURL:null,version:null,selectedTabID:null,active:null,popupPort:null,initAPI:function(e){return S=e,S.mixin("StayFocusd",{getActiveDays:this.getActiveDays.bind(this),getActiveHours:this.getActiveHours.bind(this),getActiveHoursQueue:this.getActiveHoursQueue.bind(this),getAPIURL:()=>this.apiURL,getCurrentURL:()=>this.currentURL,getResetTime:this.getResetTime.bind(this),getResetTimeQueue:this.getResetTimeQueue.bind(this),getTotalSecondsRemaining:this.getTotalSecondsRemaining.bind(this),isActive:this.isActive.bind(this),isFirstInstallAllowanceActive:this.isFirstInstallAllowanceActive.bind(this),isUpdatePopupDisabled:this.isUpdatePopupDisabled.bind(this),localizeHTML:this.localizeHTML.bind(this),setActiveDays:this.setActiveDays.bind(this),setActiveHoursQueue:this.setActiveHoursQueue.bind(this),setResetTimeQueue:this.setResetTimeQueue.bind(this),updateBadge:this.updateBadge.bind(this),hideBadge:this.hideBadge.bind(this),postTimerUpdatedMessage:this.postTimerUpdatedMessage.bind(this),onInstalled:this.onInstalled.bind(this),onUpdated:this.onUpdated.bind(this),activated:this.activated.bind(this),setActivated:this.setActivated.bind(this),isActivateSwitchShown:this.isActivateSwitchShown.bind(this),setActivateSwitchShown:this.setActivateSwitchShown.bind(this)})},async init(){oe("init","Initializing StayFocusd",null,"DEBUG"),this.initCheckingTab(),await this.initSettings(),await this.initRemoteConfig(),this.initAnalytics(),this.initBugsnag(),await this.initRequirements(),await this.initBlockedGroups(),this.initBlockedGroupTimer(),await this.initWhitelist(),await this.initNuclearOption(),await this.initNotification(),this.initListeners(),this.initUninstallURL(),await this.initWebUsageCollect(),this.initScheduleJobs(),await this.forceOnboardingOnNewTab()},initBlockedGroupTimer(){const e=()=>this.isNewDay(),t=s=>this.killPage(s),n=s=>this.updateBadge(s),i=()=>this.postTimerUpdatedMessage(),r=s=>this.showNotification(s);S.BlockedGroupsTimer.init(e,t,n,i,r)},async initSettings(){await S.Settings.initAsync(),await S.Storage.setBucket(["backupKeys","disableUpdatePopup","isUpdated","previousVersion","productivityBypass"]),S.Storage.addOnChangeListener(async(e,t)=>{oe("init",t+" storage changed",e),S.Settings.refresh(()=>{S.PubSub.publish("Settings.data.refreshed",{areaName:t,changes:e})})}),this.isFirstInstall()&&this.setFirstInstallAllowance()},async initRemoteConfig(){await S.RemoteConfig.init(),await S.Chrome.Alarms.ensure("remote-config",{periodInMinutes:30}),S.Chrome.Alarms.addListener("onAlarm",async e=>{e.name==="remote-config"&&await S.RemoteConfig.refresh()}),await S.RemoteConfig.refresh()},initAnalytics(){S.Analytics.init()},initBugsnag(){S.Bugsnag.init("background")},async initWebUsageCollect(){await S.WebUsage.init(),chrome.runtime.onConnect.addListener(e=>{e.name=="getUsageSummaryData"&&e.onMessage.addListener(async t=>{if(t.message=="usage.getUsageSummaryData.request"){const n=await S.WebUsage.getUsageDatabase(),i=await n.sessionsRepo.findSessions(t.startDate,t.endDate),r=await n.adsRepo.findAds(t.startDate,t.endDate);e.postMessage({message:"usage.getUsageSummaryData.response",startDate:t.startDate,endDate:t.endDate,sessions:i,ads:r})}})})},initCheckingTab(){setInterval(()=>{S.Chrome.Tab.getSelected(void 0,e=>{e&&S.PubSub.publish("StayFocusd.tab.activity",{tabID:e.id,tab:e})})},1e3)},initScheduleJobs(){S.ScheduleJobs.init()},async initRequirements(){await S.Requirements.init()},async initBlockedGroups(){await S.BlockedGroupsRepository.init(),await S.BlockedGroupsRepository.migrate(),this.isNewDay()===!0&&S.BlockedGroupsRepository.clearElapsedTime()},async initWhitelist(){oe("initWhitelist","Initializing whitelist",null,"DEBUG"),await S.WhitelistRepository.init(),await S.WhitelistRepository.migrate()},async initNuclearOption(){oe("initNuclearOption","Initializing Nuclear Option",null,"DEBUG"),await rt.initAsync(),oe("initNuclearOption","Nuclear Option initialized",null,"DEBUG")},async initNotification(){oe("initNotification","Initializing Notification",null,"DEBUG"),await kn.initAsync(),oe("initNotification","Notification initialized",null,"DEBUG")},showNotification(e){kn.isset(e)&&kn.show("block")},initListeners(){oe("initListeners","Initializing listeners",null,"DEBUG"),S.PubSub.subscribe({async:!0,handler:async(e,t,n)=>{var a;function i(l){return chrome.runtime.lastError&&oe("initListeners","runtime.lastError",chrome.runtime.lastError),l!=null&&typeof l=="function"?l:()=>!0}if(n=i(n),!t||!t.tabID||(a=t.sender)!=null&&a.tab)return!0;const r=await S.Chrome.Tab.get(t.tabID);if(!r||r.status==="loading")return!0;const s=(r.url==""?r.pendingUrl:r.url)??"";return/^about:|^chrome-extension:|^chrome:\/\//i.test(s)||S.Chrome.Message.sendToTab(t.tabID,{message:e.toString(),payload:t},n),!0}}),S.Chrome.Message.on.addListener((e,t,n)=>(e.payload=e.payload||{},e.payload.sender=t||{},/^proxy-service.*$/.test(e.type)||t.tab&&S.PubSub.publish({message:e.message,payload:e.payload,onPublish:typeof n=="function"?n:()=>{}}),!0)),S.PubSub.listen("ActivityMonitor.component.initialized",()=>{S.Chrome.Tab.getSelected(void 0,e=>{e&&S.PubSub.publish("StayFocusd.tab.selected",{tab:e,tabID:e.id,blockable:this.isBlockable(e.url??"")})})}),S.PubSub.listen({message:"ActivityMonitor.overlay.hidden",async:!0,handler:(e,t,n)=>{const i={countdownStarted:S.BlockedGroupsTimer.startCountdown(this.currentURL)};typeof n=="function"&&n(i)}}),S.PubSub.listen({message:"ActivityMonitor.overlay.shown",async:!0,handler:(e,t,n)=>{const i={countdownStopped:S.BlockedGroupsTimer.stopCountdown()};typeof n=="function"&&n(i)}}),S.Chrome.Extension.addListener("onConnect",e=>{e.name==="popup"&&this.onPopupConnected(e)}),S.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)}),S.Chrome.Tab.addListener("onActivated",()=>{S.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)})}),S.Chrome.Tab.addListener("onUpdated",()=>{S.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)})}),S.Chrome.Tab.addListener("onRemoved",()=>{S.Chrome.Tab.getSelected(void 0,e=>{typeof e>"u"&&S.BlockedGroupsTimer.stopCountdown()})}),S.Chrome.Window.addListener("onRemoved",()=>{S.BlockedGroupsTimer.stopCountdown()}),S.Chrome.Window.addListener("onFocusChanged",()=>{S.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)})})},async onInstalled(e){await chrome.tabs.create({url:this.onboardingUrl,active:!0}),oe("onInstalled","Installed extension",e,"INFO");const{promise:t,resolve:n}=Le.getDecoupledPromise();chrome.runtime.onConnect.addListener(i=>{i.name=="startOnboardingAfterInstall"&&i.onMessage.addListener(async r=>{r.message=="start-onboarding"&&n()})}),await t,S.Settings.set({isNewUser:!0}),await this.openOnboarding()},async onUpdated(e){if(!e.previousVersion)return;const t=await S.Storage.get("previousVersion"),n=await S.Storage.get("disableUpdatePopup");t!==e.previousVersion&&(n!=="true"&&n!==!0&&_n.showBadge("NEW",ri.GREEN),S.Storage.set({isUpdated:!0,previousVersion:e.previousVersion}))},async openOnboarding(){oe("openOnboarding","Opening onboarding in new tab",void 0,"INFO"),await S.Storage.set({[wa]:Date.now()}),await S.Chrome.Tab.update({url:this.getOptionsPage(),active:!0})},async forceOnboardingOnNewTab(){oe("initOnboarding","initializing...",void 0,"INFO");const e=await this.getFirstSensorTowerInstallDate();S.Chrome.Tab.addListener("onCreated",async t=>{if(Date.now()-e<cn)return;oe("initOnboarding","tab.onCreated",t,"DEBUG");const n=S.RemoteConfig.get("newTabTimeout"),i=await S.Requirements.isOnboardingCompleted(),r=await S.Storage.get(wa)??0,s=Date.now()>=r+n;!i&&s&&(await S.Analytics.event("OPENING_ONBOARDING_ON_TAB_CREATED"),await this.openOnboarding())})},initUninstallURL(){S.Chrome.Extension.setUninstallURL(this.uninstallUrl)},onPopupConnected(e){oe("onPopupConnected","Popup connected",e,"DEBUG"),this.popupPort=e,e.onMessage.addListener(async t=>{const n=new Lf(t.message);if(n.matches("*.domain.add.BLACKLIST")){const i=t.payload.groupName,r=t.payload.domain,s=await S.BlockedGroupsRepository.addWebsite(i,r);e.postMessage({message:"StayFocusd.domain.added."+n.getDescriptor(),payload:{success:s}}),await this.checkURL(t.payload.domain)}if(n.matches("*.domain.add.WHITELIST")){const i=[t.payload.domain],r=await S.WhitelistRepository.add(i);e.postMessage({message:"StayFocusd.domain.added."+n.getDescriptor(),payload:{success:r}}),await this.checkURL(t.payload.domain)}if(n.matches("PopupController.toggle.*.*")){const{value:i}=t.payload;this.setActivated(i),e.postMessage({message:"StayFocusd.toggled",payload:{value:this.activated()}}),S.Chrome.Tab.getSelected(void 0,async r=>{await this.onTabStateChange(r)})}return!0}),e.onDisconnect.addListener(()=>{this.popupPort=null}),this.postTimerUpdatedMessage()},postTimerUpdatedMessage:function(){S.PubSub.publish("StayFocusd.timer.updated",{tabID:this.selectedTabID,displayTimer:this.getDisplayTimer()}),this.popupPort&&this.popupPort.postMessage({message:"StayFocusd.timer.updated",payload:{displayTimer:this.getDisplayTimer()}})},onTabStateChange:async function(e){if(typeof e>"u")return;oe("onTabStateChange","Tab state changed",e),this.currentURL=e.url,this.selectedTabID=e.id,await this.checkURL(e.url);const t=this.isBlockable(e.url);S.PubSub.publish("StayFocusd.tab.selected",{tab:e,tabID:e.id,blockable:t})},checkURL:async function(e){e=typeof e>"u"||typeof e=="string"&&e.length===0?this.currentURL:e,oe("checkURL","Checking url: ",e),this.isNewDay()===!0&&S.BlockedGroupsRepository.clearElapsedTime(),S.BlockedGroupsTimer.stopCountdown(),this.isBlockable(e)?(S.Chrome.Tab.getSelected(void 0,t=>{this.setBadgeIcon(t,En.BLOCKED)}),this.isKillable(e)?this.killPage(e):S.BlockedGroupsTimer.startCountdown(e)):S.WhitelistRepository.isExists(e)?S.Chrome.Tab.getSelected(void 0,n=>{this.setBadgeIcon(n,En.ALLOWED)}):S.Chrome.Tab.getSelected(void 0,n=>{this.setBadgeIcon(n,En.DEFAULT)})},setBadgeIcon(e,t){e&&(this.activated()?rt.isActive()?_n.setIcon(En.NUCLEAR,e.id):_n.setIcon(t,e.id):_n.setIcon(En.DEACTIVATED,e.id))},isKillable:function(e){return S.BlockedGroupsTimer.isMaxTimeAllowedExceeded(e)||rt.isActive()},isProtectedURL:function(e){return e===null||typeof e>"u"||e.length===0?!1:e.indexOf(this.redirectURL)===0||e.indexOf("rescueMe")>=0||e.indexOf("chrome")>=0&&e.indexOf("chrome")<e.indexOf("://")&&(e.indexOf("sf")>-1||e.indexOf("devtools")>-1)},isBlockable:function(e){if(!this.activated()||this.isProtectedURL(e)||e===null||typeof e>"u"||e===""||this.isActive()===!1)return!1;const t=S.BlockedGroupsRepository.isBlockable(e),n=S.WhitelistRepository.isExists(e),i=rt.isBlockable(t,n);if(S.Settings.get("isBlockAllWebsites")&&!n||i||t&&!n)return!0;if(t&&n){const s=S.BlockedGroupsRepository.getBlockedGroupByDomain(e),a=(s==null?void 0:s.websites.find(c=>S.Domain.isMoreGeneralURL(c,e)))??"",o=S.WhitelistRepository.isExists(e)?e:"";return a===e&&o!==e?!0:a!==e&&o===e?!1:Ca.isMoreGeneralURL(o,a)}return n||rt.isActive()&&!i,!1},isNewDay:function(){let e=!1;const t=new Date;let n=t.getTime(),i=S.Settings.get("resetTimestamp"),r=this.getResetTime();if(/null/.test(r)&&(r="00:00",this.setResetTime(r)),typeof i>"u"||i===null||i===""){const s=r.split(":"),a=Math.floor(s[0]),l=Math.floor(s[1]);i=new Date(t.toDateString()+" "+a+":"+l).getTime(),this.updateResetTimestamp(r)}return i=Math.floor(i),n=Math.floor(n),n>i&&(e=!0,this.updateResetTimestamp(r)),e},updateBadge:function(e,t=!1){let n=!1,i;const r=Math.floor(e),s=r.toString();t&&r<=60?(n=!0,i=ri.BLACK):r<=30?(n=!0,i=ri.RED):r<=60&&(n=!0,i=ri.YELLOW),n?_n.showBadge(s,i,this.selectedTabID??void 0):this.hideBadge()},hideBadge(){_n.hideBadge(this.selectedTabID??void 0)},killPage:function(e){return oe("killPage","Killing page",null,"INFO"),S.BlockedGroupsTimer.stopCountdown(),S.Chrome.Window.getLastFocused(t=>{typeof t<"u"&&S.Chrome.Tab.getAllInWindow(t.id,n=>{for(const i in n)if(n[i].highlighted)if(S.BlockedGroupsTimer.isMaxTimeAllowedExceeded(e)||rt.isActive()&&!rt.hasSmartBomb()){const r=S.Settings.get("customStayFocusdMsg")||"";S.Chrome.Tab.update(n[i].id,{url:this.redirectURL+"?background&customMsg="+encodeURIComponent(r)})}else rt.isActive()&&rt.hasSmartBomb()&&S.PubSub.publish("StayFocusd.smartBomb.activate",{tabID:n[i].id,smartBomb:rt.getSmartBomb()})})}),!1},getTotalSecondsRemaining:function(){return S.BlockedGroupsTimer.getTotalSecondsRemaining(this.currentURL)},getDisplayTimer:function(){function e(){const i="Default",r=q.BlockedGroupsRepository.getByName(i);return{groupName:i,time:Cn.formatDurationInSeconds(r.maxTimeAllowed-r.elapsedTime),nuclear:!1}}if(q.NuclearOption.isActive()){const i=q.NuclearOption.getExpiration();if(i){const r=(i-Date.now())/Oa;return{groupName:q.Chrome.Translation.get("nuclear"),time:Cn.formatDurationInSeconds(r),nuclear:!0}}}const t=S.BlockedAllWebsites.getTime();if(t!=null)return{groupName:null,time:Cn.formatDurationInSeconds(t.allowedTime-t.elapsedTime),nuclear:!1};if(this.currentURL==null||this.currentURL=="")return e();const n=S.BlockedGroupsRepository.getBlockedGroupByDomain(this.currentURL);return n==null?e():{groupName:n.groupName,time:Cn.formatDurationInSeconds(n.maxTimeAllowed-n.elapsedTime),nuclear:!1}},getDateString:function(){const e=new Date,t=e.getMonth()+1,n=e.getDate();return e.getFullYear()+"-"+t+"-"+n},setActiveDays:function(e){let t=null;e.length===0?t="none":t=e.join("|"),oe("setActiveDays","Setting active days",e),S.Settings.set({activeDays:t}),S.NuclearOption.updateActiveDays(this.getActiveDays(!0))},getActiveDays:function(e=!1){const t=S.Settings.get("activeDays");if(t==="none")return[];if(typeof t>"u"||t===null||t.length===0)return this.setActiveDays([0,1,2,3,4,5,6]),[0,1,2,3,4,5,6];if(typeof t!="string"||t.indexOf("|")===-1)return[Number(t)];const n=t.split("|"),i=[];for(let r=0;r<n.length;r++)i[r]=Number(n[r]);return e?this.getActiveDaysAsWeekArray(i):i},getActiveDaysAsWeekArray:function(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];t[i]=!0}for(let n=0;n<7;n++)t[n]=t[n]||!1;return t},isActiveDay:function(){const t=new Date().getDay(),n=this.getActiveDays();return typeof n>"u"||n===null||n.length===0?!1:n.inArray(t)},setActiveHours:function(e,t){oe("setActiveHours","Setting active hours",{startTime:e,endTime:t}),S.Settings.set({activeHours:e+"|"+t})},getActiveHours:function(){let e=!1,t=!1;const n=this.getActiveHoursQueue();if(n!==!1){const s=n;(new Date().getTime()>s.timestamp||this.isFirstInstallAllowanceActive())&&(e=s.startTime,t=s.endTime,this.clearActiveHoursQueue(),this.setActiveHours(e,t))}if(e===!1&&t===!1){let s=S.Settings.get("activeHours");(typeof s>"u"||s===null||s==="")&&(this.setActiveHours("00:00","23:59"),s=S.Settings.get("activeHours"));const a=s.split("|");e=a[0],t=a[1]}const i=e.split(":"),r=t.split(":");return{startTime:e,endTime:t,startHour:i[0],startMin:i[1],startHourInt:parseInt(i[0],10),startMinInt:parseInt(i[1],10),endHour:r[0],endMin:r[1],endHourInt:parseInt(r[0],10),endMinInt:parseInt(r[1],10)}},isActiveHour:function(){const e=this.getActiveHours(),t=new Date,n=t.getHours(),i=t.getMinutes();return this.isStartTimeLater(e)===!0?this.isBetween(n,i,e.startHourInt,e.startMinInt,23,59)||this.isBetween(n,i,0,0,e.endHourInt,e.endMinInt):this.isBetween(n,i,e.startHourInt,e.startMinInt,e.endHourInt,e.endMinInt)},isBetween:function(e,t,n,i,r,s){return e>n&&e<r?!0:e===n&&e===r?t>=i&&t<=s:e===n&&t>=i||e===r&&t<=s},isStartTimeLater:function(e){return e.startHourInt===e.endHourInt&&e.startMinInt>=e.endMinInt?!0:e.startHourInt>e.endHourInt},setActiveHoursQueue:function(e,t){const r=new Date().getTime()+S.Date.hoursToMilliseconds(24)+"|"+e+"|"+t;oe("setActiveHoursQueue","Setting active hours queue",r),S.Settings.set({activeHoursQueue:r})},getActiveHoursQueue:function(){const e=S.Settings.get("activeHoursQueue");if(typeof e>"u"||e===null||e==="")return!1;const t=e.split("|");return{timestamp:parseInt(t[0]),startTime:t[1],endTime:t[2]}},clearActiveHoursQueue:function(){oe("clearActiveHoursQueue","Clearing active hours queue"),S.Settings.remove("activeHoursQueue")},isActive:function(){return rt.isActive()===!0?!0:this.isActiveDay()===!0&&this.isActiveHour()===!0},activated:function(){return S.Settings.get("activated",!0)},setActivated:function(e){if(e===!1){if(!confirm(q.Chrome.Translation.get("areYouSure"))||!confirm(q.Chrome.Translation.get("disableExtension1"))||!confirm(q.Chrome.Translation.get("disableExtension2"))||!confirm(q.Chrome.Translation.get("disableExtension3"))||!confirm(q.Chrome.Translation.get("disableExtension4"))||!confirm(q.Chrome.Translation.get("disableExtension5"))||!confirm(q.Chrome.Translation.get("disableExtension6"))||!confirm(q.Chrome.Translation.get("disableExtension7"))||!confirm(q.Chrome.Translation.get("disableExtension8"))||!confirm(q.Chrome.Translation.get("disableFinalWarning")))return!1;alert(q.Chrome.Translation.get("extensionDisabled"))}return S.Settings.set({activated:e}),this.checkURL(),S.Analytics.event(e?"EXTENSION_ACTIVATED":"EXTENSION_DEACTIVATED"),!0},isActivateSwitchShown:function(){return S.Settings.get("isActivateSwitchShown",!0)},setActivateSwitchShown:function(e){S.Settings.set({isActivateSwitchShown:e})},updateResetTimestamp:function(e){const t=e.split(":"),n=parseInt(t[0],10),i=parseInt(t[1],10),s=new Date(new Date().toDateString()+" "+n+":"+i).getTime()+864e5;oe("updateResetTimestamp","Updating reset timestamp to: "+s),S.Settings.set({resetTimestamp:s})},setResetTime:function(e){oe("setResetTime","Setting reset time to: "+e),S.Settings.set({resetTime:e})},getResetTime:function(){let e=S.Settings.get("resetTime");const t=this.getResetTimeQueue(),n="00:00";if(t!==!1){const r=new Date().getTime(),s=t;(r>s.timestamp||this.isFirstInstallAllowanceActive())&&(e=s.resetTime,this.clearResetTimeQueue(),this.setResetTime(e),this.updateResetTimestamp(e))}return(typeof e>"u"||e===null||e==="")&&(this.setResetTime(n),e=n,this.updateResetTimestamp(e)),e},setResetTimeQueue:function(e){const i=new Date().getTime()+S.Date.hoursToMilliseconds(24)+"|"+e;oe("setResetTimeQueue","Setting reset time queue: "+i),S.Settings.set({resetTimeQueue:i})},getResetTimeQueue:function(){const e=S.Settings.get("resetTimeQueue");if(Le.isEmpty(e))return!1;const t=e.split("|");return{timestamp:t[0],resetTime:t[1]}},clearResetTimeQueue:function(){oe("clearResetTimeQueue","Clearing reset time queue"),S.Settings.remove("resetTimeQueue")},isFirstInstall:function(){return typeof S.Settings.get("firstInstallDate")!="string"},async getFirstSensorTowerInstallDate(){let e=await S.Storage.get("firstSensorTowerInstallDate");return typeof e!="number"&&(e=Date.now(),await S.Storage.set({firstSensorTowerInstallDate:e})),e},getOptionsPage:function(){return Rc.runtime.getURL("options.html")},isUpdatePopupDisabled:function(){const e=S.Settings.get("disableUpdatePopup");return e===!0||e==="true"},setFirstInstallAllowance:function(){const e=new Date;S.Settings.set({firstInstallDate:e.toDateString()}),e.setMinutes(e.getMinutes()+this.firstInstallAllowance),oe("setFirstInstallAllowance","Setting first install allowance to: "+e.getTime()),S.Settings.set({firstInstallAllowanceExpiration:e.getTime()})},isFirstInstallAllowanceActive:function(){const e=new Date;return S.Settings.get("firstInstallAllowanceExpiration")>e.getTime()},localizeHTML:function(e){oe("localizeHTML","Localizing HTML");const t=e.getElementsByTagName("*");for(let n=0;n<t.length;n++)t[n].dataset&&t[n].dataset.i18n&&(t[n].innerHTML=S.Chrome.Translation.get(t[n].dataset.i18n))}};Array.prototype.inArray=function(e){for(const t in this)if(this.hasOwnProperty(t)&&this[t]==e)return!0;return!1};const va="whitelist",dt="whitelistNew";let ht,xt=[];const Nf={initAPI(e){return ht=e,ht.mixin("WhitelistRepository",{init:this.init.bind(this),add:this.add.bind(this),getAll:this.getAll.bind(this),isExists:this.isExists.bind(this),delete:this.delete.bind(this),migrate:this.migrate.bind(this),importWhitelist:this.importWhitelist.bind(this)})},async init(){if(await q.Settings.get("disableSync")===!0){const n=!!(await ht.Chrome.Storage.getSync(dt))[dt];await q.Storage.setBucket(dt,"LOCAL",!n)}else{const n=!!(await ht.Chrome.Storage.getLocal(dt))[dt];await q.Storage.setBucket(dt,"SYNC",!n)}this.getWhitelist(),this.addListeners()},getWhitelist(){const e=ht.Settings.get(dt);xt=e??[]},async add(e){let t=!1;for(let n=0;n<e.length;n++){const i=e[n];i&&xt.find(r=>r==i)==null&&(t=!0,xt.push(i),await this.saveChanges())}return t},getAll(){return xt},async delete(e){const t=xt.findIndex(n=>n==e);t>-1&&(xt.splice(t,1),await this.saveChanges())},isExists(e){return e==null?!1:(e=e.toLowerCase(),xt.find(t=>Pn(t,e))!=null)},async migrate(){if(this.needMigrate()){const e=ht.Settings.get(va);if(e!=null){const t=Object.keys(e);await this.add(t)}}},needMigrate(){return ht.Settings.get(dt)==null},async importWhitelist(){xt=[];const e=ht.Settings.get(va);if(e!=null){const t=Object.keys(e);await this.add(t)}},async saveChanges(){await ht.Storage.set({[dt]:xt})},addListeners(){q.PubSub.listen("Settings.data.refreshed",async(e,t)=>{(t.changes.whitelistNew||t.changes.disableSync)&&(t.changes.disableSync&&(t.disableSync===!1?await ht.Storage.setBucket(dt,"SYNC"):await ht.Storage.setBucket(dt,"LOCAL")),this.getWhitelist())})}},ba=[q,Ea,cu,Aa,lu,uu,Ca,Le,hu,Ct,gu,$e,fu,mu,_p,Of,Po,kn,rt,Mf,Pf,kf,Nf,Rf];q.mixin({mixin:q.mixin.bind(q),PubSub:Po});for(let e=0;e<ba.length;e++){const t=ba[e];typeof t=="object"&&t!==null&&typeof t.initAPI=="function"&&t.initAPI(q)}Ea.initAPI(q);Aa.initAPI(q);export{q as A,Ca as D,mr as H,Lf as M,Po as P,Oa as S,Cn as T,Le as U,jf as W,zf as a,Mo as b,ns as c,uu as d,Wf as e,Ff as f,Hf as g,Mn as h,Zf as i,Jr as j,cn as k};
//# sourceMappingURL=CoreAPI.js.map
