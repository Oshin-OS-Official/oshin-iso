{"version":3,"file":"ActivityMonitorOverlayView.js","sources":["../src/components/ActivityMonitor/views/overlay/overlay.tpl?raw","../node_modules/.pnpm/is-potential-custom-element-name@1.0.1/node_modules/is-potential-custom-element-name/index.js","../node_modules/.pnpm/@webext-core+isolated-element@1.1.2/node_modules/@webext-core/isolated-element/lib/index.js","../src/components/ActivityMonitor/views/overlay/ActivityMonitorOverlayView.js"],"sourcesContent":["export default \"<div id=\\\"StayFocusd-still-there\\\" class=\\\"flex flex-col items-center justify-center prose\\\">\\n    <div class=\\\"md:w-[70%] flex flex-col items-center text-center\\\">\\n        <img src=\\\"{{extensionURL}}common/img/logo.svg\\\" title=\\\"StayFocusd\\\" alt=\\\"StayFocusd\\\" class=\\\"w-64\\\" />\\n\\n        <h1 id=\\\"StayFocusd-overlayHeader\\\">{{activityMonitorOverlayHeader}}</h1>\\n        <p id=\\\"StayFocusd-overlayBody\\\">{{activityMonitorOverlayBody}}</p>\\n        <p class=\\\"label justify-start gap-3\\\">\\n            <b>{{activityMonitorOverlayLink1}} <a href=\\\"#\\\" id=\\\"StayFocusd-unblock-link\\\" title=\\\"{{activityMonitorOverlayLink4}}\\\">{{activityMonitorOverlayLink2}}</a> {{activityMonitorOverlayLink3}}</b>\\n        </p>\\n    </div>\\n</div>\\n\"","// Generated using `npm run build`. Do not edit.\n\nvar regex = /^[a-z](?:[\\.0-9_a-z\\xB7\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u037D\\u037F-\\u1FFF\\u200C\\u200D\\u203F\\u2040\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]|[\\uD800-\\uDB7F][\\uDC00-\\uDFFF])*-(?:[\\x2D\\.0-9_a-z\\xB7\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u037D\\u037F-\\u1FFF\\u200C\\u200D\\u203F\\u2040\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]|[\\uD800-\\uDB7F][\\uDC00-\\uDFFF])*$/;\n\nvar isPotentialCustomElementName = function(string) {\n\treturn regex.test(string);\n};\n\nmodule.exports = isPotentialCustomElementName;\n","var __async = (__this, __arguments, generator) => {\n  return new Promise((resolve, reject) => {\n    var fulfilled = (value) => {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var rejected = (value) => {\n      try {\n        step(generator.throw(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);\n    step((generator = generator.apply(__this, __arguments)).next());\n  });\n};\n\n// src/index.ts\nimport isPotentialCustomElementName from \"is-potential-custom-element-name\";\nfunction createIsolatedElement(options) {\n  return __async(this, null, function* () {\n    const { name, mode = \"closed\", css, isolateEvents = false } = options;\n    if (!isPotentialCustomElementName(name)) {\n      throw Error(\n        `\"${name}\" is not a valid custom element name. It must be two words and kebab-case, with a few exceptions. See spec for more details: https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name`\n      );\n    }\n    const parentElement = document.createElement(name);\n    const shadow = parentElement.attachShadow({ mode });\n    const isolatedElement = document.createElement(\"html\");\n    const body = document.createElement(\"body\");\n    const head = document.createElement(\"head\");\n    if (css) {\n      const style = document.createElement(\"style\");\n      if (\"url\" in css) {\n        style.textContent = yield fetch(css.url).then((res) => res.text());\n      } else {\n        style.textContent = css.textContent;\n      }\n      head.appendChild(style);\n    }\n    isolatedElement.appendChild(head);\n    isolatedElement.appendChild(body);\n    shadow.appendChild(isolatedElement);\n    if (isolateEvents) {\n      const eventTypes = Array.isArray(isolateEvents) ? isolateEvents : [\"keydown\", \"keyup\", \"keypress\"];\n      eventTypes.forEach((eventType) => {\n        body.addEventListener(eventType, (e) => e.stopPropagation());\n      });\n    }\n    return {\n      parentElement,\n      shadow,\n      isolatedElement: body\n    };\n  });\n}\nexport {\n  createIsolatedElement\n};\n","import Logger from '~/core/Logger'\nimport Brightline from 'brightline.js'\nimport API from '~/core/CoreAPI'\nimport overlayTpl from './overlay.tpl?raw'\nimport $original from 'jquery'\nimport { createIsolatedElement } from '@webext-core/isolated-element'\nimport Browser from 'webextension-polyfill'\nlet $ = $original\n\n/**\n * Alias for Logger.log(). Prepends class name to funcName.\n *\n * @param originator The name of the instance to prepend to the log message\n * @param funcName The name of the function generating the log message\n * @param message The message to log\n * @param payload Data object\n * @param level Log level (ERROR, WARN, INFO, DEBUG)\n */\nvar log = function (originator, funcName, message, payload, level) {\n  Logger.log(originator + '.' + funcName, message, payload, level)\n}\n\nexport default class ActivityMonitorOverlayView {\n  model = null\n  isOverlayActive = false\n  isOverlayHTMLInjected = false\n  customElement = null\n\n  /**\n   * Renders view template\n   */\n  render() {\n    log(this.originator, 'render', 'Rendering view', null, 'DEBUG')\n\n    var template = new Brightline(overlayTpl)\n\n    template.set('extensionURL', Browser.runtime.getURL('/'))\n    template.set(\n      'activityMonitorOverlayHeader',\n      API.Chrome.Translation.get('activityMonitorOverlayHeader'),\n    )\n    template.set(\n      'activityMonitorOverlayBody',\n      API.Chrome.Translation.get('activityMonitorOverlayBody'),\n    )\n\n    for (var i = 1; i <= 4; i++) {\n      template.set(\n        'activityMonitorOverlayLink' + i,\n        API.Chrome.Translation.get('activityMonitorOverlayLink' + i),\n      )\n    }\n\n    return template.render()\n  }\n\n  /**\n   * Injects rendered view into page\n   */\n  async inject(onComplete) {\n    log(this.originator, 'inject', 'Injecting ActivityMonitor overlay')\n    // :root doesn't work in shadow dom, so fetch the css and replace :root with html\n    let textContent = await fetch(Browser.runtime.getURL('style.css')).then(\n      (res) => res.text(),\n    )\n    textContent = textContent.replace(/:root/g, 'html')\n\n    this.customElement = await createIsolatedElement({\n      name: 'stayfocusd-still-there',\n      css: { textContent },\n      mode: 'open',\n    })\n    document.body.appendChild(this.customElement.parentElement)\n    $(this.customElement.isolatedElement)\n      .addClass(\n        'fixed flex flex-col items-center justify-center top-0 bottom-0 right-0 left-0 bg-neutral hidden',\n      )\n      .css('z-index', '999999999')\n      .append(this.render())\n\n    this.isOverlayHTMLInjected = true\n\n    this.bindUIHandlers()\n\n    if (typeof onComplete === 'function') {\n      onComplete()\n    }\n  }\n\n  /**\n   * Binds handlers to UI\n   */\n  bindUIHandlers() {\n    log(this.originator, 'bindUIHandlers', 'Binding UI handlers', null, 'TRACE')\n\n    var self = this\n\n    $(this.customElement.isolatedElement).on(\n      'click',\n      '#StayFocusd-unblock-link',\n      function () {\n        if (self.isOverlayActive === true) {\n          self.hide()\n        }\n      },\n    )\n\n    /* If key is pressed while screen is blocked, unblock screen */\n    $('body').keydown(function () {\n      if (self.isOverlayActive === true) {\n        self.hide()\n      }\n    })\n  }\n\n  /**\n   * Shows ActivityMonitor overlay\n   */\n  show() {\n    var self = this\n\n    /* If the Overlay HTML isn't injected yet, inject it then re-call\n     * this function once injection is complete */\n    if (!this.isOverlayHTMLInjected) {\n      this.inject(function () {\n        self.show()\n      })\n\n      return null\n    }\n\n    log(this.originator, 'show', 'Showing ActivityMonitor overlay')\n\n    /* Hide embedded objects like Flash video and ads */\n    $('embed').addClass('StayFocusd-hidden')\n    $('object').addClass('StayFocusd-hidden')\n    $('applet').addClass('StayFocusd-hidden')\n\n    /* Position and show overlay */\n    $(this.customElement.isolatedElement).removeClass('hidden')\n\n    this.isOverlayActive = true\n\n    API.PubSub.publish('ActivityMonitor.overlay.shown')\n  }\n\n  /**\n   * Hides ActivityMonitor overlay\n   */\n  hide() {\n    if (this.isOverlayActive) {\n      log(this.originator, 'hide', 'Hiding ActivityMonitor overlay')\n\n      $(this.customElement.isolatedElement).addClass('hidden')\n\n      /* Show embedded objects like Flash video and ads */\n      $('embed').removeClass('StayFocusd-hidden')\n      $('object').removeClass('StayFocusd-hidden')\n      $('applet').removeClass('StayFocusd-hidden')\n\n      this.isOverlayActive = false\n\n      API.PubSub.publish('ActivityMonitor.overlay.hidden')\n    }\n  }\n\n  /**\n   * Binds functions to detect activity in page\n   */\n  bindActivityDetectors() {\n    log(\n      this.originator,\n      'bindActivityDetectors',\n      'Binding activity detectors',\n      null,\n      'DEBUG',\n    )\n\n    /* Bind timer reset to main page body */\n    this.bindTimerReset('body')\n\n    var self = this\n\n    /**\n     * Bind timer reset to the bodies of any pages in iframes.\n     * This is a fix for sites like Gmail, where the mouse events aren't\n     * tracked by the main page, because the whole thing is covered with\n     * iframes.\n     */\n    $('iframe').each(function () {\n      var iframeSrc = $(this).attr('src')\n\n      if (typeof iframeSrc !== 'undefined') {\n        var iframeBase = API.Domain.extractFullDomain(iframeSrc)\n        var pageBase = API.Domain.extractFullDomain(top.location.href)\n\n        /* Only bind to iframes from the same domain (i.e. not ad frames) to avoid\n         * cross-domain access violations */\n        if (iframeBase === pageBase) {\n          self.bindTimerReset($(this).contents().find('body'))\n        }\n      }\n    })\n  }\n\n  /**\n   * Binds resetTimer method to mouse and keypress events\n   * on an element\n   *\n   * @param element element The element to bind, i.e. $('body')\n   */\n  bindTimerReset(element) {\n    log(\n      this.originator,\n      'bindTimerReset',\n      'Binding timer reset',\n      element,\n      'TRACE',\n    )\n\n    var activityDetectedEvent = 'ActivityMonitor.activity.detected'\n\n    if (element) {\n      $(element).mousedown(function () {\n        API.PubSub.publish(activityDetectedEvent)\n      })\n\n      $(element).mousemove(function () {\n        API.PubSub.publish(activityDetectedEvent)\n      })\n\n      $(element).keypress(function () {\n        API.PubSub.publish(activityDetectedEvent)\n      })\n    }\n  }\n\n  /**\n   * Pass in instance of jQuery bound to page in which view is being rendered\n   *\n   * @param jQuery\n   */\n  setJQuery(jQuery) {\n    $ = jQuery || $original\n    log(this.originator, 'setJQuery', 'Setting jQuery')\n  }\n}\n"],"names":["overlayTpl","regex","isPotentialCustomElementName","string","isPotentialCustomElementName_1","__async","__this","__arguments","generator","resolve","reject","fulfilled","value","step","e","rejected","x","createIsolatedElement","options","name","mode","css","isolateEvents","parentElement","shadow","isolatedElement","body","head","style","res","eventType","$","$original","log","originator","funcName","message","payload","level","Logger","ActivityMonitorOverlayView","__publicField","template","Brightline","Browser","API","i","onComplete","textContent","self","iframeSrc","iframeBase","pageBase","element","activityDetectedEvent","jQuery"],"mappings":"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","x_google_ignoreList":[1,2]}