var Km=Object.defineProperty;var Ym=(Je,Qe,Qt)=>Qe in Je?Km(Je,Qe,{enumerable:!0,configurable:!0,writable:!0,value:Qt}):Je[Qe]=Qt;var _n=(Je,Qe,Qt)=>(Ym(Je,typeof Qe!="symbol"?Qe+"":Qe,Qt),Qt);(function(){var fn;"use strict";var Je=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Qt(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var Rs={exports:{}};function cc(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Pi={exports:{}};const lc=Qt(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Ls;function uc(){return Ls||(Ls=1,function(e,t){(function(n,r){e.exports=r()})(Je,function(){var n=n||function(r,i){var s;if(typeof window<"u"&&window.crypto&&(s=window.crypto),typeof self<"u"&&self.crypto&&(s=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(s=globalThis.crypto),!s&&typeof window<"u"&&window.msCrypto&&(s=window.msCrypto),!s&&typeof Je<"u"&&Je.crypto&&(s=Je.crypto),!s&&typeof cc=="function")try{s=lc}catch{}var a=function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},l=Object.create||function(){function _(){}return function(p){var v;return _.prototype=p,v=new _,_.prototype=null,v}}(),c={},o=c.lib={},u=o.Base=function(){return{extend:function(_){var p=l(this);return _&&p.mixIn(_),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var _=this.extend();return _.init.apply(_,arguments),_},init:function(){},mixIn:function(_){for(var p in _)_.hasOwnProperty(p)&&(this[p]=_[p]);_.hasOwnProperty("toString")&&(this.toString=_.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),h=o.WordArray=u.extend({init:function(_,p){_=this.words=_||[],p!=i?this.sigBytes=p:this.sigBytes=_.length*4},toString:function(_){return(_||f).stringify(this)},concat:function(_){var p=this.words,v=_.words,C=this.sigBytes,S=_.sigBytes;if(this.clamp(),C%4)for(var P=0;P<S;P++){var b=v[P>>>2]>>>24-P%4*8&255;p[C+P>>>2]|=b<<24-(C+P)%4*8}else for(var x=0;x<S;x+=4)p[C+x>>>2]=v[x>>>2];return this.sigBytes+=S,this},clamp:function(){var _=this.words,p=this.sigBytes;_[p>>>2]&=4294967295<<32-p%4*8,_.length=r.ceil(p/4)},clone:function(){var _=u.clone.call(this);return _.words=this.words.slice(0),_},random:function(_){for(var p=[],v=0;v<_;v+=4)p.push(a());return new h.init(p,_)}}),d=c.enc={},f=d.Hex={stringify:function(_){for(var p=_.words,v=_.sigBytes,C=[],S=0;S<v;S++){var P=p[S>>>2]>>>24-S%4*8&255;C.push((P>>>4).toString(16)),C.push((P&15).toString(16))}return C.join("")},parse:function(_){for(var p=_.length,v=[],C=0;C<p;C+=2)v[C>>>3]|=parseInt(_.substr(C,2),16)<<24-C%8*4;return new h.init(v,p/2)}},g=d.Latin1={stringify:function(_){for(var p=_.words,v=_.sigBytes,C=[],S=0;S<v;S++){var P=p[S>>>2]>>>24-S%4*8&255;C.push(String.fromCharCode(P))}return C.join("")},parse:function(_){for(var p=_.length,v=[],C=0;C<p;C++)v[C>>>2]|=(_.charCodeAt(C)&255)<<24-C%4*8;return new h.init(v,p)}},m=d.Utf8={stringify:function(_){try{return decodeURIComponent(escape(g.stringify(_)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(_){return g.parse(unescape(encodeURIComponent(_)))}},A=o.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(_){typeof _=="string"&&(_=m.parse(_)),this._data.concat(_),this._nDataBytes+=_.sigBytes},_process:function(_){var p,v=this._data,C=v.words,S=v.sigBytes,P=this.blockSize,b=P*4,x=S/b;_?x=r.ceil(x):x=r.max((x|0)-this._minBufferSize,0);var I=x*P,R=r.min(I*4,S);if(I){for(var H=0;H<I;H+=P)this._doProcessBlock(C,H);p=C.splice(0,I),v.sigBytes-=R}return new h.init(p,R)},clone:function(){var _=u.clone.call(this);return _._data=this._data.clone(),_},_minBufferSize:0});o.Hasher=A.extend({cfg:u.extend(),init:function(_){this.cfg=this.cfg.extend(_),this.reset()},reset:function(){A.reset.call(this),this._doReset()},update:function(_){return this._append(_),this._process(),this},finalize:function(_){_&&this._append(_);var p=this._doFinalize();return p},blockSize:16,_createHelper:function(_){return function(p,v){return new _.init(v).finalize(p)}},_createHmacHelper:function(_){return function(p,v){return new E.HMAC.init(_,v).finalize(p)}}});var E=c.algo={};return c}(Math);return n})}(Pi)),Pi.exports}(function(e,t){(function(n,r){e.exports=r(uc())})(Je,function(n){return function(r){var i=n,s=i.lib,a=s.WordArray,l=s.Hasher,c=i.algo,o=[];(function(){for(var m=0;m<64;m++)o[m]=r.abs(r.sin(m+1))*4294967296|0})();var u=c.MD5=l.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(m,A){for(var E=0;E<16;E++){var _=A+E,p=m[_];m[_]=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360}var v=this._hash.words,C=m[A+0],S=m[A+1],P=m[A+2],b=m[A+3],x=m[A+4],I=m[A+5],R=m[A+6],H=m[A+7],T=m[A+8],D=m[A+9],y=m[A+10],k=m[A+11],N=m[A+12],$=m[A+13],j=m[A+14],Z=m[A+15],M=v[0],B=v[1],F=v[2],W=v[3];M=h(M,B,F,W,C,7,o[0]),W=h(W,M,B,F,S,12,o[1]),F=h(F,W,M,B,P,17,o[2]),B=h(B,F,W,M,b,22,o[3]),M=h(M,B,F,W,x,7,o[4]),W=h(W,M,B,F,I,12,o[5]),F=h(F,W,M,B,R,17,o[6]),B=h(B,F,W,M,H,22,o[7]),M=h(M,B,F,W,T,7,o[8]),W=h(W,M,B,F,D,12,o[9]),F=h(F,W,M,B,y,17,o[10]),B=h(B,F,W,M,k,22,o[11]),M=h(M,B,F,W,N,7,o[12]),W=h(W,M,B,F,$,12,o[13]),F=h(F,W,M,B,j,17,o[14]),B=h(B,F,W,M,Z,22,o[15]),M=d(M,B,F,W,S,5,o[16]),W=d(W,M,B,F,R,9,o[17]),F=d(F,W,M,B,k,14,o[18]),B=d(B,F,W,M,C,20,o[19]),M=d(M,B,F,W,I,5,o[20]),W=d(W,M,B,F,y,9,o[21]),F=d(F,W,M,B,Z,14,o[22]),B=d(B,F,W,M,x,20,o[23]),M=d(M,B,F,W,D,5,o[24]),W=d(W,M,B,F,j,9,o[25]),F=d(F,W,M,B,b,14,o[26]),B=d(B,F,W,M,T,20,o[27]),M=d(M,B,F,W,$,5,o[28]),W=d(W,M,B,F,P,9,o[29]),F=d(F,W,M,B,H,14,o[30]),B=d(B,F,W,M,N,20,o[31]),M=f(M,B,F,W,I,4,o[32]),W=f(W,M,B,F,T,11,o[33]),F=f(F,W,M,B,k,16,o[34]),B=f(B,F,W,M,j,23,o[35]),M=f(M,B,F,W,S,4,o[36]),W=f(W,M,B,F,x,11,o[37]),F=f(F,W,M,B,H,16,o[38]),B=f(B,F,W,M,y,23,o[39]),M=f(M,B,F,W,$,4,o[40]),W=f(W,M,B,F,C,11,o[41]),F=f(F,W,M,B,b,16,o[42]),B=f(B,F,W,M,R,23,o[43]),M=f(M,B,F,W,D,4,o[44]),W=f(W,M,B,F,N,11,o[45]),F=f(F,W,M,B,Z,16,o[46]),B=f(B,F,W,M,P,23,o[47]),M=g(M,B,F,W,C,6,o[48]),W=g(W,M,B,F,H,10,o[49]),F=g(F,W,M,B,j,15,o[50]),B=g(B,F,W,M,I,21,o[51]),M=g(M,B,F,W,N,6,o[52]),W=g(W,M,B,F,b,10,o[53]),F=g(F,W,M,B,y,15,o[54]),B=g(B,F,W,M,S,21,o[55]),M=g(M,B,F,W,T,6,o[56]),W=g(W,M,B,F,Z,10,o[57]),F=g(F,W,M,B,R,15,o[58]),B=g(B,F,W,M,$,21,o[59]),M=g(M,B,F,W,x,6,o[60]),W=g(W,M,B,F,k,10,o[61]),F=g(F,W,M,B,P,15,o[62]),B=g(B,F,W,M,D,21,o[63]),v[0]=v[0]+M|0,v[1]=v[1]+B|0,v[2]=v[2]+F|0,v[3]=v[3]+W|0},_doFinalize:function(){var m=this._data,A=m.words,E=this._nDataBytes*8,_=m.sigBytes*8;A[_>>>5]|=128<<24-_%32;var p=r.floor(E/4294967296),v=E;A[(_+64>>>9<<4)+15]=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360,A[(_+64>>>9<<4)+14]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,m.sigBytes=(A.length+1)*4,this._process();for(var C=this._hash,S=C.words,P=0;P<4;P++){var b=S[P];S[P]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360}return C},clone:function(){var m=l.clone.call(this);return m._hash=this._hash.clone(),m}});function h(m,A,E,_,p,v,C){var S=m+(A&E|~A&_)+p+C;return(S<<v|S>>>32-v)+A}function d(m,A,E,_,p,v,C){var S=m+(A&_|E&~_)+p+C;return(S<<v|S>>>32-v)+A}function f(m,A,E,_,p,v,C){var S=m+(A^E^_)+p+C;return(S<<v|S>>>32-v)+A}function g(m,A,E,_,p,v,C){var S=m+(E^(A|~_))+p+C;return(S<<v|S>>>32-v)+A}i.MD5=l._createHelper(u),i.HmacMD5=l._createHmacHelper(u)}(Math),n.MD5})})(Rs);var dc=Rs.exports;const hc=Qe(dc);function Us(){let e=/^.+?(-|_)(.+?)($|-|_)/,t=[...typeof navigator<"u"?navigator.languages:[],Intl.DateTimeFormat().resolvedOptions().locale].map(n=>{var r;return(r=n.match(e))==null?void 0:r[2]}).find(n=>!!n);return t==null?void 0:t.toUpperCase()}async function gc(e){var t;let n=Us()??"",r=e.promptConfig;if(r.countryList&&!r.countryList.includes(n)||!await e.enabled())return;let i=localStorage.getItem(r.storageKey),s=i?JSON.parse(i):{conversations:{}},a=()=>{let c=window.location.href;if(!c.includes(e.conversationUrl))return;let o=fc(document.body,c).filter(u=>{var h;let d=u.conversation_id;return!((h=s.conversations[d])!=null&&h.includes(u.text))&&!r.forbiddenWords.some(f=>u.text.includes(" "+f))});pc(e,o,n),o.forEach(u=>{let h=u.conversation_id;s.conversations[h]||(s.conversations[h]=[]),s.conversations[h].push(u.text)}),localStorage.setItem(r.storageKey,JSON.stringify(s))};setTimeout(a,r.loadDelay??3*1e3);let l=setInterval(a,r.pollInterval??10*1e3);(t=r.signal)==null||t.addEventListener("abort",()=>clearInterval(l))}function fc(e,t){let n='div[data-message-author-role="user"]',r=e.querySelectorAll(n),i=hc(t).toString(),s=t.split("/c/"),a=`a[href="/c/${s.length>1?s[1]:""}"]`,l=e.querySelector(a);if(!r)return[];let c=Math.round(Date.now()/1e3),o=Array.from(r).map((u,h)=>{var d,f;return{timestamp:c,service:"chatgpt.com",type:"web",conversation_id:i,conversation_summary:((d=l==null?void 0:l.textContent)==null?void 0:d.trim())||"",conversation_order:h+1,text:((f=u.textContent)==null?void 0:f.trim())||""}});return o=o.filter(u=>u.text.length>0),o}async function pc(e,t,n){if(t.length===0||!await e.enabled())return;let r={appId:e.appId,countryCode:n,prompts:t};await e.api.uploadPrompts(r)}async function mc(e){if(!await e.enabled())return;let t=window.location.href;if(!(t==e.chatGptUrl||t.includes(e.conversationUrl)))return;let n=e.statusConfig,r=localStorage.getItem(n.storageKey),i=await yc(document.body);i!=r&&(await e.api.uploadSubscriptionStatus({appId:e.appId,installId:e.installId,service:"chatgpt.com",countryCode:Us()??"",status:i}),localStorage.setItem(n.storageKey,i))}async function yc(e){try{let t=await vc(e,"#__NEXT_DATA__",10,1e3);return JSON.parse((t==null?void 0:t.textContent)??"{}").props.pageProps.statsig.user.custom.is_paid?"premium":"free"}catch{return"unknown"}}function vc(e,t,n,r){return new Promise((i,s)=>{let a=0,l=r;function c(){a++;let o=e.querySelector(t);o?i(o):a<n?(setTimeout(c,2*l),l*=2):s("Element not found within max attempts")}c()})}async function bc(e){let t=gc(e),n=mc(e);await Promise.all([t,n])}const It={initAPI(e){return e.mixin("Object",this)},merge:function(e,t,n=!1){return n?Object.assign(!0,e,t):Object.assign(e,t)},lookup:function(e,t){const n=e.split("."),r=n.pop(),i=n.length;let s=1,a=n[0];for(;(t=t[a])&&s<i;)a=n[s],s+=1;if(t)return t[r]},isObjLiteral:function(e){return typeof e=="object"&&e!==null&&typeof e.length>"u"},isArray:function(e){return typeof e=="object"&&e!==null&&typeof e.length<"u"},isJSON:function(e){try{JSON.parse(e)}catch{return!1}return!0},sort:function(e){const t=[],n={};for(const r in e)e.hasOwnProperty(r)&&t.push(r);t.sort();for(let r=0;r<t.length;r++){const i=t[r];n[i]=e[i]}return n}};var Bs={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(self,()=>(()=>{var n={11:a=>{class l{constructor(o,u,h,d=new Date){this.type=h,this.message=o,this.metadata=u,this.timestamp=d}toJSON(){return{type:this.type,name:this.message,timestamp:this.timestamp,metaData:this.metadata}}}a.exports=l},953:(a,l,c)=>{const o=c(510),u=c(750),h=c(11),d=c(743),f=c(964),g=c(566),m=c(58),A=c(611),E=c(929),_=c(795),p=c(698),v=c(987),C=c(100),S=c(377),{add:P,clear:b,merge:x}=c(908),I=()=>{};class R{constructor(y,k=o.schema,N=[],$){this._notifier=$,this._config={},this._schema=k,this._delivery={sendSession:I,sendEvent:I},this._logger={debug:I,info:I,warn:I,error:I},this._plugins={},this._breadcrumbs=[],this._session=null,this._metadata={},this._featuresIndex={},this._features=[],this._context=void 0,this._user={},this._cbs={e:[],s:[],sp:[],b:[]},this.Client=R,this.Event=u,this.Breadcrumb=h,this.Session=d,this._config=this._configure(y,N),f(N.concat(this._config.plugins),M=>{M&&this._loadPlugin(M)}),this._depth=1;const j=this,Z=this.notify;this.notify=function(){return Z.apply(j,arguments)}}addMetadata(y,k,N){return v.add(this._metadata,y,k,N)}getMetadata(y,k){return v.get(this._metadata,y,k)}clearMetadata(y,k){return v.clear(this._metadata,y,k)}addFeatureFlag(y,k=null){P(this._features,this._featuresIndex,y,k)}addFeatureFlags(y){x(this._features,y,this._featuresIndex)}clearFeatureFlag(y){b(this._features,this._featuresIndex,y)}clearFeatureFlags(){this._features=[],this._featuresIndex={}}getContext(){return this._context}setContext(y){this._context=y}_configure(y,k){const N=A(k,(Z,M)=>M&&M.configSchema?_({},Z,M.configSchema):Z,this._schema),{errors:$,config:j}=A(E(N),(Z,M)=>{const B=N[M].defaultValue(y[M]);return y[M]!==void 0?N[M].validate(y[M])?N[M].allowPartialObject?Z.config[M]=_(B,y[M]):Z.config[M]=y[M]:(Z.errors[M]=N[M].message,Z.config[M]=B):Z.config[M]=B,Z},{errors:{},config:{}});if(N.apiKey){if(!j.apiKey)throw new Error("No Bugsnag API Key set");/^[0-9a-f]{32}$/i.test(j.apiKey)||($.apiKey="should be a string of 32 hexadecimal characters")}return this._metadata=_({},j.metadata),x(this._features,j.featureFlags,this._featuresIndex),this._user=_({},j.user),this._context=j.context,j.logger&&(this._logger=j.logger),j.onError&&(this._cbs.e=this._cbs.e.concat(j.onError)),j.onBreadcrumb&&(this._cbs.b=this._cbs.b.concat(j.onBreadcrumb)),j.onSession&&(this._cbs.s=this._cbs.s.concat(j.onSession)),E($).length&&this._logger.warn(H($,y)),j}getUser(){return this._user}setUser(y,k,N){this._user={id:y,email:k,name:N}}_loadPlugin(y){const k=y.load(this);return y.name&&(this._plugins[`~${y.name}~`]=k),this}getPlugin(y){return this._plugins[`~${y}~`]}_setDelivery(y){this._delivery=y(this)}startSession(){const y=new d;return y.app.releaseStage=this._config.releaseStage,y.app.version=this._config.appVersion,y.app.type=this._config.appType,y._user=_({},this._user),C(this._cbs.s,y,"onSession",this._logger)?(this._logger.debug("Session not started due to onSession callback"),this):this._sessionDelegate.startSession(this,y)}addOnError(y,k=!1){this._cbs.e[k?"unshift":"push"](y)}removeOnError(y){this._cbs.e=m(this._cbs.e,k=>k!==y)}_addOnSessionPayload(y){this._cbs.sp.push(y)}addOnSession(y){this._cbs.s.push(y)}removeOnSession(y){this._cbs.s=m(this._cbs.s,k=>k!==y)}addOnBreadcrumb(y,k=!1){this._cbs.b[k?"unshift":"push"](y)}removeOnBreadcrumb(y){this._cbs.b=m(this._cbs.b,k=>k!==y)}pauseSession(){return this._sessionDelegate.pauseSession(this)}resumeSession(){return this._sessionDelegate.resumeSession(this)}leaveBreadcrumb(y,k,N){if(y=typeof y=="string"?y:"",N=typeof N=="string"&&g(S,N)?N:"manual",k=typeof k=="object"&&k!==null?k:{},!y)return;const $=new h(y,k,N);if(C(this._cbs.b,$,"onBreadcrumb",this._logger)){this._logger.debug("Breadcrumb not attached due to onBreadcrumb callback");return}this._breadcrumbs.push($),this._breadcrumbs.length>this._config.maxBreadcrumbs&&(this._breadcrumbs=this._breadcrumbs.slice(this._breadcrumbs.length-this._config.maxBreadcrumbs))}_isBreadcrumbTypeEnabled(y){const k=this._config.enabledBreadcrumbTypes;return k===null||g(k,y)}notify(y,k,N=I){const $=u.create(y,!0,void 0,"notify()",this._depth+1,this._logger);this._notify($,k,N)}_notify(y,k,N=I){if(y.app=_({},y.app,{releaseStage:this._config.releaseStage,version:this._config.appVersion,type:this._config.appType}),y.context=y.context||this._context,y._metadata=_({},y._metadata,this._metadata),y._user=_({},y._user,this._user),y.breadcrumbs=this._breadcrumbs.slice(),x(y._features,this._features,y._featuresIndex),this._config.enabledReleaseStages!==null&&!g(this._config.enabledReleaseStages,this._config.releaseStage))return this._logger.warn("Event not sent due to releaseStage/enabledReleaseStages configuration"),N(null,y);const $=y.severity,j=M=>{this._logger.error("Error occurred in onError callback, continuing anyway…"),this._logger.error(M)},Z=[].concat(this._cbs.e).concat(k);p(Z,y,j,(M,B)=>{if(M&&j(M),!B)return this._logger.debug("Event not sent due to onError callback"),N(null,y);this._isBreadcrumbTypeEnabled("error")&&R.prototype.leaveBreadcrumb.call(this,y.errors[0].errorClass,{errorClass:y.errors[0].errorClass,errorMessage:y.errors[0].errorMessage,severity:y.severity},"error"),$!==y.severity&&(y._handledState.severityReason={type:"userCallbackSetSeverity"}),y.unhandled!==y._handledState.unhandled&&(y._handledState.severityReason.unhandledOverridden=!0,y._handledState.unhandled=y.unhandled),this._session&&(this._session._track(y),y._session=this._session),this._delivery.sendEvent({apiKey:y.apiKey||this._config.apiKey,notifier:this._notifier,events:[y]},F=>N(F,y))})}}const H=(D,y)=>new Error(`Invalid configuration
${f(E(D),N=>`  - ${N} ${D[N]}, got ${T(y[N])}`).join(`

`)}`),T=D=>{switch(typeof D){case"string":case"number":case"object":return JSON.stringify(D);default:return String(D)}};a.exports=R},510:(a,l,c)=>{const o=c(58),u=c(611),h=c(929),d=c(37),f=c(566),g=c(849),m=c(937),A=c(90),E=c(377),_=()=>({unhandledExceptions:!0,unhandledRejections:!0});a.exports.schema={apiKey:{defaultValue:()=>null,message:"is required",validate:m},appVersion:{defaultValue:()=>{},message:"should be a string",validate:p=>p===void 0||m(p)},appType:{defaultValue:()=>{},message:"should be a string",validate:p=>p===void 0||m(p)},autoDetectErrors:{defaultValue:()=>!0,message:"should be true|false",validate:p=>p===!0||p===!1},enabledErrorTypes:{defaultValue:()=>_(),message:"should be an object containing the flags { unhandledExceptions:true|false, unhandledRejections:true|false }",allowPartialObject:!0,validate:p=>{if(typeof p!="object"||!p)return!1;const v=h(p),C=h(_());return!(o(v,S=>f(C,S)).length<v.length||o(h(p),S=>typeof p[S]!="boolean").length>0)}},onError:{defaultValue:()=>[],message:"should be a function or array of functions",validate:A},onSession:{defaultValue:()=>[],message:"should be a function or array of functions",validate:A},onBreadcrumb:{defaultValue:()=>[],message:"should be a function or array of functions",validate:A},endpoints:{defaultValue:()=>({notify:"https://notify.bugsnag.com",sessions:"https://sessions.bugsnag.com"}),message:"should be an object containing endpoint URLs { notify, sessions }",validate:p=>p&&typeof p=="object"&&m(p.notify)&&m(p.sessions)&&o(h(p),v=>!f(["notify","sessions"],v)).length===0},autoTrackSessions:{defaultValue:p=>!0,message:"should be true|false",validate:p=>p===!0||p===!1},enabledReleaseStages:{defaultValue:()=>null,message:"should be an array of strings",validate:p=>p===null||d(p)&&o(p,v=>typeof v=="string").length===p.length},releaseStage:{defaultValue:()=>"production",message:"should be a string",validate:p=>typeof p=="string"&&p.length},maxBreadcrumbs:{defaultValue:()=>25,message:"should be a number ≤100",validate:p=>g(0,100)(p)},enabledBreadcrumbTypes:{defaultValue:()=>E,message:`should be null or a list of available breadcrumb types (${E.join(",")})`,validate:p=>p===null||d(p)&&u(p,(v,C)=>v===!1?v:f(E,C),!0)},context:{defaultValue:()=>{},message:"should be a string",validate:p=>p===void 0||typeof p=="string"},user:{defaultValue:()=>({}),message:"should be an object with { id, email, name } properties",validate:p=>p===null||p&&u(h(p),(v,C)=>v&&f(["id","email","name"],C),!0)},metadata:{defaultValue:()=>({}),message:"should be an object",validate:p=>typeof p=="object"&&p!==null},logger:{defaultValue:()=>{},message:"should be null or an object with methods { debug, info, warn, error }",validate:p=>!p||p&&u(["debug","info","warn","error"],(v,C)=>v&&typeof p[C]=="function",!0)},redactedKeys:{defaultValue:()=>["password"],message:"should be an array of strings|regexes",validate:p=>d(p)&&p.length===o(p,v=>typeof v=="string"||v&&typeof v.test=="function").length},plugins:{defaultValue:()=>[],message:"should be an array of plugin objects",validate:p=>d(p)&&p.length===o(p,v=>v&&typeof v=="object"&&typeof v.load=="function").length},featureFlags:{defaultValue:()=>[],message:'should be an array of objects that have a "name" property',validate:p=>d(p)&&p.length===o(p,v=>v&&typeof v=="object"&&typeof v.name=="string").length}}},750:(a,l,c)=>{const o=c(866),u=c(346),h=c(391),d=c(964),f=c(611),g=c(58),m=c(795),A=c(987),E=c(908),_=c(473);class p{constructor(D,y,k=[],N=S(),$){this.apiKey=void 0,this.context=void 0,this.groupingHash=void 0,this.originalError=$,this._handledState=N,this.severity=this._handledState.severity,this.unhandled=this._handledState.unhandled,this.app={},this.device={},this.request={},this.breadcrumbs=[],this.threads=[],this._metadata={},this._features=[],this._featuresIndex={},this._user={},this._session=void 0,this.errors=[b(D,y,p.__type,k)]}addMetadata(D,y,k){return A.add(this._metadata,D,y,k)}getMetadata(D,y){return A.get(this._metadata,D,y)}clearMetadata(D,y){return A.clear(this._metadata,D,y)}addFeatureFlag(D,y=null){E.add(this._features,this._featuresIndex,D,y)}addFeatureFlags(D){E.merge(this._features,D,this._featuresIndex)}getFeatureFlags(){return E.toEventApi(this._features)}clearFeatureFlag(D){E.clear(this._features,this._featuresIndex,D)}clearFeatureFlags(){this._features=[],this._featuresIndex={}}getUser(){return this._user}setUser(D,y,k){this._user={id:D,email:y,name:k}}toJSON(){return{payloadVersion:"4",exceptions:d(this.errors,D=>m({},D,{message:D.errorMessage})),severity:this.severity,unhandled:this._handledState.unhandled,severityReason:this._handledState.severityReason,app:this.app,device:this.device,request:this.request,breadcrumbs:this.breadcrumbs,context:this.context,groupingHash:this.groupingHash,metaData:this._metadata,user:this._user,session:this._session,featureFlags:this.getFeatureFlags()}}}const v=T=>{const D={file:T.fileName,method:C(T.functionName),lineNumber:T.lineNumber,columnNumber:T.columnNumber,code:void 0,inProject:void 0};return D.lineNumber>-1&&!D.file&&!D.method&&(D.file="global code"),D},C=T=>/^global code$/i.test(T)?"global code":T,S=()=>({unhandled:!1,severity:"warning",severityReason:{type:"handledException"}}),P=T=>typeof T=="string"?T:"";function b(T,D,y,k){return{errorClass:P(T),errorMessage:P(D),type:y,stacktrace:f(k,(N,$)=>{const j=v($);try{return JSON.stringify(j)==="{}"?N:N.concat(j)}catch{return N}},[])}}function x(T){return T.cause?[T,...x(T.cause)]:[T]}p.getStacktrace=function(T,D,y){if(h(T))return o.parse(T).slice(D);try{return g(u.backtrace(),k=>(k.functionName||"").indexOf("StackGenerator$$")===-1).slice(1+y)}catch{return[]}},p.create=function(T,D,y,k,N=0,$){const[j,Z]=R(T,D,k,$);let M;try{const B=p.getStacktrace(j,Z>0?1+Z+N:0,1+N);M=new p(j.name,j.message,B,y,T)}catch{M=new p(j.name,j.message,[],y,T)}if(j.name==="InvalidError"&&M.addMetadata(`${k}`,"non-error parameter",I(T)),j.cause){const B=x(j).slice(1),F=d(B,W=>{const ce=_(W)&&h(W)?o.parse(W):[],[Ot]=R(W,!0,"error cause");return Ot.name==="InvalidError"&&M.addMetadata("error cause",I(W)),b(Ot.name,Ot.message,p.__type,ce)});M.errors.push(...F)}return M};const I=T=>T===null?"null":T===void 0?"undefined":T,R=(T,D,y,k)=>{let N,$=0;const j=Z=>{const M=y==="error cause"?"was":"received";k&&k.warn(`${y} ${M} a non-error: "${Z}"`);const B=new Error(`${y} ${M} a non-error. See "${y}" tab for more detail.`);return B.name="InvalidError",B};if(!D)_(T)?N=T:(N=j(typeof T),$+=2);else switch(typeof T){case"string":case"number":case"boolean":N=new Error(String(T)),$+=1;break;case"function":N=j("function"),$+=2;break;case"object":T!==null&&_(T)?N=T:T!==null&&H(T)?(N=new Error(T.message||T.errorMessage),N.name=T.name||T.errorClass,$+=1):(N=j(T===null?"null":"unsupported object"),$+=2);break;default:N=j("nothing"),$+=2}if(!h(N))try{throw N}catch(Z){h(Z)&&(N=Z,$=1)}return[N,$]};p.__type="browserjs";const H=T=>(typeof T.name=="string"||typeof T.errorClass=="string")&&(typeof T.message=="string"||typeof T.errorMessage=="string");a.exports=p},994:a=>{a.exports=(l,c,o)=>{let u=0;const h=()=>{if(u>=l.length)return o(null,!0);c(l[u],(d,f)=>{if(d)return o(d);if(f===!1)return o(null,!1);u++,h()})};h()}},377:a=>{a.exports=["navigation","request","process","log","user","state","error","manual"]},698:(a,l,c)=>{const o=c(994);a.exports=(u,h,d,f)=>{o(u,(m,A)=>{if(typeof m!="function")return A(null);try{if(m.length!==2){const E=m(h);return E&&typeof E.then=="function"?E.then(_=>setTimeout(()=>A(null,_)),_=>{setTimeout(()=>(d(_),A(null,!0)))}):A(null,E)}m(h,(E,_)=>{if(E)return d(E),A(null);A(null,_)})}catch(E){d(E),A(null)}},f)}},866:(a,l,c)=>{a.exports=c(247)},795:a=>{a.exports=function(l){for(var c=1;c<arguments.length;c++){var o=arguments[c];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(l[u]=o[u])}return l}},58:(a,l,c)=>{const o=c(611);a.exports=(u,h)=>o(u,(d,f,g,m)=>h(f,g,m)?d.concat(f):d,[])},566:(a,l,c)=>{const o=c(611);a.exports=(u,h)=>o(u,(d,f,g,m)=>d===!0||f===h,!1)},37:a=>{a.exports=l=>Object.prototype.toString.call(l)==="[object Array]"},929:a=>{const l=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];a.exports=o=>{const u=[];let h;for(h in o)Object.prototype.hasOwnProperty.call(o,h)&&u.push(h);if(!l)return u;for(let d=0,f=c.length;d<f;d++)Object.prototype.hasOwnProperty.call(o,c[d])&&u.push(c[d]);return u}},964:(a,l,c)=>{const o=c(611);a.exports=(u,h)=>o(u,(d,f,g,m)=>d.concat(h(f,g,m)),[])},611:a=>{a.exports=(l,c,o)=>{let u=o;for(let h=0,d=l.length;h<d;h++)u=c(u,l[h],h,l);return u}},908:(a,l,c)=>{const o=c(964),u=c(58),h=c(37),d=c(575);function f(E,_,p,v){if(typeof p!="string")return;v===void 0?v=null:v!==null&&typeof v!="string"&&(v=d(v));const C=_[p];if(typeof C=="number"){E[C]={name:p,variant:v};return}E.push({name:p,variant:v}),_[p]=E.length-1}function g(E,_,p){if(h(_)){for(let v=0;v<_.length;++v){const C=_[v];C===null||typeof C!="object"||f(E,p,C.name,C.variant)}return E}}function m(E){return o(u(E,Boolean),({name:_,variant:p})=>{const v={featureFlag:_};return typeof p=="string"&&(v.variant=p),v})}function A(E,_,p){const v=_[p];typeof v=="number"&&(E[v]=null,delete _[p])}a.exports={add:f,clear:A,merge:g,toEventApi:m}},391:a=>{a.exports=l=>!!l&&(!!l.stack||!!l.stacktrace||!!l["opera#sourceloc"])&&typeof(l.stack||l.stacktrace||l["opera#sourceloc"])=="string"&&l.stack!==`${l.name}: ${l.message}`},473:(a,l,c)=>{a.exports=c(232)},599:(a,l,c)=>{const o=c(575),u=["events.[].metaData","events.[].breadcrumbs.[].metaData","events.[].request"];a.exports.event=(h,d)=>{let f=o(h,null,null,{redactedPaths:u,redactedKeys:d});return f.length>1e6&&(h.events[0]._metadata={notifier:`WARNING!
Serialized payload was ${f.length/1e6}MB (limit = 1MB)
metadata was removed`},f=o(h,null,null,{redactedPaths:u,redactedKeys:d})),f},a.exports.session=(h,d)=>o(h,null,null)},987:(a,l,c)=>{const o=c(795),u=(f,g,m,A)=>{if(!g)return;let E;if(m===null)return d(f,g);typeof m=="object"&&(E=m),typeof m=="string"&&(E={[m]:A}),E&&(g==="__proto__"||g==="constructor"||g==="prototype"||(f[g]||(f[g]={}),f[g]=o({},f[g],E)))},h=(f,g,m)=>{if(typeof g=="string"){if(!m)return f[g];if(f[g])return f[g][m]}},d=(f,g,m)=>{if(typeof g=="string"){if(!m){delete f[g];return}g==="__proto__"||g==="constructor"||g==="prototype"||f[g]&&delete f[g][m]}};a.exports={add:u,get:h,clear:d}},100:a=>{a.exports=(l,c,o,u)=>{let h=!1;const d=l.slice();for(;!h&&d.length;)try{h=d.pop()(c)===!1}catch(f){u.error(`Error occurred in ${o} callback, continuing anyway…`),u.error(f)}return h}},849:a=>{a.exports=(l=1,c=1/0)=>o=>typeof o=="number"&&parseInt(""+o,10)===o&&o>=l&&o<=c},90:(a,l,c)=>{const o=c(58),u=c(37);a.exports=h=>typeof h=="function"||u(h)&&o(h,d=>typeof d=="function").length===h.length},937:a=>{a.exports=l=>typeof l=="string"&&!!l.length},277:(a,l,c)=>{var o=c(42),u=c(408),h=0,d=4,f=36,g=Math.pow(f,d);function m(){return u((Math.random()*g<<0).toString(f),d)}function A(){return h=h<g?h:0,h++,h-1}function E(){var _="c",p=new Date().getTime().toString(f),v=u(A().toString(f),d),C=o(),S=m()+m();return _+p+v+C+S}E.fingerprint=o,a.exports=E},42:(a,l,c)=>{var o=c(408),u=typeof window=="object"?window:self,h=0;for(var d in u)Object.hasOwnProperty.call(u,d)&&h++;var f=navigator.mimeTypes?navigator.mimeTypes.length:0,g=o((f+navigator.userAgent.length).toString(36)+h.toString(36),4);a.exports=function(){return g}},408:a=>{a.exports=function(c,o){var u="000000000"+c;return u.substr(u.length-o)}},575:a=>{a.exports=function(p,v,C,S){var P=S&&S.redactedKeys?S.redactedKeys:[],b=S&&S.redactedPaths?S.redactedPaths:[];return JSON.stringify(_(p,P,b),v,C)};var l=20,c=25e3,o=8,u="...";function h(p){return p instanceof Error||/^\[object (Error|(Dom)?Exception)\]$/.test(Object.prototype.toString.call(p))}function d(p){return"[Throws: "+(p?p.message:"?")+"]"}function f(p,v){for(var C=0,S=p.length;C<S;C++)if(p[C]===v)return!0;return!1}function g(p,v){for(var C=0,S=p.length;C<S;C++)if(v.indexOf(p[C])===0)return!0;return!1}function m(p,v){for(var C=0,S=p.length;C<S;C++)if(typeof p[C]=="string"&&p[C].toLowerCase()===v.toLowerCase()||p[C]&&typeof p[C].test=="function"&&p[C].test(v))return!0;return!1}function A(p){return Object.prototype.toString.call(p)==="[object Array]"}function E(p,v){try{return p[v]}catch(C){return d(C)}}function _(p,v,C){var S=[],P=0;function b(x,I){function R(){return I.length>o&&P>c}if(P++,I.length>l||R())return u;if(x===null||typeof x!="object")return x;if(f(S,x))return"[Circular]";if(S.push(x),typeof x.toJSON=="function")try{P--;var H=b(x.toJSON(),I);return S.pop(),H}catch(Z){return d(Z)}var T=h(x);if(T){P--;var D=b({name:x.name,message:x.message},I);return S.pop(),D}if(A(x)){for(var y=[],k=0,N=x.length;k<N;k++){if(R()){y.push(u);break}y.push(b(x[k],I.concat("[]")))}return S.pop(),y}var $={};try{for(var j in x)if(Object.prototype.hasOwnProperty.call(x,j)){if(g(C,I.join("."))&&m(v,j)){$[j]="[REDACTED]";continue}if(R()){$[j]=u;break}$[j]=b(E(x,j),I.concat(j))}}catch{}return S.pop(),$}return b(p,[])}},247:function(a,l,c){var o,u,h;(function(d,f){u=[c(998)],o=f,h=typeof o=="function"?o.apply(l,u):o,h!==void 0&&(a.exports=h)})(this,function(f){var g=/(^|@)\S+\:\d+/,m=/^\s*at .*(\S+\:\d+|\(native\))/m,A=/^(eval@)?(\[native code\])?$/;return{parse:function(_){if(typeof _.stacktrace<"u"||typeof _["opera#sourceloc"]<"u")return this.parseOpera(_);if(_.stack&&_.stack.match(m))return this.parseV8OrIE(_);if(_.stack)return this.parseFFOrSafari(_);throw new Error("Cannot parse given Error object")},extractLocation:function(_){if(_.indexOf(":")===-1)return[_];var p=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/,v=p.exec(_.replace(/[\(\)]/g,""));return[v[1],v[2]||void 0,v[3]||void 0]},parseV8OrIE:function(_){var p=_.stack.split(`
`).filter(function(v){return!!v.match(m)},this);return p.map(function(v){v.indexOf("(eval ")>-1&&(v=v.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var C=v.replace(/^\s+/,"").replace(/\(eval code/g,"("),S=C.match(/ (\((.+):(\d+):(\d+)\)$)/);C=S?C.replace(S[0],""):C;var P=C.split(/\s+/).slice(1),b=this.extractLocation(S?S[1]:P.pop()),x=P.join(" ")||void 0,I=["eval","<anonymous>"].indexOf(b[0])>-1?void 0:b[0];return new f({functionName:x,fileName:I,lineNumber:b[1],columnNumber:b[2],source:v})},this)},parseFFOrSafari:function(_){var p=_.stack.split(`
`).filter(function(v){return!v.match(A)},this);return p.map(function(v){if(v.indexOf(" > eval")>-1&&(v=v.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),v.indexOf("@")===-1&&v.indexOf(":")===-1)return new f({functionName:v});var C=/((.*".+"[^@]*)?[^@]*)(?:@)/,S=v.match(C),P=S&&S[1]?S[1]:void 0,b=this.extractLocation(v.replace(C,""));return new f({functionName:P,fileName:b[0],lineNumber:b[1],columnNumber:b[2],source:v})},this)},parseOpera:function(_){return!_.stacktrace||_.message.indexOf(`
`)>-1&&_.message.split(`
`).length>_.stacktrace.split(`
`).length?this.parseOpera9(_):_.stack?this.parseOpera11(_):this.parseOpera10(_)},parseOpera9:function(_){for(var p=/Line (\d+).*script (?:in )?(\S+)/i,v=_.message.split(`
`),C=[],S=2,P=v.length;S<P;S+=2){var b=p.exec(v[S]);b&&C.push(new f({fileName:b[2],lineNumber:b[1],source:v[S]}))}return C},parseOpera10:function(_){for(var p=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,v=_.stacktrace.split(`
`),C=[],S=0,P=v.length;S<P;S+=2){var b=p.exec(v[S]);b&&C.push(new f({functionName:b[3]||void 0,fileName:b[2],lineNumber:b[1],source:v[S]}))}return C},parseOpera11:function(_){var p=_.stack.split(`
`).filter(function(v){return!!v.match(g)&&!v.match(/^Error created at/)},this);return p.map(function(v){var C=v.split("@"),S=this.extractLocation(C.pop()),P=C.shift()||"",b=P.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0,x;P.match(/\(([^\)]*)\)/)&&(x=P.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var I=x===void 0||x==="[arguments not available]"?void 0:x.split(",");return new f({functionName:b,args:I,fileName:S[0],lineNumber:S[1],columnNumber:S[2],source:v})},this)}}})},232:a=>{a.exports=l;function l(c){switch(Object.prototype.toString.call(c)){case"[object Error]":return!0;case"[object Exception]":return!0;case"[object DOMException]":return!0;default:return c instanceof Error}}},346:function(a,l,c){var o,u,h;(function(d,f){u=[c(998)],o=f,h=typeof o=="function"?o.apply(l,u):o,h!==void 0&&(a.exports=h)})(this,function(d){return{backtrace:function(g){var m=[],A=10;typeof g=="object"&&typeof g.maxStackSize=="number"&&(A=g.maxStackSize);for(var E=arguments.callee;E&&m.length<A&&E.arguments;){for(var _=new Array(E.arguments.length),p=0;p<_.length;++p)_[p]=E.arguments[p];/function(?:\s+([\w$]+))+\s*\(/.test(E.toString())?m.push(new d({functionName:RegExp.$1||void 0,args:_})):m.push(new d({args:_}));try{E=E.caller}catch{break}}return m}}})},998:function(a,l){var c,o,u;(function(h,d){o=[],c=d,u=typeof c=="function"?c.apply(l,o):c,u!==void 0&&(a.exports=u)})(this,function(){function h(P){return!isNaN(parseFloat(P))&&isFinite(P)}function d(P){return P.charAt(0).toUpperCase()+P.substring(1)}function f(P){return function(){return this[P]}}var g=["isConstructor","isEval","isNative","isToplevel"],m=["columnNumber","lineNumber"],A=["fileName","functionName","source"],E=["args"],_=g.concat(m,A,E);function p(P){if(P instanceof Object)for(var b=0;b<_.length;b++)P.hasOwnProperty(_[b])&&P[_[b]]!==void 0&&this["set"+d(_[b])](P[_[b]])}p.prototype={getArgs:function(){return this.args},setArgs:function(P){if(Object.prototype.toString.call(P)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=P},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(P){if(P instanceof p)this.evalOrigin=P;else if(P instanceof Object)this.evalOrigin=new p(P);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var P=this.getFunctionName()||"{anonymous}",b="("+(this.getArgs()||[]).join(",")+")",x=this.getFileName()?"@"+this.getFileName():"",I=h(this.getLineNumber())?":"+this.getLineNumber():"",R=h(this.getColumnNumber())?":"+this.getColumnNumber():"";return P+b+x+I+R}};for(var v=0;v<g.length;v++)p.prototype["get"+d(g[v])]=f(g[v]),p.prototype["set"+d(g[v])]=function(P){return function(b){this[P]=!!b}}(g[v]);for(var C=0;C<m.length;C++)p.prototype["get"+d(m[C])]=f(m[C]),p.prototype["set"+d(m[C])]=function(P){return function(b){if(!h(b))throw new TypeError(P+" must be a Number");this[P]=Number(b)}}(m[C]);for(var S=0;S<A.length;S++)p.prototype["get"+d(A[S])]=f(A[S]),p.prototype["set"+d(A[S])]=function(P){return function(b){this[P]=String(b)}}(A[S]);return p})},743:(a,l,c)=>{const o=c(277);class u{constructor(){this.id=o(),this.startedAt=new Date,this._handled=0,this._unhandled=0,this._user={},this.app={},this.device={}}getUser(){return this._user}setUser(d,f,g){this._user={id:d,email:f,name:g}}toJSON(){return{id:this.id,startedAt:this.startedAt,events:{handled:this._handled,unhandled:this._unhandled}}}_track(d){this[d._handledState.unhandled?"_unhandled":"_handled"]+=1}}a.exports=u},798:(a,l,c)=>{const o=c(795),u="bugsnag-anonymous-id",h=f=>{try{const g=f.localStorage;let m=g.getItem(u);return m&&/^c[a-z0-9]{20,32}$/.test(m)||(m=c(79)(),g.setItem(u,m)),m}catch{}};a.exports=(f=navigator,g=window)=>({load:m=>{const A={locale:f.browserLanguage||f.systemLanguage||f.userLanguage||f.language,userAgent:f.userAgent};g&&g.screen&&g.screen.orientation&&g.screen.orientation.type?A.orientation=g.screen.orientation.type:g&&g.document&&(A.orientation=g.document.documentElement.clientWidth>g.document.documentElement.clientHeight?"landscape":"portrait"),m._config.generateAnonymousId&&(A.id=h(g)),m.addOnSession(E=>{E.device=o({},E.device,A),m._config.collectUserIp||d(E)}),m.addOnError(E=>{E.device=o({},E.device,A,{time:new Date}),m._config.collectUserIp||d(E)},!0)},configSchema:{generateAnonymousId:{validate:m=>m===!0||m===!1,defaultValue:()=>!0,message:"should be true|false"}}});const d=f=>{const g=f.getUser();(!g||!g.id)&&f.setUser(f.device.id)}},79:(a,l,c)=>{var o=c(963),u=c(879),h=0,d=4,f=36,g=Math.pow(f,d);function m(){return u((Math.random()*g<<0).toString(f),d)}function A(){return h=h<g?h:0,h++,h-1}function E(){var _="c",p=new Date().getTime().toString(f),v=u(A().toString(f),d),C=o(),S=m()+m();return _+p+v+C+S}E.fingerprint=o,a.exports=E},963:(a,l,c)=>{var o=c(879),u=typeof window=="object"?window:self,h=0;for(var d in u)Object.hasOwnProperty.call(u,d)&&h++;var f=navigator.mimeTypes?navigator.mimeTypes.length:0,g=o((f+navigator.userAgent.length).toString(36)+h.toString(36),4);a.exports=function(){return g}},879:a=>{a.exports=function(c,o){var u="000000000"+c;return u.substr(u.length-o)}},223:(a,l,c)=>{const o=c(566);a.exports={load:h=>{h._sessionDelegate=u}};const u={startSession:(h,d)=>{const f=h;return f._session=d,f._pausedSession=null,f._config.enabledReleaseStages!==null&&!o(f._config.enabledReleaseStages,f._config.releaseStage)?(f._logger.warn("Session not sent due to releaseStage/enabledReleaseStages configuration"),f):(f._delivery.sendSession({notifier:f._notifier,device:d.device,app:d.app,sessions:[{id:d.id,startedAt:d.startedAt,user:d._user}]}),f)},resumeSession:h=>h._session?h:h._pausedSession?(h._session=h._pausedSession,h._pausedSession=null,h):h.startSession(),pauseSession:h=>{h._pausedSession=h._session,h._session=null}}},155:(a,l,c)=>{const o=c(795);a.exports={load:u=>{u._config.collectUserIp||u.addOnError(h=>{h._user&&typeof h._user.id>"u"&&delete h._user.id,h._user=o({id:"[REDACTED]"},h._user),h.request=o({clientIp:"[REDACTED]"},h.request)})},configSchema:{collectUserIp:{defaultValue:()=>!0,message:"should be true|false",validate:u=>u===!0||u===!1}}}},584:a=>{a.exports=(o=window,u="window onerror")=>({load:h=>{if(!h._config.autoDetectErrors||!h._config.enabledErrorTypes.unhandledExceptions)return;function d(g,m,A,E,_){if(A===0&&/Script error\.?/.test(g))h._logger.warn("Ignoring cross-domain or eval script error. See docs: https://tinyurl.com/yy3rn63z");else{const p={severity:"error",unhandled:!0,severityReason:{type:"unhandledException"}};let v;if(_)v=h.Event.create(_,!0,p,u,1),l(v.errors[0].stacktrace,m,A,E);else if(typeof g=="object"&&g!==null&&(!m||typeof m!="string")&&!A&&!E&&!_){const C=g.type?`Event: ${g.type}`:"Error",S=g.message||g.detail||"";v=h.Event.create({name:C,message:S},!0,p,u,1),v.originalError=g,v.addMetadata(u,{event:g,extraParameters:m})}else v=h.Event.create(g,!0,p,u,1),l(v.errors[0].stacktrace,m,A,E);h._notify(v)}typeof f=="function"&&f.apply(this,arguments)}const f=o.onerror;o.onerror=d}});const l=(o,u,h,d)=>{o[0]||o.push({});const f=o[0];!f.file&&typeof u=="string"&&(f.file=u),!f.lineNumber&&c(h)&&(f.lineNumber=h),f.columnNumber||(c(d)?f.columnNumber=d:window.event&&c(window.event.errorCharacter)&&(f.columnNumber=window.event.errorCharacter))},c=o=>typeof o=="number"&&String.call(o)!=="NaN"},536:(a,l,c)=>{const o=c(964),u=c(473);a.exports=(d=window)=>({load:g=>{if(!g._config.autoDetectErrors||!g._config.enabledErrorTypes.unhandledRejections)return;const m=A=>{let E=A.reason,_=!1;try{A.detail&&A.detail.reason&&(E=A.detail.reason,_=!0)}catch{}const p=g.Event.create(E,!1,{severity:"error",unhandled:!0,severityReason:{type:"unhandledPromiseRejection"}},"unhandledrejection handler",1,g._logger);_&&o(p.errors[0].stacktrace,h(E)),g._notify(p,v=>{u(v.originalError)&&!v.originalError.stack&&v.addMetadata("unhandledRejection handler",{[Object.prototype.toString.call(v.originalError)]:{name:v.originalError.name,message:v.originalError.message,code:v.originalError.code}})})};"addEventListener"in d?d.addEventListener("unhandledrejection",m):d.onunhandledrejection=(A,E)=>{m({detail:{reason:A,promise:E}})}}});const h=d=>f=>{f.file!==d.toString()&&f.method&&(f.method=f.method.replace(/^\s+/,""))}},182:(a,l,c)=>{const{schema:o}=c(510),u=c(964),h=c(795);a.exports={appType:{...o.appType,defaultValue:()=>"workerjs"},logger:h({},o.logger,{defaultValue:()=>typeof console<"u"&&typeof console.debug=="function"?d():void 0}),autoTrackSessions:{...o.autoTrackSessions,defaultValue:()=>!1},autoDetectErrors:{...o.autoTrackSessions,defaultValue:()=>!1}};const d=()=>{const f={},g=console.log;return u(["debug","info","warn","error"],m=>{const A=console[m];f[m]=typeof A=="function"?A.bind(console,"[bugsnag]"):g.bind(console,"[bugsnag]")}),f}},230:a=>{const l=/^(chrome|moz|safari|safari-web)-extension:/;a.exports={name:"preventDiscard",load:c=>{c.addOnError(o=>{o.errors.forEach(({stacktrace:u})=>{u.forEach(function(h){h.file=h.file.replace(l,"$1_extension:")})})},!0)}}}},r={};function i(a){var l=r[a];if(l!==void 0)return l.exports;var c=r[a]={exports:{}};return n[a].call(c.exports,c,c.exports,i),c.exports}i.n=a=>{var l=a&&a.__esModule?()=>a.default:()=>a;return i.d(l,{a:l}),l},i.d=(a,l)=>{for(var c in l)i.o(l,c)&&!i.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:l[c]})},i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),i.o=(a,l)=>Object.prototype.hasOwnProperty.call(a,l);var s={};return(()=>{i.d(s,{default:()=>y});var a=i(953),l=i.n(a),c=i(510),o=i(599);const h=(k,N=i.g.fetch)=>({sendEvent:($,j=()=>{})=>{const Z=k._config.endpoints.notify;N(Z,{method:"POST",headers:{"Content-Type":"application/json","Bugsnag-Api-Key":$.apiKey||k._config.apiKey,"Bugsnag-Payload-Version":"4","Bugsnag-Sent-At":new Date().toISOString()},body:o.event($,k._config.redactedKeys)}).then(()=>{j(null)}).catch(M=>{k._logger.error(M),j(M)})},sendSession:($,j=()=>{})=>{const Z=k._config.endpoints.sessions;N(Z,{method:"POST",headers:{"Content-Type":"application/json","Bugsnag-Api-Key":k._config.apiKey,"Bugsnag-Payload-Version":"1","Bugsnag-Sent-At":new Date().toISOString()},body:o.session($,k._config.redactedKeys)}).then(()=>{j(null)}).catch(M=>{k._logger.error(M),j(M)})}});var d=i(155),f=i.n(d),g=i(584),m=i.n(g),A=i(536),E=i.n(A),_=i(182),p=i.n(_),v=i(798),C=i.n(v),S=i(223),P=i.n(S),b=i(230),x=i.n(b);const I="Bugsnag Web Worker",R="https://github.com/bugsnag/bugsnag-js",H="7.22.7",T={...c.schema,...p()},D={createClient:k=>{typeof k=="string"&&(k={apiKey:k}),k||(k={});const N=[C()(navigator,null),P(),f(),x(),m()(self,"worker onerror"),E()(self)],$=new(l())(k,T,N,{name:I,version:H,url:R});return $._setDelivery(h),$._logger.debug("Loaded!"),$._config.autoTrackSessions?$.startSession():$},start:k=>D._client?(D._client._logger.warn("Bugsnag.start() was called more than once. Ignoring."),D._client):(D._client=D.createClient(k),D._client),isStarted:()=>D._client!=null};Object.getOwnPropertyNames(l().prototype).forEach(k=>{/^_/.test(k)||k==="constructor"||(D[k]=function(){if(!D._client)return console.log(`Bugsnag.${k}() was called before Bugsnag.start()`);D._client._depth+=1;const N=D._client[k].apply(D._client,arguments);return D._client._depth-=1,N})});const y=D})(),s=s.default,s})())})(Bs);var wc=Bs.exports;const Ac=Qe(wc);function kr(e){return e==null?e:e instanceof Error?{errorClass:e.name,errorMessage:e.message}:typeof e=="function"?"[Function]":Array.isArray(e)?e.map(kr):typeof e=="object"?Object.entries(e).reduce((t,[n,r])=>(t[n]=kr(r),t),{}):e}var js={exports:{}};(function(e,t){(function(n,r){r(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Je,function(n){var r,i;if(!((i=(r=globalThis.chrome)==null?void 0:r.runtime)!=null&&i.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const s="The message port closed before a response was received.",a=l=>{const c={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(c).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(x,I=void 0){super(I),this.createItem=x}get(x){return this.has(x)||this.set(x,this.createItem(x)),super.get(x)}}const u=b=>b&&typeof b=="object"&&typeof b.then=="function",h=(b,x)=>(...I)=>{l.runtime.lastError?b.reject(new Error(l.runtime.lastError.message)):x.singleCallbackArg||I.length<=1&&x.singleCallbackArg!==!1?b.resolve(I[0]):b.resolve(I)},d=b=>b==1?"argument":"arguments",f=(b,x)=>function(R,...H){if(H.length<x.minArgs)throw new Error(`Expected at least ${x.minArgs} ${d(x.minArgs)} for ${b}(), got ${H.length}`);if(H.length>x.maxArgs)throw new Error(`Expected at most ${x.maxArgs} ${d(x.maxArgs)} for ${b}(), got ${H.length}`);return new Promise((T,D)=>{if(x.fallbackToNoCallback)try{R[b](...H,h({resolve:T,reject:D},x))}catch(y){console.warn(`${b} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,y),R[b](...H),x.fallbackToNoCallback=!1,x.noCallback=!0,T()}else x.noCallback?(R[b](...H),T()):R[b](...H,h({resolve:T,reject:D},x))})},g=(b,x,I)=>new Proxy(x,{apply(R,H,T){return I.call(H,b,...T)}});let m=Function.call.bind(Object.prototype.hasOwnProperty);const A=(b,x={},I={})=>{let R=Object.create(null),H={has(D,y){return y in b||y in R},get(D,y,k){if(y in R)return R[y];if(!(y in b))return;let N=b[y];if(typeof N=="function")if(typeof x[y]=="function")N=g(b,b[y],x[y]);else if(m(I,y)){let $=f(y,I[y]);N=g(b,b[y],$)}else N=N.bind(b);else if(typeof N=="object"&&N!==null&&(m(x,y)||m(I,y)))N=A(N,x[y],I[y]);else if(m(I,"*"))N=A(N,x[y],I["*"]);else return Object.defineProperty(R,y,{configurable:!0,enumerable:!0,get(){return b[y]},set($){b[y]=$}}),N;return R[y]=N,N},set(D,y,k,N){return y in R?R[y]=k:b[y]=k,!0},defineProperty(D,y,k){return Reflect.defineProperty(R,y,k)},deleteProperty(D,y){return Reflect.deleteProperty(R,y)}},T=Object.create(b);return new Proxy(T,H)},E=b=>({addListener(x,I,...R){x.addListener(b.get(I),...R)},hasListener(x,I){return x.hasListener(b.get(I))},removeListener(x,I){x.removeListener(b.get(I))}}),_=new o(b=>typeof b!="function"?b:function(I){const R=A(I,{},{getContent:{minArgs:0,maxArgs:0}});b(R)}),p=new o(b=>typeof b!="function"?b:function(I,R,H){let T=!1,D,y=new Promise(j=>{D=function(Z){T=!0,j(Z)}}),k;try{k=b(I,R,D)}catch(j){k=Promise.reject(j)}const N=k!==!0&&u(k);if(k!==!0&&!N&&!T)return!1;const $=j=>{j.then(Z=>{H(Z)},Z=>{let M;Z&&(Z instanceof Error||typeof Z.message=="string")?M=Z.message:M="An unexpected error occurred",H({__mozWebExtensionPolyfillReject__:!0,message:M})}).catch(Z=>{console.error("Failed to send onMessage rejected reply",Z)})};return $(N?k:y),!0}),v=({reject:b,resolve:x},I)=>{l.runtime.lastError?l.runtime.lastError.message===s?x():b(new Error(l.runtime.lastError.message)):I&&I.__mozWebExtensionPolyfillReject__?b(new Error(I.message)):x(I)},C=(b,x,I,...R)=>{if(R.length<x.minArgs)throw new Error(`Expected at least ${x.minArgs} ${d(x.minArgs)} for ${b}(), got ${R.length}`);if(R.length>x.maxArgs)throw new Error(`Expected at most ${x.maxArgs} ${d(x.maxArgs)} for ${b}(), got ${R.length}`);return new Promise((H,T)=>{const D=v.bind(null,{resolve:H,reject:T});R.push(D),I.sendMessage(...R)})},S={devtools:{network:{onRequestFinished:E(_)}},runtime:{onMessage:E(p),onMessageExternal:E(p),sendMessage:C.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:C.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},P={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return c.privacy={network:{"*":P},services:{"*":P},websites:{"*":P}},A(l,S,c)};n.exports=a(chrome)}else n.exports=globalThis.browser})})(js);var _c=js.exports;const jt=Qe(_c);let Xe;function xc(){const[,e,t]=/(.*?):\/\/(.*)/.exec(jt.runtime.getURL("/"))??["","",""];return`${e.replace(/-/g,"_")}://${t}`}function Sc(e){return typeof e=="string"||typeof e=="boolean"||typeof e=="number"}function Tc(e){var t;return!!((t=e==null?void 0:e.stacktrace)!=null&&t.find(n=>n.file.startsWith($s)))}function Ec(e,t){return!!t.find(n=>e.errorMessage.match(n))}function Cc(e){e.errors.forEach(t=>{t.stacktrace=t.stacktrace.map(n=>(n.file=n.file.replace(/chrome-extension:/g,"chrome_extension:"),n.file=n.file.replace(/moz-extension:/g,"moz_extension:"),n.file=n.file.replace(/safari-extension:/g,"safari_extension:"),n.file=n.file.replace(/safari-web-extension:/g,"safari_web_extension:"),n))})}function Fs(...e){return e.find(t=>t instanceof Error)??Oc(e)}function Oc(...e){return e.map(t=>Sc(t)?String(t):JSON.stringify(kr(t))).join(" ")}function Ws(e){return t=>{t.errors.forEach(n=>{const r=1+n.stacktrace.findIndex(i=>i.method===e.name);n.stacktrace=n.stacktrace.slice(r)})}}let $s="";const Xt={bugsnagClient:null,apiKey:"14be373dfe46ae64888094a22d25ce46",sampleGroup:0,initAPI(e){return Xe=e,Xe.mixin("Bugsnag",{init:this.init.bind(this)})},async init(e){if($s=xc(),this.bugsnagClient!=null)return;await Promise.all([Xe.Requirements.init()]);const t=await Xe.Storage.get("install-id"),n=Xe.Settings.get("hasAcceptedPrivacyPolicy"),r=await Xe.Requirements.isOnboardingCompleted(),i=Xe.Settings.get("isNewUser");this.bugsnagClient=Ac.start({apiKey:this.apiKey,appType:"Web Extension",collectUserIp:!1,appVersion:Xe.Chrome.Extension.getVersion(),enabledReleaseStages:["production"],releaseStage:"production",context:e??"unknown",logger:null,generateAnonymousId:!1,onError:[Cc,this.isValidError.bind(this)],onSession:[this.isValidSession.bind(this)]}),this.bugsnagClient.setUser(t),this.bugsnagClient.addMetadata("user properties",{hasAcceptedPrivacyPolicy:n,hasCompletedOnboarding:r,isNewUser:i}),this.sampleGroup=await Xe.Storage.getOrSet("bugsnagSamplingGroup",100*Math.random())},notifyError(...e){var t;(t=this.bugsnagClient)==null||t.notify(Fs(e),n=>{Ws(this.notifyError)(n),n.severity="error"})},notifyWarning(...e){var t;(t=this.bugsnagClient)==null||t.notify(Fs(e),n=>{Ws(this.notifyWarning)(n),n.severity="warning"})},logBreadcrumb(...e){var t;(t=this.bugsnagClient)==null||t.leaveBreadcrumb(typeof e[0]=="string"?e[0]:"(no message)",{args:kr(e)},"log")},disabled(){return!this.isReady()||!this.canUploadData()},async isValidError(e){if(this.disabled()||!this.isSampled())return!1;const t=Xe.RemoteConfig.get("bugsnagIgnoreMatches");return e.errors?!!e.errors.find(n=>Tc(n)&&!Ec(n,t)):!1},isValidSession(){if(this.disabled())return!1},canUploadData(){return Xe.Settings.get("hasAcceptedPrivacyPolicy")??!1},isReady(){return Xe.Settings.isInitialized()},isSampled(){const e=Xe.RemoteConfig.get("bugsnagSampling");return this.sampleGroup<e}};function Ic(){return{log:function(...t){const[n,r,i,s]=t,a=s??"INFO";a==="ERROR"?Xt.notifyError(...t):a==="WARN"?(Xt.logBreadcrumb(...t),Xt.notifyWarning(...t)):a==="INFO"?Xt.logBreadcrumb(...t):Xt.logBreadcrumb(...t)}}}const Dr=Ic(),ke={firstToLower:function(e){return typeof e=="string"?e.toLowerCase()[0]+e.slice(1):e},firstToUpper:function(e){return typeof e=="string"?e.toUpperCase()[0]+e.slice(1):e},isEmpty:function(e){return e===null||e===""||typeof e>"u"||Object.keys(e).length===0},sanitizeMSWordChars:function(e){let t=e;return t=t.replace(/[\u2018\u2019\u201A]/g,"'"),t=t.replace(/[\u201C\u201D\u201E]/g,'"'),t=t.replace(/\u2026/g,"..."),t=t.replace(/[\u2013\u2014]/g,"--"),t=t.replace(/\u02C6/g,"^"),t=t.replace(/\u2039/g,"<"),t=t.replace(/\u203A/g,">"),t=t.replace(/[\u02DC\u00A0]/g," "),t},getDecoupledPromise(){let e,t;const n=new Promise((r,i)=>{e=r,t=i});return{resolve:e,reject:t,promise:n}},createScopedLog(e){return(t,n,r=void 0,i="INFO")=>{Dr.log(`${e}.${t}`,n,r,i)}},isTopFrame(){return window.self===window.top},initAPI(e){return e.mixin("Utils",{firstToLower:this.firstToLower.bind(this),firstToUpper:this.firstToUpper.bind(this),isEmpty:this.isEmpty.bind(this),sanitizeMSWordChars:this.sanitizeMSWordChars.bind(this),getDecoupledPromise:this.getDecoupledPromise.bind(this),createScopedLog:this.createScopedLog.bind(this),isTopFrame:this.isTopFrame.bind(this)})}},Pc=ke.createScopedLog("API"),Y=(()=>(()=>{let t={},n=null;const r=function(...i){let s="",a=null;if(i.length===0)throw new TypeError("Mixin has no arguments");if(Pc("mixin","Adding mixin to API",i,"DEBUG"),i.length===2&&typeof i[0]=="string"){if(s=i[0],typeof i[1]=="object"&&i[1]!==null?a=i[1]:typeof i[1]=="function"&&(a=i[1]()),a)if(s.indexOf(".")>-1){const l=s.split("."),c=l.pop(),o={};n||(n=It.lookup(s,t)),o[c]=n?It.merge(n,a,!0):a,r(l.join("."),o)}else{const l=s;s in t?t[l]=It.merge(t[l],a):t[l]=a,n=null}}else i.length===1&&typeof i[0]=="object"&&i[0]!==null?t=It.merge(t,i[0]):i.length===1&&typeof i[0]=="function"&&(a=i[0](),typeof a=="object"&&a!==null&&(t=It.merge(t,a)))};return r({mixin:r}),t})())();function Mr(e){"@babel/helpers - typeof";return Mr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mr(e)}function en(e){if(e===null||e===!0||e===!1)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function Ve(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function xt(e){Ve(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||Mr(e)==="object"&&t==="[object Date]"?new Date(e.getTime()):typeof e=="number"||t==="[object Number]"?new Date(e):((typeof e=="string"||t==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function kc(e,t){Ve(2,arguments);var n=xt(e).getTime(),r=en(t);return new Date(n+r)}var Dc={};function Nr(){return Dc}function Mc(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function Nc(e){return Ve(1,arguments),e instanceof Date||Mr(e)==="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Rc(e){if(Ve(1,arguments),!Nc(e)&&typeof e!="number")return!1;var t=xt(e);return!isNaN(Number(t))}function Lc(e,t){Ve(2,arguments);var n=en(t);return kc(e,-n)}var Uc=864e5;function Bc(e){Ve(1,arguments);var t=xt(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=t.getTime(),i=n-r;return Math.floor(i/Uc)+1}function Rr(e){Ve(1,arguments);var t=1,n=xt(e),r=n.getUTCDay(),i=(r<t?7:0)+r-t;return n.setUTCDate(n.getUTCDate()-i),n.setUTCHours(0,0,0,0),n}function Vs(e){Ve(1,arguments);var t=xt(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var i=Rr(r),s=new Date(0);s.setUTCFullYear(n,0,4),s.setUTCHours(0,0,0,0);var a=Rr(s);return t.getTime()>=i.getTime()?n+1:t.getTime()>=a.getTime()?n:n-1}function jc(e){Ve(1,arguments);var t=Vs(e),n=new Date(0);n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0);var r=Rr(n);return r}var Fc=6048e5;function Wc(e){Ve(1,arguments);var t=xt(e),n=Rr(t).getTime()-jc(t).getTime();return Math.round(n/Fc)+1}function Lr(e,t){var n,r,i,s,a,l,c,o;Ve(1,arguments);var u=Nr(),h=en((n=(r=(i=(s=t==null?void 0:t.weekStartsOn)!==null&&s!==void 0?s:t==null||(a=t.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&i!==void 0?i:u.weekStartsOn)!==null&&r!==void 0?r:(c=u.locale)===null||c===void 0||(o=c.options)===null||o===void 0?void 0:o.weekStartsOn)!==null&&n!==void 0?n:0);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var d=xt(e),f=d.getUTCDay(),g=(f<h?7:0)+f-h;return d.setUTCDate(d.getUTCDate()-g),d.setUTCHours(0,0,0,0),d}function Gs(e,t){var n,r,i,s,a,l,c,o;Ve(1,arguments);var u=xt(e),h=u.getUTCFullYear(),d=Nr(),f=en((n=(r=(i=(s=t==null?void 0:t.firstWeekContainsDate)!==null&&s!==void 0?s:t==null||(a=t.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&i!==void 0?i:d.firstWeekContainsDate)!==null&&r!==void 0?r:(c=d.locale)===null||c===void 0||(o=c.options)===null||o===void 0?void 0:o.firstWeekContainsDate)!==null&&n!==void 0?n:1);if(!(f>=1&&f<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var g=new Date(0);g.setUTCFullYear(h+1,0,f),g.setUTCHours(0,0,0,0);var m=Lr(g,t),A=new Date(0);A.setUTCFullYear(h,0,f),A.setUTCHours(0,0,0,0);var E=Lr(A,t);return u.getTime()>=m.getTime()?h+1:u.getTime()>=E.getTime()?h:h-1}function $c(e,t){var n,r,i,s,a,l,c,o;Ve(1,arguments);var u=Nr(),h=en((n=(r=(i=(s=t==null?void 0:t.firstWeekContainsDate)!==null&&s!==void 0?s:t==null||(a=t.locale)===null||a===void 0||(l=a.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&i!==void 0?i:u.firstWeekContainsDate)!==null&&r!==void 0?r:(c=u.locale)===null||c===void 0||(o=c.options)===null||o===void 0?void 0:o.firstWeekContainsDate)!==null&&n!==void 0?n:1),d=Gs(e,t),f=new Date(0);f.setUTCFullYear(d,0,h),f.setUTCHours(0,0,0,0);var g=Lr(f,t);return g}var Vc=6048e5;function Gc(e,t){Ve(1,arguments);var n=xt(e),r=Lr(n,t).getTime()-$c(n,t).getTime();return Math.round(r/Vc)+1}function de(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}var Hc={y:function(t,n){var r=t.getUTCFullYear(),i=r>0?r:1-r;return de(n==="yy"?i%100:i,n.length)},M:function(t,n){var r=t.getUTCMonth();return n==="M"?String(r+1):de(r+1,2)},d:function(t,n){return de(t.getUTCDate(),n.length)},a:function(t,n){var r=t.getUTCHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h:function(t,n){return de(t.getUTCHours()%12||12,n.length)},H:function(t,n){return de(t.getUTCHours(),n.length)},m:function(t,n){return de(t.getUTCMinutes(),n.length)},s:function(t,n){return de(t.getUTCSeconds(),n.length)},S:function(t,n){var r=n.length,i=t.getUTCMilliseconds(),s=Math.floor(i*Math.pow(10,r-3));return de(s,n.length)}};const Ft=Hc;var xn={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},zc={G:function(t,n,r){var i=t.getUTCFullYear()>0?1:0;switch(n){case"G":case"GG":case"GGG":return r.era(i,{width:"abbreviated"});case"GGGGG":return r.era(i,{width:"narrow"});case"GGGG":default:return r.era(i,{width:"wide"})}},y:function(t,n,r){if(n==="yo"){var i=t.getUTCFullYear(),s=i>0?i:1-i;return r.ordinalNumber(s,{unit:"year"})}return Ft.y(t,n)},Y:function(t,n,r,i){var s=Gs(t,i),a=s>0?s:1-s;if(n==="YY"){var l=a%100;return de(l,2)}return n==="Yo"?r.ordinalNumber(a,{unit:"year"}):de(a,n.length)},R:function(t,n){var r=Vs(t);return de(r,n.length)},u:function(t,n){var r=t.getUTCFullYear();return de(r,n.length)},Q:function(t,n,r){var i=Math.ceil((t.getUTCMonth()+1)/3);switch(n){case"Q":return String(i);case"QQ":return de(i,2);case"Qo":return r.ordinalNumber(i,{unit:"quarter"});case"QQQ":return r.quarter(i,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(i,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(i,{width:"wide",context:"formatting"})}},q:function(t,n,r){var i=Math.ceil((t.getUTCMonth()+1)/3);switch(n){case"q":return String(i);case"qq":return de(i,2);case"qo":return r.ordinalNumber(i,{unit:"quarter"});case"qqq":return r.quarter(i,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(i,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(i,{width:"wide",context:"standalone"})}},M:function(t,n,r){var i=t.getUTCMonth();switch(n){case"M":case"MM":return Ft.M(t,n);case"Mo":return r.ordinalNumber(i+1,{unit:"month"});case"MMM":return r.month(i,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(i,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(i,{width:"wide",context:"formatting"})}},L:function(t,n,r){var i=t.getUTCMonth();switch(n){case"L":return String(i+1);case"LL":return de(i+1,2);case"Lo":return r.ordinalNumber(i+1,{unit:"month"});case"LLL":return r.month(i,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(i,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(i,{width:"wide",context:"standalone"})}},w:function(t,n,r,i){var s=Gc(t,i);return n==="wo"?r.ordinalNumber(s,{unit:"week"}):de(s,n.length)},I:function(t,n,r){var i=Wc(t);return n==="Io"?r.ordinalNumber(i,{unit:"week"}):de(i,n.length)},d:function(t,n,r){return n==="do"?r.ordinalNumber(t.getUTCDate(),{unit:"date"}):Ft.d(t,n)},D:function(t,n,r){var i=Bc(t);return n==="Do"?r.ordinalNumber(i,{unit:"dayOfYear"}):de(i,n.length)},E:function(t,n,r){var i=t.getUTCDay();switch(n){case"E":case"EE":case"EEE":return r.day(i,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(i,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(i,{width:"short",context:"formatting"});case"EEEE":default:return r.day(i,{width:"wide",context:"formatting"})}},e:function(t,n,r,i){var s=t.getUTCDay(),a=(s-i.weekStartsOn+8)%7||7;switch(n){case"e":return String(a);case"ee":return de(a,2);case"eo":return r.ordinalNumber(a,{unit:"day"});case"eee":return r.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(s,{width:"short",context:"formatting"});case"eeee":default:return r.day(s,{width:"wide",context:"formatting"})}},c:function(t,n,r,i){var s=t.getUTCDay(),a=(s-i.weekStartsOn+8)%7||7;switch(n){case"c":return String(a);case"cc":return de(a,n.length);case"co":return r.ordinalNumber(a,{unit:"day"});case"ccc":return r.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(s,{width:"narrow",context:"standalone"});case"cccccc":return r.day(s,{width:"short",context:"standalone"});case"cccc":default:return r.day(s,{width:"wide",context:"standalone"})}},i:function(t,n,r){var i=t.getUTCDay(),s=i===0?7:i;switch(n){case"i":return String(s);case"ii":return de(s,n.length);case"io":return r.ordinalNumber(s,{unit:"day"});case"iii":return r.day(i,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(i,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(i,{width:"short",context:"formatting"});case"iiii":default:return r.day(i,{width:"wide",context:"formatting"})}},a:function(t,n,r){var i=t.getUTCHours(),s=i/12>=1?"pm":"am";switch(n){case"a":case"aa":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(t,n,r){var i=t.getUTCHours(),s;switch(i===12?s=xn.noon:i===0?s=xn.midnight:s=i/12>=1?"pm":"am",n){case"b":case"bb":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(t,n,r){var i=t.getUTCHours(),s;switch(i>=17?s=xn.evening:i>=12?s=xn.afternoon:i>=4?s=xn.morning:s=xn.night,n){case"B":case"BB":case"BBB":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(t,n,r){if(n==="ho"){var i=t.getUTCHours()%12;return i===0&&(i=12),r.ordinalNumber(i,{unit:"hour"})}return Ft.h(t,n)},H:function(t,n,r){return n==="Ho"?r.ordinalNumber(t.getUTCHours(),{unit:"hour"}):Ft.H(t,n)},K:function(t,n,r){var i=t.getUTCHours()%12;return n==="Ko"?r.ordinalNumber(i,{unit:"hour"}):de(i,n.length)},k:function(t,n,r){var i=t.getUTCHours();return i===0&&(i=24),n==="ko"?r.ordinalNumber(i,{unit:"hour"}):de(i,n.length)},m:function(t,n,r){return n==="mo"?r.ordinalNumber(t.getUTCMinutes(),{unit:"minute"}):Ft.m(t,n)},s:function(t,n,r){return n==="so"?r.ordinalNumber(t.getUTCSeconds(),{unit:"second"}):Ft.s(t,n)},S:function(t,n){return Ft.S(t,n)},X:function(t,n,r,i){var s=i._originalDate||t,a=s.getTimezoneOffset();if(a===0)return"Z";switch(n){case"X":return zs(a);case"XXXX":case"XX":return tn(a);case"XXXXX":case"XXX":default:return tn(a,":")}},x:function(t,n,r,i){var s=i._originalDate||t,a=s.getTimezoneOffset();switch(n){case"x":return zs(a);case"xxxx":case"xx":return tn(a);case"xxxxx":case"xxx":default:return tn(a,":")}},O:function(t,n,r,i){var s=i._originalDate||t,a=s.getTimezoneOffset();switch(n){case"O":case"OO":case"OOO":return"GMT"+Hs(a,":");case"OOOO":default:return"GMT"+tn(a,":")}},z:function(t,n,r,i){var s=i._originalDate||t,a=s.getTimezoneOffset();switch(n){case"z":case"zz":case"zzz":return"GMT"+Hs(a,":");case"zzzz":default:return"GMT"+tn(a,":")}},t:function(t,n,r,i){var s=i._originalDate||t,a=Math.floor(s.getTime()/1e3);return de(a,n.length)},T:function(t,n,r,i){var s=i._originalDate||t,a=s.getTime();return de(a,n.length)}};function Hs(e,t){var n=e>0?"-":"+",r=Math.abs(e),i=Math.floor(r/60),s=r%60;if(s===0)return n+String(i);var a=t||"";return n+String(i)+a+de(s,2)}function zs(e,t){if(e%60===0){var n=e>0?"-":"+";return n+de(Math.abs(e)/60,2)}return tn(e,t)}function tn(e,t){var n=t||"",r=e>0?"-":"+",i=Math.abs(e),s=de(Math.floor(i/60),2),a=de(i%60,2);return r+s+n+a}const qc=zc;var qs=function(t,n){switch(t){case"P":return n.date({width:"short"});case"PP":return n.date({width:"medium"});case"PPP":return n.date({width:"long"});case"PPPP":default:return n.date({width:"full"})}},Zs=function(t,n){switch(t){case"p":return n.time({width:"short"});case"pp":return n.time({width:"medium"});case"ppp":return n.time({width:"long"});case"pppp":default:return n.time({width:"full"})}},Zc=function(t,n){var r=t.match(/(P+)(p+)?/)||[],i=r[1],s=r[2];if(!s)return qs(t,n);var a;switch(i){case"P":a=n.dateTime({width:"short"});break;case"PP":a=n.dateTime({width:"medium"});break;case"PPP":a=n.dateTime({width:"long"});break;case"PPPP":default:a=n.dateTime({width:"full"});break}return a.replace("{{date}}",qs(i,n)).replace("{{time}}",Zs(s,n))},Kc={p:Zs,P:Zc};const Yc=Kc;var Jc=["D","DD"],Qc=["YY","YYYY"];function Xc(e){return Jc.indexOf(e)!==-1}function el(e){return Qc.indexOf(e)!==-1}function Ks(e,t,n){if(e==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(e==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var tl={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},nl=function(t,n,r){var i,s=tl[t];return typeof s=="string"?i=s:n===1?i=s.one:i=s.other.replace("{{count}}",n.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+i:i+" ago":i};const rl=nl;function ki(e){return function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=t.width?String(t.width):e.defaultWidth,r=e.formats[n]||e.formats[e.defaultWidth];return r}}var il={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},sl={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},al={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ol={date:ki({formats:il,defaultWidth:"full"}),time:ki({formats:sl,defaultWidth:"full"}),dateTime:ki({formats:al,defaultWidth:"full"})};const cl=ol;var ll={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ul=function(t,n,r,i){return ll[t]};const dl=ul;function zn(e){return function(t,n){var r=n!=null&&n.context?String(n.context):"standalone",i;if(r==="formatting"&&e.formattingValues){var s=e.defaultFormattingWidth||e.defaultWidth,a=n!=null&&n.width?String(n.width):s;i=e.formattingValues[a]||e.formattingValues[s]}else{var l=e.defaultWidth,c=n!=null&&n.width?String(n.width):e.defaultWidth;i=e.values[c]||e.values[l]}var o=e.argumentCallback?e.argumentCallback(t):t;return i[o]}}var hl={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},gl={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},fl={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},pl={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ml={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},yl={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},vl=function(t,n){var r=Number(t),i=r%100;if(i>20||i<10)switch(i%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},bl={ordinalNumber:vl,era:zn({values:hl,defaultWidth:"wide"}),quarter:zn({values:gl,defaultWidth:"wide",argumentCallback:function(t){return t-1}}),month:zn({values:fl,defaultWidth:"wide"}),day:zn({values:pl,defaultWidth:"wide"}),dayPeriod:zn({values:ml,defaultWidth:"wide",formattingValues:yl,defaultFormattingWidth:"wide"})};const wl=bl;function qn(e){return function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.width,i=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],s=t.match(i);if(!s)return null;var a=s[0],l=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?_l(l,function(h){return h.test(a)}):Al(l,function(h){return h.test(a)}),o;o=e.valueCallback?e.valueCallback(c):c,o=n.valueCallback?n.valueCallback(o):o;var u=t.slice(a.length);return{value:o,rest:u}}}function Al(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}function _l(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}function xl(e){return function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.match(e.matchPattern);if(!r)return null;var i=r[0],s=t.match(e.parsePattern);if(!s)return null;var a=e.valueCallback?e.valueCallback(s[0]):s[0];a=n.valueCallback?n.valueCallback(a):a;var l=t.slice(i.length);return{value:a,rest:l}}}var Sl=/^(\d+)(th|st|nd|rd)?/i,Tl=/\d+/i,El={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Cl={any:[/^b/i,/^(a|c)/i]},Ol={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Il={any:[/1/i,/2/i,/3/i,/4/i]},Pl={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},kl={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Dl={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ml={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Nl={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Rl={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ll={ordinalNumber:xl({matchPattern:Sl,parsePattern:Tl,valueCallback:function(t){return parseInt(t,10)}}),era:qn({matchPatterns:El,defaultMatchWidth:"wide",parsePatterns:Cl,defaultParseWidth:"any"}),quarter:qn({matchPatterns:Ol,defaultMatchWidth:"wide",parsePatterns:Il,defaultParseWidth:"any",valueCallback:function(t){return t+1}}),month:qn({matchPatterns:Pl,defaultMatchWidth:"wide",parsePatterns:kl,defaultParseWidth:"any"}),day:qn({matchPatterns:Dl,defaultMatchWidth:"wide",parsePatterns:Ml,defaultParseWidth:"any"}),dayPeriod:qn({matchPatterns:Nl,defaultMatchWidth:"any",parsePatterns:Rl,defaultParseWidth:"any"})},Ul={code:"en-US",formatDistance:rl,formatLong:cl,formatRelative:dl,localize:wl,match:Ll,options:{weekStartsOn:0,firstWeekContainsDate:1}};const Bl=Ul;var jl=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Fl=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Wl=/^'([^]*?)'?$/,$l=/''/g,Vl=/[a-zA-Z]/;function Gl(e,t,n){var r,i,s,a,l,c,o,u,h,d,f,g,m,A,E,_,p,v;Ve(2,arguments);var C=String(t),S=Nr(),P=(r=(i=n==null?void 0:n.locale)!==null&&i!==void 0?i:S.locale)!==null&&r!==void 0?r:Bl,b=en((s=(a=(l=(c=n==null?void 0:n.firstWeekContainsDate)!==null&&c!==void 0?c:n==null||(o=n.locale)===null||o===void 0||(u=o.options)===null||u===void 0?void 0:u.firstWeekContainsDate)!==null&&l!==void 0?l:S.firstWeekContainsDate)!==null&&a!==void 0?a:(h=S.locale)===null||h===void 0||(d=h.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&s!==void 0?s:1);if(!(b>=1&&b<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var x=en((f=(g=(m=(A=n==null?void 0:n.weekStartsOn)!==null&&A!==void 0?A:n==null||(E=n.locale)===null||E===void 0||(_=E.options)===null||_===void 0?void 0:_.weekStartsOn)!==null&&m!==void 0?m:S.weekStartsOn)!==null&&g!==void 0?g:(p=S.locale)===null||p===void 0||(v=p.options)===null||v===void 0?void 0:v.weekStartsOn)!==null&&f!==void 0?f:0);if(!(x>=0&&x<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!P.localize)throw new RangeError("locale must contain localize property");if(!P.formatLong)throw new RangeError("locale must contain formatLong property");var I=xt(e);if(!Rc(I))throw new RangeError("Invalid time value");var R=Mc(I),H=Lc(I,R),T={firstWeekContainsDate:b,weekStartsOn:x,locale:P,_originalDate:I},D=C.match(Fl).map(function(y){var k=y[0];if(k==="p"||k==="P"){var N=Yc[k];return N(y,P.formatLong)}return y}).join("").match(jl).map(function(y){if(y==="''")return"'";var k=y[0];if(k==="'")return Hl(y);var N=qc[k];if(N)return!(n!=null&&n.useAdditionalWeekYearTokens)&&el(y)&&Ks(y,t,String(e)),!(n!=null&&n.useAdditionalDayOfYearTokens)&&Xc(y)&&Ks(y,t,String(e)),N(H,y,P.localize,T);if(k.match(Vl))throw new RangeError("Format string contains an unescaped latin alphabet character `"+k+"`");return y}).join("");return D}function Hl(e){var t=e.match(Wl);return t?t[1].replace($l,"'"):e}function Zn(){return Gl(new Date,"OOOO")}function Ur(){let e=/^.+?(-|_)(.+?)($|-|_)/,t=[...typeof navigator<"u"?navigator.languages:[],Intl.DateTimeFormat().resolvedOptions().locale].map(n=>{var r;return(r=n.match(e))==null?void 0:r[2]}).find(n=>!!n);return t==null?void 0:t.toUpperCase()}var zl=13,Ys="abcdefghijklmnopqrstuvwxyz0123456789",ql=Ys.length;function Zl(){let e="";for(let t=0;t<zl;t++)e+=Ys.charAt(Math.floor(Math.random()*ql));return e}function Kl(e,t){if(typeof e=="string"&&(e=Yl(e.trim())),!e)return;let n=(t==null?void 0:t.removeGenericPrefixes)??!0,r=e.hostname;return n&&(r=r.replace(/^(m|mobile|amp|www|www1|www2|www3|tab|item|checkout|secure|user|account|accounts|web|app|open|i|v|preview|cdn|l|id|nid|user|sso|signin|login|auth0|play|api|click|detail|dashboard|console|manage|support|help)\./,"").replace(/.*\.zoom\.us/,"zoom.us").replace(/.*\.slack\.com/,"slack.com").replace(/.*\.wikipedia\.org/,"wikipedia.org").replace(/.*\.amazonaws\.com/,"amazonaws.com").replace(/.*\.netsuite\.com/,"netsuite.com").replace(/.*\.tumblr\.com/,"tumblr.com").replace(/.*\.deviantart\.com/,"deviantart.com")),{hostname:r,path:Jl(e.pathname)}}function Yl(e){if(!e)return;let t=n=>{let r=new URL(n);if(!/^https?:/.test(r.protocol))throw Error("Invalid URL, ignored protocol found");if(!r.hostname)throw Error("Invalid URL, no hostname");if(r.hostname.lastIndexOf(".")>=r.hostname.length-2)throw Error("Invalid URL, bad domain ending");return r};try{return t(e)}catch{}if(!e.includes("://"))try{return t("https://"+e)}catch{}}function Jl(e){return e.endsWith("/")?e.substring(0,Math.max(1,e.length-1)):e}var Di={exports:{}};(function(e,t){(function(n,r){var i="1.0.37",s="",a="?",l="function",c="undefined",o="object",u="string",h="major",d="model",f="name",g="type",m="vendor",A="version",E="architecture",_="console",p="mobile",v="tablet",C="smarttv",S="wearable",P="embedded",b=500,x="Amazon",I="Apple",R="ASUS",H="BlackBerry",T="Browser",D="Chrome",y="Edge",k="Firefox",N="Google",$="Huawei",j="LG",Z="Microsoft",M="Motorola",B="Opera",F="Samsung",W="Sharp",ce="Sony",Ot="Xiaomi",Ar="Zebra",dt="Facebook",_r="Chromium OS",xr="Mac OS",wi=function(ie,le){var X={};for(var ue in ie)le[ue]&&le[ue].length%2===0?X[ue]=le[ue].concat(ie[ue]):X[ue]=ie[ue];return X},zt=function(ie){for(var le={},X=0;X<ie.length;X++)le[ie[X].toUpperCase()]=ie[X];return le},Sr=function(ie,le){return typeof ie===u?qt(le).indexOf(qt(ie))!==-1:!1},qt=function(ie){return ie.toLowerCase()},Cs=function(ie){return typeof ie===u?ie.replace(/[^\d\.]/g,s).split(".")[0]:r},Tr=function(ie,le){if(typeof ie===u)return ie=ie.replace(/^\s\s*/,s),typeof le===c?ie:ie.substring(0,b)},pn=function(ie,le){for(var X=0,ue,At,_e,oe,Q,ht;X<le.length&&!Q;){var Gn=le[X],mn=le[X+1];for(ue=At=0;ue<Gn.length&&!Q&&Gn[ue];)if(Q=Gn[ue++].exec(ie),Q)for(_e=0;_e<mn.length;_e++)ht=Q[++At],oe=mn[_e],typeof oe===o&&oe.length>0?oe.length===2?typeof oe[1]==l?this[oe[0]]=oe[1].call(this,ht):this[oe[0]]=oe[1]:oe.length===3?typeof oe[1]===l&&!(oe[1].exec&&oe[1].test)?this[oe[0]]=ht?oe[1].call(this,ht,oe[2]):r:this[oe[0]]=ht?ht.replace(oe[1],oe[2]):r:oe.length===4&&(this[oe[0]]=ht?oe[3].call(this,ht.replace(oe[1],oe[2])):r):this[oe]=ht||r;X+=2}},Er=function(ie,le){for(var X in le)if(typeof le[X]===o&&le[X].length>0){for(var ue=0;ue<le[X].length;ue++)if(Sr(le[X][ue],ie))return X===a?r:X}else if(Sr(le[X],ie))return X===a?r:X;return ie},Os={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Ai={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},_i={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[A,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[A,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,A],[/opios[\/ ]+([\w\.]+)/i],[A,[f,B+" Mini"]],[/\bopr\/([\w\.]+)/i],[A,[f,B]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[A,[f,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[f,A],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[A,[f,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[A,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[A,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[A,[f,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[A,[f,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[A,[f,"Smart Lenovo "+T]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+T],A],[/\bfocus\/([\w\.]+)/i],[A,[f,k+" Focus"]],[/\bopt\/([\w\.]+)/i],[A,[f,B+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[A,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[A,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[A,[f,B+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[A,[f,"MIUI "+T]],[/fxios\/([-\w\.]+)/i],[A,[f,k]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 "+T]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 "+T],A],[/samsungbrowser\/([\w\.]+)/i],[A,[f,F+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],A],[/metasr[\/ ]?([\d\.]+)/i],[A,[f,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[f,"Sogou Mobile"],A],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[f,A],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,dt],A],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[f,A],[/\bgsa\/([\w\.]+) .*safari\//i],[A,[f,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[A,[f,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[A,[f,D+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,D+" WebView"],A],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[A,[f,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,A],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[A,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[A,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[A,Er,Os]],[/(webkit|khtml)\/([\w\.]+)/i],[f,A],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],A],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[A,[f,k+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,A],[/(cobalt)\/([\w\.]+)/i],[f,[A,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[E,"amd64"]],[/(ia32(?=;))/i],[[E,qt]],[/((?:i[346]|x)86)[;\)]/i],[[E,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[E,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[E,"armhf"]],[/windows (ce|mobile); ppc;/i],[[E,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[E,/ower/,s,qt]],[/(sun4\w)[;\)]/i],[[E,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[E,qt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[m,F],[g,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[m,F],[g,p]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[m,I],[g,p]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[m,I],[g,v]],[/(macintosh);/i],[d,[m,I]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[m,W],[g,p]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[m,$],[g,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[m,$],[g,p]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[m,Ot],[g,p]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[m,Ot],[g,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[m,"OPPO"],[g,p]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[m,"Vivo"],[g,p]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[m,"Realme"],[g,p]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[m,M],[g,p]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[m,M],[g,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[m,j],[g,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[m,j],[g,p]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[m,"Lenovo"],[g,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[m,"Nokia"],[g,p]],[/(pixel c)\b/i],[d,[m,N],[g,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[m,N],[g,p]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[m,ce],[g,p]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[m,ce],[g,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[m,"OnePlus"],[g,p]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[m,x],[g,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[m,x],[g,p]],[/(playbook);[-\w\),; ]+(rim)/i],[d,m,[g,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[m,H],[g,p]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[m,R],[g,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[m,R],[g,p]],[/(nexus 9)/i],[d,[m,"HTC"],[g,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[d,/_/g," "],[g,p]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[m,"Acer"],[g,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[m,"Meizu"],[g,p]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[m,"Ulefone"],[g,p]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,d,[g,p]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,d,[g,v]],[/(surface duo)/i],[d,[m,Z],[g,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[m,"Fairphone"],[g,p]],[/(u304aa)/i],[d,[m,"AT&T"],[g,p]],[/\bsie-(\w*)/i],[d,[m,"Siemens"],[g,p]],[/\b(rct\w+) b/i],[d,[m,"RCA"],[g,v]],[/\b(venue[\d ]{2,7}) b/i],[d,[m,"Dell"],[g,v]],[/\b(q(?:mv|ta)\w+) b/i],[d,[m,"Verizon"],[g,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[m,"Barnes & Noble"],[g,v]],[/\b(tm\d{3}\w+) b/i],[d,[m,"NuVision"],[g,v]],[/\b(k88) b/i],[d,[m,"ZTE"],[g,v]],[/\b(nx\d{3}j) b/i],[d,[m,"ZTE"],[g,p]],[/\b(gen\d{3}) b.+49h/i],[d,[m,"Swiss"],[g,p]],[/\b(zur\d{3}) b/i],[d,[m,"Swiss"],[g,v]],[/\b((zeki)?tb.*\b) b/i],[d,[m,"Zeki"],[g,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],d,[g,v]],[/\b(ns-?\w{0,9}) b/i],[d,[m,"Insignia"],[g,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[m,"NextBook"],[g,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],d,[g,p]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],d,[g,p]],[/\b(ph-1) /i],[d,[m,"Essential"],[g,p]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[m,"Envizen"],[g,v]],[/\b(trio[-\w\. ]+) b/i],[d,[m,"MachSpeed"],[g,v]],[/\btu_(1491) b/i],[d,[m,"Rotor"],[g,v]],[/(shield[\w ]+) b/i],[d,[m,"Nvidia"],[g,v]],[/(sprint) (\w+)/i],[m,d,[g,p]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[m,Z],[g,p]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[m,Ar],[g,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[m,Ar],[g,p]],[/smart-tv.+(samsung)/i],[m,[g,C]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[m,F],[g,C]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,j],[g,C]],[/(apple) ?tv/i],[m,[d,I+" TV"],[g,C]],[/crkey/i],[[d,D+"cast"],[m,N],[g,C]],[/droid.+aft(\w+)( bui|\))/i],[d,[m,x],[g,C]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[m,W],[g,C]],[/(bravia[\w ]+)( bui|\))/i],[d,[m,ce],[g,C]],[/(mitv-\w{5}) bui/i],[d,[m,Ot],[g,C]],[/Hbbtv.*(technisat) (.*);/i],[m,d,[g,C]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,Tr],[d,Tr],[g,C]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,C]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,d,[g,_]],[/droid.+; (shield) bui/i],[d,[m,"Nvidia"],[g,_]],[/(playstation [345portablevi]+)/i],[d,[m,ce],[g,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[m,Z],[g,_]],[/((pebble))app/i],[m,d,[g,S]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[m,I],[g,S]],[/droid.+; (glass) \d/i],[d,[m,N],[g,S]],[/droid.+; (wt63?0{2,3})\)/i],[d,[m,Ar],[g,S]],[/(quest( 2| pro)?)/i],[d,[m,dt],[g,S]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[g,P]],[/(aeobc)\b/i],[d,[m,x],[g,P]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[g,p]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[g,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,p]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[A,[f,y+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[A,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[f,A],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[A,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,A],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[f,[A,Er,Ai]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[A,Er,Ai],[f,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[A,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,xr],[A,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[A,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,A],[/\(bb(10);/i],[A,[f,H]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[A,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[A,[f,k+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[A,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[A,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[A,[f,D+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,_r],A],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,A],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],A],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[f,A]]},rt=function(ie,le){if(typeof ie===o&&(le=ie,ie=r),!(this instanceof rt))return new rt(ie,le).getResult();var X=typeof n!==c&&n.navigator?n.navigator:r,ue=ie||(X&&X.userAgent?X.userAgent:s),At=X&&X.userAgentData?X.userAgentData:r,_e=le?wi(_i,le):_i,oe=X&&X.userAgent==ue;return this.getBrowser=function(){var Q={};return Q[f]=r,Q[A]=r,pn.call(Q,ue,_e.browser),Q[h]=Cs(Q[A]),oe&&X&&X.brave&&typeof X.brave.isBrave==l&&(Q[f]="Brave"),Q},this.getCPU=function(){var Q={};return Q[E]=r,pn.call(Q,ue,_e.cpu),Q},this.getDevice=function(){var Q={};return Q[m]=r,Q[d]=r,Q[g]=r,pn.call(Q,ue,_e.device),oe&&!Q[g]&&At&&At.mobile&&(Q[g]=p),oe&&Q[d]=="Macintosh"&&X&&typeof X.standalone!==c&&X.maxTouchPoints&&X.maxTouchPoints>2&&(Q[d]="iPad",Q[g]=v),Q},this.getEngine=function(){var Q={};return Q[f]=r,Q[A]=r,pn.call(Q,ue,_e.engine),Q},this.getOS=function(){var Q={};return Q[f]=r,Q[A]=r,pn.call(Q,ue,_e.os),oe&&!Q[f]&&At&&At.platform!="Unknown"&&(Q[f]=At.platform.replace(/chrome os/i,_r).replace(/macos/i,xr)),Q},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ue},this.setUA=function(Q){return ue=typeof Q===u&&Q.length>b?Tr(Q,b):Q,this},this.setUA(ue),this};rt.VERSION=i,rt.BROWSER=zt([f,A,h]),rt.CPU=zt([E]),rt.DEVICE=zt([d,m,g,_,p,C,v,S,P]),rt.ENGINE=rt.OS=zt([f,A]),e.exports&&(t=e.exports=rt),t.UAParser=rt;var Zt=typeof n!==c&&(n.jQuery||n.Zepto);if(Zt&&!Zt.ua){var Vn=new rt;Zt.ua=Vn.getResult(),Zt.ua.get=function(){return Vn.getUA()},Zt.ua.set=function(ie){Vn.setUA(ie);var le=Vn.getResult();for(var X in le)Zt.ua[X]=le[X]}}})(typeof window=="object"?window:Je)})(Di,Di.exports);var Ql=Di.exports;const Mi=Qe(Ql),Ge=ke.createScopedLog("Amplitude");let De;const Js={installIdKey:"install-id",initialized:null,installId:null,browser:null,os:null,version:null,sessionId:null,sampleGroup:null,enabled:null,initAPI(e){return De=e,De.mixin("Analytics",{init:this.init.bind(this),event:this.event.bind(this),bindHtmlEvents:this.bindHtmlEvents.bind(this)})},async init(){if(this.initialized!=null)Ge==null||Ge("init","Amplitude already initialized",{sessionId:this.sessionId},"DEBUG");else{const{promise:e,resolve:t}=De.Utils.getDecoupledPromise();this.initialized=e;const n=new Mi(navigator.userAgent);this.sessionId=Date.now(),this.os=n.getOS(),this.browser=n.getBrowser(),this.version=De.Chrome.Extension.getVersion(),this.sampleGroup=await De.Storage.getOrSet("analyticsSamplingGroup",100*Math.random());const r=De.Settings.get("hasAcceptedPrivacyPolicy")??!0,i=!0;this.enabled=r&&i,this.installId=await De.Storage.get(this.installIdKey),this.installId||(this.installId=Zl(),await De.Storage.set({[this.installIdKey]:this.installId})),t(),Ge==null||Ge("init","Initialized Amplitude",this,"INFO")}},async event(e,t){if(!this.initialized){Ge==null||Ge("event","Cannot report event until initialized",this,"WARN");return}const n=Date.now();await this.initialized;const r=De.RemoteConfig.get("amplitudeSampling"),i=De.RemoteConfig.get("defaultAmplitudeSampling"),s=r[e]??i,a=this.sampleGroup<s,l=this.enabled&&a,c={event_type:e,user_id:this.installId,user_properties:{hasAcceptedToS:!!De.Settings.get("hasAcceptedToS"),hasAcceptedPrivacyPolicy:!!De.Settings.get("hasAcceptedPrivacyPolicy"),explicitlyDeclinedPrivacyPolicy:!!De.Settings.get("explicitlyDeclinedPrivacyPolicy"),isNewUser:!!De.Settings.get("isNewUser"),is18OrOlder:De.Settings.get("is18OrOlder"),age:De.Settings.get("age")},time:n,event_properties:{page:`${location.protocol}//${location.hostname}${location.pathname}`,...t},app_version:this.version,os_name:this.browser.name,os_version:this.browser.version,platform:this.os.name};Ge==null||Ge("event",l?"Reported event":"Skipped event",{event:c,samplePercentInt:s,isSampled:a,thisEnabled:this.enabled},"DEBUG"),l&&await De.AmplitudeAPI.uploadEvents(c)},bindHtmlEvents(){Ge==null||Ge("bindHtmlEvents","Binding amplitude events to DOM",void 0,"DEBUG");const e="data-analytics-click";document.querySelectorAll(`*[${e}]`).forEach(n=>{n.addEventListener("click",r=>{var a;const i=r.target,s=(a=i==null?void 0:i.getAttribute)==null?void 0:a.call(i,e);s&&this.event(s)})});const t="data-analytics-toggle";document.querySelectorAll(`*[${t}]`).forEach(n=>{n.addEventListener("change",r=>{var l;const i=r.target,s=i==null?void 0:i.checked,a=(l=i==null?void 0:i.getAttribute)==null?void 0:l.call(i,t);a&&this.event(a,{checked:s})})})}},Xl=ke.createScopedLog("AmplitudeAPI"),eu={baseUrl:"https://api2.amplitude.com",apiKey:"07de81d51a94380a82c075614cd12f6e",initAPI(e){return e.mixin("AmplitudeAPI",{uploadEvents:this.uploadEvents.bind(this)})},async uploadEvents(...e){return await fetch(`${this.baseUrl}/batch`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify({api_key:this.apiKey,events:e})}).catch(t=>{Xl("uploadEvents","Failed to upload event",t,"WARN")})}},tu={initAPI(e){return e.mixin("Chrome",{Extension:{addListener:this.exists("runtime")?this.addRuntimeListener.bind(this):this.throwMisusedAPIException,connect:this.exists("runtime","connect")?chrome.runtime.connect.bind(chrome.runtime):this.throwMisusedAPIException,getID:this.exists("runtime")?function(){return chrome.runtime.id}:this.throwMisusedAPIException,getURL:this.exists("extension","getURL")?chrome.extension.getURL.bind(chrome.extension):this.throwMisusedAPIException,reload:this.exists("runtime","reload")?chrome.runtime.reload.bind(chrome.runtime):this.throwMisusedAPIException,getVersion:this.exists("runtime","getManifest")?this.getVersion.bind(this):this.throwMisusedAPIException,setUninstallURL:this.exists("runtime","setUninstallURL")?chrome.runtime.setUninstallURL.bind(chrome.runtime):this.throwMisusedAPIException},Message:{on:chrome.runtime.onMessage,send:this.exists("runtime","sendMessage")?chrome.runtime.sendMessage.bind(chrome.runtime):this.throwMisusedAPIException,sendToTab:this.exists("tabs","sendMessage")?chrome.tabs.sendMessage.bind(chrome.tabs):this.throwMisusedAPIException},Notification:{create:this.exists("notifications","create")?chrome.notifications.create.bind(chrome.notifications):this.throwMisusedAPIException,clear:this.exists("notifications","clear")?chrome.notifications.clear.bind(chrome.notifications):this.throwMisusedAPIException},Storage:{addListener:this.exists("storage")?this.addStorageListener.bind(this):this.throwMisusedAPIException,getLocal:this.exists("storage")?chrome.storage.local.get.bind(chrome.storage.local):this.throwMisusedAPIException,getSync:this.exists("storage")?chrome.storage.sync.get.bind(chrome.storage.sync):this.throwMisusedAPIException,removeLocal:this.exists("storage")?chrome.storage.local.remove.bind(chrome.storage.local):this.throwMisusedAPIException,removeSync:this.exists("storage")?chrome.storage.sync.remove.bind(chrome.storage.sync):this.throwMisusedAPIException,setLocal:this.exists("storage")?chrome.storage.local.set.bind(chrome.storage.local):this.throwMisusedAPIException,setSync:this.exists("storage")?chrome.storage.sync.set.bind(chrome.storage.sync):this.throwMisusedAPIException},Tab:{addListener:this.exists("tabs")?this.addTabsListener.bind(this):this.throwMisusedAPIException,create:this.exists("tabs","create")?chrome.tabs.create.bind(chrome.tabs):this.throwMisusedAPIException,getAllInWindow:this.exists("tabs","query")?this.getAllTabsInWindow.bind(this):this.throwMisusedAPIException,getCurrent:this.exists("tabs","getCurrent")?chrome.tabs.getCurrent.bind(chrome.tabs):this.throwMisusedAPIException,getSelected:this.exists("tabs","query")?this.getSelectedTab.bind(this):this.throwMisusedAPIException,remove:this.exists("tabs","remove")?chrome.tabs.remove.bind(chrome.tabs):this.throwMisusedAPIException,update:this.exists("tabs","update")?chrome.tabs.update.bind(chrome.tabs):this.throwMisusedAPIException,get:this.exists("tabs","get")?chrome.tabs.get.bind(chrome.tabs):this.throwMisusedAPIException},Translation:{get:this.exists("i18n","getMessage")?chrome.i18n.getMessage.bind(chrome.i18n):this.throwMisusedAPIException},Window:{addListener:this.exists("windows")?this.addWindowsListener.bind(this):this.throwMisusedAPIException,getLastFocused:this.exists("windows","getLastFocused")?chrome.windows.getLastFocused.bind(chrome.windows):this.throwMisusedAPIException},Alarms:{addListener:this.exists("alarms")?this.addAlarmsListener.bind(this):this.throwMisusedAPIException,ensure:this.exists("alarms")?this.ensureAlarm.bind(this):this.throwMisusedAPIException}})},getSelectedTab:function(e,t){const n={active:!0};e?n.windowId=e:n.currentWindow=!0,chrome.tabs.query(n,function(r){const i=r[0];typeof t=="function"&&t(i)})},getAllTabsInWindow:function(e,t){const n={};e?n.windowId=e:n.currentWindow=!0,chrome.tabs.query(n,function(r){typeof t=="function"&&t(r)})},getVersion(){return chrome.runtime.getManifest().version},async ensureAlarm(e,t){return new Promise(n=>{chrome.alarms.get(e,r=>{r||chrome.alarms.create(e,t),n()})})},addRuntimeListener:function(e,t){this.addListener("runtime",e,t)},addStorageListener:function(e,t){this.addListener("storage",e,t)},addTabsListener:function(e,t){this.addListener("tabs",e,t)},addWindowsListener:function(e,t){this.addListener("windows",e,t)},addAlarmsListener(e,t){this.addListener("alarms",e,t)},addListener:function(e,t,n){const r=e,i=t;typeof chrome[r][i]<"u"&&chrome[r][i].addListener(n)},exists:function(e,t){const n=e,r=t;let i=chrome&&typeof chrome[n]=="object";return i&&r&&(i=typeof chrome[n][r]=="function"),i},throwMisusedAPIException:function(){throw new Error("Improper use of chrome API in content script!")}},nu={initAPI(e){return e.mixin("Date",this)},parseMilitaryTime:function(e){const t=e.split(":");let n=parseInt(t[0],10);const r=parseInt(t[1],10),i=n>=12?"pm":"am";n=n>=12?n-12:n;const s=n===0?12:n,a=i==="pm"?Y.Chrome.Translation.get("timePM"):Y.Chrome.Translation.get("timeAM");return{hour:this.toTwoDigits(s),min:this.toTwoDigits(r),ampm:i,display:s+":"+this.toTwoDigits(r)+" "+a}},timestampToDisplayDate:function(e){const t=new Date(e),n={},r=t.getMonth()+1,i=t.getDate(),s=t.getHours(),a=t.getMinutes();return n.year=t.getFullYear(),n.month=this.toTwoDigits(r),n.day=this.toTwoDigits(i),n.minutes=this.toTwoDigits(a),n.ampm=s>=12?Y.Chrome.Translation.get("timePM"):Y.Chrome.Translation.get("timeAM"),n.hours=s>12?s-12:s,n.hours===0&&(n.hours=12,n.ampm=Y.Chrome.Translation.get("timeAM")),n},hasTimePassed:function(e,t,n,r=new Date){e=n==="pm"?parseInt(e,10)+12:e;const i=r.toDateString();return new Date(i+" "+e+":"+t)<r},secondsUntilTime:function(e,t,n,r=new Date){e=n==="pm"?parseInt(e,10)+12:e;const i=r.toDateString(),a=new Date(i+" "+e+":"+t).getTime()-r.getTime();return Math.floor(a/1e3)},minutesUntilTime:function(e,t,n,r){const i=this.secondsUntilTime(e,t,n,r);return Math.floor(i/60)},getTodayDateObj:function(e,t,n,r=new Date){e=n==="pm"?parseInt(e,10)+12:e;const i=r.toDateString();return new Date(i+" "+e+":"+t)},hoursToMilliseconds:function(e){return parseFloat(e)*60*60*1e3},timeUnitToMilliseconds:function(e,t){if(!this.isValidTimeUnit(t))throw new Error('[DateUtils.timeUnitToMilliseconds()] Could not convert time unit to milliseconds. "'+t+'" is not a valid time unit.');return e=parseFloat(e),this.isValidHourUnit(t)?e*60*60*1e3:this.isValidMinUnit(t)?e*60*1e3:this.isValidSecUnit(t)?e*1e3:e},isValidTime:function(e,t){if(typeof e!="string"||e.indexOf(":")!==2||e.length!==5)return!1;t=t===12?12:24;const n=e.split(":"),r=parseInt(n[0]),i=parseInt(n[1]);return i>=0&&i<=59&&(t===12&&r>=1&&r<=12||t===24&&r>=0&&r<=23)},isValidTimeUnit:function(e){return this.isValidHourUnit(e)||this.isValidMinUnit(e)||this.isValidSecUnit(e)||this.isValidMSUnit(e)},isValidHourUnit:function(e){return typeof e=="string"&&(e.indexOf("hour")===0||e.indexOf("hr")===0||e==="h")},isValidMinUnit:function(e){return typeof e=="string"&&(e.indexOf("min")===0||e==="m")},isValidSecUnit:function(e){return typeof e=="string"&&(e.indexOf("sec")===0||e==="s")},isValidMSUnit:function(e){return typeof e=="string"&&(e.indexOf("millis")===0||e==="ms")},dayNumToDay:function(e,t){if(e<0||e>6)throw new Error("[DateUtils.dayNumToDay()] Day num must be between 0 and 6");return t===!0?["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e]:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]},getDaysInMonth:function(e,t){const n=new Date;return e=e||n.getMonth(),t=t||n.getYear(),32-new Date(t,e,32).getDate()},secondsToMinsAndSecs:function(e){return e/60===Math.floor(e/60)?e/60+" minutes":Math.floor(e/60)+" minutes and "+(e-Math.floor(e/60)*60)+" seconds"},toTwoDigits:function(e){return e<10?"0"+e:e.toString()},getYMD:function(e){e=e||new Date;const t=this.toTwoDigits(e.getMonth()+1),n=this.toTwoDigits(e.getDate());return e.getFullYear()+"-"+t+"-"+n}},Me=ke.createScopedLog("DomainParser"),Qs={initAPI(e){return e.mixin("Domain",{extractBaseDomain:this.extractBaseDomain.bind(this),extractFullDomain:this.extractFullDomain.bind(this),isMoreGeneralURL:this.isMoreGeneralURL.bind(this),matchesWildcard:this.matchesWildcard.bind(this)})},extractFullDomain:function(e){if(!e)return null;Me("extractFullDomain","Extracting full domain from",e,"TRACE");const t=e.match(/^(.[^/]*?:\/\/)?(.[^/]+)/);if(t===null||t.length<2)return e.split("/")[0];let n=t[2];return n.startsWith("www.")&&(n=n.replace("www.","")),n},extractBaseDomain:function(e){Me("extractBaseDomain","Extracting base domain from",e,"TRACE");const t=this.extractFullDomain(e);if(!t||t.length===0)return"";const n=t.split(".");if(n.length===1)return t;let r=n[n.length-1];return r=n[n.length-2]+"."+r,this.isMultiPartDomain(t)&&(r=n[n.length-3]+"."+r),r},isMultiPartDomain:function(e){const t="Is "+e+" multi-part domain?",n=e.split(".");let r=[];if(n.length===1)return Me("isMultiPartDomain",t,"NO","TRACE"),!1;const i=n[n.length-2];if(i.length===1||i.length===2&&n.length>3)return Me("isMultiPartDomain",t,"YES","TRACE"),!0;if(i.length===3&&n.length>=3){r=["com","edu","gov","mil","net","org","biz","www","pro","int","web","xxx"];for(const s in r)if(r.hasOwnProperty(s)&&i===r[s])return Me("isMultiPartDomain",t,"YES","TRACE"),!0}if(i.length===4&&n.length>=3){r=["info","mobi","name","jobs","kiwi","aero","asia","coop"];for(const s in r)if(r.hasOwnProperty(s)&&i===r[s])return Me("isMultiPartDomain",t,"YES","TRACE"),!0}if(n.length>=3){const s=n[n.length-3];if(i.length===2&&n.length===3&&s.length>2&&s!=="www")return Me("isMultiPartDomain",t,"YES","TRACE"),!0}return Me("isMultiPartDomain",t,"NO","TRACE"),!1},isMoreGeneralURL:function(e,t){e=typeof e=="string"?e.toLowerCase():e,t=typeof t=="string"?t.toLowerCase():t;const n="Is "+e+" more general than "+t+"?";if(e=="chrome-extension://"&&(t==null?void 0:t.indexOf(e))==0)return!0;if(e=this.stripProtocol(e),t=this.stripProtocol(t),e==""&&t!="")return!1;const r=this.extractBaseDomain(t);if(e===t||e===r||t.indexOf(e)===0)return Me("isMoreGeneralURL",n,"YES","TRACE"),!0;const i=this.extractBaseDomain(e);return i===r&&e.length<=t.length&&t.indexOf(e)>=0&&(t.indexOf("/")>=0||t.indexOf("?")>=0)||r.length>i.length&&r.indexOf(e)>-1?(Me("isMoreGeneralURL",n,"YES","TRACE"),!0):(Me("isMoreGeneralURL",n,"NO","TRACE"),!1)},matchesWildcard:function(e,t){if(e.indexOf("*")==-1)return;const n="Does "+t+" match wildcard "+e+"?";e=e.toLowerCase(),t=t.toLowerCase();const r=e.replace("*","");if(t=t||"",t.indexOf(r)===-1)return Me("matchesWildcard",n,"NO","TRACE"),!1;const i=t.substring(0,t.indexOf(r)+r.length),a=t.substring(i.length-r.length,i.length)===r;return Me("matchesWildcard",n,a?"YES":"NO","TRACE"),a},stripProtocol:function(e){return e?e.indexOf("://")>-1?e.slice(e.indexOf("://")+3,e.length):e:""}};let nn;function Xs(){return nn.RemoteConfig.get("incrementalRollout")}const ru=e=>({storageKey:`@incrementalRollout/${e}`,async getMyPercent(){return nn.Storage.getOrSet(this.storageKey,Math.random())},async getEnabledPercent(){return(await Xs())[e]??0},async isEnabled(){const t=await this.getEnabledPercent();return await this.getMyPercent()<t},async debug(){Dr.log("IncrementalRollout","Incremental rollout info:",{isEnabled:await this.isEnabled(),myPercent:await this.getMyPercent(),enabledPercent:await this.getEnabledPercent(),remoteConfig:await Xs()},"DEBUG")},async enable(){await nn.Storage.set({[this.storageKey]:-1})},async disable(){await nn.Storage.set({[this.storageKey]:2})},async randomize(){await nn.Storage.set({[this.storageKey]:Math.random()})}}),iu={initAPI(e){return nn=e,nn.mixin("IncrementalRollout",{AdFinder:ru("ad-finder")})}};let Ce;const su={initialized:null,onboardingSampleGroup:null,initAPI(e){return Ce=e,Ce.mixin("Requirements",{init:this.init.bind(this),isOnboardingCompleted:this.isOnboardingCompleted.bind(this),getPromptAgainAt:this.getPromptAgainAt.bind(this),setPromptAgainAt:this.setPromptAgainAt.bind(this),getOnboardingShownCount:this.getOnboardingShownCount.bind(this),incrementOnboardingShownCount:this.incrementOnboardingShownCount.bind(this),getConfirmationCount:this.getConfirmationCount.bind(this),incrementConfirmationCount:this.incrementConfirmationCount.bind(this),isUnder18:this.isUnder18.bind(this)})},async init(){if(this.initialized!=null)return;const{promise:e,resolve:t,reject:n}=Ce.Utils.getDecoupledPromise();this.initialized=e,this.onboardingSampleGroup=await Ce.Storage.getOrSet("onboardingSampleGroup",100*Math.random());try{await Promise.all([Ce.Settings.initAsync(),Ce.RemoteConfig.init()]),t()}catch(r){n(r)}},async isOnboardingCompleted(){const e=Date.now();if(this.initialized==null)throw Error("You must call `API.Requirements.init()` before calling `isOnboardingCompleted()`");await this.initialized;const t=Ce.RemoteConfig.get("onboardingEnabledPercentInt2");if(!(this.onboardingSampleGroup<t)||this.isUnder18()||Ce.Settings.get("explicitlyDeclinedPrivacyPolicy"))return!0;if(!Ce.Settings.get("hasAcceptedToS"))return!1;const a=Ce.Settings.get("hasAcceptedPrivacyPolicy"),l=await this.getPromptAgainAt(),c=await this.getConfirmationCount();return!!a||e<l||c>3},async getPromptAgainAt(){return await Ce.Storage.get("showOnboardingAgainAt")??0},setPromptAgainAt(e){return Ce.Storage.set({showOnboardingAgainAt:e})},async getOnboardingShownCount(){return await Ce.Storage.get("onboardingShownCount")??0},async incrementOnboardingShownCount(){const e=await this.getOnboardingShownCount();await Ce.Storage.set({onboardingShownCount:e+1})},async getConfirmationCount(){return await Ce.Storage.get("privacyPolicyConfirmationCount")??0},async incrementConfirmationCount(){const e=await this.getConfirmationCount();await Ce.Storage.set({privacyPolicyConfirmationCount:e+1})},isUnder18(){if(Ce.Settings.get("is18OrOlder"))return!1;const t=Ce.Settings.get("age");return t&&t<18},isEffectiveHourOfDay(){const e=[3,22,13,9,8,5,11,2,12,14,4,1],t=new Date().getHours();return!e.includes(t)}},xe=ke.createScopedLog("Storage");let et;const He={LOCAL:1,SYNC:2,map:null,cache:{},initAPI:function(e){return et=e,et.mixin("Storage",{addOnChangeListener:this.addOnChangeListener.bind(this),init:this.init.bind(this),initAsync:this.initAsync.bind(this),get:this.get.bind(this),getOrSet:this.getOrSet.bind(this),getAll:this.getAll.bind(this),set:this.set.bind(this),merge:this.merge.bind(this),remove:this.remove.bind(this),setBucket:this.setBucket.bind(this)})},init:async function(e){xe("init","Initializing storage",null,"DEBUG"),this.cache={},this.map=null;const t=await this.getSynced("storageMap");xe("init","Storage initialization complete",t,"DEBUG"),typeof t<"u"?this.map=t:(this.map={},await this.saveMap()),typeof e=="function"&&e()},initAsync(){return new Promise(e=>this.init(e))},get:async function(e,t=!1){let n;return this.inCache(e)&&!t?n=this.getCached(e):this.inSync(e)?n=await this.getSynced(e):n=await this.getLocal(e),n},async getOrSet(e,t,n=!1){let r=await this.get(e,n);return r==null&&(r=t,await this.set({[e]:r})),r},refresh:async function(e){return await this.get(e,!0)},getAll:async function(e){const t=typeof e=="string"?e.toUpperCase():e;if(t){if(t==="SYNC")return await et.Chrome.Storage.getSync(null);if(t==="LOCAL")return await et.Chrome.Storage.getLocal(null)}else{const n={},[r,i]=await Promise.all([et.Chrome.Storage.getSync(null),et.Chrome.Storage.getLocal(null)]);return n.SYNC=r,n.LOCAL=i,n}return{}},set:async function(e,t=null){const n=typeof t=="string"?t.toUpperCase():null,r={},i={};let s=!1,a=!1;for(const c in e)e.hasOwnProperty(c)&&(this.inSync(c)||n==="SYNC"?(r[c]=e[c],s=!0):(i[c]=e[c],a=!0));const l=[];s&&l.push(this.setSynced(r)),a&&l.push(this.setLocal(i)),await Promise.all(l)},remove:async function(e,t){var n;this.inSync(e)||t==="SYNC"?await this.removeSynced(e):await this.removeLocal(e),typeof((n=this.map)==null?void 0:n[e])<"u"&&(delete this.map[e],await this.saveMap())},merge:async function(e,t,n){if(xe("merge","Merging "+e+" from "+n+" to "+t,null,"TRACE"),n==="SYNC"){const r=await this.getSynced(e),i=await this.getLocal(e);await this.doMerge(e,t,i,r)}else if(n==="LOCAL"){const r=await this.getLocal(e),i=await this.getSynced(e);await this.doMerge(e,t,i,r)}},doMerge:async function(e,t,n,r){n=It.isObjLiteral(n)?n:{},r=It.isObjLiteral(r)?r:{},await this.remove(e),await this.setBucket(e,t,!0);const i={};i[e]=It.merge(n,r,!0),await this.set(i)},setBucket:async function(e,t,n=!1){if(this.isArray(e)){const r=e;for(let i=0;i<r.length;i++)await this.setBucket(r[i],t,n)}else if(typeof e=="string"){const r=e;typeof t=="string"&&(t=t.toUpperCase()),t=typeof this[t]<"u"?t:"LOCAL",xe("setBucket","Adding "+r+" to "+t+" storage bucket",null,"TRACE"),this.map[r]=this[t],await this.saveMap(),n!==!0&&await this.migrate(r,t)}},saveMap:async function(e){const t=e??this.map;await this.setSynced({storageMap:t})},migrate:async function(e,t){const n=t==="SYNC"?"LOCAL":"SYNC";if(xe("migrate","Migrating "+e+" from "+n+" to "+t,null,"DEBUG"),t==="SYNC"){const r=await this.getLocal(e),i={};i[e]=r,await this.removeLocal(e),await this.setSynced(i)}else if(t==="LOCAL"){const r=await this.getSynced(e),i={};i[e]=r,await this.removeSynced(e),await this.setLocal(i)}},addOnChangeListener:function(e){e=typeof e=="function"?e:function(){},et.Chrome.Storage.addListener("onChanged",e)},inCache:function(e){return typeof this.cache[e]<"u"},inSync:function(e){return this.map[e]===this.SYNC},inLocal:function(e){return this.map[e]===this.LOCAL},setCached:function(e){xe("setCached","Storing items in cache",e,"TRACE");for(const t in e)e.hasOwnProperty(t)&&(this.cache[t]=e[t])},getCached:function(e){return xe("getCached","Getting "+e+" from cache",null,"TRACE"),this.cache[e]},removeCached:function(e){xe("removeCached","Removing "+e+" from cache",null,"TRACE"),delete this.cache[e]},setSynced:async function(e,t=()=>{}){xe("setSynced","Storing items in sync storage",e,"TRACE"),this.setCached(e),await et.Chrome.Storage.setSync(e,t)},getSynced:async function(e){xe("getSynced","Getting "+e+" from sync storage",null,"TRACE");const t=await et.Chrome.Storage.getSync(e);return typeof e=="string"?(xe("getSynced",e+" retrieved from sync storage:",t[e],"TRACE"),this.setCached(t),t[e]):(xe("getSynced","Data retrieved from sync storage:",t,"TRACE"),t)},removeSynced:async function(e){xe("removeSynced","Removing "+e+" from sync storage",null,"TRACE"),this.removeCached(e),await et.Chrome.Storage.removeSync(e)},setLocal:async function(e){xe("setLocal","Storing items in Chrome local storage",e,"TRACE"),this.setCached(e),await et.Chrome.Storage.setLocal(e)},getLocal:async function(e){xe("getLocal","Getting data from Chrome local storage",e,"TRACE");let t=await et.Chrome.Storage.getLocal(e);if(typeof e=="string"){t=t||{};let n=t[e];(typeof n>"u"||n===null)&&(n=await this.getFromLocalStorageBackup(e)),xe("getLocal",e+" retrieved from local storage:",n,"TRACE");const r={};return r[e]=n,this.setCached(r),n}else return xe("getLocal","Data retrieved from local storage:",t,"TRACE"),t},getFromLocalStorageBackup:async function(e){xe("getFromLocalStorageBackup","Getting "+e+" from HTML5 localStorage",null,"TRACE");let t=null;const n=await chrome.storage.local.get(e);if(n==null)return null;const r=n[e];if(typeof r<"u"&&r!==null){xe("getLocal",e+" found in HTML5 localStorage:",r,"TRACE");try{t=JSON.parse(r)}catch{t=r}const i={};i[e]=t,await this.setLocal(i)}return t},removeLocal:async function(e){xe("removeLocal","Removing "+e+" from Chrome local storage",null,"TRACE"),this.removeCached(e),await et.Chrome.Storage.removeLocal(e)},isArray:function(e){return typeof e=="object"&&e!==null&&typeof e.length=="number"}},Ze=ke.createScopedLog("Settings");let Ni;const au={MAX_BACKUP_VERSIONS:5,keys:["activeDays","activeHours","activeHoursQueue","blacklist","challengeRequired","challengeText","customStayFocusdMsg","disableActivityMonitor","disableSync","disableUpdatePopup","firstInstallDate","firstInstallAllowanceExpiration","hideAllowSiteLink","maxTimeAllowed","notificationSettings","nuclearOptionSettings","productivityBypass","resetTimeQueue","resetTimestamp","resetTime","whitelist","hasAcceptedToS","hasAcceptedPrivacyPolicy","explicitlyDeclinedPrivacyPolicy","is18OrOlder","age","isNewUser","promptBirthYearAt","promptBirthYearInterval","promptReview","promptReviewAt","promptReviewInterval","promptSurvey","promptSurveyAt","promptSurveyInterval","debugActivityMonitor","blockedGroups","isBlockAllWebsites","blockAllWebsitesAllowedTime","blockAllWebsitesElapsedTime","showedInitialTutorial","desktopPromoDismissed","whitelistNew","activated","isActivateSwitchShown"],cache:{},backupKeys:[],initialized:!1,initAPI:function(e){return Ni=e,Ni.mixin("Settings",{init:this.init.bind(this),initAsync:this.initAsync.bind(this),get:this.get.bind(this),set:this.set.bind(this),setAsync:this.setAsync.bind(this),refresh:this.refresh.bind(this),remove:this.remove.bind(this),restoreBackup:this.restoreBackup.bind(this),isInitialized:this.isInitialized.bind(this)})},init:function(e){this.initialized?(Ze("init","Settings already initialized",this.keys,"DEBUG"),typeof e=="function"&&e()):(Ze("init","Initializing Settings",this.keys,"DEBUG"),this.initialized=!0,this.cache={},He.init(()=>{this.initBackups(),this.refresh(e)}))},initAsync(){return new Promise(e=>this.init(e))},refresh:function(e){Ze("refresh","Refreshing Settings",this.keys,"TRACE");let t=0;const n=this.keys.length,r=i=>{He.refresh(i).then(s=>{this.cache[i]=typeof s<"u"?s:null,t++,t===n&&(Ze("refresh","Settings refreshed",null,"TRACE"),typeof e=="function"&&e())})};for(let i=0;i<n;i++)r(this.keys[i])},get:function(e,t){if(!this.inCache(e))throw new Error("[Settings.get()] "+e+" is not registered as a key in Settings.js");return this.cache[e]!==null?this.cache[e]:t},set(e,t,n,r){this.saveBackup();for(const i in e){const s=i;if(e.hasOwnProperty(s)){if(!this.inCache(s)&&!r)throw new Error("[Settings.get()] "+s+" is not registered as a key in Settings.js");this.cache[s]=e[s]}}He.set(e,n).then(()=>{typeof t=="function"&&t()})},setAsync(e,t,n){return new Promise(r=>this.set(e,r,t,n))},remove:function(e){this.inCache(e)&&(this.cache[e]=null),He.remove(e)},initBackups:function(){He.get("backupKeys").then(e=>{this.backupKeys=typeof e=="string"?JSON.parse(e):[],this.deleteOrphanedBackups(this.backupKeys)})},saveBackup:async function(){const e="backup-"+new Date().getTime();Ze("saveBackup","Saving backup: "+e,this.cache,"TRACE"),this.backupKeys.length>=this.MAX_BACKUP_VERSIONS&&this.pruneBackups(),this.backupKeys.unshift(e);const t={};t[e]=JSON.stringify(this.cache),t.backupKeys=JSON.stringify(this.backupKeys),await He.setBucket(e),await He.set(t),Ze("saveBackup","Backup saved",null,"TRACE")},restoreBackup:function(e=void 0){const t=e||this.backupKeys.shift();return t?(Ze("restoreBackup","Restoring backup",t,"DEBUG"),He.get(t).then(n=>{if(Ze("restoreBackup","Backup loaded",t,"DEBUG"),typeof n=="string")try{const r=JSON.parse(n);He.set(r).then(async()=>{await He.remove(t),Ze("restoreBackup","Backup restored",t,"DEBUG"),await He.set({backupKeys:JSON.stringify(this.backupKeys)}),Ni.Chrome.Extension.reload()})}catch{Ze("restoreBackup","Backup failed. Error parsing backup JSON.",t,"DEBUG"),this.restoreBackup()}else Ze("restoreBackup","Backup failed. Backup wasn't a string.",t,"DEBUG"),this.restoreBackup()}),!0):(Ze("restoreBackup","No backup available to restore",null,"WARN"),!1)},pruneBackups:function(){if(this.isArray(this.backupKeys)){const e=this.backupKeys.pop();Ze("pruneBackups","Pruning backup: "+e,null,"TRACE"),He.remove(e)}},deleteOrphanedBackups:function(e){Ze("deleteOrphanedBackups","Deleting orphaned backups",null,"TRACE");const t={};for(let n=0;n<e.length;n++)t[e[n]]=1;He.get("storageMap").then(n=>{let r=!1;for(const i in n)n.hasOwnProperty(i)&&i.indexOf("backup-")===0&&!(i in t)&&(delete n[i],r=!0);r&&He.saveMap(n)})},inCache:function(e){return typeof this.cache[e]<"u"},isArray:function(e){return typeof e=="object"&&e!==null&&typeof e.length=="number"},isInitialized(){return this.initialized}},ea=1e3,rn=60*ea,Br=60*rn,ou=24*Br,Sn=60,sn=60*Sn,ta=Sn*10,Tn={getToday(){return Tn.getStartOfDay(new Date)},getEndOfToday(){return Tn.getEndOfDay(new Date)},getStartOfDay(e){const t=new Date(e);return t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),t.setHours(0),t.getTime()},getEndOfDay(e){const t=new Date(e);return t.setMilliseconds(999),t.setSeconds(59),t.setMinutes(59),t.setHours(23),t.getTime()},formatDurationInSeconds(e){if(e===0||e<0)return"00:00";const t=Math.floor(e/sn),n=Math.floor((e-t*sn)/60),r=Math.floor(e-(t*sn+n*60)),i=Y.Date.toTwoDigits(t),s=Y.Date.toTwoDigits(n),a=Y.Date.toTwoDigits(r);return(i=="00"?"":`${i}:`)+`${s}:${a}`},formatTimeToString(e){return e>=0&&e<10?`0${e}`:e},getTimeFromSeconds(e){if(e<0)return{hours:0,minutes:0,seconds:0};const t=Math.floor(e/sn),n=Math.floor((e-t*sn)/60),r=e-(t*sn+n*60);return{hours:t,minutes:n,seconds:r}},getTimeFromMilliseconds(e){const t=e/rn,n=t<60?0:Math.floor(t/60);let r=0;return n>0?r=t-n*60:r=Math.floor(t),{hours:n,minutes:r}},getTimeInMilliseconds(e,t){return e*Br+t*rn},getTimeInSeconds(e,t){return e*sn+t*Sn}},we=ke.createScopedLog("RemoteConfig");let jr;const cu={cache:{},initialized:!1,defaults:{onboardingEnabledPercentInt2:0,defaultAmplitudeSampling:.1,amplitudeSampling:{},newTabTimeout:3*ou,uploadWebUsage:!0,usageUploadBatchSize:500,pageViewAllowlist:[],incrementalRollout:{},bugsnagSampling:.01,bugsnagIgnoreMatches:["Extension context invalidated.","Could not establish connection. Receiving end does not exist.","The browser is shutting down.",'{\\s*"?isTrusted"?:\\s*true\\s*}',"Failed to execute 'abort' on 'IDBTransaction': The transaction has finished.","Failed to execute 'transaction' on 'IDBDatabase': The database connection is closing.","^IO error: \\.\\.\\.\\/.+?: .*? \\(ChromeMethodBFE: .*\\)$","Cannot access contents of the page. Extension manifest must request permission to access the respective host.","The extensions gallery cannot be scripted."],instacartSelectors:{productSelector:['div[aria-label="Product"]'],sponsoredRegex:["/s\\s*p\\s*o\\s*n\\s*s\\s*o\\s*r\\s*/i"],companyName:[".e-1f1gsmn",".e-1opt332"],searchTerm:["#search-bar-input"],productTitle:[".e-th3ch3",".e-u2e78b",".e-1exr31r",".e-wrmemy"],productSize:[".e-k9ly30",".e-owckh2",".e-1hb8rq9",".e-1188c9v"],productPrice:[".e-1jioxed > span.screen-reader-only",".e-1ybpdrh > span.screen-reader-only",".e-1ghw7u1 > span.screen-reader-only",".e-hlbpyw > span.screen-reader-only",".e-t5lw1y > span.e-13d1dsr"]},forbiddenPromptWords:["drug","alcohol","porn"],chatGptUrl:"https://chatgpt.com/",chatGptConversationUrl:"https://chatgpt.com/c/"},url:"https://stayfocusd.st-panel-api.com/v1/remote_config/stayfocusd",sharedConfigUrl:"https://stayfocusd.st-panel-api.com/v1/remote_config/shared-web-config",storageKey:"remote-config",initAPI(e){return jr=e,jr.mixin("RemoteConfig",{storageKey:this.storageKey,init:this.init.bind(this),get:this.get.bind(this),refresh:this.refresh.bind(this)})},async init(){if(this.initialized){we==null||we("init","RemoteConfig already initialized",this.cache,"DEBUG");return}we==null||we("init","Initializing RemoteConfig",this.defaults,"DEBUG"),this.initialized=!0,this.cache={...this.defaults},this.cache={...this.cache,...await jr.Storage.get(this.storageKey)},we==null||we("init","Initialized",this.cache,"DEBUG")},async refresh(){we==null||we("refresh","Refreshing...",{currentConfig:this.cache},"DEBUG");try{const e=await fetch(this.url).then(n=>n.json()),t=await fetch(this.sharedConfigUrl).then(n=>n.json());we==null||we("refresh","Fetched config",e,"DEBUG"),this.cache={...this.defaults,...e,...t},await jr.Storage.set({[this.storageKey]:this.cache}),we==null||we("refresh","Saved config",this.cache,"DEBUG")}catch(e){we==null||we("refresh","Failed to fetch remote config",e,"WARN")}},get(e){if(!this.inCache(e))throw new Error("[RemoteConfig.get()] "+e+" is not registered as a key in RemoteConfig.js");return this.cache[e]},inCache(e){return typeof this.cache[e]<"u"}};var lu=Object.defineProperty,uu=(e,t,n)=>t in e?lu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Oe=(e,t,n)=>(uu(e,typeof t!="symbol"?t+"":t,n),n),Ri=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},V=(e,t,n)=>(Ri(e,t,"read from private field"),n?n.call(e):t.get(e)),Ke=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},Se=(e,t,n,r)=>(Ri(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),Kn=(e,t,n)=>(Ri(e,t,"access private method"),n),ae;(function(e){e.assertEqual=i=>i;function t(i){}e.assertIs=t;function n(i){throw new Error}e.assertNever=n,e.arrayToEnum=i=>{const s={};for(const a of i)s[a]=a;return s},e.getValidEnumValues=i=>{const s=e.objectKeys(i).filter(l=>typeof i[i[l]]!="number"),a={};for(const l of s)a[l]=i[l];return e.objectValues(a)},e.objectValues=i=>e.objectKeys(i).map(function(s){return i[s]}),e.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},e.find=(i,s)=>{for(const a of i)if(s(a))return a},e.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function r(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}e.joinValues=r,e.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ae||(ae={}));const z=ae.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Wt=e=>{switch(typeof e){case"undefined":return z.undefined;case"string":return z.string;case"number":return isNaN(e)?z.nan:z.number;case"boolean":return z.boolean;case"function":return z.function;case"bigint":return z.bigint;case"symbol":return z.symbol;case"object":return Array.isArray(e)?z.array:e===null?z.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?z.promise:typeof Map<"u"&&e instanceof Map?z.map:typeof Set<"u"&&e instanceof Set?z.set:typeof Date<"u"&&e instanceof Date?z.date:z.object;default:return z.unknown}},G=ae.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),du=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class Pt extends Error{constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const n=t||function(s){return s.message},r={_errors:[]},i=s=>{for(const a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)r._errors.push(n(a));else{let l=r,c=0;for(;c<a.path.length;){const o=a.path[c];c===a.path.length-1?(l[o]=l[o]||{_errors:[]},l[o]._errors.push(n(a))):l[o]=l[o]||{_errors:[]},l=l[o],c++}}};return i(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,ae.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const i of this.issues)i.path.length>0?(n[i.path[0]]=n[i.path[0]]||[],n[i.path[0]].push(t(i))):r.push(t(i));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}Pt.create=e=>new Pt(e);const Yn=(e,t)=>{let n;switch(e.code){case G.invalid_type:e.received===z.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case G.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,ae.jsonStringifyReplacer)}`;break;case G.unrecognized_keys:n=`Unrecognized key(s) in object: ${ae.joinValues(e.keys,", ")}`;break;case G.invalid_union:n="Invalid input";break;case G.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${ae.joinValues(e.options)}`;break;case G.invalid_enum_value:n=`Invalid enum value. Expected ${ae.joinValues(e.options)}, received '${e.received}'`;break;case G.invalid_arguments:n="Invalid function arguments";break;case G.invalid_return_type:n="Invalid function return type";break;case G.invalid_date:n="Invalid date";break;case G.invalid_string:typeof e.validation=="object"?"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:ae.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case G.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(e.minimum)}`:n="Invalid input";break;case G.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(e.maximum)}`:n="Invalid input";break;case G.custom:n="Invalid input";break;case G.invalid_intersection_types:n="Intersection results could not be merged";break;case G.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case G.not_finite:n="Number must be finite";break;default:n=t.defaultError,ae.assertNever(e)}return{message:n}};let na=Yn;function hu(e){na=e}function Fr(){return na}const Wr=e=>{const{data:t,path:n,errorMaps:r,issueData:i}=e,s=[...n,...i.path||[]],a={...i,path:s};let l="";const c=r.filter(o=>!!o).slice().reverse();for(const o of c)l=o(a,{data:t,defaultError:l}).message;return{...i,path:s,message:i.message||l}},gu=[];function K(e,t){const n=Wr({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,Fr(),Yn].filter(r=>!!r)});e.common.issues.push(n)}let tt=class ac{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const i of n){if(i.status==="aborted")return ee;i.status==="dirty"&&t.dirty(),r.push(i.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const i of n)r.push({key:await i.key,value:await i.value});return ac.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const i of n){const{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return ee;s.status==="dirty"&&t.dirty(),a.status==="dirty"&&t.dirty(),(typeof a.value<"u"||i.alwaysSet)&&(r[s.value]=a.value)}return{status:t.value,value:r}}};const ee=Object.freeze({status:"aborted"}),ra=e=>({status:"dirty",value:e}),je=e=>({status:"valid",value:e}),Li=e=>e.status==="aborted",Ui=e=>e.status==="dirty",$r=e=>e.status==="valid",Vr=e=>typeof Promise!==void 0&&e instanceof Promise;var se;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(se||(se={}));let St=class{constructor(t,n,r,i){this.parent=t,this.data=n,this._path=r,this._key=i}get path(){return this._path.concat(this._key)}};const ia=(e,t)=>{if($r(t))return{success:!0,data:t.value};{if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,error:new Pt(e.common.issues)}}};function re(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:i}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:i}:{errorMap:(s,a)=>s.code!=="invalid_type"?{message:a.defaultError}:typeof a.data>"u"?{message:r??a.defaultError}:{message:n??a.defaultError},description:i}}class ne{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return Wt(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:Wt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new tt,ctx:{common:t.parent.common,data:t.data,parsedType:Wt(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(Vr(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){var r;const i={common:{issues:[],async:(r=n==null?void 0:n.async)!==null&&r!==void 0?r:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Wt(t)},s=this._parseSync({data:t,path:i.path,parent:i});return ia(i,s)}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Wt(t)},i=this._parse({data:t,path:r.path,parent:r}),s=await(Vr(i)?i:Promise.resolve(i));return ia(r,s)}refine(t,n){const r=i=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(i):n;return this._refinement((i,s)=>{const a=t(i),l=()=>s.addIssue({code:G.custom,...r(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(l(),!1)):a?!0:(l(),!1)})}refinement(t,n){return this._refinement((r,i)=>t(r)?!0:(i.addIssue(typeof n=="function"?n(r,i):n),!1))}_refinement(t){return new mt({schema:this,typeName:J.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return Tt.create(this)}nullable(){return ln.create(this)}nullish(){return this.optional().nullable()}array(){return pt.create(this)}promise(){return In.create(this)}or(t){return tr.create([this,t])}and(t){return nr.create(this,t)}transform(t){return new mt({schema:this,typeName:J.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new cr({innerType:this,defaultValue:n,typeName:J.ZodDefault})}brand(){return new oa({typeName:J.ZodBranded,type:this,...re(void 0)})}catch(t){const n=typeof t=="function"?t:()=>t;return new Yr({innerType:this,defaultValue:n,typeName:J.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return lr.create(this,t)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const fu=/^c[^\s-]{8,}$/i,pu=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,mu=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,yu=e=>e.precision?e.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}:\\d{2})|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):e.precision===0?e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}:\\d{2})|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}:\\d{2})|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");class kt extends ne{constructor(){super(...arguments),this._regex=(t,n,r)=>this.refinement(i=>t.test(i),{validation:n,code:G.invalid_string,...se.errToObj(r)}),this.nonempty=t=>this.min(1,se.errToObj(t)),this.trim=()=>new kt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==z.string){const i=this._getOrReturnCtx(t);return K(i,{code:G.invalid_type,expected:z.string,received:i.parsedType}),ee}const n=new tt;let r;for(const i of this._def.checks)if(i.kind==="min")t.data.length<i.value&&(r=this._getOrReturnCtx(t,r),K(r,{code:G.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")t.data.length>i.value&&(r=this._getOrReturnCtx(t,r),K(r,{code:G.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){const s=t.data.length>i.value,a=t.data.length<i.value;(s||a)&&(r=this._getOrReturnCtx(t,r),s?K(r,{code:G.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&K(r,{code:G.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")mu.test(t.data)||(r=this._getOrReturnCtx(t,r),K(r,{validation:"email",code:G.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")pu.test(t.data)||(r=this._getOrReturnCtx(t,r),K(r,{validation:"uuid",code:G.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")fu.test(t.data)||(r=this._getOrReturnCtx(t,r),K(r,{validation:"cuid",code:G.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(t.data)}catch{r=this._getOrReturnCtx(t,r),K(r,{validation:"url",code:G.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(t.data)||(r=this._getOrReturnCtx(t,r),K(r,{validation:"regex",code:G.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?t.data=t.data.trim():i.kind==="startsWith"?t.data.startsWith(i.value)||(r=this._getOrReturnCtx(t,r),K(r,{code:G.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?t.data.endsWith(i.value)||(r=this._getOrReturnCtx(t,r),K(r,{code:G.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?yu(i).test(t.data)||(r=this._getOrReturnCtx(t,r),K(r,{code:G.invalid_string,validation:"datetime",message:i.message}),n.dirty()):ae.assertNever(i);return{status:n.value,value:t.data}}_addCheck(t){return new kt({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...se.errToObj(t)})}url(t){return this._addCheck({kind:"url",...se.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...se.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...se.errToObj(t)})}datetime(t){var n;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(n=t==null?void 0:t.offset)!==null&&n!==void 0?n:!1,...se.errToObj(t==null?void 0:t.message)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...se.errToObj(n)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...se.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...se.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...se.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...se.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...se.errToObj(n)})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}kt.create=e=>{var t;return new kt({checks:[],typeName:J.ZodString,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...re(e)})};function vu(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,i=n>r?n:r,s=parseInt(e.toFixed(i).replace(".","")),a=parseInt(t.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}class $t extends ne{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==z.number){const i=this._getOrReturnCtx(t);return K(i,{code:G.invalid_type,expected:z.number,received:i.parsedType}),ee}let n;const r=new tt;for(const i of this._def.checks)i.kind==="int"?ae.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),K(n,{code:G.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(n=this._getOrReturnCtx(t,n),K(n,{code:G.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(n=this._getOrReturnCtx(t,n),K(n,{code:G.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="multipleOf"?vu(t.data,i.value)!==0&&(n=this._getOrReturnCtx(t,n),K(n,{code:G.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):i.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),K(n,{code:G.not_finite,message:i.message}),r.dirty()):ae.assertNever(i);return{status:r.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,se.toString(n))}gt(t,n){return this.setLimit("min",t,!1,se.toString(n))}lte(t,n){return this.setLimit("max",t,!0,se.toString(n))}lt(t,n){return this.setLimit("max",t,!1,se.toString(n))}setLimit(t,n,r,i){return new $t({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:se.toString(i)}]})}_addCheck(t){return new $t({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:se.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:se.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:se.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:se.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:se.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:se.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:se.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int")}}$t.create=e=>new $t({checks:[],typeName:J.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...re(e)});class Jn extends ne{_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==z.bigint){const n=this._getOrReturnCtx(t);return K(n,{code:G.invalid_type,expected:z.bigint,received:n.parsedType}),ee}return je(t.data)}}Jn.create=e=>{var t;return new Jn({typeName:J.ZodBigInt,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...re(e)})};class Qn extends ne{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==z.boolean){const n=this._getOrReturnCtx(t);return K(n,{code:G.invalid_type,expected:z.boolean,received:n.parsedType}),ee}return je(t.data)}}Qn.create=e=>new Qn({typeName:J.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...re(e)});class an extends ne{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==z.date){const i=this._getOrReturnCtx(t);return K(i,{code:G.invalid_type,expected:z.date,received:i.parsedType}),ee}if(isNaN(t.data.getTime())){const i=this._getOrReturnCtx(t);return K(i,{code:G.invalid_date}),ee}const n=new tt;let r;for(const i of this._def.checks)i.kind==="min"?t.data.getTime()<i.value&&(r=this._getOrReturnCtx(t,r),K(r,{code:G.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?t.data.getTime()>i.value&&(r=this._getOrReturnCtx(t,r),K(r,{code:G.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):ae.assertNever(i);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new an({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:se.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:se.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}an.create=e=>new an({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:J.ZodDate,...re(e)});class Gr extends ne{_parse(t){if(this._getType(t)!==z.symbol){const n=this._getOrReturnCtx(t);return K(n,{code:G.invalid_type,expected:z.symbol,received:n.parsedType}),ee}return je(t.data)}}Gr.create=e=>new Gr({typeName:J.ZodSymbol,...re(e)});class Xn extends ne{_parse(t){if(this._getType(t)!==z.undefined){const n=this._getOrReturnCtx(t);return K(n,{code:G.invalid_type,expected:z.undefined,received:n.parsedType}),ee}return je(t.data)}}Xn.create=e=>new Xn({typeName:J.ZodUndefined,...re(e)});class er extends ne{_parse(t){if(this._getType(t)!==z.null){const n=this._getOrReturnCtx(t);return K(n,{code:G.invalid_type,expected:z.null,received:n.parsedType}),ee}return je(t.data)}}er.create=e=>new er({typeName:J.ZodNull,...re(e)});class En extends ne{constructor(){super(...arguments),this._any=!0}_parse(t){return je(t.data)}}En.create=e=>new En({typeName:J.ZodAny,...re(e)});class on extends ne{constructor(){super(...arguments),this._unknown=!0}_parse(t){return je(t.data)}}on.create=e=>new on({typeName:J.ZodUnknown,...re(e)});let Dt=class extends ne{_parse(t){const n=this._getOrReturnCtx(t);return K(n,{code:G.invalid_type,expected:z.never,received:n.parsedType}),ee}};Dt.create=e=>new Dt({typeName:J.ZodNever,...re(e)});class Hr extends ne{_parse(t){if(this._getType(t)!==z.undefined){const n=this._getOrReturnCtx(t);return K(n,{code:G.invalid_type,expected:z.void,received:n.parsedType}),ee}return je(t.data)}}Hr.create=e=>new Hr({typeName:J.ZodVoid,...re(e)});class pt extends ne{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),i=this._def;if(n.parsedType!==z.array)return K(n,{code:G.invalid_type,expected:z.array,received:n.parsedType}),ee;if(i.exactLength!==null){const a=n.data.length>i.exactLength.value,l=n.data.length<i.exactLength.value;(a||l)&&(K(n,{code:a?G.too_big:G.too_small,minimum:l?i.exactLength.value:void 0,maximum:a?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&n.data.length<i.minLength.value&&(K(n,{code:G.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&n.data.length>i.maxLength.value&&(K(n,{code:G.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),n.common.async)return Promise.all(n.data.map((a,l)=>i.type._parseAsync(new St(n,a,n.path,l)))).then(a=>tt.mergeArray(r,a));const s=n.data.map((a,l)=>i.type._parseSync(new St(n,a,n.path,l)));return tt.mergeArray(r,s)}get element(){return this._def.type}min(t,n){return new pt({...this._def,minLength:{value:t,message:se.toString(n)}})}max(t,n){return new pt({...this._def,maxLength:{value:t,message:se.toString(n)}})}length(t,n){return new pt({...this._def,exactLength:{value:t,message:se.toString(n)}})}nonempty(t){return this.min(1,t)}}pt.create=(e,t)=>new pt({type:e,minLength:null,maxLength:null,exactLength:null,typeName:J.ZodArray,...re(t)});var zr;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(zr||(zr={}));const sa=e=>t=>new pe({...e,shape:()=>({...e.shape(),...t})});function Cn(e){if(e instanceof pe){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=Tt.create(Cn(r))}return new pe({...e._def,shape:()=>t})}else return e instanceof pt?pt.create(Cn(e.element)):e instanceof Tt?Tt.create(Cn(e.unwrap())):e instanceof ln?ln.create(Cn(e.unwrap())):e instanceof Vt?Vt.create(e.items.map(t=>Cn(t))):e}class pe extends ne{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=sa(this._def),this.extend=sa(this._def)}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=ae.objectKeys(t);return this._cached={shape:t,keys:n}}_parse(t){if(this._getType(t)!==z.object){const c=this._getOrReturnCtx(t);return K(c,{code:G.invalid_type,expected:z.object,received:c.parsedType}),ee}const{status:n,ctx:r}=this._processInputParams(t),{shape:i,keys:s}=this._getCached(),a=[];if(!(this._def.catchall instanceof Dt&&this._def.unknownKeys==="strip"))for(const c in r.data)s.includes(c)||a.push(c);const l=[];for(const c of s){const o=i[c],u=r.data[c];l.push({key:{status:"valid",value:c},value:o._parse(new St(r,u,r.path,c)),alwaysSet:c in r.data})}if(this._def.catchall instanceof Dt){const c=this._def.unknownKeys;if(c==="passthrough")for(const o of a)l.push({key:{status:"valid",value:o},value:{status:"valid",value:r.data[o]}});else if(c==="strict")a.length>0&&(K(r,{code:G.unrecognized_keys,keys:a}),n.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const o of a){const u=r.data[o];l.push({key:{status:"valid",value:o},value:c._parse(new St(r,u,r.path,o)),alwaysSet:o in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const c=[];for(const o of l){const u=await o.key;c.push({key:u,value:await o.value,alwaysSet:o.alwaysSet})}return c}).then(c=>tt.mergeObjectSync(n,c)):tt.mergeObjectSync(n,l)}get shape(){return this._def.shape()}strict(t){return se.errToObj,new pe({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var i,s,a,l;const c=(a=(s=(i=this._def).errorMap)===null||s===void 0?void 0:s.call(i,n,r).message)!==null&&a!==void 0?a:r.defaultError;return n.code==="unrecognized_keys"?{message:(l=se.errToObj(t).message)!==null&&l!==void 0?l:c}:{message:c}}}:{}})}strip(){return new pe({...this._def,unknownKeys:"strip"})}passthrough(){return new pe({...this._def,unknownKeys:"passthrough"})}setKey(t,n){return this.augment({[t]:n})}merge(t){return new pe({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>zr.mergeShapes(this._def.shape(),t._def.shape()),typeName:J.ZodObject})}catchall(t){return new pe({...this._def,catchall:t})}pick(t){const n={};return ae.objectKeys(t).map(r=>{this.shape[r]&&(n[r]=this.shape[r])}),new pe({...this._def,shape:()=>n})}omit(t){const n={};return ae.objectKeys(this.shape).map(r=>{ae.objectKeys(t).indexOf(r)===-1&&(n[r]=this.shape[r])}),new pe({...this._def,shape:()=>n})}deepPartial(){return Cn(this)}partial(t){const n={};if(t)return ae.objectKeys(this.shape).map(r=>{ae.objectKeys(t).indexOf(r)===-1?n[r]=this.shape[r]:n[r]=this.shape[r].optional()}),new pe({...this._def,shape:()=>n});for(const r in this.shape){const i=this.shape[r];n[r]=i.optional()}return new pe({...this._def,shape:()=>n})}required(t){const n={};if(t)ae.objectKeys(this.shape).map(r=>{if(ae.objectKeys(t).indexOf(r)===-1)n[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof Tt;)i=i._def.innerType;n[r]=i}});else for(const r in this.shape){let i=this.shape[r];for(;i instanceof Tt;)i=i._def.innerType;n[r]=i}return new pe({...this._def,shape:()=>n})}keyof(){return aa(ae.objectKeys(this.shape))}}pe.create=(e,t)=>new pe({shape:()=>e,unknownKeys:"strip",catchall:Dt.create(),typeName:J.ZodObject,...re(t)}),pe.strictCreate=(e,t)=>new pe({shape:()=>e,unknownKeys:"strict",catchall:Dt.create(),typeName:J.ZodObject,...re(t)}),pe.lazycreate=(e,t)=>new pe({shape:e,unknownKeys:"strip",catchall:Dt.create(),typeName:J.ZodObject,...re(t)});class tr extends ne{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function i(s){for(const l of s)if(l.result.status==="valid")return l.result;for(const l of s)if(l.result.status==="dirty")return n.common.issues.push(...l.ctx.common.issues),l.result;const a=s.map(l=>new Pt(l.ctx.common.issues));return K(n,{code:G.invalid_union,unionErrors:a}),ee}if(n.common.async)return Promise.all(r.map(async s=>{const a={...n,common:{...n.common,issues:[]},parent:null};return{result:await s._parseAsync({data:n.data,path:n.path,parent:a}),ctx:a}})).then(i);{let s;const a=[];for(const c of r){const o={...n,common:{...n.common,issues:[]},parent:null},u=c._parseSync({data:n.data,path:n.path,parent:o});if(u.status==="valid")return u;u.status==="dirty"&&!s&&(s={result:u,ctx:o}),o.common.issues.length&&a.push(o.common.issues)}if(s)return n.common.issues.push(...s.ctx.common.issues),s.result;const l=a.map(c=>new Pt(c));return K(n,{code:G.invalid_union,unionErrors:l}),ee}}get options(){return this._def.options}}tr.create=(e,t)=>new tr({options:e,typeName:J.ZodUnion,...re(t)});const qr=e=>e instanceof ir?qr(e.schema):e instanceof mt?qr(e.innerType()):e instanceof sr?[e.value]:e instanceof ar?e.options:e instanceof or?Object.keys(e.enum):e instanceof cr?qr(e._def.innerType):e instanceof Xn?[void 0]:e instanceof er?[null]:null;class Zr extends ne{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==z.object)return K(n,{code:G.invalid_type,expected:z.object,received:n.parsedType}),ee;const r=this.discriminator,i=n.data[r],s=this.optionsMap.get(i);return s?n.common.async?s._parseAsync({data:n.data,path:n.path,parent:n}):s._parseSync({data:n.data,path:n.path,parent:n}):(K(n,{code:G.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),ee)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){const i=new Map;for(const s of n){const a=qr(s.shape[t]);if(!a)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const l of a){if(i.has(l))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(l)}`);i.set(l,s)}}return new Zr({typeName:J.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:i,...re(r)})}}function Bi(e,t){const n=Wt(e),r=Wt(t);if(e===t)return{valid:!0,data:e};if(n===z.object&&r===z.object){const i=ae.objectKeys(t),s=ae.objectKeys(e).filter(l=>i.indexOf(l)!==-1),a={...e,...t};for(const l of s){const c=Bi(e[l],t[l]);if(!c.valid)return{valid:!1};a[l]=c.data}return{valid:!0,data:a}}else if(n===z.array&&r===z.array){if(e.length!==t.length)return{valid:!1};const i=[];for(let s=0;s<e.length;s++){const a=e[s],l=t[s],c=Bi(a,l);if(!c.valid)return{valid:!1};i.push(c.data)}return{valid:!0,data:i}}else return n===z.date&&r===z.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class nr extends ne{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),i=(s,a)=>{if(Li(s)||Li(a))return ee;const l=Bi(s.value,a.value);return l.valid?((Ui(s)||Ui(a))&&n.dirty(),{status:n.value,value:l.data}):(K(r,{code:G.invalid_intersection_types}),ee)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,a])=>i(s,a)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}nr.create=(e,t,n)=>new nr({left:e,right:t,typeName:J.ZodIntersection,...re(n)});let Vt=class oc extends ne{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==z.array)return K(r,{code:G.invalid_type,expected:z.array,received:r.parsedType}),ee;if(r.data.length<this._def.items.length)return K(r,{code:G.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ee;!this._def.rest&&r.data.length>this._def.items.length&&(K(r,{code:G.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const i=r.data.map((s,a)=>{const l=this._def.items[a]||this._def.rest;return l?l._parse(new St(r,s,r.path,a)):null}).filter(s=>!!s);return r.common.async?Promise.all(i).then(s=>tt.mergeArray(n,s)):tt.mergeArray(n,i)}get items(){return this._def.items}rest(t){return new oc({...this._def,rest:t})}};Vt.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Vt({items:e,typeName:J.ZodTuple,rest:null,...re(t)})};class rr extends ne{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==z.object)return K(r,{code:G.invalid_type,expected:z.object,received:r.parsedType}),ee;const i=[],s=this._def.keyType,a=this._def.valueType;for(const l in r.data)i.push({key:s._parse(new St(r,l,r.path,l)),value:a._parse(new St(r,r.data[l],r.path,l))});return r.common.async?tt.mergeObjectAsync(n,i):tt.mergeObjectSync(n,i)}get element(){return this._def.valueType}static create(t,n,r){return n instanceof ne?new rr({keyType:t,valueType:n,typeName:J.ZodRecord,...re(r)}):new rr({keyType:kt.create(),valueType:t,typeName:J.ZodRecord,...re(n)})}}class Kr extends ne{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==z.map)return K(r,{code:G.invalid_type,expected:z.map,received:r.parsedType}),ee;const i=this._def.keyType,s=this._def.valueType,a=[...r.data.entries()].map(([l,c],o)=>({key:i._parse(new St(r,l,r.path,[o,"key"])),value:s._parse(new St(r,c,r.path,[o,"value"]))}));if(r.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const c of a){const o=await c.key,u=await c.value;if(o.status==="aborted"||u.status==="aborted")return ee;(o.status==="dirty"||u.status==="dirty")&&n.dirty(),l.set(o.value,u.value)}return{status:n.value,value:l}})}else{const l=new Map;for(const c of a){const o=c.key,u=c.value;if(o.status==="aborted"||u.status==="aborted")return ee;(o.status==="dirty"||u.status==="dirty")&&n.dirty(),l.set(o.value,u.value)}return{status:n.value,value:l}}}}Kr.create=(e,t,n)=>new Kr({valueType:t,keyType:e,typeName:J.ZodMap,...re(n)});class cn extends ne{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==z.set)return K(r,{code:G.invalid_type,expected:z.set,received:r.parsedType}),ee;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(K(r,{code:G.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),n.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(K(r,{code:G.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),n.dirty());const s=this._def.valueType;function a(c){const o=new Set;for(const u of c){if(u.status==="aborted")return ee;u.status==="dirty"&&n.dirty(),o.add(u.value)}return{status:n.value,value:o}}const l=[...r.data.values()].map((c,o)=>s._parse(new St(r,c,r.path,o)));return r.common.async?Promise.all(l).then(c=>a(c)):a(l)}min(t,n){return new cn({...this._def,minSize:{value:t,message:se.toString(n)}})}max(t,n){return new cn({...this._def,maxSize:{value:t,message:se.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}cn.create=(e,t)=>new cn({valueType:e,minSize:null,maxSize:null,typeName:J.ZodSet,...re(t)});class On extends ne{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==z.function)return K(n,{code:G.invalid_type,expected:z.function,received:n.parsedType}),ee;function r(l,c){return Wr({data:l,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Fr(),Yn].filter(o=>!!o),issueData:{code:G.invalid_arguments,argumentsError:c}})}function i(l,c){return Wr({data:l,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Fr(),Yn].filter(o=>!!o),issueData:{code:G.invalid_return_type,returnTypeError:c}})}const s={errorMap:n.common.contextualErrorMap},a=n.data;return this._def.returns instanceof In?je(async(...l)=>{const c=new Pt([]),o=await this._def.args.parseAsync(l,s).catch(h=>{throw c.addIssue(r(l,h)),c}),u=await a(...o);return await this._def.returns._def.type.parseAsync(u,s).catch(h=>{throw c.addIssue(i(u,h)),c})}):je((...l)=>{const c=this._def.args.safeParse(l,s);if(!c.success)throw new Pt([r(l,c.error)]);const o=a(...c.data),u=this._def.returns.safeParse(o,s);if(!u.success)throw new Pt([i(o,u.error)]);return u.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new On({...this._def,args:Vt.create(t).rest(on.create())})}returns(t){return new On({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,n,r){return new On({args:t||Vt.create([]).rest(on.create()),returns:n||on.create(),typeName:J.ZodFunction,...re(r)})}}class ir extends ne{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}ir.create=(e,t)=>new ir({getter:e,typeName:J.ZodLazy,...re(t)});class sr extends ne{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return K(n,{code:G.invalid_literal,expected:this._def.value}),ee}return{status:"valid",value:t.data}}get value(){return this._def.value}}sr.create=(e,t)=>new sr({value:e,typeName:J.ZodLiteral,...re(t)});function aa(e,t){return new ar({values:e,typeName:J.ZodEnum,...re(t)})}class ar extends ne{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return K(n,{expected:ae.joinValues(r),received:n.parsedType,code:G.invalid_type}),ee}if(this._def.values.indexOf(t.data)===-1){const n=this._getOrReturnCtx(t),r=this._def.values;return K(n,{received:n.data,code:G.invalid_enum_value,options:r}),ee}return je(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}}ar.create=aa;class or extends ne{_parse(t){const n=ae.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==z.string&&r.parsedType!==z.number){const i=ae.objectValues(n);return K(r,{expected:ae.joinValues(i),received:r.parsedType,code:G.invalid_type}),ee}if(n.indexOf(t.data)===-1){const i=ae.objectValues(n);return K(r,{received:r.data,code:G.invalid_enum_value,options:i}),ee}return je(t.data)}get enum(){return this._def.values}}or.create=(e,t)=>new or({values:e,typeName:J.ZodNativeEnum,...re(t)});class In extends ne{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==z.promise&&n.common.async===!1)return K(n,{code:G.invalid_type,expected:z.promise,received:n.parsedType}),ee;const r=n.parsedType===z.promise?n.data:Promise.resolve(n.data);return je(r.then(i=>this._def.type.parseAsync(i,{path:n.path,errorMap:n.common.contextualErrorMap})))}}In.create=(e,t)=>new In({type:e,typeName:J.ZodPromise,...re(t)});let mt=class extends ne{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===J.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),i=this._def.effect||null;if(i.type==="preprocess"){const a=i.transform(r.data);return r.common.async?Promise.resolve(a).then(l=>this._def.schema._parseAsync({data:l,path:r.path,parent:r})):this._def.schema._parseSync({data:a,path:r.path,parent:r})}const s={addIssue:a=>{K(r,a),a.fatal?n.abort():n.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="refinement"){const a=l=>{const c=i.refinement(l,s);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(r.common.async===!1){const l=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return l.status==="aborted"?ee:(l.status==="dirty"&&n.dirty(),a(l.value),{status:n.value,value:l.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(l=>l.status==="aborted"?ee:(l.status==="dirty"&&n.dirty(),a(l.value).then(()=>({status:n.value,value:l.value}))))}if(i.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!$r(a))return a;const l=i.transform(a.value,s);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:l}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>$r(a)?Promise.resolve(i.transform(a.value,s)).then(l=>({status:n.value,value:l})):a);ae.assertNever(i)}};mt.create=(e,t,n)=>new mt({schema:e,typeName:J.ZodEffects,effect:t,...re(n)}),mt.createWithPreprocess=(e,t,n)=>new mt({schema:t,effect:{type:"preprocess",transform:e},typeName:J.ZodEffects,...re(n)});class Tt extends ne{_parse(t){return this._getType(t)===z.undefined?je(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Tt.create=(e,t)=>new Tt({innerType:e,typeName:J.ZodOptional,...re(t)});class ln extends ne{_parse(t){return this._getType(t)===z.null?je(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}ln.create=(e,t)=>new ln({innerType:e,typeName:J.ZodNullable,...re(t)});class cr extends ne{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===z.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}cr.create=(e,t)=>new cr({innerType:e,typeName:J.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...re(t)});class Yr extends ne{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.innerType._parse({data:n.data,path:n.path,parent:n});return Vr(r)?r.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.defaultValue()})):{status:"valid",value:r.status==="valid"?r.value:this._def.defaultValue()}}removeDefault(){return this._def.innerType}}Yr.create=(e,t)=>new Yr({innerType:e,typeName:J.ZodCatch,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...re(t)});class Jr extends ne{_parse(t){if(this._getType(t)!==z.nan){const n=this._getOrReturnCtx(t);return K(n,{code:G.invalid_type,expected:z.nan,received:n.parsedType}),ee}return{status:"valid",value:t.data}}}Jr.create=e=>new Jr({typeName:J.ZodNaN,...re(e)});const bu=Symbol("zod_brand");class oa extends ne{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class lr extends ne{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?ee:i.status==="dirty"?(n.dirty(),ra(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?ee:i.status==="dirty"?(n.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(t,n){return new lr({in:t,out:n,typeName:J.ZodPipeline})}}const ca=(e,t={},n)=>e?En.create().superRefine((r,i)=>{if(!e(r)){const s=typeof t=="function"?t(r):t,a=typeof s=="string"?{message:s}:s;i.addIssue({code:"custom",...a,fatal:n})}}):En.create(),wu={object:pe.lazycreate};var J;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline"})(J||(J={}));const Au=(e,t={message:`Input not instance of ${e.name}`})=>ca(n=>n instanceof e,t,!0),Fe=kt.create,ve=$t.create,_u=Jr.create,xu=Jn.create,Qr=Qn.create,Su=an.create,Tu=Gr.create,Eu=Xn.create,Cu=er.create,la=En.create,Ou=on.create,Iu=Dt.create,Pu=Hr.create,ku=pt.create,st=pe.create,Du=pe.strictCreate,ji=tr.create,Mu=Zr.create,Nu=nr.create,Ru=Vt.create,ua=rr.create,Lu=Kr.create,Uu=cn.create,Bu=On.create,ju=ir.create,Fu=sr.create,Pn=ar.create,Wu=or.create,$u=In.create,da=mt.create,Vu=Tt.create,Gu=ln.create,Hu=mt.createWithPreprocess,zu=lr.create;var at=Object.freeze({__proto__:null,defaultErrorMap:Yn,setErrorMap:hu,getErrorMap:Fr,makeIssue:Wr,EMPTY_PATH:gu,addIssueToContext:K,ParseStatus:tt,INVALID:ee,DIRTY:ra,OK:je,isAborted:Li,isDirty:Ui,isValid:$r,isAsync:Vr,get util(){return ae},ZodParsedType:z,getParsedType:Wt,ZodType:ne,ZodString:kt,ZodNumber:$t,ZodBigInt:Jn,ZodBoolean:Qn,ZodDate:an,ZodSymbol:Gr,ZodUndefined:Xn,ZodNull:er,ZodAny:En,ZodUnknown:on,ZodNever:Dt,ZodVoid:Hr,ZodArray:pt,get objectUtil(){return zr},ZodObject:pe,ZodUnion:tr,ZodDiscriminatedUnion:Zr,ZodIntersection:nr,ZodTuple:Vt,ZodRecord:rr,ZodMap:Kr,ZodSet:cn,ZodFunction:On,ZodLazy:ir,ZodLiteral:sr,ZodEnum:ar,ZodNativeEnum:or,ZodPromise:In,ZodEffects:mt,ZodTransformer:mt,ZodOptional:Tt,ZodNullable:ln,ZodDefault:cr,ZodCatch:Yr,ZodNaN:Jr,BRAND:bu,ZodBranded:oa,ZodPipeline:lr,custom:ca,Schema:ne,ZodSchema:ne,late:wu,get ZodFirstPartyTypeKind(){return J},coerce:{string:e=>kt.create({...e,coerce:!0}),number:e=>$t.create({...e,coerce:!0}),boolean:e=>Qn.create({...e,coerce:!0}),bigint:e=>Jn.create({...e,coerce:!0}),date:e=>an.create({...e,coerce:!0})},any:la,array:ku,bigint:xu,boolean:Qr,date:Su,discriminatedUnion:Mu,effect:da,enum:Pn,function:Bu,instanceof:Au,intersection:Nu,lazy:ju,literal:Fu,map:Lu,nan:_u,nativeEnum:Wu,never:Iu,null:Cu,nullable:Gu,number:ve,object:st,oboolean:()=>Qr().optional(),onumber:()=>ve().optional(),optional:Vu,ostring:()=>Fe().optional(),pipeline:zu,preprocess:Hu,promise:$u,record:ua,set:Uu,strictObject:Du,string:Fe,symbol:Tu,transformer:da,tuple:Ru,undefined:Eu,union:ji,unknown:Ou,void:Pu,NEVER:ee,ZodIssueCode:G,quotelessJson:du,ZodError:Pt});const Xr=()=>Fe().uuid(),qu=/^(?=.{1,255}$)[0-9A-Za-z_](?:(?:[0-9A-Za-z_]|-){0,61}[0-9A-Za-z_])?(?:\.[0-9A-Za-z_](?:(?:[0-9A-Za-z_]|-){0,61}[0-9A-Za-z_])?)*\.?$/,ha=()=>Fe().regex(qu);st({id:Xr(),host:ha(),startedAt:ve().positive(),endedAt:ve().nullable().optional()}).strict();const ga=st({id:Xr(),sessionId:Xr(),adUrl:Fe().url(),timestamp:ve().positive().describe("The time in ms since 1970 that this ad was seen at")}).strict(),Zu=ga.extend({type:Pn(["image"]),additionalDetails:st({width:ve().nonnegative(),height:ve().nonnegative()})}).strict(),Ku=ga.extend({type:Pn(["iframe"]),additionalDetails:st({width:ve().nonnegative(),height:ve().nonnegative()})}).strict();ji([Zu,Ku]);const Fi=Xr,fa=ha,Wi=()=>Qr().nullable().optional(),$i=()=>Qr().nullable().optional();st({id:Fi(),host:fa(),startedAt:ve().positive(),endedAt:ve().nullable().optional(),imported:Wi(),generated:$i()}).strict();const pa=st({id:Fe(),sessionId:Fi(),timestamp:ve().positive().describe("The time in ms since 1970 that this ad was seen at"),imported:Wi()}).strict(),Yu=pa.extend({type:Pn(["basic-display"]),details:st({type:Pn(["image","iframe"]),url:Fe().url().describe("The URL the ad is accessible at"),width:ve().nonnegative(),height:ve().nonnegative()}).strict()}),Ju=()=>ua(Fe(),la()),Qu=pa.extend({type:Pn(["youtube/hulu/vast","pathmatics"]),details:Ju()}),Xu=ji([Yu,Qu]),Vi=Fi,Gi=Wi,ed=$i,Hi=()=>fa().describe("The mobile app bundle ID or website hostname"),td=st({id:Vi(),appId:Hi(),createdBy:Fe({description:"The install id that created the session"}),startedAt:ve().positive(),endedAt:ve(),imported:Gi(),generated:ed()}).strict(),nd=st({id:Vi(),appId:Hi(),createdBy:Fe(),startedAt:ve().positive(),endedAt:ve().nullable().optional(),imported:Gi(),generated:$i()}).strict(),rd=Xu,ma=Vi,ya=Gi,va=Hi,id=td,sd=nd,ad=st({id:ma(),appId:va(),path:Fe().startsWith("/"),referrer:Fe().nullish(),createdBy:Fe(),startedAt:ve().positive(),endedAt:ve(),imported:ya()}).strict(),od=st({id:ma(),appId:va(),path:Fe().startsWith("/"),referrer:Fe().nullish(),createdBy:Fe(),startedAt:ve().positive(),endedAt:ve().nullish(),imported:ya()}).strict(),cd=rd,ld=id,ba=sd,ud=ad,dd=od,wa=cd;class zi{constructor(t,n){this.db=t,this.storeName=n}async deleteAll(){const t=(await this.db).transaction(this.storeName,"readwrite");let n=await t.objectStore(this.storeName).openCursor();for(;n;)await n.delete(),n=await n.continue();await t.done}async findAll(){return await(await this.db).getAll(this.storeName)}}const ur=class extends zi{constructor(e){super(e.db,ur.STORE_NAME_LATEST),this.config=e}async findAds(e,t){return await(await this.db).getAllFromIndex(this.storeName,ur.INDEX_TIMESTAMP,IDBKeyRange.bound(e,t,!1,!0))}async findAdsForSession(e){return await(await this.db).getAllFromIndex(this.storeName,ur.INDEX_SESSION_ID,e)}async upsertAd(e){var t,n;const r=await this.db,i=wa.parse(e);return(n=(t=this.config).onAdUpserted)==null||n.call(t,i),await r.put(this.storeName,i),i}};let Te=ur;Te.STORE_NAME_1="ads",Te.STORE_NAME_2="ads-2",Te.STORE_NAME_LATEST=ur.STORE_NAME_2,Te.INDEX_SESSION_ID="idx_ad_sessionId",Te.INDEX_TIMESTAMP="idx_ad_timestamp";let ei;const hd=new Uint8Array(16);function gd(){if(!ei&&(ei=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ei))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ei(hd)}const Ne=[];for(let e=0;e<256;++e)Ne.push((e+256).toString(16).slice(1));function fd(e,t=0){return(Ne[e[t+0]]+Ne[e[t+1]]+Ne[e[t+2]]+Ne[e[t+3]]+"-"+Ne[e[t+4]]+Ne[e[t+5]]+"-"+Ne[e[t+6]]+Ne[e[t+7]]+"-"+Ne[e[t+8]]+Ne[e[t+9]]+"-"+Ne[e[t+10]]+Ne[e[t+11]]+Ne[e[t+12]]+Ne[e[t+13]]+Ne[e[t+14]]+Ne[e[t+15]]).toLowerCase()}const pd=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Aa={randomUUID:pd};function dr(e,t,n){if(Aa.randomUUID&&!t&&!e)return Aa.randomUUID();e=e||{};const r=e.random||(e.rng||gd)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(let i=0;i<16;++i)t[n+i]=r[i];return t}return fd(r)}const qi=-1;function md(e){var t;return{id:e.id,appId:e.appId,path:e.path,referrer:e.referrer,createdBy:e.createdBy,endedAt:(t=e.endedAt)!=null?t:qi,startedAt:e.startedAt,imported:e.imported}}function Zi(e){return{id:e.id,appId:e.appId,path:e.path,referrer:e.referrer,createdBy:e.createdBy,endedAt:e.endedAt===qi?null:e.endedAt,startedAt:e.startedAt,imported:e.imported}}const hr=class extends zi{constructor(e){super(e.db,hr.STORE_NAME_LATEST),this.config=e}async startPageView(e){const t=await this.db,n=dd.parse({...e,id:dr(),createdBy:await this.config.getInstallId(),endedAt:void 0}),r=md(n);return await t.add(this.storeName,r),n}async endPageView(e,t){const n=await this.db,r=await n.get(this.storeName,e.id);if(r==null)throw Error(`Cannot update: PageView not found with id=${e.id}`);const i={...r,endedAt:t};return await n.put(this.storeName,i),Zi(i)}async getActivePageViews(){return(await(await this.db).getAllFromIndex(this.storeName,hr.INDEX_ENDED_AT,qi)).map(Zi)}async findPageViewsByEndedAt(e,t){return(await(await this.db).getAllFromIndex(this.storeName,hr.INDEX_ENDED_AT,IDBKeyRange.bound(e,t,!1,!0))).map(Zi)}async deleteAllGeneratedPageViews(){const e=(await this.db).transaction(this.storeName,"readwrite");let t=await e.store.openCursor();for(;t;)t.value.imported&&await t.delete(),t=await t.continue();await e.done}};let Mt=hr;Mt.STORE_NAME_1="page_views",Mt.STORE_NAME_LATEST=hr.STORE_NAME_1,Mt.INDEX_ENDED_AT="idx_page_view_endedAt",Mt.INDEX_STARTED_AT="idx_page_view_startedAt";function _a(e,t,n,r){function i(s){return s instanceof n?s:new n(function(a){a(s)})}return new(n||(n=Promise))(function(s,a){function l(u){try{o(r.next(u))}catch(h){a(h)}}function c(u){try{o(r.throw(u))}catch(h){a(h)}}function o(u){u.done?s(u.value):i(u.value).then(l,c)}o((r=r.apply(e,t||[])).next())})}function xa(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(o){return function(u){return c([o,u])}}function c(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(n=0)),n;)try{if(r=1,i&&(s=o[0]&2?i.return:o[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,o[1])).done)return s;switch(i=0,s&&(o=[o[0]&2,s.value]),o[0]){case 0:case 1:s=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,i=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(o[0]===6||o[0]===2)){n=0;continue}if(o[0]===3&&(!s||o[1]>s[0]&&o[1]<s[3])){n.label=o[1];break}if(o[0]===6&&n.label<s[1]){n.label=s[1],s=o;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(o);break}s[2]&&n.ops.pop(),n.trys.pop();continue}o=t.call(e,n)}catch(u){o=[6,u],i=0}finally{r=s=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}var yd=new Error("request for lock canceled"),vd=function(){function e(t,n){n===void 0&&(n=yd),this._value=t,this._cancelError=n,this._weightedQueues=[],this._weightedWaiters=[]}return e.prototype.acquire=function(t){var n=this;if(t===void 0&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise(function(r,i){n._weightedQueues[t-1]||(n._weightedQueues[t-1]=[]),n._weightedQueues[t-1].push({resolve:r,reject:i}),n._dispatch()})},e.prototype.runExclusive=function(t,n){return n===void 0&&(n=1),_a(this,void 0,void 0,function(){var r,i,s;return xa(this,function(a){switch(a.label){case 0:return[4,this.acquire(n)];case 1:r=a.sent(),i=r[0],s=r[1],a.label=2;case 2:return a.trys.push([2,,4,5]),[4,t(i)];case 3:return[2,a.sent()];case 4:return s(),[7];case 5:return[2]}})})},e.prototype.waitForUnlock=function(t){var n=this;if(t===void 0&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise(function(r){n._weightedWaiters[t-1]||(n._weightedWaiters[t-1]=[]),n._weightedWaiters[t-1].push(r),n._dispatch()})},e.prototype.isLocked=function(){return this._value<=0},e.prototype.getValue=function(){return this._value},e.prototype.setValue=function(t){this._value=t,this._dispatch()},e.prototype.release=function(t){if(t===void 0&&(t=1),t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));this._value+=t,this._dispatch()},e.prototype.cancel=function(){var t=this;this._weightedQueues.forEach(function(n){return n.forEach(function(r){return r.reject(t._cancelError)})}),this._weightedQueues=[]},e.prototype._dispatch=function(){for(var t,n=this._value;n>0;n--){var r=(t=this._weightedQueues[n-1])===null||t===void 0?void 0:t.shift();if(r){var i=this._value,s=n;this._value-=n,n=this._value+1,r.resolve([i,this._newReleaser(s)])}}this._drainUnlockWaiters()},e.prototype._newReleaser=function(t){var n=this,r=!1;return function(){r||(r=!0,n.release(t))}},e.prototype._drainUnlockWaiters=function(){for(var t=this._value;t>0;t--)!this._weightedWaiters[t-1]||(this._weightedWaiters[t-1].forEach(function(n){return n()}),this._weightedWaiters[t-1]=[])},e}(),Sa=function(){function e(t){this._semaphore=new vd(1,t)}return e.prototype.acquire=function(){return _a(this,void 0,void 0,function(){var t,n;return xa(this,function(r){switch(r.label){case 0:return[4,this._semaphore.acquire()];case 1:return t=r.sent(),n=t[1],[2,n]}})})},e.prototype.runExclusive=function(t){return this._semaphore.runExclusive(function(){return t()})},e.prototype.isLocked=function(){return this._semaphore.isLocked()},e.prototype.waitForUnlock=function(){return this._semaphore.waitForUnlock()},e.prototype.release=function(){this._semaphore.isLocked()&&this._semaphore.release()},e.prototype.cancel=function(){return this._semaphore.cancel()},e}(),gr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ta={exports:{}};(function(e,t){(function(n,r){r(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:gr,function(n){var r,i;if(!((i=(r=globalThis.chrome)==null?void 0:r.runtime)!=null&&i.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const s="The message port closed before a response was received.",a=l=>{const c={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(c).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(x,I=void 0){super(I),this.createItem=x}get(x){return this.has(x)||this.set(x,this.createItem(x)),super.get(x)}}const u=b=>b&&typeof b=="object"&&typeof b.then=="function",h=(b,x)=>(...I)=>{l.runtime.lastError?b.reject(new Error(l.runtime.lastError.message)):x.singleCallbackArg||I.length<=1&&x.singleCallbackArg!==!1?b.resolve(I[0]):b.resolve(I)},d=b=>b==1?"argument":"arguments",f=(b,x)=>function(I,...R){if(R.length<x.minArgs)throw new Error(`Expected at least ${x.minArgs} ${d(x.minArgs)} for ${b}(), got ${R.length}`);if(R.length>x.maxArgs)throw new Error(`Expected at most ${x.maxArgs} ${d(x.maxArgs)} for ${b}(), got ${R.length}`);return new Promise((H,T)=>{if(x.fallbackToNoCallback)try{I[b](...R,h({resolve:H,reject:T},x))}catch(D){console.warn(`${b} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,D),I[b](...R),x.fallbackToNoCallback=!1,x.noCallback=!0,H()}else x.noCallback?(I[b](...R),H()):I[b](...R,h({resolve:H,reject:T},x))})},g=(b,x,I)=>new Proxy(x,{apply(R,H,T){return I.call(H,b,...T)}});let m=Function.call.bind(Object.prototype.hasOwnProperty);const A=(b,x={},I={})=>{let R=Object.create(null),H={has(D,y){return y in b||y in R},get(D,y,k){if(y in R)return R[y];if(!(y in b))return;let N=b[y];if(typeof N=="function")if(typeof x[y]=="function")N=g(b,b[y],x[y]);else if(m(I,y)){let $=f(y,I[y]);N=g(b,b[y],$)}else N=N.bind(b);else if(typeof N=="object"&&N!==null&&(m(x,y)||m(I,y)))N=A(N,x[y],I[y]);else if(m(I,"*"))N=A(N,x[y],I["*"]);else return Object.defineProperty(R,y,{configurable:!0,enumerable:!0,get(){return b[y]},set($){b[y]=$}}),N;return R[y]=N,N},set(D,y,k,N){return y in R?R[y]=k:b[y]=k,!0},defineProperty(D,y,k){return Reflect.defineProperty(R,y,k)},deleteProperty(D,y){return Reflect.deleteProperty(R,y)}},T=Object.create(b);return new Proxy(T,H)},E=b=>({addListener(x,I,...R){x.addListener(b.get(I),...R)},hasListener(x,I){return x.hasListener(b.get(I))},removeListener(x,I){x.removeListener(b.get(I))}}),_=new o(b=>typeof b!="function"?b:function(x){const I=A(x,{},{getContent:{minArgs:0,maxArgs:0}});b(I)}),p=new o(b=>typeof b!="function"?b:function(x,I,R){let H=!1,T,D=new Promise($=>{T=function(j){H=!0,$(j)}}),y;try{y=b(x,I,T)}catch($){y=Promise.reject($)}const k=y!==!0&&u(y);return y!==!0&&!k&&!H?!1:(($=>{$.then(j=>{R(j)},j=>{let Z;j&&(j instanceof Error||typeof j.message=="string")?Z=j.message:Z="An unexpected error occurred",R({__mozWebExtensionPolyfillReject__:!0,message:Z})}).catch(j=>{console.error("Failed to send onMessage rejected reply",j)})})(k?y:D),!0)}),v=({reject:b,resolve:x},I)=>{l.runtime.lastError?l.runtime.lastError.message===s?x():b(new Error(l.runtime.lastError.message)):I&&I.__mozWebExtensionPolyfillReject__?b(new Error(I.message)):x(I)},C=(b,x,I,...R)=>{if(R.length<x.minArgs)throw new Error(`Expected at least ${x.minArgs} ${d(x.minArgs)} for ${b}(), got ${R.length}`);if(R.length>x.maxArgs)throw new Error(`Expected at most ${x.maxArgs} ${d(x.maxArgs)} for ${b}(), got ${R.length}`);return new Promise((H,T)=>{const D=v.bind(null,{resolve:H,reject:T});R.push(D),I.sendMessage(...R)})},S={devtools:{network:{onRequestFinished:E(_)}},runtime:{onMessage:E(p),onMessageExternal:E(p),sendMessage:C.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:C.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},P={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return c.privacy={network:{"*":P},services:{"*":P},websites:{"*":P}},A(l,S,c)};n.exports=a(chrome)}else n.exports=globalThis.browser})})(Ta);const he=Ta.exports;class bd{constructor(t,n=Date.now()){this.logMethod=t,this.startedAt=n}log(t){const n=Date.now()-this.startedAt;this.logMethod(t.replace(/\{duration\}/g,`${(n/1e3).toFixed(3)}s`))}}const kn=1e3,Ki=60*kn,wd=60*Ki;function ti(e){return Math.round(e/1e3)}function Ad(){return new Promise(e=>setTimeout(e,0))}function _d(e){const t=new Sa;return(...n)=>t.runExclusive(()=>e(...n))}async function Yi(e){return(await he.storage.local.get(e))[e]}async function fr(e,t){t===void 0?await he.storage.local.remove(e):await he.storage.local.set({[e]:t})}function xd(e,t){const n=typeof t=="string",r=i=>n?i[t]:t(i);return e.reduce((i,s)=>{var a,l;const c=r(s);return i[c]=(l=(a=i[c])==null?void 0:a.concat(s))!=null?l:[s],i},{})}function Sd(e,t){const n=typeof t=="string",r=i=>n?i[t]:t(i);return e.reduce((i,s)=>{const a=r(s);return i[a]=s,i},{})}function Td(){let e,t;return[new Promise((n,r)=>{e=n,t=r}),e,t]}function Ed(e){return e.state!=="docked"&&e.state!=="minimized"}function Cd(e,t,n,r){return r&&e.audible||e.active&&t.focused&&Ed(t)&&n}function Ea(e){const t=e.objectStoreNames.length,n=[];for(let r=0;r<t;r++){const i=e.objectStoreNames.item(r);i&&n.push(i)}return n}const Ji=-1;function Ca(e){var t;return{id:e.id,appId:e.appId,createdBy:e.createdBy,endedAt:(t=e.endedAt)!=null?t:Ji,startedAt:e.startedAt,imported:e.imported,generated:e.generated}}function un(e){return{id:e.id,appId:e.appId,createdBy:e.createdBy,endedAt:e.endedAt===Ji?null:e.endedAt,startedAt:e.startedAt,imported:e.imported,generated:e.generated}}const Nt=class extends zi{constructor(e){super(e.db,Nt.STORE_NAME_LATEST),this.config=e}async startSession(e){const t=await this.db,n=ba.parse({...e,id:dr(),createdBy:await this.config.getInstallId(),endedAt:void 0}),r=Ca(n);return await t.add(this.storeName,r),n}async createSessions(e){const t=await this.db,n=await this.config.getInstallId(),r=t.transaction(Nt.STORE_NAME_LATEST,"readwrite"),i=r.objectStore(Nt.STORE_NAME_LATEST),s=e.map(l=>ba.parse({...l,id:dr(),createdBy:n})),a=s.map(Ca);return await Promise.all([...a.map(l=>i.add(l)),r.done]),s}async endSession(e,t){var n,r;const i=await this.db;t-e.startedAt>=6*wd&&((r=(n=this.config).onLongSessionDetected)==null||r.call(n,e,t),t=e.startedAt+10*Ki);const s=await i.get(this.storeName,e.id);if(s==null)throw Error(`Cannot update: Session not found with id=${e.id}`);const a={...s,endedAt:t};return await i.put(this.storeName,a),un(a)}async findAllSessions(){return(await super.findAll()).map(un)}async findSessions(e,t){return(await(await this.db).getAllFromIndex(this.storeName,Nt.INDEX_STARTED_AT,IDBKeyRange.bound(e,t,!1,!0))).map(un)}async findSessionsByEndedAt(e,t){return(await(await this.db).getAllFromIndex(this.storeName,Nt.INDEX_ENDED_AT,IDBKeyRange.bound(e,t,!1,!0))).map(un)}async findOldestSession(){const e=(await(await this.db).getAllFromIndex(this.storeName,Nt.INDEX_STARTED_AT,IDBKeyRange.lowerBound(0,!0))).shift();return e?un(e):void 0}async getSession(e){const t=await(await this.db).get(this.storeName,e);if(t==null)throw Error(`No session with id=${e} was found`);return un(t)}async getActiveSessions(){return(await(await this.db).getAllFromIndex(this.storeName,Nt.INDEX_ENDED_AT,Ji)).map(un)}async deleteAllGeneratedSessions(){const e=(await this.db).transaction(this.storeName,"readwrite");let t=await e.store.openCursor();for(;t;){const n=t.value;(n.imported||n.generated)&&await t.delete(),t=await t.continue()}await e.done}};let Ae=Nt;Ae.STORE_NAME_1="sessions",Ae.STORE_NAME_2="sessions_2",Ae.STORE_NAME_LATEST=Nt.STORE_NAME_2,Ae.INDEX_ENDED_AT="idx_session_endedAt",Ae.INDEX_STARTED_AT="idx_session_startedAt";var Re=(e=>(e[e.V2=2]="V2",e[e.V3=3]="V3",e[e.V4=4]="V4",e[e.V5=5]="V5",e[e.V6=6]="V6",e[e.V7=7]="V7",e[e.V8=8]="V8",e))(Re||{});const Od=at.object({version:at.nativeEnum(Re),stores:at.object({[Ae.STORE_NAME_LATEST]:at.array(ld).optional(),[Mt.STORE_NAME_LATEST]:at.array(ud).optional(),[Te.STORE_NAME_LATEST]:at.array(wa).optional()})});at.object({version:at.nativeEnum(Re),stores:at.record(at.string(),at.array(at.any()))});async function Id(e){const t=await e,n={version:t.version,stores:{}},r=Ea(t),i=t.transaction(r,"readonly");for(const s of r){const a=await i.objectStore(s).getAll();a.forEach(l=>{delete l.imported}),n.stores[s]=a}return await i.done,n}function Pd(e,t){return{...e,id:dr(),sessionId:t}}function kd(e){return{...e,id:dr()}}function Oa(e){return{id:e.id,sessionId:e.sessionId,timestamp:e.timestamp,type:"basic-display",details:{type:e.type,height:e.additionalDetails.height,width:e.additionalDetails.width,url:e.adUrl}}}function ni(e,t){var n;return{id:e.id,appId:e.host,createdBy:t,startedAt:e.startedAt,endedAt:(n=e.endedAt)!=null?n:-1,imported:e.imported,generated:e.generated}}async function Dd({dbPromise:e,usageBackup:t,logger:n,getInstallId:r}){const i=await e;n==null||n.debug("[import-backup] Importing...",t);const s=await r(),a=await Od.parseAsync(await Ia(t,i.version,{installId:s})),l=Ea(i),c=i.transaction(l,"readwrite");for(const o of l){const u=a.stores[o];if(u!=null&&u.length){const h=c.objectStore(o);for(const d of u)n==null||n.debug(`[import-backup]: ${o}:`,d),await h.put({...d,imported:!0})}}await c.done}const Qi=e=>t=>({...t,version:e}),Md=()=>e=>e,Nd=e=>{var t;return{version:Re.V4,stores:{[Ae.STORE_NAME_2]:e.stores[Ae.STORE_NAME_2],[Te.STORE_NAME_2]:(t=e.stores[Te.STORE_NAME_2])==null?void 0:t.map(Oa)}}},Rd=(e,{installId:t})=>{var n;return{version:Re.V6,stores:{[Ae.STORE_NAME_2]:(n=e.stores[Ae.STORE_NAME_2])==null?void 0:n.map(r=>ni(r,t)),[Te.STORE_NAME_2]:e.stores[Te.STORE_NAME_2]}}},Ld=(e,{installId:t})=>{var n;return{version:Re.V7,stores:{[Ae.STORE_NAME_2]:(n=e.stores[Ae.STORE_NAME_2])==null?void 0:n.map(r=>"host"in r?ni(r,t):r),[Te.STORE_NAME_2]:e.stores[Te.STORE_NAME_2]}}},Ud={[Re.V2]:Qi(Re.V3),[Re.V3]:Nd,[Re.V4]:Qi(Re.V5),[Re.V5]:Rd,[Re.V6]:Ld,[Re.V7]:Qi(Re.V8),[Re.V8]:Md()};async function Ia(e,t,n){if(e.version===t)return e;const r=Ud[e.version];if(r==null)throw Error(`Failed to upgrade backup version ${e.version}, version not supported`);const i=await r(e,n);return await Ia(i,t,n)}const Bd=(e,t)=>t.some(n=>e instanceof n);let Pa,ka;function jd(){return Pa||(Pa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Fd(){return ka||(ka=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Da=new WeakMap,Xi=new WeakMap,Ma=new WeakMap,es=new WeakMap,ts=new WeakMap;function Wd(e){const t=new Promise((n,r)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",a)},s=()=>{n(Gt(e.result)),i()},a=()=>{r(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",a)});return t.then(n=>{n instanceof IDBCursor&&Da.set(n,e)}).catch(()=>{}),ts.set(t,e),t}function $d(e){if(Xi.has(e))return;const t=new Promise((n,r)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",a),e.removeEventListener("abort",a)},s=()=>{n(),i()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",a),e.addEventListener("abort",a)});Xi.set(e,t)}let ns={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return Xi.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Ma.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Gt(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Vd(e){ns=e(ns)}function Gd(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const r=e.call(rs(this),t,...n);return Ma.set(r,t.sort?t.sort():[t]),Gt(r)}:Fd().includes(e)?function(...t){return e.apply(rs(this),t),Gt(Da.get(this))}:function(...t){return Gt(e.apply(rs(this),t))}}function Hd(e){return typeof e=="function"?Gd(e):(e instanceof IDBTransaction&&$d(e),Bd(e,jd())?new Proxy(e,ns):e)}function Gt(e){if(e instanceof IDBRequest)return Wd(e);if(es.has(e))return es.get(e);const t=Hd(e);return t!==e&&(es.set(e,t),ts.set(t,e)),t}const rs=e=>ts.get(e);function zd(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),l=Gt(a);return r&&a.addEventListener("upgradeneeded",c=>{r(Gt(a.result),c.oldVersion,c.newVersion,Gt(a.transaction),c)}),n&&a.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",o=>i(o.oldVersion,o.newVersion,o))}).catch(()=>{}),l}const qd=["get","getKey","getAll","getAllKeys","count"],Zd=["put","add","delete","clear"],is=new Map;function Na(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(is.get(t))return is.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=Zd.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||qd.includes(n)))return;const s=async function(a,...l){const c=this.transaction(a,i?"readwrite":"readonly");let o=c.store;return r&&(o=o.index(l.shift())),(await Promise.all([o[n](...l),i&&c.done]))[0]};return is.set(t,s),s}Vd(e=>({...e,get:(t,n,r)=>Na(t,n)||e.get(t,n,r),has:(t,n)=>!!Na(t,n)||e.has(t,n)}));async function Kd({db:e,tx:t}){const n=t.objectStore(Ae.STORE_NAME_1),r=t.objectStore(Ae.STORE_NAME_2),i=t.objectStore(Te.STORE_NAME_1),s=t.objectStore(Te.STORE_NAME_2),a=await n.index(Ae.INDEX_STARTED_AT).getAll();for(const l of a){const c=kd(l);await r.add(c);const o=await i.index(Te.INDEX_SESSION_ID).getAll(l.id);for(const u of o){const h=Pd(u,c.id);await s.add(h)}}e.deleteObjectStore(n.name),e.deleteObjectStore(i.name)}async function Yd({tx:e}){const t=e.objectStore(Te.STORE_NAME_2),n=await t.getAll();for(const r of n){const i=Oa(r);await t.put(i)}}async function Jd({tx:e,ctx:t}){const n=e.objectStore(Ae.STORE_NAME_2),r=await n.getAll();for(const i of r){const s=ni(i,t.installId);await n.put(s)}}async function Qd({tx:e,ctx:t}){const n=e.objectStore(Ae.STORE_NAME_2),r=await n.getAll();for(const i of r)if("host"in i){const s=ni(i,t.installId);await n.put(s)}}const ri=()=>{},Xd=[ri,ri,ri,Kd,Yd,ri,Jd,Qd];async function eh(e,{logger:t}){if(e.oldVersion===0||e.newVersion==null){t==null||t.debug("[usage-database] Skipping migrations for new databases",{oldVersion:e.oldVersion,newVersion:e.newVersion});return}const n=e.oldVersion+1,r=e.newVersion,i=Xd.slice(n,r+1);if(i.length===0){t==null||t.log("[usage-database] No migrations to run");return}t==null||t.log(`[usage-database] Running migrations ${n} -> ${r}`);for(const s of i)await s(e)}function Dn(e,t,n,r){return e.indexNames.contains(t)?e.index(t):e.createIndex(t,n,r)}function ss({db:e,tx:t},n,r){return e.objectStoreNames.contains(n)?t.objectStore(n):e.createObjectStore(n,r)}const th=Re.V8;async function nh(e){const t=await e.getInstallId();return zd("UsageSdkDb",th,{async upgrade(n,r,i,s){const a={db:n,oldVersion:r,newVersion:i,tx:s,ctx:{installId:t}};rh(a),await eh(a,{logger:null})}})}function rh(e){const t=ss(e,Ae.STORE_NAME_LATEST,{keyPath:"id"});Dn(t,Ae.INDEX_STARTED_AT,"startedAt",{unique:!1}),Dn(t,Ae.INDEX_ENDED_AT,"endedAt",{unique:!1});const n=ss(e,Mt.STORE_NAME_LATEST,{keyPath:"id"});Dn(n,Mt.INDEX_STARTED_AT,"startedAt",{unique:!1}),Dn(n,Mt.INDEX_ENDED_AT,"endedAt",{unique:!1});const r=ss(e,Te.STORE_NAME_LATEST,{keyPath:"id"});Dn(r,Te.INDEX_SESSION_ID,"sessionId",{unique:!1}),Dn(r,Te.INDEX_TIMESTAMP,"timestamp",{unique:!1})}function ih(e){const t=nh(e),n=e.logger===void 0?console:e.logger;return{indexedDb:t,sessionsRepo:new Ae({db:t,...e}),pageViewsRepo:new Mt({db:t,...e}),adsRepo:new Te({db:t,...e}),exportBackup:()=>Id(t),importBackup:r=>Dd({dbPromise:t,usageBackup:r,getInstallId:e.getInstallId,logger:n})}}var as={exports:{}};(function(e,t){var n=200,r="__lodash_hash_undefined__",i=1,s=2,a=9007199254740991,l="[object Arguments]",c="[object Array]",o="[object AsyncFunction]",u="[object Boolean]",h="[object Date]",d="[object Error]",f="[object Function]",g="[object GeneratorFunction]",m="[object Map]",A="[object Number]",E="[object Null]",_="[object Object]",p="[object Promise]",v="[object Proxy]",C="[object RegExp]",S="[object Set]",P="[object String]",b="[object Symbol]",x="[object Undefined]",I="[object WeakMap]",R="[object ArrayBuffer]",H="[object DataView]",T="[object Float32Array]",D="[object Float64Array]",y="[object Int8Array]",k="[object Int16Array]",N="[object Int32Array]",$="[object Uint8Array]",j="[object Uint8ClampedArray]",Z="[object Uint16Array]",M="[object Uint32Array]",B=/[\\^$.*+?()[\]{}|]/g,F=/^\[object .+?Constructor\]$/,W=/^(?:0|[1-9]\d*)$/,ce={};ce[T]=ce[D]=ce[y]=ce[k]=ce[N]=ce[$]=ce[j]=ce[Z]=ce[M]=!0,ce[l]=ce[c]=ce[R]=ce[u]=ce[H]=ce[h]=ce[d]=ce[f]=ce[m]=ce[A]=ce[_]=ce[C]=ce[S]=ce[P]=ce[I]=!1;var Ot=typeof gr=="object"&&gr&&gr.Object===Object&&gr,Ar=typeof self=="object"&&self&&self.Object===Object&&self,dt=Ot||Ar||Function("return this")(),_r=t&&!t.nodeType&&t,xr=_r&&!0&&e&&!e.nodeType&&e,wi=xr&&xr.exports===_r,zt=wi&&Ot.process,Sr=function(){try{return zt&&zt.binding&&zt.binding("util")}catch{}}(),qt=Sr&&Sr.isTypedArray;function Cs(w,O){for(var U=-1,q=w==null?0:w.length,fe=0,te=[];++U<q;){var be=w[U];O(be,U,w)&&(te[fe++]=be)}return te}function Tr(w,O){for(var U=-1,q=O.length,fe=w.length;++U<q;)w[fe+U]=O[U];return w}function pn(w,O){for(var U=-1,q=w==null?0:w.length;++U<q;)if(O(w[U],U,w))return!0;return!1}function Er(w,O){for(var U=-1,q=Array(w);++U<w;)q[U]=O(U);return q}function Os(w){return function(O){return w(O)}}function Ai(w,O){return w.has(O)}function _i(w,O){return w==null?void 0:w[O]}function rt(w){var O=-1,U=Array(w.size);return w.forEach(function(q,fe){U[++O]=[fe,q]}),U}function Zt(w,O){return function(U){return w(O(U))}}function Vn(w){var O=-1,U=Array(w.size);return w.forEach(function(q){U[++O]=q}),U}var ie=Array.prototype,le=Function.prototype,X=Object.prototype,ue=dt["__core-js_shared__"],At=le.toString,_e=X.hasOwnProperty,oe=function(){var w=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return w?"Symbol(src)_1."+w:""}(),Q=X.toString,ht=RegExp("^"+At.call(_e).replace(B,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gn=wi?dt.Buffer:void 0,mn=dt.Symbol,zo=dt.Uint8Array,qo=X.propertyIsEnumerable,Qp=ie.splice,yn=mn?mn.toStringTag:void 0,Zo=Object.getOwnPropertySymbols,Xp=Gn?Gn.isBuffer:void 0,em=Zt(Object.keys,Object),Is=Hn(dt,"DataView"),Cr=Hn(dt,"Map"),Ps=Hn(dt,"Promise"),ks=Hn(dt,"Set"),Ds=Hn(dt,"WeakMap"),Or=Hn(Object,"create"),tm=wn(Is),nm=wn(Cr),rm=wn(Ps),im=wn(ks),sm=wn(Ds),Ko=mn?mn.prototype:void 0,Ms=Ko?Ko.valueOf:void 0;function vn(w){var O=-1,U=w==null?0:w.length;for(this.clear();++O<U;){var q=w[O];this.set(q[0],q[1])}}function am(){this.__data__=Or?Or(null):{},this.size=0}function om(w){var O=this.has(w)&&delete this.__data__[w];return this.size-=O?1:0,O}function cm(w){var O=this.__data__;if(Or){var U=O[w];return U===r?void 0:U}return _e.call(O,w)?O[w]:void 0}function lm(w){var O=this.__data__;return Or?O[w]!==void 0:_e.call(O,w)}function um(w,O){var U=this.__data__;return this.size+=this.has(w)?0:1,U[w]=Or&&O===void 0?r:O,this}vn.prototype.clear=am,vn.prototype.delete=om,vn.prototype.get=cm,vn.prototype.has=lm,vn.prototype.set=um;function Ut(w){var O=-1,U=w==null?0:w.length;for(this.clear();++O<U;){var q=w[O];this.set(q[0],q[1])}}function dm(){this.__data__=[],this.size=0}function hm(w){var O=this.__data__,U=Si(O,w);if(U<0)return!1;var q=O.length-1;return U==q?O.pop():Qp.call(O,U,1),--this.size,!0}function gm(w){var O=this.__data__,U=Si(O,w);return U<0?void 0:O[U][1]}function fm(w){return Si(this.__data__,w)>-1}function pm(w,O){var U=this.__data__,q=Si(U,w);return q<0?(++this.size,U.push([w,O])):U[q][1]=O,this}Ut.prototype.clear=dm,Ut.prototype.delete=hm,Ut.prototype.get=gm,Ut.prototype.has=fm,Ut.prototype.set=pm;function bn(w){var O=-1,U=w==null?0:w.length;for(this.clear();++O<U;){var q=w[O];this.set(q[0],q[1])}}function mm(){this.size=0,this.__data__={hash:new vn,map:new(Cr||Ut),string:new vn}}function ym(w){var O=Ti(this,w).delete(w);return this.size-=O?1:0,O}function vm(w){return Ti(this,w).get(w)}function bm(w){return Ti(this,w).has(w)}function wm(w,O){var U=Ti(this,w),q=U.size;return U.set(w,O),this.size+=U.size==q?0:1,this}bn.prototype.clear=mm,bn.prototype.delete=ym,bn.prototype.get=vm,bn.prototype.has=bm,bn.prototype.set=wm;function xi(w){var O=-1,U=w==null?0:w.length;for(this.__data__=new bn;++O<U;)this.add(w[O])}function Am(w){return this.__data__.set(w,r),this}function _m(w){return this.__data__.has(w)}xi.prototype.add=xi.prototype.push=Am,xi.prototype.has=_m;function Kt(w){var O=this.__data__=new Ut(w);this.size=O.size}function xm(){this.__data__=new Ut,this.size=0}function Sm(w){var O=this.__data__,U=O.delete(w);return this.size=O.size,U}function Tm(w){return this.__data__.get(w)}function Em(w){return this.__data__.has(w)}function Cm(w,O){var U=this.__data__;if(U instanceof Ut){var q=U.__data__;if(!Cr||q.length<n-1)return q.push([w,O]),this.size=++U.size,this;U=this.__data__=new bn(q)}return U.set(w,O),this.size=U.size,this}Kt.prototype.clear=xm,Kt.prototype.delete=Sm,Kt.prototype.get=Tm,Kt.prototype.has=Em,Kt.prototype.set=Cm;function Om(w,O){var U=Ei(w),q=!U&&Vm(w),fe=!U&&!q&&Ns(w),te=!U&&!q&&!fe&&ic(w),be=U||q||fe||te,Pe=be?Er(w.length,String):[],Be=Pe.length;for(var ye in w)(O||_e.call(w,ye))&&!(be&&(ye=="length"||fe&&(ye=="offset"||ye=="parent")||te&&(ye=="buffer"||ye=="byteLength"||ye=="byteOffset")||Bm(ye,Be)))&&Pe.push(ye);return Pe}function Si(w,O){for(var U=w.length;U--;)if(ec(w[U][0],O))return U;return-1}function Im(w,O,U){var q=O(w);return Ei(w)?q:Tr(q,U(w))}function Ir(w){return w==null?w===void 0?x:E:yn&&yn in Object(w)?Lm(w):$m(w)}function Yo(w){return Pr(w)&&Ir(w)==l}function Jo(w,O,U,q,fe){return w===O?!0:w==null||O==null||!Pr(w)&&!Pr(O)?w!==w&&O!==O:Pm(w,O,U,q,Jo,fe)}function Pm(w,O,U,q,fe,te){var be=Ei(w),Pe=Ei(O),Be=be?c:Yt(w),ye=Pe?c:Yt(O);Be=Be==l?_:Be,ye=ye==l?_:ye;var it=Be==_,_t=ye==_,$e=Be==ye;if($e&&Ns(w)){if(!Ns(O))return!1;be=!0,it=!1}if($e&&!it)return te||(te=new Kt),be||ic(w)?Qo(w,O,U,q,fe,te):Nm(w,O,Be,U,q,fe,te);if(!(U&i)){var gt=it&&_e.call(w,"__wrapped__"),ft=_t&&_e.call(O,"__wrapped__");if(gt||ft){var Jt=gt?w.value():w,Bt=ft?O.value():O;return te||(te=new Kt),fe(Jt,Bt,U,q,te)}}return $e?(te||(te=new Kt),Rm(w,O,U,q,fe,te)):!1}function km(w){if(!rc(w)||Fm(w))return!1;var O=tc(w)?ht:F;return O.test(wn(w))}function Dm(w){return Pr(w)&&nc(w.length)&&!!ce[Ir(w)]}function Mm(w){if(!Wm(w))return em(w);var O=[];for(var U in Object(w))_e.call(w,U)&&U!="constructor"&&O.push(U);return O}function Qo(w,O,U,q,fe,te){var be=U&i,Pe=w.length,Be=O.length;if(Pe!=Be&&!(be&&Be>Pe))return!1;var ye=te.get(w);if(ye&&te.get(O))return ye==O;var it=-1,_t=!0,$e=U&s?new xi:void 0;for(te.set(w,O),te.set(O,w);++it<Pe;){var gt=w[it],ft=O[it];if(q)var Jt=be?q(ft,gt,it,O,w,te):q(gt,ft,it,w,O,te);if(Jt!==void 0){if(Jt)continue;_t=!1;break}if($e){if(!pn(O,function(Bt,An){if(!Ai($e,An)&&(gt===Bt||fe(gt,Bt,U,q,te)))return $e.push(An)})){_t=!1;break}}else if(!(gt===ft||fe(gt,ft,U,q,te))){_t=!1;break}}return te.delete(w),te.delete(O),_t}function Nm(w,O,U,q,fe,te,be){switch(U){case H:if(w.byteLength!=O.byteLength||w.byteOffset!=O.byteOffset)return!1;w=w.buffer,O=O.buffer;case R:return!(w.byteLength!=O.byteLength||!te(new zo(w),new zo(O)));case u:case h:case A:return ec(+w,+O);case d:return w.name==O.name&&w.message==O.message;case C:case P:return w==O+"";case m:var Pe=rt;case S:var Be=q&i;if(Pe||(Pe=Vn),w.size!=O.size&&!Be)return!1;var ye=be.get(w);if(ye)return ye==O;q|=s,be.set(w,O);var it=Qo(Pe(w),Pe(O),q,fe,te,be);return be.delete(w),it;case b:if(Ms)return Ms.call(w)==Ms.call(O)}return!1}function Rm(w,O,U,q,fe,te){var be=U&i,Pe=Xo(w),Be=Pe.length,ye=Xo(O),it=ye.length;if(Be!=it&&!be)return!1;for(var _t=Be;_t--;){var $e=Pe[_t];if(!(be?$e in O:_e.call(O,$e)))return!1}var gt=te.get(w);if(gt&&te.get(O))return gt==O;var ft=!0;te.set(w,O),te.set(O,w);for(var Jt=be;++_t<Be;){$e=Pe[_t];var Bt=w[$e],An=O[$e];if(q)var sc=be?q(An,Bt,$e,O,w,te):q(Bt,An,$e,w,O,te);if(!(sc===void 0?Bt===An||fe(Bt,An,U,q,te):sc)){ft=!1;break}Jt||(Jt=$e=="constructor")}if(ft&&!Jt){var Ci=w.constructor,Oi=O.constructor;Ci!=Oi&&"constructor"in w&&"constructor"in O&&!(typeof Ci=="function"&&Ci instanceof Ci&&typeof Oi=="function"&&Oi instanceof Oi)&&(ft=!1)}return te.delete(w),te.delete(O),ft}function Xo(w){return Im(w,zm,Um)}function Ti(w,O){var U=w.__data__;return jm(O)?U[typeof O=="string"?"string":"hash"]:U.map}function Hn(w,O){var U=_i(w,O);return km(U)?U:void 0}function Lm(w){var O=_e.call(w,yn),U=w[yn];try{w[yn]=void 0;var q=!0}catch{}var fe=Q.call(w);return q&&(O?w[yn]=U:delete w[yn]),fe}var Um=Zo?function(w){return w==null?[]:(w=Object(w),Cs(Zo(w),function(O){return qo.call(w,O)}))}:qm,Yt=Ir;(Is&&Yt(new Is(new ArrayBuffer(1)))!=H||Cr&&Yt(new Cr)!=m||Ps&&Yt(Ps.resolve())!=p||ks&&Yt(new ks)!=S||Ds&&Yt(new Ds)!=I)&&(Yt=function(w){var O=Ir(w),U=O==_?w.constructor:void 0,q=U?wn(U):"";if(q)switch(q){case tm:return H;case nm:return m;case rm:return p;case im:return S;case sm:return I}return O});function Bm(w,O){return O=O??a,!!O&&(typeof w=="number"||W.test(w))&&w>-1&&w%1==0&&w<O}function jm(w){var O=typeof w;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?w!=="__proto__":w===null}function Fm(w){return!!oe&&oe in w}function Wm(w){var O=w&&w.constructor,U=typeof O=="function"&&O.prototype||X;return w===U}function $m(w){return Q.call(w)}function wn(w){if(w!=null){try{return At.call(w)}catch{}try{return w+""}catch{}}return""}function ec(w,O){return w===O||w!==w&&O!==O}var Vm=Yo(function(){return arguments}())?Yo:function(w){return Pr(w)&&_e.call(w,"callee")&&!qo.call(w,"callee")},Ei=Array.isArray;function Gm(w){return w!=null&&nc(w.length)&&!tc(w)}var Ns=Xp||Zm;function Hm(w,O){return Jo(w,O)}function tc(w){if(!rc(w))return!1;var O=Ir(w);return O==f||O==g||O==o||O==v}function nc(w){return typeof w=="number"&&w>-1&&w%1==0&&w<=a}function rc(w){var O=typeof w;return w!=null&&(O=="object"||O=="function")}function Pr(w){return w!=null&&typeof w=="object"}var ic=qt?Os(qt):Dm;function zm(w){return Gm(w)?Om(w):Mm(w)}function qm(){return[]}function Zm(){return!1}e.exports=Hm})(as,as.exports);const sh=as.exports;function Ra(e,t){var n;if(typeof e=="string"&&(e=ah(e.trim())),!e)return;let r=(n=t==null?void 0:t.removeGenericPrefixes)!=null?n:!0,i=e.hostname;return r&&(i=i.replace(/^(m|mobile|amp|www|www1|www2|www3|tab|item|checkout|secure|user|account|accounts|web|app|open|i|v|preview|cdn|l|id|nid|user|sso|signin|login|auth0|play|api|click|detail|dashboard|console|manage|support|help)\./,"").replace(/.*\.zoom\.us/,"zoom.us").replace(/.*\.slack\.com/,"slack.com").replace(/.*\.wikipedia\.org/,"wikipedia.org").replace(/.*\.amazonaws\.com/,"amazonaws.com").replace(/.*\.netsuite\.com/,"netsuite.com")),{hostname:i,path:oh(e.pathname)}}function ah(e){if(!e)return;let t=n=>{let r=new URL(n);if(!/^https?:/.test(r.protocol))throw Error("Invalid URL, ignored protocol found");if(!r.hostname)throw Error("Invalid URL, no hostname");if(r.hostname.lastIndexOf(".")>=r.hostname.length-2)throw Error("Invalid URL, bad domain ending");return r};try{return t(e)}catch{}if(!e.includes("://"))try{return t("https://"+e)}catch{}}function oh(e){return e.endsWith("/")?e.substring(0,Math.max(1,e.length-1)):e}const ii="tab-history-map",La=class{constructor(e){this.tabHistoryMap=this.restoreTabHistory(),this.lock=new Sa;let t=0;he.tabs.onCreated.addListener(n=>this.lock.runExclusive(async()=>{var r;if(n.id!=null&&(e==null||e.debug(`[referrer] ${t++} tabs.onCreated`,n),n.openerTabId!=null)){const i=(r=(await this.tabHistoryMap)[n.openerTabId])==null?void 0:r[0];i&&await this.addHistory(n.id,i)}})),he.webNavigation.onCommitted.addListener(n=>this.lock.runExclusive(async()=>{e==null||e.debug(`[referrer] ${t++} webNavigation.onCommitted`,n);const{frameId:r,tabId:i,url:s,transitionQualifiers:a}=n;r===0&&((a.includes("forward_back")||a.includes("from_address_bar"))&&await this.addHistory(i,void 0),await this.addHistory(i,s))})),he.runtime.onStartup.addListener(()=>this.resetHistory()),he.runtime.onSuspend.addListener(()=>this.resetHistory()),he.tabs.onRemoved.addListener(n=>this.removeHistory(n))}async restoreTabHistory(){const e=await Yi(ii);return e??{}}async addHistory(e,t){var n;const r=await this.tabHistoryMap,i=(n=r[e])!=null?n:r[e]=[];t!==i[0]&&i.unshift(this.sanatizeReferrerUrl(t)),i.splice(La.MAX_HISTORY_COUNT_PER_TAB),await fr(ii,r)}sanatizeReferrerUrl(e){if(e)try{const t=new URL(e);return t.search="",t.username="",t.password="",t.hash="",t.href}catch{return}}getReferrerFor(e,t){return this.lock.runExclusive(async()=>{if(e==null||!t)return;const n=(await this.tabHistoryMap)[e];if(n==null)return;const r=n.findIndex(i=>i===t);return r===-1?void 0:n[r+1]})}resetHistory(){return fr(ii,{})}async removeHistory(e){const t=await this.tabHistoryMap;delete t[e],await fr(ii,t)}};let Ua=La;Ua.MAX_HISTORY_COUNT_PER_TAB=10;class Ba{constructor(){this.map={}}markAsProcessed(t){t.forEach(n=>this.map[n.id]=!0)}isProcessed(t){var n;return(n=this.map[t.id])!=null?n:!1}}const Et=class{constructor(e,t){this.wakeUpTimeoutDisabled=!1,this.hasRecentUserActivity=!0,this.sessionUpdatedListeners=[],this.pageViewUpdatedListeners=[],this.checkSessionsListeners=[],this.latestTriggerId=0,this.updateSessions=_d(async i=>{var s,a,l;const c=`[update-sessions] [${i.triggerId}]`;if((s=this.logger)==null||s.debug(`${c} Waiting for startup to stop previous sessions...`),await this.startupPromise,(a=this.logger)==null||a.debug(`${c} Processing @ ${new Date(i.timestamp).toLocaleTimeString()}`),this.pingLastAliveAt(),this.invokeCheckSessionsListeners(),await this.config.enabled()){const o=this.logger?new bd(this.logger.debug.bind(this.logger)):void 0,u=await this.getComputeDependencies();o==null||o.log(`${c} Got required data after {duration}`);const h=this.findSessionChanges(i,u);o==null||o.log(`${c} Computed session changes after {duration}`);const d=await this.findPageViewChanges(i,u);o==null||o.log(`${c} Computed page view changes after {duration}`),await this.saveSessionChanges(i.timestamp,h),o==null||o.log(`${c} Session changes committed to the database after {duration}`),await this.savePageViewChanges(i.timestamp,d),o==null||o.log(`${c} Page view changes committed to the database after {duration}`)}(l=this.logger)==null||l.log(`${c} Done`)}),this.config=t,this.sessionsRepo=e.sessionsRepo,this.pageViewsRepo=e.pageViewsRepo,this.updateSessions=this.updateSessions.bind(this),t.logger===void 0?this.logger=console:this.logger=t.logger;const[n,r]=Td();this.startupPromise=n,this.allowSessionUpdates=r}setupTriggers(){var e,t;this.referrers=new Ua(this.logger),(t=(e=this.config).setupCustomTriggers)==null||t.call(e,{triggerSessionChangeCheck:this.basicTrigger.bind(this),setHasRecentUserActivity:this.setHasRecentUserActivity.bind(this)}),this.setupExtensionApiTriggers(),this.setupIdleTriggers(),this.setupStartupTriggers()}addSessionUpdatedListener(e){this.sessionUpdatedListeners.push(e)}addPageViewUpdatedListener(e){this.pageViewUpdatedListeners.push(e)}addCheckSessionsListener(e){this.checkSessionsListeners.push(e)}setupExtensionApiTriggers(){he.webNavigation.onCompleted.addListener(async e=>{e.frameId>0||await this.basicTrigger("webNavigation.onCompleted",Math.floor(e.timeStamp))}),he.tabs.onCreated.addListener(()=>this.basicTrigger("tabs.onCreated")),he.tabs.onUpdated.addListener(()=>this.basicTrigger("tabs.onUpdated")),he.tabs.onActivated.addListener(()=>this.basicTrigger("tabs.onActivated")),he.tabs.onRemoved.addListener(()=>this.basicTrigger("tabs.onRemoved")),he.windows.onCreated.addListener(()=>this.basicTrigger("windows.onCreated")),he.windows.onFocusChanged.addListener(()=>this.basicTrigger("windows.onFocusChanged")),he.windows.onRemoved.addListener(()=>this.basicTrigger("windows.onRemoved")),this.onWindowStateChanged(e=>this.basicTrigger("SessionMonitor.onWindowStateChanged",e))}setupIdleTriggers(){}setupStartupTriggers(){const e=Date.now();this.config.isOnStartupAvailable()?(he.runtime.onStartup.addListener(()=>{this.wakeUpTimeoutDisabled=!0,this.startupFlow({cleanupSessions:!0,trigger:"runtime.onStartup",timestamp:e})}),setTimeout(()=>{this.wakeUpTimeoutDisabled||this.startupFlow({cleanupSessions:!1,trigger:"setTimeout",timestamp:e})},Et.ALWAYS_STARTUP_AFTER_MS)):(he.alarms.clear("ping-last-alive-at"),he.alarms.create("ping-last-alive-at",{delayInMinutes:Et.LAST_ALIVE_AT_INTERVAL_MS/kn,periodInMinutes:Et.LAST_ALIVE_AT_INTERVAL_MS/kn}),he.alarms.onAlarm.addListener(n=>{if(n.name==="ping-last-alive-at")return this.pingLastAliveAt()}),this.getLastAliveAt().then(n=>{this.wakeUpTimeoutDisabled=!0;const r=n!=null&&Date.now()-n>2*Et.LAST_ALIVE_AT_INTERVAL_MS;this.startupFlow({cleanupSessions:r,trigger:r?"time since last alive at > 2 * lastAliveInterval":"time since last alive at <= 2 * lastAliveInterval",timestamp:e})})),he.runtime.onInstalled.addListener(n=>{this.wakeUpTimeoutDisabled=!0,this.startupFlow({cleanupSessions:n.reason!=="install",trigger:"runtime.onInstalled",timestamp:e})});const{onSuspend:t}=he.runtime;t==null||t.addListener(()=>this.endAllActiveSessions(Date.now()))}basicTrigger(e,t=Date.now()){var n;const r=this.latestTriggerId++;return(n=this.logger)==null||n.log(`[update-sessions] [${r}] Queued by ${e} @ ${new Date(t).toLocaleTimeString()}`),this.updateSessions({timestamp:t,triggerId:r,triggeredBy:e})}onWindowStateChanged(e){let t={};this.getWindowStates().then(n=>{t=n}),setInterval(async()=>{const n=Date.now(),r=await this.getWindowStates();sh(t,r)||(e(n),t=r)},Et.WINDOW_STATE_POLLING_INTERVAL_MS)}async getWindowStates(){return(await he.windows.getAll()).reduce((e,t)=>(t.id!=null&&(e[t.id]=t.state),e),{})}async startupFlow({cleanupSessions:e,trigger:t,timestamp:n}){e&&await this.cleanupActiveSessionsOnStartup(n),await this.pingLastAliveAt(),await Ad().then(()=>this.allowSessionUpdates()),await this.basicTrigger(t,n)}async cleanupActiveSessionsOnStartup(e){var t,n,r,i;const s=await this.getLastAliveAt();if((t=this.logger)==null||t.debug("[on-startup] onStartup()",{lastActivity:s&&new Date(s).toISOString(),now:new Date(e).toISOString()}),s==null)throw Error("lastActivity was not set yet");(n=this.logger)==null||n.log("[on-startup] Ending sessions after quit...");const a=s+Et.LAST_ALIVE_AT_POLL_INTERVAL_MS,l=Math.min(e,a);(r=this.logger)==null||r.log("[on-startup] Timing details:",{lastActivity:new Date(s).toISOString(),now:new Date(e).toISOString(),quitAt:new Date(a).toISOString(),endAt:new Date(l).toISOString()}),await this.endAllActiveSessions(l),(i=this.logger)==null||i.log("[on-startup] Startup finished!")}async getComputeDependencies(){const[e,t]=await Promise.all([he.windows.getAll(),he.tabs.query({})]),n=await this.sessionsRepo.getActiveSessions(),r=await this.pageViewsRepo.getActivePageViews();return{isTabActiveWhenPlayingAudio:await this.config.isTabActiveWhenPlayingAudio(),hostnameToTabsMap:t.reduce((i,s)=>{var a,l;const c=(a=Ra(s.url))==null?void 0:a.hostname;return c&&(i[c]!=null||(i[c]=[]),(l=i[c])==null||l.push(s)),i},{}),allActiveSessions:n,allActivePageViews:r,appIdToActiveSessionMap:xd(n??[],"appId"),windowIdToWindowMap:Sd(e,"id"),processedActiveSessionCache:new Ba,processedActivePageViewCache:new Ba}}findSessionChanges(e,t){var n,r,i;const s=[],a=[];for(const[l,c]of Object.entries(t.hostnameToTabsMap))if(l)try{if(!(c!=null&&c.length))throw Error("This shouldn't be possible");const o=t.appIdToActiveSessionMap[l],u=!!(o!=null&&o.length),h=!!c.find(d=>this.isTabActive(d,t));!u&&h?s.push({appId:l,startedAt:e.timestamp}):u&&!h&&a.push(...o),u&&t.processedActiveSessionCache.markAsProcessed(o)}catch(o){(n=this.logger)==null||n.error(`[update-sessions] Failed find sessions to change for ${l}:`,o)}return((i=(r=t.allActiveSessions)==null?void 0:r.filter(l=>!t.processedActiveSessionCache.isProcessed(l)))!=null?i:[]).forEach(l=>a.push(l)),{toStart:s,toEnd:a,count:s.length+a.length}}async findPageViewChanges(e,t){var n;const r=Object.values(t.hostnameToTabsMap).flat().filter(a=>!!a&&this.isTabActive(a,t)),i=[],s=[...t.allActivePageViews];for(const a of r){const l=Ra(a.url);if(l==null)continue;const c=t.allActivePageViews.filter(o=>o.appId===(l==null?void 0:l.hostname)&&o.path===l.path);if(c.length>0)for(const o of c){const u=s.findIndex(h=>h.id===o.id);u>=0&&s.splice(u,1)}else i.push({appId:l.hostname,path:l.path,startedAt:e.timestamp,referrer:await((n=this.referrers)==null?void 0:n.getReferrerFor(a.id,a.url))})}return{toStart:i,toEnd:s,count:i.length+s.length}}async saveSessionChanges(e,t){const n=t.toEnd.map(a=>{var l;const c=new Date(e).toLocaleTimeString();return(l=this.logger)==null||l.log(`[change-session] Stop session ${a.appId} @ ${c} (${e-a.startedAt}ms)`),this.sessionsRepo.endSession(a,e)}),r=t.toStart.map(a=>{var l;return(l=this.logger)==null||l.log(`[change-session] Start session ${a.appId} @ ${new Date(a.startedAt).toLocaleTimeString()}`,{session:a}),this.sessionsRepo.startSession(a)}),i=await Promise.allSettled(n),s=await Promise.allSettled(r);this.logSettledErrors("sessions","ending",i),this.logSettledErrors("sessions","starting",s),t.count>0&&this.invokeSessionUpdatedListeners()}async savePageViewChanges(e,t){const n=t.toEnd.map(a=>{var l;const c=new Date(e).toLocaleTimeString();return(l=this.logger)==null||l.log(`[change-session] Stop page view ${a.appId}${a.path} @ ${c} (${e-a.startedAt}ms)`),this.pageViewsRepo.endPageView(a,e)}),r=t.toStart.map(a=>{var l;return(l=this.logger)==null||l.log(`[change-session] Start page view ${a.appId}${a.path} @ ${new Date(a.startedAt).toLocaleTimeString()}`,{session:a}),this.pageViewsRepo.startPageView(a)}),i=await Promise.allSettled(n),s=await Promise.allSettled(r);this.logSettledErrors("page views","ending",i),this.logSettledErrors("page views","starting",s),t.count>0&&this.invokePageViewUpdatedListeners()}logSettledErrors(e,t,n){var r;const i=n.map(s=>{if(s.status==="rejected")return s.reason}).filter(s=>s!=null);i.length>0&&((r=this.logger)==null||r.warn(`[update-sessions] ${i.length}/${n.length} transactions failed when ${t} ${e}`,i))}isTabActive(e,t){var n;if(e.windowId==null)return(n=this.logger)==null||n.warn("[update-sessions] Checking if tab without a windowId is active"),!1;const r=t.windowIdToWindowMap[e.windowId];return!!r&&Cd(e,r,this.hasRecentUserActivity,t.isTabActiveWhenPlayingAudio)}async endAllActiveSessions(e){var t,n,r;const i=await this.sessionsRepo.getActiveSessions();if(i.length===0){(t=this.logger)==null||t.log("[stop-active-sessions] No active sessions to stop");return}(n=this.logger)==null||n.log("[stop-active-sessions] Stopping all active sessions:",{activeSessions:i,timestamp:e}),await this.saveSessionChanges(e,{toStart:[],toEnd:i,count:i.length}),(r=this.logger)==null||r.log("[stop-active-sessions] All active sessions stopped!")}async pingLastAliveAt(){var e;const t=Date.now();(e=this.logger)==null||e.debug("[SessionMonitor] Updating last time browser was known to be open",t),await fr(Et.LAST_ALIVE_AT_KEY,t),clearTimeout(this.lastAlivePing),this.lastAlivePing=setTimeout(()=>this.pingLastAliveAt(),Et.LAST_ALIVE_AT_POLL_INTERVAL_MS)}getLastAliveAt(){return Yi(Et.LAST_ALIVE_AT_KEY)}invokeCheckSessionsListeners(){this.checkSessionsListeners.forEach(e=>e())}invokeSessionUpdatedListeners(){this.sessionUpdatedListeners.forEach(e=>e())}invokePageViewUpdatedListeners(){this.pageViewUpdatedListeners.forEach(e=>e())}setHasRecentUserActivity(e){this.hasRecentUserActivity=e}};let Mn=Et;Mn.LAST_ALIVE_AT_KEY="last-activity-time-ms",Mn.LAST_ALIVE_AT_INTERVAL_MS=Ki,Mn.LAST_ALIVE_AT_POLL_INTERVAL_MS=30*kn,Mn.ALWAYS_STARTUP_AFTER_MS=5*kn,Mn.WINDOW_STATE_POLLING_INTERVAL_MS=5*kn;function ch(e){const t=new Mn(e.db,e);return t.setupTriggers(),{sessionMonitor:t}}var ja=1/0,Fa=9007199254740991,lh=17976931348623157e292,Wa=0/0,uh="[object Function]",dh="[object GeneratorFunction]",hh="[object Symbol]",gh=/^\s+|\s+$/g,fh=/^[-+]0x[0-9a-f]+$/i,ph=/^0b[01]+$/i,mh=/^0o[0-7]+$/i,yh=/^(?:0|[1-9]\d*)$/,vh=parseInt,bh=Object.prototype,$a=bh.toString,wh=Math.ceil,Ah=Math.max;function _h(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function xh(e,t){return t=t??Fa,!!t&&(typeof e=="number"||yh.test(e))&&e>-1&&e%1==0&&e<t}function Sh(e,t,n){if(!si(n))return!1;var r=typeof t;return(r=="number"?Ch(n)&&xh(t,n.length):r=="string"&&t in n)?Eh(n[t],e):!1}function Th(e,t,n){(n?Sh(e,t,n):t===void 0)?t=1:t=Ah(Mh(t),0);var r=e?e.length:0;if(!r||t<1)return[];for(var i=0,s=0,a=Array(wh(r/t));i<r;)a[s++]=_h(e,i,i+=t);return a}function Eh(e,t){return e===t||e!==e&&t!==t}function Ch(e){return e!=null&&Ih(e.length)&&!Oh(e)}function Oh(e){var t=si(e)?$a.call(e):"";return t==uh||t==dh}function Ih(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Fa}function si(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Ph(e){return!!e&&typeof e=="object"}function kh(e){return typeof e=="symbol"||Ph(e)&&$a.call(e)==hh}function Dh(e){if(!e)return e===0?e:0;if(e=Nh(e),e===ja||e===-ja){var t=e<0?-1:1;return t*lh}return e===e?e:0}function Mh(e){var t=Dh(e),n=t%1;return t===t?n?t-n:t:0}function Nh(e){if(typeof e=="number")return e;if(kh(e))return Wa;if(si(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=si(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(gh,"");var n=ph.test(e);return n||mh.test(e)?vh(e.slice(2),n?2:8):fh.test(e)?Wa:+e}var Rh=Th;const Lh=100;function Uh(e){const t=e.logger===void 0?console:e.logger;async function n(){var s;const[a,l,c]=await Promise.all([e.getAppId(),e.getInstallId(),(s=e.getBirthYear)==null?void 0:s.call(e)]);return{appId:a,installId:l,birthYear:c}}async function r(s,a){var l,c;let o;try{t==null||t.log(`[${s.label}-uploader] Beginning upload @ ${new Date(a).toISOString()}`);const[u,h,d]=await Promise.all([s.getLastUploadedAt(),e.db,e.enabled()]);if(!d){t==null||t.log(`[${s.label}-uploader] Uploads are disabled`);return}const f=await s.getModelsToUpload({db:h,lastUploadedAt:u,uploadStartedAt:a}),g=(c=await((l=e.getUploadBatchSize)==null?void 0:l.call(e)))!=null?c:Lh,m=Rh(f,g),A=await n();o={models:f,batches:m,body:A},t==null||t.debug(`[${s.label}-uploader] Data`,o);for(const _ of m){t==null||t.debug(`[${s.label}-uploader] Uploading`,{batch:_,requestSkipped:!!e.dev}),e.dev||await s.upload(A,_);const p=_[_.length-1];(p==null?void 0:p.endedAt)!=null&&await s.setLastUploadedAt(p.endedAt)}await s.setLastUploadedAt(a);const E=(Date.now()-a)/1e3;t==null||t.log(`[${s.label}-uploader] Uploaded ${f.length} items in ${m.length} batches in ${E}s`),s.onSuccess({total:f.length,batches:m.length,batchSize:g,durationInSec:E})}catch(u){t==null||t.error(`[${s.label}-uploader] Failed to upload`,u,o),s.onFailure(u)}}async function i(){const s=Date.now();await Promise.allSettled(e.uploaders.map(a=>r(a,s)))}return{uploadAll:i}}function Bh({api:e,onSuccess:t,onFailure:n,lastUploadedAtStorageKey:r}){return{label:"sessions",onSuccess:t,onFailure:n,async getLastUploadedAt(){const i=await Yi(r);return i??1},setLastUploadedAt(i){return fr(r,i)},async getModelsToUpload({db:i,lastUploadedAt:s,uploadStartedAt:a}){return(await i.sessionsRepo.findSessionsByEndedAt(s,a)).filter(l=>!l.imported)},async upload(i,s){const a=s.reduce((l,c)=>{var o;if(c.endedAt==null)throw Error("Cannot upload a session that is in progress");const u={duration:ti(c.endedAt-c.startedAt),timestamp:ti(c.startedAt)};return u.duration>0&&(l[o=c.appId]!=null||(l[o]={sessions:[]}),l[c.appId].sessions.push(u)),l},{});await e.uploadSessions({...i,websites:a})}}}var jh=Va;function Va(e,t,n){e instanceof RegExp&&(e=Ga(e,n)),t instanceof RegExp&&(t=Ga(t,n));var r=Ha(e,t,n);return r&&{start:r[0],end:r[1],pre:n.slice(0,r[0]),body:n.slice(r[0]+e.length,r[1]),post:n.slice(r[1]+t.length)}}function Ga(e,t){var n=t.match(e);return n?n[0]:null}Va.range=Ha;function Ha(e,t,n){var r,i,s,a,l,c=n.indexOf(e),o=n.indexOf(t,c+1),u=c;if(c>=0&&o>0){if(e===t)return[c,o];for(r=[],s=n.length;u>=0&&!l;)u==c?(r.push(u),c=n.indexOf(e,u+1)):r.length==1?l=[r.pop(),o]:(i=r.pop(),i<s&&(s=i,a=o),o=n.indexOf(t,u+1)),u=c<o&&c>=0?c:o;r.length&&(l=[s,a])}return l}var za=jh,Fh=Vh,qa="\0SLASH"+Math.random()+"\0",Za="\0OPEN"+Math.random()+"\0",os="\0CLOSE"+Math.random()+"\0",Ka="\0COMMA"+Math.random()+"\0",Ya="\0PERIOD"+Math.random()+"\0";function cs(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function Wh(e){return e.split("\\\\").join(qa).split("\\{").join(Za).split("\\}").join(os).split("\\,").join(Ka).split("\\.").join(Ya)}function $h(e){return e.split(qa).join("\\").split(Za).join("{").split(os).join("}").split(Ka).join(",").split(Ya).join(".")}function Ja(e){if(!e)return[""];var t=[],n=za("{","}",e);if(!n)return e.split(",");var r=n.pre,i=n.body,s=n.post,a=r.split(",");a[a.length-1]+="{"+i+"}";var l=Ja(s);return s.length&&(a[a.length-1]+=l.shift(),a.push.apply(a,l)),t.push.apply(t,a),t}function Vh(e){return e?(e.substr(0,2)==="{}"&&(e="\\{\\}"+e.substr(2)),pr(Wh(e),!0).map($h)):[]}function Gh(e){return"{"+e+"}"}function Hh(e){return/^-?0\d/.test(e)}function zh(e,t){return e<=t}function qh(e,t){return e>=t}function pr(e,t){var n=[],r=za("{","}",e);if(!r)return[e];var i=r.pre,s=r.post.length?pr(r.post,!1):[""];if(/\$$/.test(r.pre))for(var a=0;a<s.length;a++){var l=i+"{"+r.body+"}"+s[a];n.push(l)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),u=c||o,h=r.body.indexOf(",")>=0;if(!u&&!h)return r.post.match(/,.*\}/)?(e=r.pre+"{"+r.body+os+r.post,pr(e)):[e];var d;if(u)d=r.body.split(/\.\./);else if(d=Ja(r.body),d.length===1&&(d=pr(d[0],!1).map(Gh),d.length===1))return s.map(function(I){return r.pre+d[0]+I});var f;if(u){var g=cs(d[0]),m=cs(d[1]),A=Math.max(d[0].length,d[1].length),E=d.length==3?Math.abs(cs(d[2])):1,_=zh,p=m<g;p&&(E*=-1,_=qh);var v=d.some(Hh);f=[];for(var C=g;_(C,m);C+=E){var S;if(o)S=String.fromCharCode(C),S==="\\"&&(S="");else if(S=String(C),v){var P=A-S.length;if(P>0){var b=new Array(P+1).join("0");C<0?S="-"+b+S.slice(1):S=b+S}}f.push(S)}}else{f=[];for(var x=0;x<d.length;x++)f.push.apply(f,pr(d[x],!1))}for(var x=0;x<f.length;x++)for(var a=0;a<s.length;a++){var l=i+f[x]+s[a];(!t||u||l)&&n.push(l)}}return n}const Zh=1024*64,ai=e=>{if(typeof e!="string")throw new TypeError("invalid pattern");if(e.length>Zh)throw new TypeError("pattern is too long")},Kh={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},mr=e=>e.replace(/[[\]\\-]/g,"\\$&"),Yh=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Qa=e=>e.join(""),Jh=(e,t)=>{const n=t;if(e.charAt(n)!=="[")throw new Error("not in a brace expression");const r=[],i=[];let s=n+1,a=!1,l=!1,c=!1,o=!1,u=n,h="";e:for(;s<e.length;){const g=e.charAt(s);if((g==="!"||g==="^")&&s===n+1){o=!0,s++;continue}if(g==="]"&&a&&!c){u=s+1;break}if(a=!0,g==="\\"&&!c){c=!0,s++;continue}if(g==="["&&!c){for(const[m,[A,E,_]]of Object.entries(Kh))if(e.startsWith(m,s)){if(h)return["$.",!1,e.length-n,!0];s+=m.length,_?i.push(A):r.push(A),l=l||E;continue e}}if(c=!1,h){g>h?r.push(mr(h)+"-"+mr(g)):g===h&&r.push(mr(g)),h="",s++;continue}if(e.startsWith("-]",s+1)){r.push(mr(g+"-")),s+=2;continue}if(e.startsWith("-",s+1)){h=g,s+=2;continue}r.push(mr(g)),s++}if(u<s)return["",!1,0,!1];if(!r.length&&!i.length)return["$.",!1,e.length-n,!0];if(i.length===0&&r.length===1&&/^\\?.$/.test(r[0])&&!o){const g=r[0].length===2?r[0].slice(-1):r[0];return[Yh(g),!1,u-n,!1]}const d="["+(o?"^":"")+Qa(r)+"]",f="["+(o?"":"^")+Qa(i)+"]";return[r.length&&i.length?"("+d+"|"+f+")":r.length?d:f,l,u-n,!0]},yr=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/\[([^\/\\])\]/g,"$1"):e.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),Qh=new Set(["!","?","+","*","@"]),Xa=e=>Qh.has(e),Xh="(?!\\.\\.?(?:$|/))",ls="(?!\\.)",eg=new Set(["[","."]),tg=new Set(["..","."]),ng=new Set("().*{}+?[]^$\\!"),rg=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),us="[^/]",eo=us+"*?",to=us+"+?";var Ie,Le,Ht,me,Ee,dn,Nn,hn,yt,Rn,oi,ds,no,vr,ci,hs,ro;const nt=class{constructor(t,n,r={}){Ke(this,ds),Oe(this,"type"),Ke(this,Ie,void 0),Ke(this,Le,void 0),Ke(this,Ht,!1),Ke(this,me,[]),Ke(this,Ee,void 0),Ke(this,dn,void 0),Ke(this,Nn,void 0),Ke(this,hn,!1),Ke(this,yt,void 0),Ke(this,Rn,void 0),Ke(this,oi,!1),this.type=t,t&&Se(this,Le,!0),Se(this,Ee,n),Se(this,Ie,V(this,Ee)?V(V(this,Ee),Ie):this),Se(this,yt,V(this,Ie)===this?r:V(V(this,Ie),yt)),Se(this,Nn,V(this,Ie)===this?[]:V(V(this,Ie),Nn)),t==="!"&&!V(V(this,Ie),hn)&&V(this,Nn).push(this),Se(this,dn,V(this,Ee)?V(V(this,Ee),me).length:0)}get hasMagic(){if(V(this,Le)!==void 0)return V(this,Le);for(const t of V(this,me))if(typeof t!="string"&&(t.type||t.hasMagic))return Se(this,Le,!0);return V(this,Le)}toString(){return V(this,Rn)!==void 0?V(this,Rn):this.type?Se(this,Rn,this.type+"("+V(this,me).map(t=>String(t)).join("|")+")"):Se(this,Rn,V(this,me).map(t=>String(t)).join(""))}push(...t){for(const n of t)if(n!==""){if(typeof n!="string"&&!(n instanceof nt&&V(n,Ee)===this))throw new Error("invalid part: "+n);V(this,me).push(n)}}toJSON(){var t;const n=this.type===null?V(this,me).slice().map(r=>typeof r=="string"?r:r.toJSON()):[this.type,...V(this,me).map(r=>r.toJSON())];return this.isStart()&&!this.type&&n.unshift([]),this.isEnd()&&(this===V(this,Ie)||V(V(this,Ie),hn)&&((t=V(this,Ee))==null?void 0:t.type)==="!")&&n.push({}),n}isStart(){var t;if(V(this,Ie)===this)return!0;if(!((t=V(this,Ee))!=null&&t.isStart()))return!1;if(V(this,dn)===0)return!0;const n=V(this,Ee);for(let r=0;r<V(this,dn);r++){const i=V(n,me)[r];if(!(i instanceof nt&&i.type==="!"))return!1}return!0}isEnd(){var t,n,r;if(V(this,Ie)===this||((t=V(this,Ee))==null?void 0:t.type)==="!")return!0;if(!((n=V(this,Ee))!=null&&n.isEnd()))return!1;if(!this.type)return(r=V(this,Ee))==null?void 0:r.isEnd();const i=V(this,Ee)?V(V(this,Ee),me).length:0;return V(this,dn)===i-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){const n=new nt(this.type,t);for(const r of V(this,me))n.copyIn(r);return n}static fromGlob(t,n={}){var r;const i=new nt(null,void 0,n);return Kn(r=nt,vr,ci).call(r,t,i,0,n),i}toMMPattern(){if(this!==V(this,Ie))return V(this,Ie).toMMPattern();const t=this.toString(),[n,r,i,s]=this.toRegExpSource();if(!(i||V(this,Le)||V(this,yt).nocase&&!V(this,yt).nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return r;const a=(V(this,yt).nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${n}$`,a),{_src:n,_glob:t})}toRegExpSource(){var t;if(V(this,Ie)===this&&Kn(this,ds,no).call(this),!this.type){const s=this.isStart()&&this.isEnd(),a=V(this,me).map(o=>{var u;const[h,d,f,g]=typeof o=="string"?Kn(u=nt,hs,ro).call(u,o,V(this,Le),s):o.toRegExpSource();return Se(this,Le,V(this,Le)||f),Se(this,Ht,V(this,Ht)||g),h}).join("");let l="";if(this.isStart()&&typeof V(this,me)[0]=="string"&&!(V(this,me).length===1&&tg.has(V(this,me)[0]))){const o=eg,u=V(this,yt).dot&&o.has(a.charAt(0))||a.startsWith("\\.")&&o.has(a.charAt(2))||a.startsWith("\\.\\.")&&o.has(a.charAt(4)),h=!V(this,yt).dot&&o.has(a.charAt(0));l=u?Xh:h?ls:""}let c="";return this.isEnd()&&V(V(this,Ie),hn)&&((t=V(this,Ee))==null?void 0:t.type)==="!"&&(c="(?:$|\\/)"),[l+a+c,yr(a),Se(this,Le,!!V(this,Le)),V(this,Ht)]}const n=this.type==="!"?"(?:(?!(?:":"(?:",r=V(this,me).map(s=>{if(typeof s=="string")throw new Error("string type in extglob ast??");const[a,l,c,o]=s.toRegExpSource();return Se(this,Ht,V(this,Ht)||o),a}).filter(s=>!(this.isStart()&&this.isEnd())||!!s).join("|");if(this.isStart()&&this.isEnd()&&!r&&this.type!=="!"){const s=this.toString();return Se(this,me,[s]),this.type=null,Se(this,Le,void 0),[s,yr(this.toString()),!1,!1]}let i="";if(this.type==="!"&&V(this,oi))i=(this.isStart()&&!V(this,yt).dot?ls:"")+to;else{const s=this.type==="!"?"))"+(this.isStart()&&!V(this,yt).dot?ls:"")+eo+")":this.type==="@"?")":`)${this.type}`;i=n+r+s}return[i,yr(r),Se(this,Le,!!V(this,Le)),V(this,Ht)]}};let li=nt;Ie=new WeakMap,Le=new WeakMap,Ht=new WeakMap,me=new WeakMap,Ee=new WeakMap,dn=new WeakMap,Nn=new WeakMap,hn=new WeakMap,yt=new WeakMap,Rn=new WeakMap,oi=new WeakMap,ds=new WeakSet,no=function(){if(this!==V(this,Ie))throw new Error("should only call on root");if(V(this,hn))return this;this.toString(),Se(this,hn,!0);let e;for(;e=V(this,Nn).pop();){if(e.type!=="!")continue;let t=e,n=V(t,Ee);for(;n;){for(let r=V(t,dn)+1;!n.type&&r<V(n,me).length;r++)for(const i of V(e,me)){if(typeof i=="string")throw new Error("string part in extglob AST??");i.copyIn(V(n,me)[r])}t=n,n=V(t,Ee)}}return this},vr=new WeakSet,ci=function(e,t,n,r){var i,s;let a=!1,l=!1,c=-1,o=!1;if(t.type===null){let g=n,m="";for(;g<e.length;){const A=e.charAt(g++);if(a||A==="\\"){a=!a,m+=A;continue}if(l){g===c+1?(A==="^"||A==="!")&&(o=!0):A==="]"&&!(g===c+2&&o)&&(l=!1),m+=A;continue}else if(A==="["){l=!0,c=g,o=!1,m+=A;continue}if(!r.noext&&Xa(A)&&e.charAt(g)==="("){t.push(m),m="";const E=new nt(A,t);g=Kn(i=nt,vr,ci).call(i,e,E,g,r),t.push(E);continue}m+=A}return t.push(m),g}let u=n+1,h=new nt(null,t);const d=[];let f="";for(;u<e.length;){const g=e.charAt(u++);if(a||g==="\\"){a=!a,f+=g;continue}if(l){u===c+1?(g==="^"||g==="!")&&(o=!0):g==="]"&&!(u===c+2&&o)&&(l=!1),f+=g;continue}else if(g==="["){l=!0,c=u,o=!1,f+=g;continue}if(Xa(g)&&e.charAt(u)==="("){h.push(f),f="";const m=new nt(g,h);h.push(m),u=Kn(s=nt,vr,ci).call(s,e,m,u,r);continue}if(g==="|"){h.push(f),f="",d.push(h),h=new nt(null,t);continue}if(g===")")return f===""&&V(t,me).length===0&&Se(t,oi,!0),h.push(f),f="",t.push(...d,h),u;f+=g}return t.type=null,Se(t,Le,void 0),Se(t,me,[e.substring(n-1)]),u},hs=new WeakSet,ro=function(e,t,n=!1){let r=!1,i="",s=!1;for(let a=0;a<e.length;a++){const l=e.charAt(a);if(r){r=!1,i+=(ng.has(l)?"\\":"")+l;continue}if(l==="\\"){a===e.length-1?i+="\\\\":r=!0;continue}if(l==="["){const[c,o,u,h]=Jh(e,a);if(u){i+=c,s=s||o,a+=u-1,t=t||h;continue}}if(l==="*"){n&&e==="*"?i+=to:i+=eo,t=!0;continue}if(l==="?"){i+=us,t=!0;continue}i+=rg(l)}return[i,yr(e),!!t,s]},Ke(li,vr),Ke(li,hs);const ig=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/[?*()[\]]/g,"[$&]"):e.replace(/[?*()[\]\\]/g,"\\$&"),We=(e,t,n={})=>(ai(t),!n.nocomment&&t.charAt(0)==="#"?!1:new ui(t,n).match(e)),sg=/^\*+([^+@!?\*\[\(]*)$/,ag=e=>t=>!t.startsWith(".")&&t.endsWith(e),og=e=>t=>t.endsWith(e),cg=e=>(e=e.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(e)),lg=e=>(e=e.toLowerCase(),t=>t.toLowerCase().endsWith(e)),ug=/^\*+\.\*+$/,dg=e=>!e.startsWith(".")&&e.includes("."),hg=e=>e!=="."&&e!==".."&&e.includes("."),gg=/^\.\*+$/,fg=e=>e!=="."&&e!==".."&&e.startsWith("."),pg=/^\*+$/,mg=e=>e.length!==0&&!e.startsWith("."),yg=e=>e.length!==0&&e!=="."&&e!=="..",vg=/^\?+([^+@!?\*\[\(]*)?$/,bg=([e,t=""])=>{const n=io([e]);return t?(t=t.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(t)):n},wg=([e,t=""])=>{const n=so([e]);return t?(t=t.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(t)):n},Ag=([e,t=""])=>{const n=so([e]);return t?r=>n(r)&&r.endsWith(t):n},_g=([e,t=""])=>{const n=io([e]);return t?r=>n(r)&&r.endsWith(t):n},io=([e])=>{const t=e.length;return n=>n.length===t&&!n.startsWith(".")},so=([e])=>{const t=e.length;return n=>n.length===t&&n!=="."&&n!==".."},ao=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",oo={win32:{sep:"\\"},posix:{sep:"/"}},xg=ao==="win32"?oo.win32.sep:oo.posix.sep;We.sep=xg;const ot=Symbol("globstar **");We.GLOBSTAR=ot;const Sg="[^/]",Tg=Sg+"*?",Eg="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Cg="(?:(?!(?:\\/|^)\\.).)*?",Og=(e,t={})=>n=>We(n,e,t);We.filter=Og;const ct=(e,t={})=>Object.assign({},e,t),Ig=e=>{if(!e||typeof e!="object"||!Object.keys(e).length)return We;const t=We;return Object.assign((n,r,i={})=>t(n,r,ct(e,i)),{Minimatch:class extends t.Minimatch{constructor(n,r={}){super(n,ct(e,r))}static defaults(n){return t.defaults(ct(e,n)).Minimatch}},AST:class extends t.AST{constructor(n,r,i={}){super(n,r,ct(e,i))}static fromGlob(n,r={}){return t.AST.fromGlob(n,ct(e,r))}},unescape:(n,r={})=>t.unescape(n,ct(e,r)),escape:(n,r={})=>t.escape(n,ct(e,r)),filter:(n,r={})=>t.filter(n,ct(e,r)),defaults:n=>t.defaults(ct(e,n)),makeRe:(n,r={})=>t.makeRe(n,ct(e,r)),braceExpand:(n,r={})=>t.braceExpand(n,ct(e,r)),match:(n,r,i={})=>t.match(n,r,ct(e,i)),sep:t.sep,GLOBSTAR:ot})};We.defaults=Ig;const co=(e,t={})=>(ai(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:Fh(e));We.braceExpand=co;const Pg=(e,t={})=>new ui(e,t).makeRe();We.makeRe=Pg;const kg=(e,t,n={})=>{const r=new ui(t,n);return e=e.filter(i=>r.match(i)),r.options.nonull&&!e.length&&e.push(t),e};We.match=kg;const lo=/[?*]|[+@!]\(.*?\)|\[|\]/,Dg=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class ui{constructor(t,n={}){Oe(this,"options"),Oe(this,"set"),Oe(this,"pattern"),Oe(this,"windowsPathsNoEscape"),Oe(this,"nonegate"),Oe(this,"negate"),Oe(this,"comment"),Oe(this,"empty"),Oe(this,"preserveMultipleSlashes"),Oe(this,"partial"),Oe(this,"globSet"),Oe(this,"globParts"),Oe(this,"nocase"),Oe(this,"isWindows"),Oe(this,"platform"),Oe(this,"windowsNoMagicRoot"),Oe(this,"regexp"),ai(t),n=n||{},this.options=n,this.pattern=t,this.platform=n.platform||ao,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!n.windowsPathsNoEscape||n.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!n.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!n.nonegate,this.comment=!1,this.empty=!1,this.partial=!!n.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=n.windowsNoMagicRoot!==void 0?n.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const n of t)if(typeof n!="string")return!0;return!1}debug(...t){}make(){const t=this.pattern,n=this.options;if(!n.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],n.debug&&(this.debug=(...s)=>console.error(...s)),this.debug(this.pattern,this.globSet);const r=this.globSet.map(s=>this.slashSplit(s));this.globParts=this.preprocess(r),this.debug(this.pattern,this.globParts);let i=this.globParts.map((s,a,l)=>{if(this.isWindows&&this.windowsNoMagicRoot){const c=s[0]===""&&s[1]===""&&(s[2]==="?"||!lo.test(s[2]))&&!lo.test(s[3]),o=/^[a-z]:/i.test(s[0]);if(c)return[...s.slice(0,4),...s.slice(4).map(u=>this.parse(u))];if(o)return[s[0],...s.slice(1).map(u=>this.parse(u))]}return s.map(c=>this.parse(c))});if(this.debug(this.pattern,i),this.set=i.filter(s=>s.indexOf(!1)===-1),this.isWindows)for(let s=0;s<this.set.length;s++){const a=this.set[s];a[0]===""&&a[1]===""&&this.globParts[s][2]==="?"&&typeof a[3]=="string"&&/^[a-z]:$/i.test(a[3])&&(a[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let r=0;r<t.length;r++)for(let i=0;i<t[r].length;i++)t[r][i]==="**"&&(t[r][i]="*");const{optimizationLevel:n=1}=this.options;return n>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):n>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(n=>{let r=-1;for(;(r=n.indexOf("**",r+1))!==-1;){let i=r;for(;n[i+1]==="**";)i++;i!==r&&n.splice(r,i-r)}return n})}levelOneOptimize(t){return t.map(n=>(n=n.reduce((r,i)=>{const s=r[r.length-1];return i==="**"&&s==="**"?r:i===".."&&s&&s!==".."&&s!=="."&&s!=="**"?(r.pop(),r):(r.push(i),r)},[]),n.length===0?[""]:n))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let n=!1;do{if(n=!1,!this.preserveMultipleSlashes){for(let i=1;i<t.length-1;i++){const s=t[i];i===1&&s===""&&t[0]===""||(s==="."||s==="")&&(n=!0,t.splice(i,1),i--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(n=!0,t.pop())}let r=0;for(;(r=t.indexOf("..",r+1))!==-1;){const i=t[r-1];i&&i!=="."&&i!==".."&&i!=="**"&&(n=!0,t.splice(r-1,2),r-=2)}}while(n);return t.length===0?[""]:t}firstPhasePreProcess(t){let n=!1;do{n=!1;for(let r of t){let i=-1;for(;(i=r.indexOf("**",i+1))!==-1;){let a=i;for(;r[a+1]==="**";)a++;a>i&&r.splice(i+1,a-i);let l=r[i+1];const c=r[i+2],o=r[i+3];if(l!==".."||!c||c==="."||c===".."||!o||o==="."||o==="..")continue;n=!0,r.splice(i,1);const u=r.slice(0);u[i]="**",t.push(u),i--}if(!this.preserveMultipleSlashes){for(let a=1;a<r.length-1;a++){const l=r[a];a===1&&l===""&&r[0]===""||(l==="."||l==="")&&(n=!0,r.splice(a,1),a--)}r[0]==="."&&r.length===2&&(r[1]==="."||r[1]==="")&&(n=!0,r.pop())}let s=0;for(;(s=r.indexOf("..",s+1))!==-1;){const a=r[s-1];if(a&&a!=="."&&a!==".."&&a!=="**"){n=!0;const l=s===1&&r[s+1]==="**"?["."]:[];r.splice(s-1,2,...l),r.length===0&&r.push(""),s-=2}}}}while(n);return t}secondPhasePreProcess(t){for(let n=0;n<t.length-1;n++)for(let r=n+1;r<t.length;r++){const i=this.partsMatch(t[n],t[r],!this.preserveMultipleSlashes);!i||(t[n]=i,t[r]=[])}return t.filter(n=>n.length)}partsMatch(t,n,r=!1){let i=0,s=0,a=[],l="";for(;i<t.length&&s<n.length;)if(t[i]===n[s])a.push(l==="b"?n[s]:t[i]),i++,s++;else if(r&&t[i]==="**"&&n[s]===t[i+1])a.push(t[i]),i++;else if(r&&n[s]==="**"&&t[i]===n[s+1])a.push(n[s]),s++;else if(t[i]==="*"&&n[s]&&(this.options.dot||!n[s].startsWith("."))&&n[s]!=="**"){if(l==="b")return!1;l="a",a.push(t[i]),i++,s++}else if(n[s]==="*"&&t[i]&&(this.options.dot||!t[i].startsWith("."))&&t[i]!=="**"){if(l==="a")return!1;l="b",a.push(n[s]),i++,s++}else return!1;return t.length===n.length&&a}parseNegate(){if(this.nonegate)return;const t=this.pattern;let n=!1,r=0;for(let i=0;i<t.length&&t.charAt(i)==="!";i++)n=!n,r++;r&&(this.pattern=t.slice(r)),this.negate=n}matchOne(t,n,r=!1){const i=this.options;if(this.isWindows){const m=t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),A=n[0]===""&&n[1]===""&&n[2]==="?"&&typeof n[3]=="string"&&/^[a-z]:$/i.test(n[3]);if(m&&A){const E=t[3],_=n[3];E.toLowerCase()===_.toLowerCase()&&(t[3]=_)}else if(A&&typeof t[0]=="string"){const E=n[3],_=t[0];E.toLowerCase()===_.toLowerCase()&&(n[3]=_,n=n.slice(3))}else if(m&&typeof n[0]=="string"){const E=t[3];E.toLowerCase()===n[0].toLowerCase()&&(n[0]=E,t=t.slice(3))}}const{optimizationLevel:s=1}=this.options;s>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:n}),this.debug("matchOne",t.length,n.length);for(var a=0,l=0,c=t.length,o=n.length;a<c&&l<o;a++,l++){this.debug("matchOne loop");var u=n[l],h=t[a];if(this.debug(n,u,h),u===!1)return!1;if(u===ot){this.debug("GLOBSTAR",[n,u,h]);var d=a,f=l+1;if(f===o){for(this.debug("** at the end");a<c;a++)if(t[a]==="."||t[a]===".."||!i.dot&&t[a].charAt(0)===".")return!1;return!0}for(;d<c;){var g=t[d];if(this.debug(`
globstar while`,t,d,n,f,g),this.matchOne(t.slice(d),n.slice(f),r))return this.debug("globstar found match!",d,c,g),!0;if(g==="."||g===".."||!i.dot&&g.charAt(0)==="."){this.debug("dot detected!",t,d,n,f);break}this.debug("globstar swallow a segment, and continue"),d++}return!!(r&&(this.debug(`
>>> no match, partial?`,t,d,n,f),d===c))}let m;if(typeof u=="string"?(m=h===u,this.debug("string match",u,h,m)):(m=u.test(h),this.debug("pattern match",u,h,m)),!m)return!1}if(a===c&&l===o)return!0;if(a===c)return r;if(l===o)return a===c-1&&t[a]==="";throw new Error("wtf?")}braceExpand(){return co(this.pattern,this.options)}parse(t){ai(t);const n=this.options;if(t==="**")return ot;if(t==="")return"";let r,i=null;(r=t.match(pg))?i=n.dot?yg:mg:(r=t.match(sg))?i=(n.nocase?n.dot?lg:cg:n.dot?og:ag)(r[1]):(r=t.match(vg))?i=(n.nocase?n.dot?wg:bg:n.dot?Ag:_g)(r):(r=t.match(ug))?i=n.dot?hg:dg:(r=t.match(gg))&&(i=fg);const s=li.fromGlob(t,this.options).toMMPattern();return i?Object.assign(s,{test:i}):s}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const n=this.options,r=n.noglobstar?Tg:n.dot?Eg:Cg,i=new Set(n.nocase?["i"]:[]);let s=t.map(c=>{const o=c.map(u=>{if(u instanceof RegExp)for(const h of u.flags.split(""))i.add(h);return typeof u=="string"?Dg(u):u===ot?ot:u._src});return o.forEach((u,h)=>{const d=o[h+1],f=o[h-1];u!==ot||f===ot||(f===void 0?d!==void 0&&d!==ot?o[h+1]="(?:\\/|"+r+"\\/)?"+d:o[h]=r:d===void 0?o[h-1]=f+"(?:\\/|"+r+")?":d!==ot&&(o[h-1]=f+"(?:\\/|\\/"+r+"\\/)"+d,o[h+1]=ot))}),o.filter(u=>u!==ot).join("/")}).join("|");const[a,l]=t.length>1?["(?:",")"]:["",""];s="^"+a+s+l+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...i].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,n=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&n)return!0;const r=this.options;this.isWindows&&(t=t.split("\\").join("/"));const i=this.slashSplit(t);this.debug(this.pattern,"split",i);const s=this.set;this.debug(this.pattern,"set",s);let a=i[i.length-1];if(!a)for(let l=i.length-2;!a&&l>=0;l--)a=i[l];for(let l=0;l<s.length;l++){const c=s[l];let o=i;if(r.matchBase&&c.length===1&&(o=[a]),this.matchOne(o,c,n))return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}static defaults(t){return We.defaults(t).Minimatch}}We.AST=li,We.Minimatch=ui,We.escape=ig,We.unescape=yr;function Mg({api:e,onSuccess:t,onFailure:n,lastUploadedAtStorageKey:r,getUploadAllowlist:i}){return{label:"page-views",onSuccess:t,onFailure:n,async getLastUploadedAt(){const s=(await he.storage.local.get(r))[r];return s??1},setLastUploadedAt(s){return he.storage.local.set({[r]:s})},async getModelsToUpload({db:s,lastUploadedAt:a,uploadStartedAt:l}){var c;const o=await s.pageViewsRepo.findPageViewsByEndedAt(a,l),u=(c=await i())!=null?c:[];return o.filter(h=>h.imported?!1:!!u.find(d=>We(h.appId+h.path,d)))},async upload(s,a){const l=a.reduce((c,o)=>{var u,h,d;if(o.endedAt==null)throw Error("Cannot upload a page view that is in progress");const f={duration:ti(o.endedAt-o.startedAt),timestamp:ti(o.startedAt),referrer:o.referrer};return f.duration>0&&(c[u=o.appId]!=null||(c[u]={}),(h=c[o.appId])[d=o.path]!=null||(h[d]={page_views:[]}),c[o.appId][o.path].page_views.push(f)),c},{});await e.uploadPageViews({...s,websites:l})}}}function Ng(e){const t=Bh({api:e.api,...e.sessions}),n=Mg({api:e.api,...e.pageViews});return Uh({...e,uploaders:[t,n]})}const di={APP_ID:"laankejkbhbdhmipfmgcngdelahlfoji",INSTALL_ID_KEY:"install-id"};var Rg=Object.defineProperty,Lg=(e,t,n)=>t in e?Rg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ln=(e,t,n)=>(Lg(e,typeof t!="symbol"?t+"":t,n),n);const Ug='"use strict";(()=>{var Pe=Object.create;var Ht=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var Oe=Object.getOwnPropertyNames;var Fe=Object.getPrototypeOf,Ue=Object.prototype.hasOwnProperty;var Le=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var De=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Oe(t))!Ue.call(e,s)&&s!==r&&Ht(e,s,{get:()=>t[s],enumerable:!(o=Me(t,s))||o.enumerable});return e};var Vt=(e,t,r)=>(r=e!=null?Pe(Fe(e)):{},De(t||!e||!e.__esModule?Ht(r,"default",{value:e,enumerable:!0}):r,e));var vt=Le((Bt,Wt)=>{"use strict";(function(e){if(typeof Bt=="object")Wt.exports=e();else if(typeof define=="function"&&define.amd)define(e);else{var t;try{t=window}catch{t=self}t.SparkMD5=e()}})(function(e){"use strict";var t=function(d,l){return d+l&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function o(d,l,i,n,c,a){return l=t(t(l,d),t(n,a)),t(l<<c|l>>>32-c,i)}function s(d,l){var i=d[0],n=d[1],c=d[2],a=d[3];i+=(n&c|~n&a)+l[0]-680876936|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[1]-389564586|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[2]+606105819|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[3]-1044525330|0,n=(n<<22|n>>>10)+c|0,i+=(n&c|~n&a)+l[4]-176418897|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[5]+1200080426|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[6]-1473231341|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[7]-45705983|0,n=(n<<22|n>>>10)+c|0,i+=(n&c|~n&a)+l[8]+1770035416|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[9]-1958414417|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[10]-42063|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[11]-1990404162|0,n=(n<<22|n>>>10)+c|0,i+=(n&c|~n&a)+l[12]+1804603682|0,i=(i<<7|i>>>25)+n|0,a+=(i&n|~i&c)+l[13]-40341101|0,a=(a<<12|a>>>20)+i|0,c+=(a&i|~a&n)+l[14]-1502002290|0,c=(c<<17|c>>>15)+a|0,n+=(c&a|~c&i)+l[15]+1236535329|0,n=(n<<22|n>>>10)+c|0,i+=(n&a|c&~a)+l[1]-165796510|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[6]-1069501632|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[11]+643717713|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[0]-373897302|0,n=(n<<20|n>>>12)+c|0,i+=(n&a|c&~a)+l[5]-701558691|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[10]+38016083|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[15]-660478335|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[4]-405537848|0,n=(n<<20|n>>>12)+c|0,i+=(n&a|c&~a)+l[9]+568446438|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[14]-1019803690|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[3]-187363961|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[8]+1163531501|0,n=(n<<20|n>>>12)+c|0,i+=(n&a|c&~a)+l[13]-1444681467|0,i=(i<<5|i>>>27)+n|0,a+=(i&c|n&~c)+l[2]-51403784|0,a=(a<<9|a>>>23)+i|0,c+=(a&n|i&~n)+l[7]+1735328473|0,c=(c<<14|c>>>18)+a|0,n+=(c&i|a&~i)+l[12]-1926607734|0,n=(n<<20|n>>>12)+c|0,i+=(n^c^a)+l[5]-378558|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[8]-2022574463|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[11]+1839030562|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[14]-35309556|0,n=(n<<23|n>>>9)+c|0,i+=(n^c^a)+l[1]-1530992060|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[4]+1272893353|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[7]-155497632|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[10]-1094730640|0,n=(n<<23|n>>>9)+c|0,i+=(n^c^a)+l[13]+681279174|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[0]-358537222|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[3]-722521979|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[6]+76029189|0,n=(n<<23|n>>>9)+c|0,i+=(n^c^a)+l[9]-640364487|0,i=(i<<4|i>>>28)+n|0,a+=(i^n^c)+l[12]-421815835|0,a=(a<<11|a>>>21)+i|0,c+=(a^i^n)+l[15]+530742520|0,c=(c<<16|c>>>16)+a|0,n+=(c^a^i)+l[2]-995338651|0,n=(n<<23|n>>>9)+c|0,i+=(c^(n|~a))+l[0]-198630844|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[7]+1126891415|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[14]-1416354905|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[5]-57434055|0,n=(n<<21|n>>>11)+c|0,i+=(c^(n|~a))+l[12]+1700485571|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[3]-1894986606|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[10]-1051523|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[1]-2054922799|0,n=(n<<21|n>>>11)+c|0,i+=(c^(n|~a))+l[8]+1873313359|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[15]-30611744|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[6]-1560198380|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[13]+1309151649|0,n=(n<<21|n>>>11)+c|0,i+=(c^(n|~a))+l[4]-145523070|0,i=(i<<6|i>>>26)+n|0,a+=(n^(i|~c))+l[11]-1120210379|0,a=(a<<10|a>>>22)+i|0,c+=(i^(a|~n))+l[2]+718787259|0,c=(c<<15|c>>>17)+a|0,n+=(a^(c|~i))+l[9]-343485551|0,n=(n<<21|n>>>11)+c|0,d[0]=i+d[0]|0,d[1]=n+d[1]|0,d[2]=c+d[2]|0,d[3]=a+d[3]|0}function u(d){var l=[],i;for(i=0;i<64;i+=4)l[i>>2]=d.charCodeAt(i)+(d.charCodeAt(i+1)<<8)+(d.charCodeAt(i+2)<<16)+(d.charCodeAt(i+3)<<24);return l}function h(d){var l=[],i;for(i=0;i<64;i+=4)l[i>>2]=d[i]+(d[i+1]<<8)+(d[i+2]<<16)+(d[i+3]<<24);return l}function f(d){var l=d.length,i=[1732584193,-271733879,-1732584194,271733878],n,c,a,x,O,L;for(n=64;n<=l;n+=64)s(i,u(d.substring(n-64,n)));for(d=d.substring(n-64),c=d.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<c;n+=1)a[n>>2]|=d.charCodeAt(n)<<(n%4<<3);if(a[n>>2]|=128<<(n%4<<3),n>55)for(s(i,a),n=0;n<16;n+=1)a[n]=0;return x=l*8,x=x.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(x[2],16),L=parseInt(x[1],16)||0,a[14]=O,a[15]=L,s(i,a),i}function p(d){var l=d.length,i=[1732584193,-271733879,-1732584194,271733878],n,c,a,x,O,L;for(n=64;n<=l;n+=64)s(i,h(d.subarray(n-64,n)));for(d=n-64<l?d.subarray(n-64):new Uint8Array(0),c=d.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<c;n+=1)a[n>>2]|=d[n]<<(n%4<<3);if(a[n>>2]|=128<<(n%4<<3),n>55)for(s(i,a),n=0;n<16;n+=1)a[n]=0;return x=l*8,x=x.toString(16).match(/(.*?)(.{0,8})$/),O=parseInt(x[2],16),L=parseInt(x[1],16)||0,a[14]=O,a[15]=L,s(i,a),i}function m(d){var l="",i;for(i=0;i<4;i+=1)l+=r[d>>i*8+4&15]+r[d>>i*8&15];return l}function g(d){var l;for(l=0;l<d.length;l+=1)d[l]=m(d[l]);return d.join("")}g(f("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(t=function(d,l){var i=(d&65535)+(l&65535),n=(d>>16)+(l>>16)+(i>>16);return n<<16|i&65535}),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function d(l,i){return l=l|0||0,l<0?Math.max(l+i,0):Math.min(l,i)}ArrayBuffer.prototype.slice=function(l,i){var n=this.byteLength,c=d(l,n),a=n,x,O,L,Dt;return i!==e&&(a=d(i,n)),c>a?new ArrayBuffer(0):(x=a-c,O=new ArrayBuffer(x),L=new Uint8Array(O),Dt=new Uint8Array(this,c,x),L.set(Dt),O)}}();function w(d){return/[\\u0080-\\uFFFF]/.test(d)&&(d=unescape(encodeURIComponent(d))),d}function v(d,l){var i=d.length,n=new ArrayBuffer(i),c=new Uint8Array(n),a;for(a=0;a<i;a+=1)c[a]=d.charCodeAt(a);return l?c:n}function R(d){return String.fromCharCode.apply(null,new Uint8Array(d))}function b(d,l,i){var n=new Uint8Array(d.byteLength+l.byteLength);return n.set(new Uint8Array(d)),n.set(new Uint8Array(l),d.byteLength),i?n:n.buffer}function q(d){var l=[],i=d.length,n;for(n=0;n<i-1;n+=2)l.push(parseInt(d.substr(n,2),16));return String.fromCharCode.apply(String,l)}function A(){this.reset()}return A.prototype.append=function(d){return this.appendBinary(w(d)),this},A.prototype.appendBinary=function(d){this._buff+=d,this._length+=d.length;var l=this._buff.length,i;for(i=64;i<=l;i+=64)s(this._hash,u(this._buff.substring(i-64,i)));return this._buff=this._buff.substring(i-64),this},A.prototype.end=function(d){var l=this._buff,i=l.length,n,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a;for(n=0;n<i;n+=1)c[n>>2]|=l.charCodeAt(n)<<(n%4<<3);return this._finish(c,i),a=g(this._hash),d&&(a=q(a)),this.reset(),a},A.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},A.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},A.prototype.setState=function(d){return this._buff=d.buff,this._length=d.length,this._hash=d.hash,this},A.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},A.prototype._finish=function(d,l){var i=l,n,c,a;if(d[i>>2]|=128<<(i%4<<3),i>55)for(s(this._hash,d),i=0;i<16;i+=1)d[i]=0;n=this._length*8,n=n.toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(n[2],16),a=parseInt(n[1],16)||0,d[14]=c,d[15]=a,s(this._hash,d)},A.hash=function(d,l){return A.hashBinary(w(d),l)},A.hashBinary=function(d,l){var i=f(d),n=g(i);return l?q(n):n},A.ArrayBuffer=function(){this.reset()},A.ArrayBuffer.prototype.append=function(d){var l=b(this._buff.buffer,d,!0),i=l.length,n;for(this._length+=d.byteLength,n=64;n<=i;n+=64)s(this._hash,h(l.subarray(n-64,n)));return this._buff=n-64<i?new Uint8Array(l.buffer.slice(n-64)):new Uint8Array(0),this},A.ArrayBuffer.prototype.end=function(d){var l=this._buff,i=l.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c,a;for(c=0;c<i;c+=1)n[c>>2]|=l[c]<<(c%4<<3);return this._finish(n,i),a=g(this._hash),d&&(a=q(a)),this.reset(),a},A.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},A.ArrayBuffer.prototype.getState=function(){var d=A.prototype.getState.call(this);return d.buff=R(d.buff),d},A.ArrayBuffer.prototype.setState=function(d){return d.buff=v(d.buff,!0),A.prototype.setState.call(this,d)},A.ArrayBuffer.prototype.destroy=A.prototype.destroy,A.ArrayBuffer.prototype._finish=A.prototype._finish,A.ArrayBuffer.hash=function(d,l){var i=p(new Uint8Array(d)),n=g(i);return l?q(n):n},A})});var T=class e{constructor(t,r){this.operation=t;this.data=r}static NONCE="z3ZCw_12v";nonce=e.NONCE;static fromObject(t){return!t||t.nonce!==e.NONCE?null:new e(t.operation,t.data)}validate(){return this.nonce===e.NONCE}};var X=class{crawlId;installId;zys;dateCrawlStarted;dateCrawled;crawlUrl;fragmentIndex;youTubeChannelId;youTubeChannelName;youTubeVideoId;constructor(t,r,o,s,u,h,f,p){this.crawlId=t,this.installId=r,this.zys=o,this.dateCrawlStarted=s,this.dateCrawled=u,this.crawlUrl=h,this.fragmentIndex=f,Object.assign(this,p)}get ads(){return this.zys}set ads(t){this.zys=t}};var ct=Vt(vt(),1);var _=class{x;y;width;height;text;sourceUrls;hash;hashOverride;type;typeOverride;canvases;svgs;depth;adRuleId;dedupeKey;duration;language;youTubeId;netflixData;twitterData;vastData;outerHtml;static minWidth=120;static minHeight=28;static minimumVideoToAdAreaRatio=.5;static minimumImageToAdAreaRatio=.05;constructor(t){this.x=t.x??0,this.y=t.y??0,this.width=t.width,this.height=t.height,this.text=t.text??"",this.sourceUrls=t.sourceUrls??[],this.hash=t.hash??"",this.type=t.type,this.canvases=[],this.svgs=[],this.depth=0,this.adRuleId=t.adRuleId,this.duration=t.duration,this.language=t.language,this.youTubeId=t.youTubeId,this.netflixData=t.netflixData,this.twitterData=t.twitterData,this.vastData=t.vastData}};var y=class e{u;t;h;d;width;height;constructor(t){this.u=e.qualifyURL(t.url,t.doc),this.t=t.urlType,this.d=t.depth,this.width=t.width,this.height=t.height}get url(){return this.u}set url(t){this.u=t}get urlType(){return this.t}set urlType(t){this.t=t}get depth(){return this.d}set depth(t){this.d=t}get hash(){return this.h}set hash(t){this.h=t}static SourceUrlTags=new Set(["A","DIV","IFRAME","IMG","LINK","SCRIPT","SPAN","VIDEO"]);static qualifyURL(t,r){if(!t||new RegExp("^(?:\\\\w+-extension)|(?:about)|(?:blob)|(?:javascript):").test(t))return"";r=r||document;let o=r.createElement("a");return o.href=t,o.href}};async function Q(e,t){if(!e)return[];let r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,u=>y.SourceUrlTags.has(u.nodeName)||u?.shadowRoot?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP),o=[],s=r.currentNode;for(;s;){o.push(...await He(s,t));let u=s?.shadowRoot;u&&o.push(...await Q(u?.firstElementChild,t)),s=r.nextNode()}return o.filter(u=>u.url)}async function He(e,t){if(!e||!y.SourceUrlTags.has(e.nodeName))return[];if(e.nodeName=="IMG")return[await qt(e,t)];if(e.nodeName=="DIV"||e.nodeName=="SPAN"){let s=/url\\([\'"]?([^\'"]+)[\'"]?\\)/gi,u=getComputedStyle(e).getPropertyValue("background-image");return Promise.all(Array.from(u.matchAll(s)).filter(h=>h).map(h=>h[1]).map(async h=>{try{let f=new Image;return f.src=h,await f.decode(),qt(f,t)}catch{return new y({url:h,urlType:7,depth:t,doc:e?.ownerDocument})}}))}if(e.nodeName==="VIDEO"){if(e=e.hasAttribute("src")?e:e.querySelector("source"),!e)return[];let s=e.getBoundingClientRect(),u=Math.round(s.width),h=Math.round(s.height);return[new y({url:e.getAttribute("src"),urlType:4,depth:t,width:u,height:h,doc:e.ownerDocument})]}if(e.nodeName==="IFRAME")return[new y({url:e.getAttribute("src"),urlType:1,depth:t,width:e.offsetWidth,height:e.offsetHeight,doc:e.ownerDocument})];let r=null,o=0;switch(e.nodeName){case"SCRIPT":r=e.getAttribute("src"),o=6;break;case"LINK":r=e.getAttribute("href"),o=6;break;case"A":r=e.getAttribute("href"),o=8;break}return[new y({url:r,urlType:o,depth:t,doc:e.ownerDocument})]}async function qt(e,t){let r=e.getAttribute("src"),o=e.getBoundingClientRect(),s=Math.round(e.naturalWidth||o.width),u=Math.round(e.naturalHeight||o.height);if(!(s||u)&&r)try{let f=new Image;f.src=r,await f.decode(),s=f.naturalWidth,u=f.naturalHeight}catch{}let h=0;return(o.width||s)<2&&(o.height||u)<2||s===43&&u===22||o.y+window.scrollY<5&&(o.width||s)<85&&(o.height||u)<=20?h=7:h=3,new y({url:r,urlType:h,depth:t,width:o.width||s,height:o.height||u,doc:e.ownerDocument})}async function ut(e,t){e.sourceUrls=lt(e.sourceUrls,h=>h.u);let r=e.sourceUrls.filter(h=>h.t===3||h.t===4),s=r.filter(h=>h.t===3).sort((h,f)=>(h.width||0)*(h.height||0)-(f.width||0)*(f.height||0)).pop(),u=r.filter(h=>h.t===4);if(e.type=e.typeOverride??(r.length===1&&(r[0].width||0)>=e.width-2&&(r[0].height||0)>=e.height-2?r[0].t===3?1:3:u.length===1&&(u[0].width||0)*(u[0].height||0)>=e.width*e.height*_.minimumVideoToAdAreaRatio?3:7),e.hashOverride)return e.hash=e.hashOverride;if(e.type===7&&!u.length&&(s?.width||0)*(s?.height||0)<e.width*e.height*_.minimumImageToAdAreaRatio)return e.hash="";for(let h of r)h.h=await j(h.u||"",t);if(e.hash=r.filter(h=>h.h).reduce((h,f)=>z(h,f.h),"")||"",e.type===3&&!e.hash&&(e.hash=k(r[0].u??"",!0)),e.type===7&&e.text){let h=k(e.text.toLowerCase(),!0);e.hash=z(e.hash,h)}if(e.hash||(e.canvases?.length&&(e.hash=e.canvases.reduce((h,f)=>z(k(f),h),e.hash)),e.svgs?.length&&(e.hash=e.svgs.reduce((h,f)=>z(k(f),h),e.hash))),e.type===7&&e.hash){let h=k(Be(kt(Math.round(e.height)),kt(Math.round(e.width))),!0);e.hash=z(e.hash,h)}r.forEach(h=>{h.h&&(h.h=btoa(h.h))}),e.hash=btoa(e.hash)}async function j(e,t){try{return k(await t(e))}catch(r){return S(r),""}}function k(e,t){if(Ve(e)==="arraybuffer"){let r=e;return r.byteLength===0?"":ct.default.ArrayBuffer.hash(r,!0)}else{let r=e;return t?ct.default.hash(r,!0):ct.default.hashBinary(r,!0)}}function Ve(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}function z(e,t){if(!t)return e||"";if(!e)return t;if(e.length<t.length){let u=e;e=t,t=u}let r=e.length,o=t.length,s="";for(let u=0;u<o;u++)s+=String.fromCharCode(e.charCodeAt(u)^t.charCodeAt(u));for(let u=o;u<r;u++)s+=String.fromCharCode(e.charCodeAt(u));return s}function kt(e){let t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e,!0),t}function Be(e,t){let r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}var V=3e3;var Et="pc",Ct="ca",et=72e5,Z=null;function S(...e){Z&&(e=e||[],e=e.map(t=>t?.stack&&t.message?{error:t.message,stack:t.stack}:t),e=e.map(t=>typeof t!="object"||t instanceof String?t:JSON.stringify(t)),e.length==1?Z(e[0]):Z(e))}function Jt(e){Z=e||Z}var ht=class{constructor(t,r,o,s){let u=Xt(t);u==="object"?(this.left=0,Object.assign(this,t)):u==="number"&&(this.left=Math.round(Math.max(t||0,0))||0,this.top=Math.round(Math.max(r||0,0))||0,this.width=Math.round(Math.max(o||0,0))||0,this.height=Math.round(Math.max(s||0,0))||0)}get bottom(){return this.top+this.height}get right(){return this.left+this.width}toString(){return`${this.width}x${this.height}@${this.left},${this.top}`}};function We(){return([1e7]+-1e3+-1e3+-1e3+-1e11).replace(/[01]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function Xt(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}function qe(e,t){let r={},o=Object.keys(t);for(let s=0,u=o.length;s<u;s++){let h=o[s];if(t.hasOwnProperty(h)){let f=t[h];if(f==null||f===""&&e[h]||f instanceof Array&&!f.length&&e[h]?.length||(h==="top"||h==="left"||h==="X"||h==="Y")&&e[h]>0)continue;r[h]=t[h]}}return Object.assign(e,t)}function E(e){try{return e()}catch{return null}}var $r=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789").map(e=>e.charCodeAt(0));function zt(e){return e.tagName?.toUpperCase?.()||E(()=>e.outerHTML.substr(1,e.outerHTML.indexOf(" ")-1).toUpperCase())||""}function jt(e){let t=0,r="",o={" ":1,"\\f":1,"\\n":1,"\\r":1,"	":1,"\\v":1,"\\xA0":1,"\\u2028":1,"\\u2029":1};for(let s=0,u=e.length;s<u;s++)o[e.charAt(s)]?(t||(r+=" "),t=1):(t=0,r+=e.charAt(s));return r.trim()}function F(){return ke(C.location.hostname)}function ke(e){return e.split(".").slice(e.endsWith(".uk")||e.endsWith(".jp")?-3:-2).join(".")}function pt(){let e=new Set(["aarp.org","abc.com","aol.com","attn.com","atttvnow.com","brainly.com","bravotv.com","cartoonnetwork.com","cbs.com","cbssports.com","chron.com","citationmachine.net","cnet.com","cnn.com","crunchyroll.com","dailymail.co.uk","delish.com","discoveryplus.com","easybib.com","espn.com","fandom.com","foxbusiness.com","foxnews.com","fubo.tv","genius.com","go.cnn.com","go.com","goodhousekeeping.com","happykids.tv","hulu.com","imdb.com","investigationdiscovery.com","linkedin.com","locast.org","mlb.com","msn.com","music.amazon.com","music.apple.com","music.youtube.com","mytuner-radio.com","nexusmods.com","nfl.com","nhl.com","nypost.com","nytimes.com","paramountplus.com","pch.com","philo.com","playstation.com","pluto.tv","rawstory.com","realtor.com","refinery29.com","seattlepi.com","sfgate.com","sling.com","spanishdict.com","sporcle.com","steampowered.com","tablotv.com","therokuchannel.roku.com","try.frndlytv.com","tubitv.com","tv.apple.com","tv.youtube.com","twitch.tv","uproxx.com","usatoday.com","vudu.com","washingtonpost.com","watch.hgtv.com","watch.spectrum.net","weather.com","www3.nhk.or.jp","xbox.com","xfinity.com","yahoo.com","yelp.com","youtubekids.com"]);return I&&(e.has(C.location.hostname)||e.has(F()))}function U(e){e.documentElement&&(e=e.documentElement);let t=zt(e);if(e.offsetParent===null&&t!=="BODY"&&t!=="HTML"&&t!=="FRAME")return new ht;let o=(e.ownerDocument||document).defaultView||C,s=e.getBoundingClientRect();return new ht(s.left+o.scrollX,s.top+o.scrollY,s.width,s.height)}var Gt=["background-image","display","visibility","z-index","border-top-width","border-left-width","border-bottom-width","border-right-width","padding-top","padding-left","padding-bottom","padding-right","position","width","height","top","bottom","left","right","font-size"];function je(e){if(e._pm_st)return e.style&&(e._pm_st=qe(e._pm_st,JSON.parse(JSON.stringify(e.style,Gt)))),e._pm_st;let t=e.ownerDocument?.defaultView;typeof window<"u"&&(!t||!t.opener)&&(t=window);let r=JSON.parse(JSON.stringify(t.getComputedStyle(e),Gt));return e._pm_st=r,r}function Kt(e,t){let r=e.nodeName,o=je(e),s=U(e);if(o?.display!=="none"&&s&&s.width>20&&s.height>20)if(r==="CANVAS"&&!e.matches(".__pm_marker"))try{t.canvases.push(e.toDataURL("image/jpeg",.2))}catch{}else r==="SVG"&&t.svgs.push(e.outerHTML)}function mt(e){if(!e)return"";let t=e?.ownerDocument||document,r=t.defaultView.NodeFilter;if(Xt(e)==="htmldocument"&&e.body&&(e=e.body),!e)return"";let o={SCRIPT:1,NOSCRIPT:1,STYLE:1},s=zt(e);if(s==="HTML"&&(e=e.querySelector("body")),!e)return"";let u=function(m){try{return m.nodeType===3?r.FILTER_ACCEPT:!m.tagName||o[m.tagName]||m.offsetParent===null?r.FILTER_REJECT:r.FILTER_ACCEPT}catch{return r.FILTER_REJECT}};if(e.nodeType!==3&&(!s||o[s]))return"";let h=t.createTreeWalker(e,r.SHOW_ELEMENT|r.SHOW_TEXT,{acceptNode:u},!0),f={"LEARN MORE":1,REPLAY:1},p=[];for(;e;){if(e.nodeType===3){let m=jt(e.nodeValue||"");!f[m.toUpperCase()]&&!p.includes(m)&&p.push(m)}e=h.nextNode()}return p.length?jt(p.join(" ")):""}function P(e,t){return C.requestIdleCallback?{id:C.requestIdleCallback(e,{timeout:t}),isIdleCallback:!0}:{id:setTimeout(e,t),isIdleCallback:!1}}var tt=null;function G(e){tt=e||tt}function It(){tt=null}function Yt(){if(typeof window>"u")return;let e=function(f,p,m,g){P(()=>{!tt||!f||tt(f,p,m,g)},1e4)},t=f=>new TextDecoder("utf-8").decode(new Uint8Array(f)),r=function(f,p){try{if(p=f.currentTarget||p,p=p._datadog_xhr||p,p.readyState===4&&p.status>=200&&p.status<=210){let m=E(()=>p.responseXML),g=E(()=>p.responseText)||E(()=>t(p.response))||E(()=>m.documentElement.outerHTML);(g||m)&&e(g,m,p.reponseType==="json",p.responseURL)}}catch{}},o=XMLHttpRequest.prototype.send;function s(){let f=this.onreadystatechange,p=arguments;this.onreadystatechange=function(m){return r(m,this),f?.apply?.(this,arguments)},o.apply(this,p)}XMLHttpRequest.prototype.send=s;let u=C.fetch,h=function(){return u.apply(this,arguments).then(f=>{let p=f.headers.get("Content-Type");if(p&&(p.includes("text")||p.includes("json")||p.includes("xml")||p.includes("javascript"))){let m=f.clone();P(()=>{m.text().then(g=>e(g,null,p.includes("json"),f.url))},5e3)}return f})};C.fetch=h}function Tt(e){if(!e)return null;let t=null;return e=(e+"").trim(),e=="start"?t=0:e.indexOf(":")>=0?t=E(()=>Math.round(e.split(":").reduce((r,o,s,u)=>r+parseFloat(o)*Math.pow(60,u.length-s-1),0)))||t:isNaN(e)||(t=Math.round(parseFloat(e))),t}var Qt,$,Zt,St,H,dt,ft;function te(e){H[e.dedupeKey]?.depth>e.depth||H[e.dedupeKey]?.depth===e.depth&&H[e.dedupeKey].adRuleId<e.adRuleId||(H[e.dedupeKey]=e)}function Ge(){let e=C.location;return e.href.indexOf("youtube.com/watch")===-1?e.origin+e.pathname:e.href}async function $e(e){await Promise.all(e.map(t=>ut(t,M)))}async function Je(){let e=Object.values(H),t=Object.values(dt);return H={},dt={},await $e(e),new X(Qt,gt,e.concat(t).filter(r=>r.hash),$-(D?.TimeOffset||0),Date.now()-(D?.TimeOffset||0),St,Zt++,ft)}function N(e,t){if(!I){W(top,new T(Et,[e,t]));return}e.forEach(r=>dt[r.hash]=r),ft=t||ft,B()}var $t=0;async function B(){let e=Date.now();if(e-$t>V){$t=e;let t=await Je();Nt?.(JSON.stringify(t))}}function ee(){if(!I)return;Qt=We(),$=Date.now(),Zt=0;let e=D?.ParsedSiteConfigs[F()];if(e){let t=new RegExp(e).exec(location.href);St=t?t.slice(1).join(""):location.protocol+"://"+location.hostname}else St=Ge();H={},dt={},ft=void 0}function Xe(e,t){return e.reduce(function(r,o){return(r[t(o)]=r[t(o)]||[]).push(o),r},{})}function lt(e,t){return Object.values(Xe(e,t)).map(r=>r[0])}function W(e,t){e.postMessage(t,"*")}var re=null;function ne(){let e=document.querySelector("video.ad-video-player,video#ad-video-player"),t=document.querySelector(".AdUnitView a"),r=e&&e.src;if(e&&t&&r&&re!==r&&r.endsWith(".mp4")&&r.indexOf("bumper")===-1&&(r.indexOf("ads")>=0||r.indexOf("Ads")>=0)){if(!e.duration||isNaN(e.duration))return;re=r,P(()=>{j(r,M).then(o=>N([new _({width:1920,height:1080,sourceUrls:[new y({url:r,urlType:4}),new y({url:t.href,urlType:8})],hash:btoa(o),type:3,duration:Math.round(e.duration)})]))});return}}var yt={},ie=!1;function oe(){if(S("NETFLIX AD CAPTURE"),!(typeof window>"u")){if(!ie){let e=Object.defineProperty;Object.defineProperty=function(r,o,s){return Date.now()-$<et&&P(()=>{if(Object.hasOwn(r,"isAd")&&r.isAd){let u=ze(r);u&&(yt[u.hash]=u)}}),e(r,o,s)},ie=!0}N(Object.values(yt)),yt={}}}function ze(e){let t=e.movieId;if(!t||yt[t])return;let r=e.video_tracks[0].streams[0],o=r.res_w,s=r.res_h,u=e.audio_tracks[0].streams[0];return new _({hash:("n+++"+t).padEnd(t.length+4+(t.length+4)*6%8/2,"=").replace("===","A=="),type:3,sourceUrls:[new y({url:r.urls[0].url,urlType:4,width:o,height:s}),new y({url:u.urls[0].url,urlType:9})],width:o,height:s,duration:e.duration,language:u.language,netflixData:{id:t}})}var rt=[];async function Rt(){S("TWITTER AD CAPTURE"),G((e,t,r,o)=>{try{if(!o||!o.includes("HomeTimeline")&&!(o.includes("/conversation/")&&o.includes("/"+/\\d+$/.exec(window.location.pathname)[0]+".json")))return;let s=Ke(e);rt=rt.concat(s)}catch{}}),await Ye()}function Ke(e){let t=JSON.parse(e);return([].concat.apply([],t?.data?.home?.home_timeline_urt?.instructions?.filter?.(s=>s?.type=="TimelineAddEntries")?.map?.(s=>s.entries))||[]).map(s=>s.content?.itemContent).filter(s=>s?.promotedMetadata).map(s=>{let u=s.tweet_results?.result?.card?.legacy?.binding_values?.filter?.(f=>f?.key=="unified_card")?.map?.(f=>JSON.parse(f.value?.string_value))?.[0],h=u?.destination_objects?.browser_1?.data?.url_data?.url||u?.destination_objects?.browser_with_docked_media_1?.url_data?.url;return{id_str:s?.tweet_results?.result?.rest_id,screen_name:s?.tweet_results?.result?.core?.user_results?.result?.legacy?.screen_name,cardDestination:h,advertiserId:s?.promotedMetadata?.advertiser_results?.result?.rest_id,user_id_str:s?.tweet_results?.result?.legacy?.user_id_str}}).filter(s=>s.id_str&&s.screen_name)}async function Ye(){if(!nt)return;let e=await Qe(document,rt),t=e.map(r=>r.twitterData.tid);rt=rt.filter(r=>!t.includes(r.id_str)),N(e)}async function Qe(e,t){let r="div.tweet.promoted-tweet",o=Array.from(e.querySelectorAll(r));o.length||(o=Array.from(e.querySelectorAll("article div>svg")).map(u=>u.parentElement.querySelector("span")).filter(u=>u?.textContent&&u.textContent.length<50).map(u=>u.closest("article"))),o.length||(o=Array.from(document.querySelectorAll("span")).filter(u=>u.textContent==="Ad").map(u=>u.closest("article")));let s=[];for(let u=0;u<o.length;u++){let h=o[u],f=Array.from(h.querySelectorAll("div>span,a span")).map(b=>b.textContent).filter(b=>b?.startsWith("@"))[0];f=f.startsWith("@")?f.substring(1):f;let p=null,m=null;for(m of t)if(m.screen_name==f&&(p=m.id_str,p))break;if(!p)continue;let g=mt(h);g&&(g=g.replace(new RegExp("# (\\\\w)","gi"),"#$1"));let w=U(h),v=new _({x:w.left,y:w.top,width:w.width,height:w.height,text:g,sourceUrls:(await Q(h.querySelector(".tweet-details-fixer")||h)).concat([new y({url:m.cardDestination,urlType:8})]).filter(b=>b.url&&!b.url.includes("/profile_images/")&&!b.url.includes(p+"/retweets")&&!b.url.includes(p+"/likes")&&!b.url.includes("/using-twitter/how-to")),hash:("t+++"+p).padEnd(p.length+4+(p.length+4)*6%8/2,"=").replace("===","A=="),type:h.querySelector("video")||h.querySelector(".PlayableMedia")?105:Array.from(h.querySelectorAll("img")).filter(b=>b.naturalWidth>200&&b.naturalHeight>40).length?104:h.querySelector("iframe")?102:103,twitterData:{taid:m.advertiserId||m.user_id_str||0,tid:p,tsn:f}}),R=(v.sourceUrls||[]).filter(b=>b?.url);v.sourceUrls=lt(R,b=>b.url),s.push(v)}return s}function Pt(){S("VAST AD CAPTURE"),G((e,t,r)=>{try{let o=e.substring(0,500),s=o.indexOf(\'"ad_id":\')>=0||o.indexOf(\'"ad_type"\')>=0,u=[];if(r||s)Ze(e,u);else if(o.indexOf("<VAST ")>=0||o.indexOf("<vmap:AdBreak ")>=0){let h=E(()=>t?.documentElement||e&&new DOMParser().parseFromString(e,"application/xml").documentElement);tr(h,u)}else return;Promise.allSettled(u).then(h=>{S("Ads found.",h.map(f=>f.value)),N(h.map(f=>f.value).filter(f=>f))})}catch(o){S(o)}})}function Ze(e,t){let r=E,o=r(()=>e&&JSON.parse(e)),s=r(()=>o.items);s?.length&&Array.from(s).forEach(u=>{let h=r(()=>u.media.streamurl);if(!h)return;let f=r(()=>u.clickthrough),p=r(()=>u.media.duration),m=r(()=>u.ad_id||u.ad_video_id),g=r(()=>u.title);m&&F()==="peacocktv.com"&&(m=m.split(".")[0]);let w=r(()=>u.system);t.push(j(h,M).then(v=>new _({width:1920,height:1080,sourceUrls:[new y({url:h,urlType:4}),new y({url:f,urlType:8}),new y({url:"http://"+w,urlType:1})].filter(b=>b.url),hash:btoa(v)||m,type:3,duration:Math.round(p),vastData:{Id:m,Title:g,System:w}})))})}function tr(e,t){let r=E,o=r(()=>e?.querySelectorAll("VAST Ad"));o&&Array.from(o).forEach(s=>{let u=s.querySelector("Creatives Creative");if(!u)return;let h=u.querySelector("MediaFiles");if(!h)return;let f=r(()=>u.querySelector("VideoClicks ClickThrough").textContent.trim())||r(()=>document.querySelector(".AdUnitView a").href.trim()),p=r(()=>Tt(u.querySelector("Duration").textContent)),m=r(()=>h.querySelector("MediaFile[type=\'video/mp4\'],MediaFile[type=\'application/dash+xml\'],MediaFile[type=\'video/mpd\']").textContent.trim());if(!m){let l=u.querySelector("AdParameters"),i={},n,c=new RegExp("<(\\\\w+)>([^<]+)</\\\\1>","gi");for(;(n=c.exec(l.textContent))!==null;)i[n[1]]=n[2];p=r(()=>Tt(i.adDuration)),f=r(()=>i.clickUrl);let a=i.JsParameters;if(!a)return;let x=JSON.parse(a);m=r(()=>x.videos[0].url),m&&(p=p||x.duration,f=f||x.clickThruUrl||x.clickThroughUrl)}if(!m)return;let g=u.getAttribute("AdID")||u.getAttribute("AdId")||u.getAttribute("adid")||s.getAttribute("id");if(!g)return;F()==="peacocktv.com"&&(g=g.split(".")[0]);let w=r(()=>s.querySelector("AdTitle").textContent.trim()),v=r(()=>s.querySelector("AdSystem").textContent.trim()),R=s.querySelector("Extension"),b=r(()=>R.querySelector("CreativeParameter[name=\'_fw_advertiser_name\']").textContent.trim())||r(()=>R.querySelector("CreativeParameter[name=\'fw_advertiser_name\']").textContent.trim())||r(()=>R.querySelector("CreativeParameter[name=\'fw_advertiser\']").textContent.trim()),q=r(()=>R.querySelector("CreativeParameter[name=\'fw_brand\']").textContent.trim()),A=r(()=>R.querySelector("CreativeParameter[name=\'industry\']").textContent.trim()),d=r(()=>R.querySelector("CreativeParameter[name=\'ccr_measurement\']").textContent.trim());t.push(j(m,M).then(l=>new _({width:1920,height:1080,sourceUrls:[new y({url:m,urlType:4}),new y({url:f,urlType:8}),new y({url:d,urlType:0})].filter(i=>i.url),hash:btoa(l)||g,type:3,duration:Math.round(p),vastData:{Id:g,Adv:b,Brand:q,Cat:A,Title:w,System:v}})))})}var ae=Vt(vt(),1);function er(e){return e?new URL(e).searchParams.get("v"):null}var Mt;function wt(){return Mt||(Mt=document.querySelector("#movie_player")),Mt}function rr(){return E(()=>{let e=JSON.parse(wt().getDebugText());return e.ad_debug_videoId||e.addebug_videoId||e.ad_videoId})}function nr(){return E(()=>{let e=document.querySelector("#upload-info a.yt-simple-endpoint"),t=e.href.split("/");return{youTubeChannelId:t[t.length-1],youTubeChannelName:e.textContent.trim(),youTubeVideoId:E(()=>er(window.location.href))}})}function ir(){let e=E(()=>document.querySelector(".ytp-ad-player-overlay-instream-info .ytp-ad-button-text").textContent);if(e&&ar.test(e)){let t=e.indexOf("http://")===0||e.indexOf("https://")===0?e:"https://"+e.toLowerCase();return new y({url:t,urlType:8})}return null}function or(e){return e?btoa(ae.default.hash("YouTube+"+e,!0)):null}function sr(){return E(()=>wt().getAdState()>0||JSON.parse(wt().getDebugText()).addebug_videoId)}var ar=new RegExp("^(?:https?://)?[a-z0-9.-]+(\\\\.[a-z]+)+(?:$|/)"),ce={};function se(e){[e?.playerAds??[],e?.adPlacements??[]].flat().map(t=>(t.adPlacementRenderer?.renderer?.linearAdSequenceRenderer?.linearAds?.map(r=>r?.instreamVideoAdRenderer)??[]).concat([t.adPlacementRenderer?.renderer?.instreamVideoAdRenderer])).flat().filter(t=>t).map(function(t){let r=t?.playerOverlay?.instreamAdPlayerOverlayRenderer?.visitAdvertiserRenderer?.buttonRenderer?.navigationEndpoint?.urlEndpoint?.url;return r?{videoId:t.externalVideoId,lp:r}:null}).filter(t=>t).reduce((t,r)=>Object.assign(t,{[r.videoId]:new y({url:r.lp,urlType:8})}),ce)}function ue(){try{if(G((p,m,g,w)=>{try{if(!w||!w.includes("/ad_break?")&&!w.includes("/player?"))return;se(JSON.parse(p))}catch(v){S(v)}}),!sr())return B();se(window.ytInitialPlayerResponse);let e=0,t=640,r=360,o=0,s=0,u=wt(),h=u.querySelector("a.ytp-title-link"),f=u.querySelector("video");if(f){e=f.duration||0;let p=U(f);t=p?.width||t,r=p?.height||r,o=p?.left||o,s=p?.top||s}P(()=>{let p=rr()||void 0,m=ce[p]??ir(),g=nr(),w=m?[m]:[],v=new _({x:o,y:s,width:t,height:r,text:h?.textContent,sourceUrls:w,hash:or(p),type:3,duration:Math.round(e),youTubeId:p});N([v],g)})}catch(e){S(e)}}var it=class{constructor(t=null){this.log=t,this.#t.log=t??(()=>{})}simplifyTree(t){let r;for(;;){if(r=this.#t[t.r],!r)throw new Error(`Rule ${t.r} not implemented.`);if(r!==this.#t.PassOn||!t.c||!t.c.length)break;t=t.c[0]}return t.c&&t.c.length&&(t.c=t.c.map(o=>this.simplifyTree(o))),t}debugPrintParseTree(t,r=0){this.log(`${" ".repeat(r*2)}${t.r}: ${this.#t.GetText(t)}`),t.c&&t.c.length&&t.c.forEach(o=>this.debugPrintParseTree(o,r+1))}isValidRuleName(t){return t.indexOf("TerminalNode")===0||!!this.#t[t]}evaluate(t,r){return this.#t.evaluate(t,r)}#t=class{static#s=0;static evaluate(t,r,o){try{if(!this[t.r])throw new Error(t.r+" is not a parser rule function.");return this[t.r](t,r,o)}catch(s){this.log("Error "+t.r+\' at "\'+this.GetText(t)+\'": \'+s)}}static#i=new RegExp(`(?:^[\'"])|(?:[\'"]$)`,"g");static#o=new RegExp("\\\\s+","g");static#a=this;static PassOn(t,r){return this.evaluate(t.c[0],r)}static NoOp(t){this.log(`Unimplemented rule: ${t.r} at "${this.GetText(t.t)}".`)}static ExpStmt=this.PassOn;static ExpSequence=this.PassOn;static LitExp=this.PassOn;static Literal=this.PassOn;static ArrayLitExp=this.PassOn;static ArrayLit=this.PassOn;static ArrowFuncBody=this.PassOn;static ObjectLitExp=this.PassOn;static IdName=this.PassOn;static MultOperator=this.NoOp;static AdditionOperator=this.NoOp;static RelationalOperator=this.NoOp;static EqualityOperator=this.NoOp;static ReservedWord=this.NoOp;static AssignExp=this.NoOp;static VarModifier=this.NoOp;static FormalParameterList=this.NoOp;static FormalParameterArg=this.NoOp;static PropAssign=this.NoOp;static Exp=this.NoOp;static Assignable=this.NoOp;static AnonFunc=this.NoOp;static ArrowFuncParameters=this.NoOp;static PropName(t){return t.c?t.c[0].t:this.#r(t.t)}static ObjectLit(t,r){let o={};return t.c.forEach(s=>this.PropExpAssign(s,r,o)),o}static PropExpAssign(t,r,o){let s=this.evaluate(t.c[0],r),u=this.evaluate(t.c[1],r);o[s]=u}static#r(t){return t?.replaceAll(this.#i,"")}static StrLit(t){return this.#r(t?.t)}static NumLit(t){return Number.parseFloat(t?.t)}static IntLit(t){return Number.parseInt(t?.t)}static BoolLit(t){return t.t&&t.t=="true"}static NullLit(){return null}static IdExp(t,r){return this.evaluate(t.c[0],r)}static Id(t,r){return r[t.t]}static FuncExp(t,r){return this.evaluate(t.c[0],r)}static ArrowFunc(t,r){let o=t.c[0]?.c?.map(u=>this.#e(u)).flat(),s=this;return function(...u){o.forEach((f,p)=>{r[f]=u[p]});let h=s.evaluate(t.c[1],r);return o.forEach(f=>{delete r[f]}),h}}static AnonFuncDecl(t,r){let o=t.c[0]?.c?.map(u=>this.#e(u)).flat(),s=this;return function(...u){o.forEach((f,p)=>{r[f]=u[p]});let h=s.evaluate(t.c[1],r);return o.forEach(f=>{delete r[f]}),h}}static#e(t,r=null){return r=r??[],t.c?.forEach(o=>this.#e(o,r)),t.t&&r.push(t.t),r}static#c(t,r=0){this.log(`${"  ".repeat(r)}${t.r}: ${this.GetText(t)}`)}static GetText(t){return this.#e(t).join(" ")}static ElementList(t,r){return t.c.map(o=>this.evaluate(o,r))}static ArrayElem=this.PassOn;static ArgsExp(t,r){let o=t.c[0],s=this.evaluate(t.c[1],r),u=this.evaluate(o,r,s);return typeof u=="function"&&(u=u.apply(o._this??null,s)),delete o._this,u}static Args(t,r){return t.c.map(o=>this.evaluate(o,r))}static Arg(t,r){return this.evaluate(t.c[0],r)}static MemberDotExp(t,r,o){return this.#n(t,r,o,!0)}static MemberIndexExp(t,r,o){return this.#n(t,r,o)}static#n(t,r,o,s){let u=this.evaluate(t.c[0],r),h=s?t.c[1].t:this.evaluate(t.c[1],r);return this["_x_"+h]?this["_x_"+h](u,...o??[]):(t._this=u,u[h])}static ErrorNodeImpl(t){this.log(`Error parsing ${t.r} at ${t.t} (unexpected token?)`)}static AdditiveExp(t,r){switch(t.c[1].t){case"+":return this.evaluate(t.c[0],r)+this.evaluate(t.c[2],r);case"-":return this.evaluate(t.c[0],r)-this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static MultiplicativeExp(t,r){switch(t.c[1].t){case"*":return this.evaluate(t.c[0],r)*this.evaluate(t.c[2],r);case"/":return this.evaluate(t.c[0],r)/this.evaluate(t.c[2],r);case"%":return this.evaluate(t.c[0],r)%this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static RelationalExp(t,r){switch(t.c[1].t){case">":return this.evaluate(t.c[0],r)>this.evaluate(t.c[2],r);case"<":return this.evaluate(t.c[0],r)<this.evaluate(t.c[2],r);case">=":return this.evaluate(t.c[0],r)>=this.evaluate(t.c[2],r);case"<=":return this.evaluate(t.c[0],r)<=this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static EqualityExp(t,r){switch(t.c[1].t){case"==":return this.evaluate(t.c[0],r)==this.evaluate(t.c[2],r);case"!=":return this.evaluate(t.c[0],r)!=this.evaluate(t.c[2],r);case"===":return this.evaluate(t.c[0],r)===this.evaluate(t.c[2],r);case"!==":return this.evaluate(t.c[0],r)!==this.evaluate(t.c[2],r);default:throw new Error("Unknown binary operator "+t.c[1].t)}}static TernaryExp(t,r){return this.evaluate(t.c[0],r)?this.evaluate(t.c[1],r):this.evaluate(t.c[2],r)}static CoalesceExp(t,r){return this.evaluate(t.c[0],r)??this.evaluate(t.c[1],r)}static InstanceofExp(t,r){return this.evaluate(t.c[0],r)instanceof this.evaluate(t.c[1],r)}static LogicalAndExp(t,r){return this.evaluate(t.c[0],r)&&this.evaluate(t.c[1],r)}static LogicalOrExp(t,r){return this.evaluate(t.c[0],r)||this.evaluate(t.c[1],r)}static UnaryPlusExp(t,r){return+this.evaluate(t.c[0],r)}static UnaryMinusExp(t,r){return-this.evaluate(t.c[0],r)}static BitNotExp(t,r){return~this.evaluate(t.c[0],r)}static NotExp(t,r){return!this.evaluate(t.c[0],r)}static ParenthesizedExp(t,r){return this.evaluate(t.c[0],r)}static Eos(){return null}static _x_query(t,r){return Array.from(t?.querySelectorAll(r)??[])}static _x_where(t,r){return t?.filter(r)}static _x_select(t,...r){let o=r.length;if(!r||o===0)throw new Error("Method \'select\' expects on or more arrow functions.");return t?.map((s,u)=>{if(o>1){let h=[];for(let f=0;f<o-1;f++)h[f]=r[f](s,...f==0?[u]:h);return r[o-1](s,...h)}else return r[0](s,u)})}static _x_width(t){return t?.offsetWidth}static _x_height(t){return t?.offsetHeight}static _x_text(t){return t?.textContent?.trim()?.replaceAll(this.#o," ")}static _x_parent(t){return t?.parentNode}static _x_matchRegExp(t,r,o){return t.match(new RegExp(r,o))}}};function Ot(e){if(e.checkVisibility&&!e.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}))return!1;let t=e.ownerDocument,r=t.defaultView,o=r?.getComputedStyle(e);if(o&&(o.opacity==="0"||o.visibility==="hidden"))return!1;let s=e.getBoundingClientRect();if(!s||s.width<=0||s.height<=0)return!1;let{top:u,left:h,right:f,bottom:p}=s;if(f<0||p<0)return!1;let m=r?.innerWidth||t.documentElement.clientWidth,g=r?.innerHeight||t.documentElement.clientHeight;if(u>g||h>m)return!1;let w=e.parentNode;if(w&&w instanceof Element&&getComputedStyle(w).overflow==="hidden"){let v=w.getBoundingClientRect();if(p<v.top||u>v.bottom||f<v.left||h>v.right)return!1}return!0}function le(e,t){return r=>new Promise(o=>{let s=e+"-response",u=Math.random(),h=p=>{let{type:m,payload:g,nonce:w}=p.data??{};m!==s||w!==u||(o(g),f())},f=()=>{window.removeEventListener("message",h)};window.addEventListener("message",h),s==="getFrameId-response"?r.postMessage(new T("getFrameId",u),"*"):window.postMessage({type:e,nonce:u,payload:r},"*"),t&&setTimeout(o,t)})}var de,fe,pe,J,_t=new Set,bt=new Set,Ft=new Set,at=!1,Ut=[],me=[],Nt,M,D,gt,nt,C=typeof window>"u"?{location:{hostname:""}}:window,I=C.top===C.self,cr=(Math.random()+1).toString(36).substring(2),ur=2e3,ge=7e3,lr=5*ge,hr=2e3;function st(e,t,...r){let o=setTimeout(e,t,...r);return _t.add(o),o}function ot(e,t,...r){let o=setInterval(e,t,...r);return bt.add(o),o}function Lt(e,t){let r=P(e,t);return r.isIdleCallback?Ft.add(r.id):_t.add(r.id),r}var dr={"hulu.com":[ne],"netflix.com":[oe],"twitter.com":[Rt],"x.com":[Rt],"youtube.com":[ue]};at||(typeof F<"u"&&(J=F()),typeof pt<"u"&&(pt()||ye())&&Yt());function ye(){return dr[J]}function fr(){if(!I||!nt)return;if(pt()){Pt();let s=new Set,u=()=>{let h=Array.from(C.frames).concat(Array.from(document.querySelectorAll("frame,iframe")).map(f=>E(f.contentWindow)).filter(f=>f));for(let f=0;f<h.length;f++)try{let p=h[f];if(!p||s.has(p))continue;W(p,new T(Ct,et-(Date.now()-$))),s.add(p)}catch(p){S(p)}};u(),ot(u,5e3)}let e=Date.now(),t=ye(),r=function(s){e=Date.now(),Lt(async()=>{for(let u=0,h=t?.length;t&&u<h;u++)await t[u].call();I&&(t||s)&&B()},V-500)},o=ot(r,V);r(!0),ot(()=>{Date.now()-e>V*5&&(clearInterval(o),bt.delete(o),o=ot(r,V),r(!0))},V)}function we(){I&&(J=F(),_t=new Set,bt=new Set,Ft=new Set,ee(),B())}function pr(){if(!I)return;let e=D.AdRules.filter(o=>!o.Hostnames||o.Hostnames.startsWith("^")&&!o.Hostnames.includes(J)),t=D.AdRules.filter(o=>o.Hostnames&&!o.Hostnames.startsWith("^")&&o.Hostnames.includes(J)),r=e.concat(t);st(()=>{Pr();let o=ot(()=>{he(r)},ge);he(r),st(()=>{t.length?r=t:clearInterval(o)},lr)},ur)}var mr=new Set(["facebook.com","hulu.com","netflix.com","twitter.com","x.com"]);function Ae(){fr(),mr.has(J)||pr(),st(wr,et)}function gr(e){if(!I)return;let t=C.location.href.split("#")[0];setInterval(()=>{let r=C.location.href.split("#")[0];r!==t&&(t=r,e())},1e3)}function _e(){_t.forEach(e=>clearTimeout(e)),bt.forEach(e=>clearInterval(e)),Ft.forEach(e=>cancelIdleCallback(e))}function yr(){_e(),we(),Ae()}function wr(){It(),_e()}function Ar(e){at?ut(e,M).then(()=>window.dispatchEvent(new CustomEvent("displayAdFound",{detail:e}))):te(e)}async function _r(e){try{let t=T.fromObject(e.data);if(!t)return;let r=t.data;switch(t.operation){case Ct:r>0&&(Pt(),st(It,r));break;case Et:N(r[0],r[1]);break;case"extractDisplayAd":I||await At(document.documentElement,r);break;case"displayAdFound":I&&Ar(r);break;case"getFrameId":W(e.source,{type:"getFrameId-response",payload:cr,nonce:r});break}}catch(t){S(t);return}}function br(){function e(){C.addEventListener("message",_r,!0)}e();let t=setInterval(e,200);setTimeout(clearInterval,1e4,t)}function xr(e){fe=e.getInstallId,at=e.isRuleEditor,Nt=e.sendData,M=e.fetchHttpResponse,de=e.getExternalConfiguration?t=>e.getExternalConfiguration(t):null,Jt(e.pm_log)}function be(e){pe=le("getFrameId",1e3),M=e.fetchHttpResponse,br(),I&&(xr(e),fe().then(t=>gt=t).then(t=>de()).then(t=>D=t||{EnabledPct:0}).then(t=>{nt=Array.from(gt).map(r=>r.charCodeAt(0)).reduce((r,o)=>r+o,0)%100<D.EnabledPct,nt&&(we(),Ae(),gr(yr))}))}async function vr(e,t){at||(I||(t.dedupeKey=await pe(e.ownerDocument.defaultView)),t.dedupeKey??=`${t.width}x${t.height} @ ${t.x},${t.y}`),W(top,new T("displayAdFound",t))}async function Sr(e,t){if(e){let r=U(e);(t.isFromIFrame||e.nodeName!=="IFRAME")&&(t.x+=r.left,t.y+=r.top),t.sourceUrls.push(...await Q(e,t.depth)),t.text+=mt(e)+" ";let o=Array.from(e.querySelectorAll("canvas, svg"));o.length&&o.forEach(s=>Kt(s,t))}}async function At(e,t){if(await Sr(e,t),e.nodeName==="IFRAME"){t.depth++,t.outerHtml=e.outerHTML;try{await At(e.contentWindow.document.documentElement,t)}catch{W(e.contentWindow,new T("extractDisplayAd",t));try{var r=e.contentWindow.frames;for(let s=0,u=r.length;s<u;s++)try{W(r[s],new T("extractDisplayAd",t))}catch(h){S(h)}}catch(s){S(s)}}}else{e.nodeName==="HTML"&&(t.outerHtml+=`<!-- IFRAME Content -->${e.outerHTML}`);let o;if(t.isFromIFrame){if(e.scrollWidth<=t.width-5||e.scrollHeight<=t.height-5)return;o=Array.from(e.querySelectorAll("iframe")).filter(s=>(s.scrollWidth>=t.width||s.scrollHeight>=t.height)&&s.scrollWidth>=_.minWidth&&s.scrollHeight>=_.minHeight&&Ot(s))}else o=Array.from(e.querySelectorAll("iframe")).filter(s=>Ot(s)).sort((s,u)=>s.scrollWidth*s.scrollHeight-u.scrollWidth*u.scrollHeight).slice(0,1);o?.length?await Promise.allSettled(o.map(s=>{let u={...t,width:Math.min(t.width,s.offsetWidth),height:Math.min(t.height,s.offsetHeight),sourceUrls:t.sourceUrls.map(h=>h)};return At(s,u)})):(t.text=t.textOverride??t.text.trim(),vr(e,t))}}function Er(e,t,r){try{let o=new it,s=o.evaluate(t,{doc:document});Ut.forEach(u=>s.push(...o.evaluate(t,{doc:u}))),me.forEach(u=>{u.doc.defaultView&&s.push(...o.evaluate(t,{doc:u.doc}).map(h=>xe(h)?(h.x??=u.x,h.y??=u.y,h.depth??=u.depth,h):{element:h,x:u.x,y:u.y,depth:u.depth}))}),s&&s.forEach(async u=>await Ir(e,u,r))}catch{}}function Cr(e){e.forEach(t=>Er(t.Id,t.ParseTree))}async function Ir(e,t,r){let o={};xe(t)&&(o=t,t=t.element,delete o.element);let s=new _({width:t.offsetWidth,height:t.offsetHeight,adRuleId:e});s.isFromIFrame=t.nodeName==="IFRAME",at&&(s.adRuleName=r,s.tabUrl=location.href),Object.assign(s,o),await At(t,s)}function he(e){I&&Lt(t=>{t.didTimeout||(Cr(e),st(B,hr))},4e3)}function Tr(e){let t=Date.now(),r=null;for(;r=e[0];){for(var o=null;o=r.nextNode();)if(o.shadowRoot&&(e.push(document.createTreeWalker(o.shadowRoot,NodeFilter.SHOW_ELEMENT)),Ut.push(o.shadowRoot)),Date.now()-t>50)return!1;e.shift()}return!0}function Nr(){Ut=[];let e=[];try{e.push(document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT))}catch{}let t=!1,r=0;for(;!t&&r++<100;)Lt(()=>t||=Tr(e))}function Rr(){me=Array.from(document.querySelectorAll("iframe")).filter(e=>e.src&&new URL(e.src).origin==top.location.origin&&e.offsetWidth>=_.minWidth&&e.offsetHeight>=_.minHeight).map(e=>{try{let t=e.contentWindow,r=U(e),o=r.left,s=r.top,u=1;for(;t?.parent&&t.parent!==top;)t=t.parent,r=U(t.frameElement),o+=r.left,s+=r.top,u++;return{doc:e.contentDocument,x:o,y:s,depth:u}}catch{return null}}).filter(e=>e)}function Pr(){Nr(),Rr()}function xe(e){return!(e instanceof Node)&&e.element}function ve(...e){console.log("[injected-script]",...Array.isArray(e)?e:[e])}function xt(e,t){return r=>new Promise(o=>{let s=t+"-response",u=Math.random(),h=p=>{let{type:m,payload:g,nonce:w}=p.data??{};m!==s||w!==u||(e?.("Got response:",{name:t,payload:r,response:g}),o(g),f())},f=()=>{window.removeEventListener("message",h)};window.addEventListener("message",h),e?.("Sending message:",{name:t,payload:r}),window.postMessage({type:t,payload:r,nonce:u},"*")})}function Se(e,t){return r=>{e?.("Sending message:",{type:t,payload:r}),window.postMessage({type:t,payload:r},"*")}}var Ee="ads#INIT",Ce="ads#SEND_DATA",Ie="ads#GET_INSTALL_ID",Te="ads#GET_EXTERNAL_CONFIG",Ne="ads#FETCH_HTTP_RESPONSE";function Re(e){let t=e.enableLogs?ve:void 0;t?.("Recieved init event",{config:e});let r=Se(t,Ce),o=xt(t,Ie),s=xt(t,Te),u=xt(t,Ne);be({getInstallId:o,fetchHttpResponse:u,sendData:r,pm_log:t,getExternalConfiguration:s})}function Mr(){window.addEventListener("message",({data:e})=>{e?.type===Ee&&Re(e.payload)})}Mr();})();\n';var uo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ho={exports:{}};(function(e,t){(function(n,r){r(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:uo,function(n){var r,i;if(!((i=(r=globalThis.chrome)==null?void 0:r.runtime)!=null&&i.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const s="The message port closed before a response was received.",a=l=>{const c={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(c).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(x,I=void 0){super(I),this.createItem=x}get(x){return this.has(x)||this.set(x,this.createItem(x)),super.get(x)}}const u=b=>b&&typeof b=="object"&&typeof b.then=="function",h=(b,x)=>(...I)=>{l.runtime.lastError?b.reject(new Error(l.runtime.lastError.message)):x.singleCallbackArg||I.length<=1&&x.singleCallbackArg!==!1?b.resolve(I[0]):b.resolve(I)},d=b=>b==1?"argument":"arguments",f=(b,x)=>function(I,...R){if(R.length<x.minArgs)throw new Error(`Expected at least ${x.minArgs} ${d(x.minArgs)} for ${b}(), got ${R.length}`);if(R.length>x.maxArgs)throw new Error(`Expected at most ${x.maxArgs} ${d(x.maxArgs)} for ${b}(), got ${R.length}`);return new Promise((H,T)=>{if(x.fallbackToNoCallback)try{I[b](...R,h({resolve:H,reject:T},x))}catch(D){console.warn(`${b} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,D),I[b](...R),x.fallbackToNoCallback=!1,x.noCallback=!0,H()}else x.noCallback?(I[b](...R),H()):I[b](...R,h({resolve:H,reject:T},x))})},g=(b,x,I)=>new Proxy(x,{apply(R,H,T){return I.call(H,b,...T)}});let m=Function.call.bind(Object.prototype.hasOwnProperty);const A=(b,x={},I={})=>{let R=Object.create(null),H={has(D,y){return y in b||y in R},get(D,y,k){if(y in R)return R[y];if(!(y in b))return;let N=b[y];if(typeof N=="function")if(typeof x[y]=="function")N=g(b,b[y],x[y]);else if(m(I,y)){let $=f(y,I[y]);N=g(b,b[y],$)}else N=N.bind(b);else if(typeof N=="object"&&N!==null&&(m(x,y)||m(I,y)))N=A(N,x[y],I[y]);else if(m(I,"*"))N=A(N,x[y],I["*"]);else return Object.defineProperty(R,y,{configurable:!0,enumerable:!0,get(){return b[y]},set($){b[y]=$}}),N;return R[y]=N,N},set(D,y,k,N){return y in R?R[y]=k:b[y]=k,!0},defineProperty(D,y,k){return Reflect.defineProperty(R,y,k)},deleteProperty(D,y){return Reflect.deleteProperty(R,y)}},T=Object.create(b);return new Proxy(T,H)},E=b=>({addListener(x,I,...R){x.addListener(b.get(I),...R)},hasListener(x,I){return x.hasListener(b.get(I))},removeListener(x,I){x.removeListener(b.get(I))}}),_=new o(b=>typeof b!="function"?b:function(x){const I=A(x,{},{getContent:{minArgs:0,maxArgs:0}});b(I)}),p=new o(b=>typeof b!="function"?b:function(x,I,R){let H=!1,T,D=new Promise($=>{T=function(j){H=!0,$(j)}}),y;try{y=b(x,I,T)}catch($){y=Promise.reject($)}const k=y!==!0&&u(y);return y!==!0&&!k&&!H?!1:(($=>{$.then(j=>{R(j)},j=>{let Z;j&&(j instanceof Error||typeof j.message=="string")?Z=j.message:Z="An unexpected error occurred",R({__mozWebExtensionPolyfillReject__:!0,message:Z})}).catch(j=>{console.error("Failed to send onMessage rejected reply",j)})})(k?y:D),!0)}),v=({reject:b,resolve:x},I)=>{l.runtime.lastError?l.runtime.lastError.message===s?x():b(new Error(l.runtime.lastError.message)):I&&I.__mozWebExtensionPolyfillReject__?b(new Error(I.message)):x(I)},C=(b,x,I,...R)=>{if(R.length<x.minArgs)throw new Error(`Expected at least ${x.minArgs} ${d(x.minArgs)} for ${b}(), got ${R.length}`);if(R.length>x.maxArgs)throw new Error(`Expected at most ${x.maxArgs} ${d(x.maxArgs)} for ${b}(), got ${R.length}`);return new Promise((H,T)=>{const D=v.bind(null,{resolve:H,reject:T});R.push(D),I.sendMessage(...R)})},S={devtools:{network:{onRequestFinished:E(_)}},runtime:{onMessage:E(p),onMessageExternal:E(p),sendMessage:C.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:C.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},P={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return c.privacy={network:{"*":P},services:{"*":P},websites:{"*":P}},A(l,S,c)};n.exports=a(chrome)}else n.exports=globalThis.browser})})(ho);var Bg=ho.exports;const Un=gs(Bg);var fs={exports:{}};fs.exports,function(e){var t=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function a(c,o){if(!s[c]){s[c]={};for(var u=0;u<c.length;u++)s[c][c.charAt(u)]=u}return s[c][o]}var l={compressToBase64:function(c){if(c==null)return"";var o=l._compress(c,6,function(u){return r.charAt(u)});switch(o.length%4){default:case 0:return o;case 1:return o+"===";case 2:return o+"==";case 3:return o+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:l._decompress(c.length,32,function(o){return a(r,c.charAt(o))})},compressToUTF16:function(c){return c==null?"":l._compress(c,15,function(o){return n(o+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:l._decompress(c.length,16384,function(o){return c.charCodeAt(o)-32})},compressToUint8Array:function(c){for(var o=l.compress(c),u=new Uint8Array(o.length*2),h=0,d=o.length;h<d;h++){var f=o.charCodeAt(h);u[h*2]=f>>>8,u[h*2+1]=f%256}return u},decompressFromUint8Array:function(c){if(c==null)return l.decompress(c);for(var o=new Array(c.length/2),u=0,h=o.length;u<h;u++)o[u]=c[u*2]*256+c[u*2+1];var d=[];return o.forEach(function(f){d.push(n(f))}),l.decompress(d.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":l._compress(c,6,function(o){return i.charAt(o)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),l._decompress(c.length,32,function(o){return a(i,c.charAt(o))}))},compress:function(c){return l._compress(c,16,function(o){return n(o)})},_compress:function(c,o,u){if(c==null)return"";var h,d,f={},g={},m="",A="",E="",_=2,p=3,v=2,C=[],S=0,P=0,b;for(b=0;b<c.length;b+=1)if(m=c.charAt(b),Object.prototype.hasOwnProperty.call(f,m)||(f[m]=p++,g[m]=!0),A=E+m,Object.prototype.hasOwnProperty.call(f,A))E=A;else{if(Object.prototype.hasOwnProperty.call(g,E)){if(E.charCodeAt(0)<256){for(h=0;h<v;h++)S=S<<1,P==o-1?(P=0,C.push(u(S)),S=0):P++;for(d=E.charCodeAt(0),h=0;h<8;h++)S=S<<1|d&1,P==o-1?(P=0,C.push(u(S)),S=0):P++,d=d>>1}else{for(d=1,h=0;h<v;h++)S=S<<1|d,P==o-1?(P=0,C.push(u(S)),S=0):P++,d=0;for(d=E.charCodeAt(0),h=0;h<16;h++)S=S<<1|d&1,P==o-1?(P=0,C.push(u(S)),S=0):P++,d=d>>1}_--,_==0&&(_=Math.pow(2,v),v++),delete g[E]}else for(d=f[E],h=0;h<v;h++)S=S<<1|d&1,P==o-1?(P=0,C.push(u(S)),S=0):P++,d=d>>1;_--,_==0&&(_=Math.pow(2,v),v++),f[A]=p++,E=String(m)}if(E!==""){if(Object.prototype.hasOwnProperty.call(g,E)){if(E.charCodeAt(0)<256){for(h=0;h<v;h++)S=S<<1,P==o-1?(P=0,C.push(u(S)),S=0):P++;for(d=E.charCodeAt(0),h=0;h<8;h++)S=S<<1|d&1,P==o-1?(P=0,C.push(u(S)),S=0):P++,d=d>>1}else{for(d=1,h=0;h<v;h++)S=S<<1|d,P==o-1?(P=0,C.push(u(S)),S=0):P++,d=0;for(d=E.charCodeAt(0),h=0;h<16;h++)S=S<<1|d&1,P==o-1?(P=0,C.push(u(S)),S=0):P++,d=d>>1}_--,_==0&&(_=Math.pow(2,v),v++),delete g[E]}else for(d=f[E],h=0;h<v;h++)S=S<<1|d&1,P==o-1?(P=0,C.push(u(S)),S=0):P++,d=d>>1;_--,_==0&&(_=Math.pow(2,v),v++)}for(d=2,h=0;h<v;h++)S=S<<1|d&1,P==o-1?(P=0,C.push(u(S)),S=0):P++,d=d>>1;for(;;)if(S=S<<1,P==o-1){C.push(u(S));break}else P++;return C.join("")},decompress:function(c){return c==null?"":c==""?null:l._decompress(c.length,32768,function(o){return c.charCodeAt(o)})},_decompress:function(c,o,u){var h=[],d=4,f=4,g=3,m="",A=[],E,_,p,v,C,S,P,b={val:u(0),position:o,index:1};for(E=0;E<3;E+=1)h[E]=E;for(p=0,C=Math.pow(2,2),S=1;S!=C;)v=b.val&b.position,b.position>>=1,b.position==0&&(b.position=o,b.val=u(b.index++)),p|=(v>0?1:0)*S,S<<=1;switch(p){case 0:for(p=0,C=Math.pow(2,8),S=1;S!=C;)v=b.val&b.position,b.position>>=1,b.position==0&&(b.position=o,b.val=u(b.index++)),p|=(v>0?1:0)*S,S<<=1;P=n(p);break;case 1:for(p=0,C=Math.pow(2,16),S=1;S!=C;)v=b.val&b.position,b.position>>=1,b.position==0&&(b.position=o,b.val=u(b.index++)),p|=(v>0?1:0)*S,S<<=1;P=n(p);break;case 2:return""}for(h[3]=P,_=P,A.push(P);;){if(b.index>c)return"";for(p=0,C=Math.pow(2,g),S=1;S!=C;)v=b.val&b.position,b.position>>=1,b.position==0&&(b.position=o,b.val=u(b.index++)),p|=(v>0?1:0)*S,S<<=1;switch(P=p){case 0:for(p=0,C=Math.pow(2,8),S=1;S!=C;)v=b.val&b.position,b.position>>=1,b.position==0&&(b.position=o,b.val=u(b.index++)),p|=(v>0?1:0)*S,S<<=1;h[f++]=n(p),P=f-1,d--;break;case 1:for(p=0,C=Math.pow(2,16),S=1;S!=C;)v=b.val&b.position,b.position>>=1,b.position==0&&(b.position=o,b.val=u(b.index++)),p|=(v>0?1:0)*S,S<<=1;h[f++]=n(p),P=f-1,d--;break;case 2:return A.join("")}if(d==0&&(d=Math.pow(2,g),g++),h[P])m=h[P];else if(P===f)m=_+_.charAt(0);else return null;A.push(m),h[f++]=_+m.charAt(0),d--,_=m,d==0&&(d=Math.pow(2,g),g++)}}};return l}();e!=null&&(e.exports=t)}(fs);var jg=fs.exports;const ps=gs(jg);function Fg(e){const t=ps.decompressFromUint8Array(new Uint8Array(e));if(t==null)throw Error("Failed to convert string to ArrayBuffer");return t}async function go(e){if(!e.byteLength)return"";const t=new Blob([e]),n=await new Promise((r,i)=>{const s=new FileReader;s.onload=()=>{typeof s.result=="string"&&r(s.result),i(Error("Failed to read buffer as string, got "+typeof s.result))},s.onerror=()=>i(s.error),s.onabort=()=>i("FileReader aborted"),s.readAsDataURL(t)});return(n==null?void 0:n.split(",").pop())||""}function Wg(e){if(!e)return Promise.resolve(new ArrayBuffer(0));try{const t="data:application/octet-binary;base64,"+e;return fetch(t).then(n=>n.arrayBuffer(),()=>new ArrayBuffer(0))}catch{return Promise.resolve(new ArrayBuffer(0))}}var gn=(e=>(e.UPLOAD_CRAWL="ads#CRAWL",e.GET_PM_EXTERNAL_CONFIG="ads#GET_EXTERNAL_CONFIGURATION",e.FETCH_HTTP_RESPONSE="ads#FETCH_HTTP_RESPONSE",e))(gn||{});function hi(e){try{return JSON.parse(e)}catch{return}}async function $g(e){return(await Un.storage.local.get(e))[e]}async function fo(e,t){const n={};n[e]=t,await Un.storage.local.set(n)}async function po(e,t,n){let r=await(n?null:$g(e));return r==null&&(r=await t(),await fo(e,r)),r}function mo(e){return e.split(".").slice(e.endsWith(".uk")||e.endsWith(".jp")?-3:-2).join(".")}async function yo(e){const t=await po("configTs",Date.now),n=Date.now()-t>18e5;return po("config",async()=>{const r=await e({type:gn.GET_PM_EXTERNAL_CONFIG,payload:void 0}),i=hi(r);if(i!=null)return i.TimeOffset=i.Now&&Date.now()-i.Now||0,Vg(i),Gg(i),Hg(i),fo("configTs",Date.now()),i},n)}function Vg(e){var t;(t=e.AdRules)==null||t.filter(n=>{const r=ps.decompressFromUTF16(n.ParseTreeString||"")??"";return n.ParseTree=hi(r),n.ParseTree==null?!1:(delete n.ParseTreeString,!0)})}function Gg(e){var t;e.ParsedSiteConfigs=(t=e.SiteConfigs)==null?void 0:t.reduce((n,r)=>(n[r.d]=r.r,n),{}),delete e.SiteConfigs}function Hg(e){var t;e.ParsedUrlBlackList=(t=e.UrlBlackList)==null?void 0:t.filter(n=>n.BlockAllAds).reduce((n,r)=>{var i;return(n[i=mo(r.Hostname)]??(n[i]=[])).push(r.UrlRegex),n},{}),delete e.UrlBlackList}function vo(){return window.self===window.top}class zg{constructor(t){this.config=t}async inject(t){return new Promise((n,r)=>{const i=this.defineOnCspError(r),s=()=>{var a,l;try{document.addEventListener("securitypolicyviolation",i);const c=document.createElement(t),o=()=>{var d,f;this.config.keepInDom||c.remove(),(f=(d=this.config).onInjected)==null||f.call(d)},u=this.getManifestVersion();u===3?c.onload=o:setTimeout(o),this.setSrc(c,u),(a=this.config.logger)==null||a.log(c);const h=(l=document.documentElement)==null?void 0:l.firstElementChild;h==null||h.insertBefore(c,h.firstChild),document.removeEventListener("securitypolicyviolation",i),n()}catch(c){r(c)}finally{document.removeEventListener("DOMContentLoaded",s)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s()})}defineOnCspError(t){return n=>{t==null||t(Error("Blocked by CSP: "+JSON.stringify({host:window.location.hostname,blockedUri:n.blockedURI,violatedDirective:n.violatedDirective,originalPolicy:n.originalPolicy})))}}getManifestVersion(){return 3}setSrc(t,n){if(n===3){if(!this.config.mv3Path)throw Error("mv3Path config must be passed for Manifest V3 extensions");t.src=Un.runtime.getURL(this.config.mv3Path)}else if(n===2){if(!this.config.mv2Content)throw Error("mv2Content config must be passed for Manifest V2 extensions");t.innerHTML=this.config.mv2Content}else throw Error(`Unsupported manifest version ${n}`)}}class qg{constructor(t){this.config=t}sendMessage(t,n,r,i){const s={type:t,payload:n,nonce:i};window.postMessage(s,"*",r)}onMessage(t,n){window.addEventListener("message",async r=>{var i,s;const{type:a,payload:l,nonce:c}=r.data??{};if(a!==t)return;(i=this.config.logger)==null||i.debug("[ad-finder-custom-event] Recieved message:",{type:a,payload:l});const o=await n(l);if(o===void 0)return;const{response:u,transferables:h}=o;(s=this.config.logger)==null||s.debug("[ad-finder-custom-event] Sending response:",{name:a,payload:l,response:u}),this.sendMessage(a+this.config.responseSuffix,u,h,c)})}}const Zg="ads#INIT",Kg="ads#SEND_DATA",Yg="ads#GET_INSTALL_ID",Jg="ads#GET_EXTERNAL_CONFIG",Qg="ads#FETCH_HTTP_RESPONSE",ms=class Ii{constructor(t){Ln(this,"injector"),Ln(this,"messenger"),this.config=t,this.injector=new zg({logger:t.logger,keepInDom:t.keepPathmaticsInDom,mv2Content:Ug,mv3Path:t.mv3PathmaticsPath,onInjected:this.initPathmaticsScript.bind(this)}),this.messenger=new qg({logger:t.logger,responseSuffix:Ii.MESSENGER_SUFFIX})}async isSupportedSite(){var t,n;const r=mo(location.hostname);if(!vo())return!(location.hostname===Ii.GOOGLE_AUTH_HOSTNAME||Ii.SUBFRAME_DOMAIN_BLOCKLIST.has(r));const i=await yo(this.config.sendMessageToBackground);return i!=null?!((n=(t=i.ParsedUrlBlackList)==null?void 0:t[r])!=null&&n.some(s=>new RegExp(s).test(location.href))):!1}async start(){var t,n,r,i,s,a;if(!document.documentElement){(t=this.config.logger)==null||t.log("Page is blank, stopping pathmatics",window.location.hostname);return}const l=await this.isSupportedSite();if((n=this.config.logger)==null||n.log("Is supported site?",l),!l){(r=this.config.logger)==null||r.log("Not supported site, stopping pathmatics",window.location.hostname);return}try{(i=this.config.logger)==null||i.log("Starting Pathmatics ad-finder...",{url:window.location.href}),this.setupMessageListeners(),await this.injector.inject("script"),(s=this.config.logger)==null||s.log("Pathmatics ad-finder injected!")}catch(c){(a=this.config.logger)==null||a.error("Failed to start Pathmatics ad-finder",c)}}setupMessageListeners(){if(Un.storage==null)throw Error("The storage permission is required for pathmatics' ad-finder");this.messenger.onMessage(Qg,async t=>{const n=await this.config.sendMessageToBackground({type:gn.FETCH_HTTP_RESPONSE,payload:t}),r=await Wg(n);return{response:r,transferables:[r]}}),vo()&&(this.messenger.onMessage(Yg,async()=>({response:await this.config.getInstallId()})),this.messenger.onMessage(Kg,async t=>{var n,r,i,s,a;const l=hi(t);if(l==null)return;const c=l.crawlId;let o=l.zys??[];if(typeof o=="string"&&(o=hi(o)),o==null)return;const u=Date.now();for(const h of o){const d={id:`${c}-${h.hash}`,type:"pathmatics",timestamp:u,details:h};(n=this.config.logger)==null||n.log("Ad detected",d);try{await((i=(r=this.config).onAdDetected)==null?void 0:i.call(r,d))}catch(f){(s=this.config.logger)==null||s.error("onAdDetected failed",{err:f})}}await this.config.sendMessageToBackground({type:gn.UPLOAD_CRAWL,payload:l}).catch((a=this.config.logger)==null?void 0:a.error)}),this.messenger.onMessage(Jg,async()=>({response:await yo(this.config.sendMessageToBackground)})))}initPathmaticsScript(){var t;(t=this.config.logger)==null||t.log("Initializing script");const n={enableLogs:this.config.enablePathmaticsLogs??!1};this.messenger.sendMessage(Zg,n)}};Ln(ms,"MESSENGER_SUFFIX","-response"),Ln(ms,"SUBFRAME_DOMAIN_BLOCKLIST",new Set(["google.com","okta.com","amazon.com"])),Ln(ms,"GOOGLE_AUTH_HOSTNAME","accounts.youtube.com");function Xg(e){return{...e,logger:e.logger===void 0?console:e.logger??void 0}}var bo={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(uo,function(){var n=function(s,a){if(a=a||{},typeof s!="function")throw new i("fetch must be a function");if(typeof a!="object")throw new i("defaults must be an object");if(a.retries!==void 0&&!r(a.retries))throw new i("retries must be a positive integer");if(a.retryDelay!==void 0&&!r(a.retryDelay)&&typeof a.retryDelay!="function")throw new i("retryDelay must be a positive integer or a function returning a positive integer");if(a.retryOn!==void 0&&!Array.isArray(a.retryOn)&&typeof a.retryOn!="function")throw new i("retryOn property expects an array or function");var l={retries:3,retryDelay:1e3,retryOn:[]};return a=Object.assign(l,a),function(c,o){var u=a.retries,h=a.retryDelay,d=a.retryOn;if(o&&o.retries!==void 0)if(r(o.retries))u=o.retries;else throw new i("retries must be a positive integer");if(o&&o.retryDelay!==void 0)if(r(o.retryDelay)||typeof o.retryDelay=="function")h=o.retryDelay;else throw new i("retryDelay must be a positive integer or a function returning a positive integer");if(o&&o.retryOn)if(Array.isArray(o.retryOn)||typeof o.retryOn=="function")d=o.retryOn;else throw new i("retryOn property expects an array or function");return new Promise(function(f,g){var m=function(E){var _=typeof Request<"u"&&c instanceof Request?c.clone():c;s(_,o).then(function(p){if(Array.isArray(d)&&d.indexOf(p.status)===-1)f(p);else if(typeof d=="function")try{return Promise.resolve(d(E,null,p)).then(function(v){v?A(E,null,p):f(p)}).catch(g)}catch(v){g(v)}else E<u?A(E,null,p):f(p)}).catch(function(p){if(typeof d=="function")try{Promise.resolve(d(E,p,null)).then(function(v){v?A(E,p,null):g(p)}).catch(function(v){g(v)})}catch(v){g(v)}else E<u?A(E,p,null):g(p)})};function A(E,_,p){var v=typeof h=="function"?h(E,_,p):h;setTimeout(function(){m(++E)},v)}m(0)})}};function r(s){return Number.isInteger(s)&&s>=0}function i(s){this.name="ArgumentError",this.message=s}return n})})(bo);var ef=bo.exports;const tf=gs(ef);function nf(e){return Math.random()*e+e/2}function rf(e){return tf(fetch,{retryOn(t,n,r){var i;if(n!==null||r.status>=500)return(i=e.logger)==null||i.log(`retrying, attempt number ${t+1}`),!0},retries:5,retryDelay(t){const n=Math.pow(2,t)*500;return nf(n)}})}class sf{constructor(t){Ln(this,"fetch"),this.config=t,this.fetch=rf(t)}async upload(t){var n,r,i;if(!await this.config.isEnabled())return;const s=this.prepareData(t);(n=this.config.logger)==null||n.log("Uploading data:",s);const a=await this.fetch(this.config.crawlUploadUrl,{method:"POST",body:ps.compressToUint8Array(JSON.stringify(s)),headers:{"Content-Type":"application/octet-stream"}}).then(l=>{var c;return(c=this.config.logger)==null?void 0:c.log({status:l.status})}).catch((r=this.config.logger)==null?void 0:r.error);(i=this.config.logger)==null||i.log("Response:",a)}prepareData(t){return{...t,PartnerVersion:Un.runtime.getManifest().version,ExtensionId:Un.runtime.id,ExtensionVersion:this.config.extensionVersion,UserAgent:navigator.userAgent,BrowserLanguage:navigator.language,BlankZys:null,PanelPartnerId:this.config.panelPartnerId}}}async function af(e){const t=await fetch(e).then(n=>n.arrayBuffer());return Fg(t)}function of(e){const t=Xg(e),n=new sf(t);return{async processAdFinderMessage(r){const i=s=>{var a;throw(a=t.logger)==null||a.error("Error handling message from ad-finder: "+JSON.stringify(r),s),s};switch(r.type){case gn.UPLOAD_CRAWL:return n.upload(r.payload).catch(i);case gn.GET_PM_EXTERNAL_CONFIG:return af(`${e.pmExternalConfigUrl}?installId=${await e.getInstallId()}`).catch(i);case gn.FETCH_HTTP_RESPONSE:return fetch(r.payload).then(s=>{const a=parseInt(s.headers.get("Content-Length")??"");return!isNaN(a)&&a>1<<25?new ArrayBuffer(0):s.arrayBuffer()}).then(s=>s.byteLength>1<<25?go(new ArrayBuffer(0)):go(s))}}}}const gi=ke.createScopedLog("WebUsage");let Bn;const cf="https://api-pm.stayfocusd.st-panel-api.com/Ajax0001/IPD",lf="https://api-pm.stayfocusd.st-panel-api.com/Ajax0001/Config",uf=33,df={initialized:null,usageDatabase:null,initAPI(e){return Bn=e,Bn.mixin("WebUsage",{init:this.init.bind(this),getUsageDatabase:this.getUsageDatabase.bind(this)})},async init(){if(this.initialized!=null)gi("init","WebUsage already initialized",{sessionId:""},"DEBUG");else{const e=async()=>await Bn.Storage.get("hasAcceptedToS",!0)??!1,t=Bn.Storage.get("install-id",!0),{promise:n,resolve:r}=Bn.Utils.getDecoupledPromise();this.initialized=n,this.usageDatabase=ih({getInstallId:()=>t}),ch({db:this.usageDatabase,enabled:e,isOnStartupAvailable:()=>!0,isTabActiveWhenPlayingAudio:()=>!0,logger:null}),r(),gi==null||gi("init","Initialized WebUsage",this,"INFO");const{processAdFinderMessage:i}=await of({isEnabled:e,getInstallId:()=>t,extensionVersion:Bn.Chrome.Extension.getVersion(),extensionId:di.APP_ID,crawlUploadUrl:cf,pmExternalConfigUrl:lf,panelPartnerId:uf});chrome.runtime.onConnect.addListener(s=>{s.name=="ad-finder"&&s.onMessage.addListener(async a=>{var l,c,o,u;if(a.message=="forward-message.request"){const h=await i(a.payload);s.postMessage({message:"forward-message.response",payload:h,nonce:a.nonce})}if(a.message=="ad-found"){const h=Kl(a.payload.hostname);if(!h)return;const d=a.payload.ad,f=await((c=(l=this.usageDatabase)==null?void 0:l.sessionsRepo)==null?void 0:c.getActiveSessions()),g=f==null?void 0:f.find(m=>m.appId===h.hostname);if(!g)return;await((u=(o=this.usageDatabase)==null?void 0:o.adsRepo)==null?void 0:u.upsertAd({...d,sessionId:g.id}))}})})}},async getUsageDatabase(){if(await this.initialized,this.usageDatabase==null)throw Error("WebUsage not initialized");return this.usageDatabase}},hf=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,gf=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,ff=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function pf(e,t){if(e==="__proto__"||e==="constructor"&&t&&typeof t=="object"&&"prototype"in t){mf(e);return}return t}function mf(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function yf(e,t={}){if(typeof e!="string")return e;const n=e.trim();if(e[0]==='"'&&e.endsWith('"')&&!e.includes("\\"))return n.slice(1,-1);if(n.length<=9){const r=n.toLowerCase();if(r==="true")return!0;if(r==="false")return!1;if(r==="undefined")return;if(r==="null")return null;if(r==="nan")return Number.NaN;if(r==="infinity")return Number.POSITIVE_INFINITY;if(r==="-infinity")return Number.NEGATIVE_INFINITY}if(!ff.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(hf.test(e)||gf.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,pf)}return JSON.parse(e)}catch(r){if(t.strict)throw r;return e}}const vf=/#/g,bf=/&/g,wf=/\//g,Af=/=/g,ys=/\+/g,_f=/%5e/gi,xf=/%60/gi,Sf=/%7c/gi,Tf=/%20/gi;function Ef(e){return encodeURI(""+e).replace(Sf,"|")}function vs(e){return Ef(typeof e=="string"?e:JSON.stringify(e)).replace(ys,"%2B").replace(Tf,"+").replace(vf,"%23").replace(bf,"%26").replace(xf,"`").replace(_f,"^").replace(wf,"%2F")}function bs(e){return vs(e).replace(Af,"%3D")}function wo(e=""){try{return decodeURIComponent(""+e)}catch{return""+e}}function Cf(e){return wo(e.replace(ys," "))}function Of(e){return wo(e.replace(ys," "))}function If(e=""){const t={};e[0]==="?"&&(e=e.slice(1));for(const n of e.split("&")){const r=n.match(/([^=]+)=?(.*)/)||[];if(r.length<2)continue;const i=Cf(r[1]);if(i==="__proto__"||i==="constructor")continue;const s=Of(r[2]||"");t[i]===void 0?t[i]=s:Array.isArray(t[i])?t[i].push(s):t[i]=[t[i],s]}return t}function Pf(e,t){return(typeof t=="number"||typeof t=="boolean")&&(t=String(t)),t?Array.isArray(t)?t.map(n=>`${bs(e)}=${vs(n)}`).join("&"):`${bs(e)}=${vs(t)}`:bs(e)}function kf(e){return Object.keys(e).filter(t=>e[t]!==void 0).map(t=>Pf(t,e[t])).filter(Boolean).join("&")}const Df=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,Mf=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,Nf=/^([/\\]\s*){2,}[^/\\]/,Rf=/\/$|\/\?|\/#/,Lf=/^\.?\//;function Ao(e,t={}){return typeof t=="boolean"&&(t={acceptRelative:t}),t.strict?Df.test(e):Mf.test(e)||(t.acceptRelative?Nf.test(e):!1)}function ws(e="",t){return t?Rf.test(e):e.endsWith("/")}function Uf(e="",t){if(!t)return(ws(e)?e.slice(0,-1):e)||"/";if(!ws(e,!0))return e||"/";let n=e,r="";const i=e.indexOf("#");i>=0&&(n=e.slice(0,i),r=e.slice(i));const[s,...a]=n.split("?");return((s.endsWith("/")?s.slice(0,-1):s)||"/")+(a.length>0?`?${a.join("?")}`:"")+r}function Bf(e="",t){if(!t)return e.endsWith("/")?e:e+"/";if(ws(e,!0))return e||"/";let n=e,r="";const i=e.indexOf("#");if(i>=0&&(n=e.slice(0,i),r=e.slice(i),!n))return r;const[s,...a]=n.split("?");return s+"/"+(a.length>0?`?${a.join("?")}`:"")+r}function jf(e,t){if(Wf(t)||Ao(e))return e;const n=Uf(t);return e.startsWith(n)?e:Vf(n,e)}function Ff(e,t){const n=xo(e),r={...If(n.search),...t};return n.search=kf(r),Gf(n)}function Wf(e){return!e||e==="/"}function $f(e){return e&&e!=="/"}function Vf(e,...t){let n=e||"";for(const r of t.filter(i=>$f(i)))if(n){const i=r.replace(Lf,"");n=Bf(n)+i}else n=r;return n}const _o=Symbol.for("ufo:protocolRelative");function xo(e="",t){const n=e.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(n){const[,h,d=""]=n;return{protocol:h.toLowerCase(),pathname:d,href:h+d,auth:"",host:"",search:"",hash:""}}if(!Ao(e,{acceptRelative:!0}))return t?xo(t+e):So(e);const[,r="",i,s=""]=e.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[],[,a="",l=""]=s.match(/([^#/?]*)(.*)?/)||[],{pathname:c,search:o,hash:u}=So(l.replace(/\/(?=[A-Za-z]:)/,""));return{protocol:r.toLowerCase(),auth:i?i.slice(0,Math.max(0,i.length-1)):"",host:a,pathname:c,search:o,hash:u,[_o]:!r}}function So(e=""){const[t="",n="",r=""]=(e.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:t,search:n,hash:r}}function Gf(e){const t=e.pathname||"",n=e.search?(e.search.startsWith("?")?"":"?")+e.search:"",r=e.hash||"",i=e.auth?e.auth+"@":"",s=e.host||"";return(e.protocol||e[_o]?(e.protocol||"")+"//":"")+i+s+t+n+r}class Hf extends Error{constructor(t,n){super(t,n),this.name="FetchError",n!=null&&n.cause&&!this.cause&&(this.cause=n.cause)}}function zf(e){var c,o,u,h,d;const t=((c=e.error)==null?void 0:c.message)||((o=e.error)==null?void 0:o.toString())||"",n=((u=e.request)==null?void 0:u.method)||((h=e.options)==null?void 0:h.method)||"GET",r=((d=e.request)==null?void 0:d.url)||String(e.request)||"/",i=`[${n}] ${JSON.stringify(r)}`,s=e.response?`${e.response.status} ${e.response.statusText}`:"<no response>",a=`${i}: ${s}${t?` ${t}`:""}`,l=new Hf(a,e.error?{cause:e.error}:void 0);for(const f of["request","options","response"])Object.defineProperty(l,f,{get(){return e[f]}});for(const[f,g]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(l,f,{get(){return e.response&&e.response[g]}});return l}const qf=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function To(e="GET"){return qf.has(e.toUpperCase())}function Zf(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}const Kf=new Set(["image/svg","application/xml","application/xhtml","application/html"]),Yf=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Jf(e=""){if(!e)return"json";const t=e.split(";").shift()||"";return Yf.test(t)?"json":Kf.has(t)||t.startsWith("text/")?"text":"blob"}function Qf(e,t,n=globalThis.Headers){const r={...t,...e};if(t!=null&&t.params&&(e!=null&&e.params)&&(r.params={...t==null?void 0:t.params,...e==null?void 0:e.params}),t!=null&&t.query&&(e!=null&&e.query)&&(r.query={...t==null?void 0:t.query,...e==null?void 0:e.query}),t!=null&&t.headers&&(e!=null&&e.headers)){r.headers=new n((t==null?void 0:t.headers)||{});for(const[i,s]of new n((e==null?void 0:e.headers)||{}))r.headers.set(i,s)}return r}const Xf=new Set([408,409,425,429,500,502,503,504]),ep=new Set([101,204,205,304]);function Eo(e={}){const{fetch:t=globalThis.fetch,Headers:n=globalThis.Headers,AbortController:r=globalThis.AbortController}=e;async function i(l){const c=l.error&&l.error.name==="AbortError"&&!l.options.timeout||!1;if(l.options.retry!==!1&&!c){let u;typeof l.options.retry=="number"?u=l.options.retry:u=To(l.options.method)?0:1;const h=l.response&&l.response.status||500;if(u>0&&(Array.isArray(l.options.retryStatusCodes)?l.options.retryStatusCodes.includes(h):Xf.has(h))){const d=l.options.retryDelay||0;return d>0&&await new Promise(f=>setTimeout(f,d)),s(l.request,{...l.options,retry:u-1})}}const o=zf(l);throw Error.captureStackTrace&&Error.captureStackTrace(o,s),o}const s=async function(c,o={}){var f;const u={request:c,options:Qf(o,e.defaults,n),response:void 0,error:void 0};u.options.method=(f=u.options.method)==null?void 0:f.toUpperCase(),u.options.onRequest&&await u.options.onRequest(u),typeof u.request=="string"&&(u.options.baseURL&&(u.request=jf(u.request,u.options.baseURL)),(u.options.query||u.options.params)&&(u.request=Ff(u.request,{...u.options.params,...u.options.query}))),u.options.body&&To(u.options.method)&&(Zf(u.options.body)?(u.options.body=typeof u.options.body=="string"?u.options.body:JSON.stringify(u.options.body),u.options.headers=new n(u.options.headers||{}),u.options.headers.has("content-type")||u.options.headers.set("content-type","application/json"),u.options.headers.has("accept")||u.options.headers.set("accept","application/json")):("pipeTo"in u.options.body&&typeof u.options.body.pipeTo=="function"||typeof u.options.body.pipe=="function")&&("duplex"in u.options||(u.options.duplex="half")));let h;if(!u.options.signal&&u.options.timeout){const g=new r;h=setTimeout(()=>g.abort(),u.options.timeout),u.options.signal=g.signal}try{u.response=await t(u.request,u.options)}catch(g){return u.error=g,u.options.onRequestError&&await u.options.onRequestError(u),await i(u)}finally{h&&clearTimeout(h)}if(u.response.body&&!ep.has(u.response.status)&&u.options.method!=="HEAD"){const g=(u.options.parseResponse?"json":u.options.responseType)||Jf(u.response.headers.get("content-type")||"");switch(g){case"json":{const m=await u.response.text(),A=u.options.parseResponse||yf;u.response._data=A(m);break}case"stream":{u.response._data=u.response.body;break}default:u.response._data=await u.response[g]()}}return u.options.onResponse&&await u.options.onResponse(u),!u.options.ignoreResponseError&&u.response.status>=400&&u.response.status<600?(u.options.onResponseError&&await u.options.onResponseError(u),await i(u)):u.response},a=async function(c,o){return(await s(c,o))._data};return a.raw=s,a.native=(...l)=>t(...l),a.create=(l={})=>Eo({...e,defaults:{...e.defaults,...l}}),a}const As=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),tp=As.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),np=As.Headers,rp=As.AbortController,ip=Eo({fetch:tp,Headers:np,AbortController:rp});var sp=(e=>(e.Notification="notification",e.Block="block",e.Popup="popup",e))(sp||{}),ap=(e=>(e.UsageTime="usage-time",e.SessionCount="session-count",e))(ap||{}),op=(e=>(e.Android="android",e.Windows="windows",e.Mac="mac",e.Linux="linux",e.Web="web",e.Category="category",e.Brand="brand",e))(op||{}),cp=class extends Error{constructor(){super("Invalid code entered")}},lp=class extends Error{constructor(){super("Both devices already belong to a device group")}},up=class extends Error{constructor(){super("Forbidden")}},fi=(fn=class extends Error{static matchesMessage(t){return t instanceof Error?t.message===fn.message:!1}constructor(){super(fn.message)}},_n(fn,"message","Not in a device group"),fn);function br(e,t){return Object.entries(e).flatMap(([n,r])=>r.sessions.map(i=>({appId:n,startedAt:i.timestamp*1e3,endedAt:(i.timestamp+i.duration)*1e3,installId:i.install_id,platform:t})))}function Co(e){return new Date(e).toISOString()}function Oo(e){let t=ip.create({retry:3,...e==null?void 0:e.ofetchDefaults}),n=(e==null?void 0:e.formatDeviceName)??(T=>T),r=e==null?void 0:e.logger;function i(T){return t("/v1/android/apps",{query:{app_ids:T.appIds.join(",")}})}async function s(T){let D=await t("/v1/sync/pairing/generate",{method:"POST",retry:0,query:{install_id:T.installId}});return{code:D.code,expiration:new Date(D.expiration*1e3).getTime()}}function a(T){return t("/v1/sync/pairing/validate",{method:"POST",retry:0,query:{install_id:T.installId,code:T.code}}).catch(D=>{var y;let k=(y=D.response)==null?void 0:y.status;throw k===403?new lp:k===404?new cp:D})}function l(T){return t("/v1/sync/pairing/check",{query:{install_id:T.installId}}).catch(D=>{var y;if(((y=D.response)==null?void 0:y.status)!==404)throw D})}async function c(T){return t("/v1/sync/devices",{query:{key:T.deviceGroupKey}}).catch(D=>{var y;throw((y=D.response)==null?void 0:y.status)===404?new fi:D})}async function o(T){await t("/v1/sync/devices/remove",{method:"POST",retry:0,query:{key:T.deviceGroupKey,install_id:T.installIdToRemove}})}async function u(T){return(await t.raw("/v1/sync/devices/sessions",{method:"HEAD",query:{key:T.deviceGroupKey,install_id:T.installId}}).catch(D=>{var y;throw((y=D.response)==null?void 0:y.status)===404?new fi:D})).headers.get("Last-Modified")??void 0}async function h(T){return t("/v1/analytics/avg_usage",{query:{app_ids:T.appIds.join(","),gender:T.gender,country_code:T.countryCode}})}async function d(T){return t("/v1/analytics/avg_web_usage",{query:{websites:T.appIds.join(","),gender:T.gender,country_code:T.countryCode}})}async function f(T){var D;let{android_apps:y,websites:k,windows_apps:N,mac_apps:$,linux_apps:j}=await t("/v1/sync/devices/sessions",{query:{key:T.deviceGroupKey,install_id:T.installId,start_time:Co(T.startTime),end_time:Co(T.endTime),app_ids:(D=T.appIds)==null?void 0:D.join(",")}}).catch(Z=>{var M;throw((M=Z.response)==null?void 0:M.status)===404?new fi:Z});return[...br(y,"android"),...br(N??{},"windows"),...br($??{},"mac"),...br(j??{},"linux"),...br(k,"web")].sort((Z,M)=>Z.startedAt-M.startedAt)}async function g(T){var D;if(!T.appId.trim()){let{websites:N,diffPrivateWebsites:$,...j}=T;throw r==null||r.error("Missing required parameter 'appId'",j),Error("Missing required parameter 'appId'")}if(!T.installId.trim()){let{websites:N,diffPrivateWebsites:$,...j}=T;throw r==null||r.error("Missing required parameter 'installId'",j),Error("Missing required parameter 'installId'")}let y=Mi(navigator==null?void 0:navigator.userAgent),k={app_id:T.appId,install_id:T.installId,time_zone:Zn(),country_code:Ur(),device_name:n((D=y.browser)==null?void 0:D.name),device_type:y.os.name,birth_year:T.birthYear,websites:T.websites,diff_private_websites:T.diffPrivateWebsites};await t("/v1/web/upload",{method:"POST",retry:0,body:k})}async function m(T){var D;if(!T.appId.trim()){let{websites:N,diffPrivateWebsites:$,...j}=T;throw r==null||r.error("Missing required parameter 'appId'",j),Error("Missing required parameter 'appId'")}if(!T.installId.trim()){let{websites:N,diffPrivateWebsites:$,...j}=T;throw r==null||r.error("Missing required parameter 'installId'",j),Error("Missing required parameter 'installId'")}let y=Mi(navigator==null?void 0:navigator.userAgent),k={app_id:T.appId,install_id:T.installId,time_zone:Zn(),country_code:Ur(),device_name:n((D=y.browser)==null?void 0:D.name),device_type:y.os.name,birth_year:T.birthYear,websites:T.websites,diff_private_websites:T.diffPrivateWebsites};await t("/v1/page_views/upload",{method:"POST",retry:0,body:k})}async function A(T){if(!T.appId.trim()){let{apps:y,...k}=T;throw r==null||r.error("Missing required parameter 'appId'",k),Error("Missing required parameter 'appId'")}if(!T.installId.trim()){let{apps:y,...k}=T;throw r==null||r.error("Missing required parameter 'installId'",k),Error("Missing required parameter 'installId'")}let D={app_id:T.appId,install_id:T.installId,time_zone:Zn(),country_code:Ur(),device_name:n("App"),device_type:T.platform,birth_year:T.birthYear,apps:T.apps};await t("/v1/desktop/upload",{method:"POST",retry:0,body:D})}function E(T){return g({appId:T.appId,installId:T.installId,websites:{}})}function _(T){return A({appId:T.appId,installId:T.installId,platform:T.platform})}function p(T){return t("/v1/brands",{query:{install_id:T.installId}}).catch(D=>{var y;throw((y=D.response)==null?void 0:y.status)===403?new up:D})}function v(T){return t("/v1/sync/config",{query:{key:T.deviceGroupKey}}).catch(D=>{var y;throw((y=D.response)==null?void 0:y.status)===404?new fi:D})}async function C(T){await t("/v1/sync/config/reset_time",{method:"POST",retry:0,body:T})}async function S(T){await t("/v1/sync/config/ignore_list/remove",{method:"POST",retry:0,body:T})}async function P(T){await t("/v1/sync/config/ignore_list/add",{method:"POST",retry:0,body:T})}async function b(T){await t("/v1/sync/config/usage_limit/add",{method:"POST",retry:0,body:T})}async function x(T){let D={key:T.key,limit_ids:T.limitIds};await t("/v1/sync/config/usage_limit/remove",{method:"POST",retry:0,body:D})}async function I(T){let D={app_id:T.appId,install_id:T.installId,time_zone:Zn(),country_code:Ur(),ads:T.ads};await t("/v1/desktop/retail/"+T.website,{method:"POST",retry:0,body:D})}async function R(T){let D={app_id:T.appId,country_code:T.countryCode,time_zone:Zn(),prompts:T.prompts};await t("/v1/ai/analytics",{method:"POST",retry:0,body:D})}async function H(T){let D={app_id:T.appId,service:T.service,install_id:T.installId,status:T.status,country_code:T.countryCode,timestamp:Math.round(Date.now()/1e3)};await t("/v1/subscriptions/status",{method:"POST",retry:0,body:D})}return{getAndroidAppInfo:i,createPairingCode:s,validatePairingCode:a,getMyDeviceGroup:l,getSessionsLastUploadedAt:u,getAverageAppUsage:h,getAverageWebUsage:d,listDeviceGroupDevices:c,removeDeviceFromDeviceGroup:o,listDeviceGroupSessions:f,uploadSessions:g,uploadPageViews:m,uploadDesktopUsage:A,createDevice:E,createDesktopDevice:_,getBrandMapping:p,getGroupConfig:v,setResetTime:C,removeFromIgnoreList:S,addToIgnoreList:P,addUsageLimit:b,removeUsageLimit:x,uploadRetailAds:I,uploadPrompts:R,uploadSubscriptionStatus:H}}const dp=ke.createScopedLog("ScheduleJobs");let ze;const Io={UploadWebUsage:"@alarm/upload-web-usage"},hp="@stayfocusd/sessions-last-uploaded-at-key",gp="@stayfocusd/page-views-last-uploaded-at-key",fp={initAPI(e){return ze=e,ze.mixin("ScheduleJobs",{init:this.init.bind(this)})},init(){ze.Chrome.Alarms.addListener("onAlarm",async e=>{e.name===Io.UploadWebUsage&&(dp("Alarm fired",e.name),await this.uploadWebUsageJob())}),ze.Chrome.Alarms.ensure(Io.UploadWebUsage,{periodInMinutes:Br/rn})},async uploadWebUsageJob(){const e=await ze.WebUsage.getUsageDatabase(),t=Oo({ofetchDefaults:{baseURL:"https://stayfocusd.st-panel-api.com"}});await Ng({db:e,enabled:async()=>{const r=await ze.RemoteConfig.get("uploadWebUsage"),i=await ze.Storage.get("hasAcceptedPrivacyPolicy",!0);return r&&i},getAppId:()=>di.APP_ID,dev:!1,getInstallId:()=>ze.Storage.get(di.INSTALL_ID_KEY),getBirthYear:()=>ze.Settings.get("age")??void 0,logger:null,getUploadBatchSize:()=>ze.RemoteConfig.get("usageUploadBatchSize"),api:t,sessions:{lastUploadedAtStorageKey:hp,onFailure:()=>ze.Analytics.event("WEB_USAGE_UPLOAD_FAILED"),onSuccess:r=>ze.Analytics.event("WEB_USAGE_UPLOAD_COMPLETED",r)},pageViews:{lastUploadedAtStorageKey:gp,onFailure:()=>ze.Analytics.event("PAGE_VIEWS_UPLOAD_FAILED"),onSuccess:r=>ze.Analytics.event("PAGE_VIEWS_UPLOAD_COMPLETED",r),getUploadAllowlist:()=>ze.RemoteConfig.get("pageViewAllowlist")}}).uploadAll()}};/** @license DropletJS.PubSub | MIT License | https://github.com/wmbenedetto/DropletJS.PubSub#mit-license */const Po=function(e,t){var n,n=function(){};typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(c){var o=this;return function(){return o.apply(c,arguments)}});var r=function(c){return typeof c=="object"&&c!==null&&typeof c.length=="number"},i=function(c){return typeof c=="object"&&c!==null&&typeof c.length!="number"},s=function(c,o){try{delete c[o]}catch{c[o]=t}},a=function(o){if(this.namespace=this.DEFAULT_NS,o.indexOf(":")>-1&&(this.namespace=o.substr(0,o.indexOf(":")),o=o.substr(o.indexOf(":")+1,o.length)),o.indexOf(".")>-1){var u=o.split(".");this.msgArray=[u[0]||"*",u[1]||"*",u[2]||"*",u[3]||"*"],this.msgString=this.msgArray.join(".")}else this.msgArray=[o],this.msgString=o};a.prototype={DEFAULT_NS:"__default",matches:function(c){if(this.msgString===c)return!0;var o=this.msgArray,u=c.split(".");if(o.length!==u.length)return!1;for(var h="",d="",f=o.length>=u.length?o.length:u.length,g=0;g<f;g++){if(o[g]!=="*"&&u[g]!=="*"&&o[g]!==u[g])return!1;h+=o[g]==="*"?"0":"1",d+=u[g]==="*"?"0":"1"}return h>=d},toString:function(){return this.msgString}};var l={handlers:{},subscribers:{before:[],after:[]},getAPI:function(){return{clear:this.clear.bind(this),listen:this.listen.bind(this),once:this.once.bind(this),publish:this.publish.bind(this),stop:this.stop.bind(this),subscribe:this.subscribe.bind(this),unsubscribe:this.unsubscribe.bind(this)}},listen:function(){var c=this.processListenArgs(Array.prototype.slice.call(arguments));if(this.log("listen","Adding listener",c),r(c.message))return this.each(c,this.listen.bind(this)),null;this.addHandler(c)},once:function(){var c=this.processListenArgs(Array.prototype.slice.call(arguments));if(c.limit=1,this.log("once","Adding one-time listener",c),r(c.message))return this.each(c,this.once.bind(this)),null;this.addHandler(c)},stop:function(c){if(c)throw new Error("Message(s) must be passed to stop()");var o={message:this.toMessage(c)};if(this.log("stop","Stopping listener",o),r(o.message))return this.each(o,this.stop.bind(this)),null;this.removeHandlers(o)},subscribe:function(){var c=this.processSubscribeArgs(Array.prototype.slice.call(arguments)),o=c.phase;this.log("subscribe","Adding subscriber",c),this.subscribers[o]=this.subscribers[o]||[],this.subscribers[o].push(c)},unsubscribe:function(){var c=this.processUnsubscribeArgs(Array.prototype.slice.call(arguments));if(!c.phase)return this.unsubscribe(c.namespace,"before"),this.unsubscribe(c.namespace,"after"),null;var o=c.namespace,u=c.phase,h=this.subscribers[u];if(this.log("unsubscribe","Unsubscribe from "+u+" phase"+(o?" in "+o+" namespace":""),c),r(h))for(var d=0;d<h.length;d++)(!o||h[d].namespace===o)&&h.splice(d,1)},publish:function(){var c=this.processPublishArgs(Array.prototype.slice.call(arguments));if(r(c.message)){var o=c.onComplete;return c.onComplete=null,this.each(c,this.publish.bind(this),o),null}var u=c.message.toString();this.log("publish","# START publishing "+u,c);for(var h=c.message,d=c.payload,f=c.onPublish,g=this.subscribers.before.concat(this.getHandlers(h)).concat(this.subscribers.after),m=0;m<g.length;m++){if(g[m].limit===null||g[m].count<g[m].limit){var A=g[m].async?g[m].handler(h,d,f):g[m].handler(h,d);g[m].async!==!0&&typeof f=="function"&&f(A),g[m].count+=1}typeof g[m].limit=="number"&&g[m].count===g[m].limit&&this.removeHandlers(c,m)}this.log("publish","# END publishing "+u,c),typeof c.onComplete=="function"&&c.onComplete()},getHandlers:function(c){var o=[];for(var u in this.handlers)this.handlers.hasOwnProperty(u)&&c.matches(u)&&(o=o.concat(this.handlers[u]));return o},clear:function(){this.log("clear","Clearing PubSub"),this.handlers={},this.subscribers={before:[],after:[]}},each:function(c,o,u){for(var h=0;h<c.message.length;h++){var d={};for(var f in c)c.hasOwnProperty(f)&&f!=="message"&&(d[f]=c[f]);d.message=c.message[h],o(d)}typeof u=="function"&&u()},addHandler:function(c){var o=c.message.toString();this.log("addHandler","Adding handler for "+o+" message",null,"TRACE"),this.handlers[o]=this.handlers[o]||[],this.handlers[o].push({namespace:c.message.namespace,handler:c.handler,async:c.async,limit:typeof c.limit=="number"?c.limit:null,count:0})},removeHandlers:function(c,o){var u=c.message.toString(),h=c.message.namespace,d=this.handlers;if(d&&d[u]){var f="Removing handler for "+u+" message";if(f+=h!==c.message.DEFAULT_NS?" in "+h+" namespace":"",this.log("removeHandlers",f,null,"TRACE"),typeof o=="number")d[u][o].namespace===h&&d[u].splice(o,1);else for(var g=0;g<d[u].length;g++)d[u][g].namespace===h&&d[u].splice(g,1);d[u].length===0&&s(d,u)}},processListenArgs:function(c){var o={};if(i(c[0])?o=c[0]:(o.message=typeof c[0]=="string"||r(c[0])?c[0]:null,o.handler=typeof c[1]=="function"?c[1]:null),!o.message||typeof o.handler!="function")throw new Error("Message(s) and handler function must be passed to listen() and/or once()");return o.message=this.toMessage(o.message),o},processSubscribeArgs:function(c){var o={};if(i(c[0])?o=c[0]:o.handler=typeof c[0]=="function"?c[0]:null,typeof o.handler!="function")throw new Error("Handler must be passed to subscribe()");if(o.phase=o.phase||"after",o.limit=null,o.count=0,o.phase&&!(o.phase in{before:1,after:1}))throw new Error(o.phase+" is not a valid phase for subscribe().");return o},processUnsubscribeArgs:function(c){var o={};if(i(c[0])?o=c[0]:(o.namespace=typeof c[0]=="string"?c[0]:null,o.phase=typeof c[1]=="string"?c[1]:null),o.phase&&!(o.phase in{before:1,after:1}))throw new Error(o.phase+" is not a valid phase for unsubscribe().");return o},processPublishArgs:function(c){var o={};if(i(c[0])?o=c[0]:(o.message=typeof c[0]=="string"||r(c[0])?c[0]:null,o.payload=typeof c[1]<"u"?c[1]:null),!o.message)throw new Error("Message(s) must be passed to publish()");return o.message=this.toMessage(o.message),o.async&&typeof o.onPublish!="function"&&(o.onPublish=function(){}),o},toMessage:function(c){if(r(c)){for(var o=[],u=0;u<c.length;u++)c[u]instanceof a||(o[u]=new a(c[u]));c=o}else c&&!(c instanceof a)&&(c=new a(c));return c},log:function(c,o,u,h){n("DropletJS.PubSub."+c,o,u,h)},setLogLevel:function(c){}};return l}(),pi=ke.createScopedLog("Notification");let vt;const jn={settings:[300,60,10],NOTIFICATION_TTL:5e3,initAPI:function(e){return vt=e,vt.mixin("Notification",{initAsync:this.initAsync.bind(this),get:this.get.bind(this),saveSettings:this.saveSettings.bind(this)})},init:function(e){pi("init","Initializing Notification",null,"DEBUG"),this.loadSettings(),typeof e=="function"&&e()},initAsync(){return new Promise(e=>this.init(e))},get:function(){return this.settings},show:function(e){pi("show","Showing "+e+" notification");let t="",n="",r=0;e==="nuclear"?(r=vt.NuclearOption.getSecondsUntilActive(),t="/common/img/icon-nuclear-48.png",n=vt.Chrome.Translation.get("nuclearNotification")||"The Nuclear Option will start blocking sites in"):e==="block"&&(r=vt.StayFocusd.getTotalSecondsRemaining(),t="/common/img/icon-red-48.png",n=vt.Chrome.Translation.get("blockNotification")||"StayFocusd will start blocking your Blocked Sites in"),n+=r>60?" "+vt.Date.secondsToMinsAndSecs(r):" "+r+" seconds";const i={type:"basic",title:"StayFocusd",iconUrl:t,message:n};vt.Chrome.Notification.create("",i,s=>{s!=null&&setTimeout(()=>{vt.Chrome.Notification.clear(s)},this.NOTIFICATION_TTL)})},isset:function(e){return this.settings.inArray(e)},saveSettings:function(e){pi("saveSettings","Saving settings",e,"TRACE"),this.settings=e,vt.Settings.set({notificationSettings:e})},loadSettings:function(){pi("loadSettings","Loading settings",null,"TRACE");const e=vt.Settings.get("notificationSettings");e&&(this.settings=e)}};var wr=(e=>(e.RED="#FF0000",e.YELLOW="#FDD017",e.GREEN="#009933",e.BLACK="#000000",e))(wr||{}),Fn=(e=>(e.ONBOARDING="/common/img/icon-red-dot-24.png",e.ALLOWED="/common/img/icon-green-24.png",e.BLOCKED="/common/img/icon-red-24.png",e.DEFAULT="/common/img/icon-24.png",e.NUCLEAR="/common/img/icon-nuclear-24.png",e.DEACTIVATED="/common/img/icon-disabled-24.png",e))(Fn||{});const mi=function(e,t,n,r){Dr.log(`BadgeIcons.${e}`,t,n,r)};function ko(){function e(a,l,c){const o=a||"",u=c||void 0;mi("showBadge","Showing badge",{text:o,iconColor:l,tabID:u},"DEBUG"),l&&r(l,u),i(o,u)}function t(a){a=a||void 0,i("",a)}async function n(a,l){l=l||void 0,mi("setIcon","Setting icon",a,"TRACE"),await s()?chrome.action.setIcon({tabId:l,path:"/common/img/icon-red-dot-24.png"}):chrome.action.setIcon({tabId:l,path:a})}function r(a,l){mi("setBadgeColor","Setting badge color",a,"TRACE"),l=l||void 0,chrome.action.setBadgeBackgroundColor({tabId:l,color:a})}function i(a,l){mi("setBadgeText","Setting badge text",a,"TRACE"),l=l||void 0,chrome.action.setBadgeText({tabId:l,text:a})}async function s(){return!1}return{showBadge:e,hideBadge:t,setIcon:n}}const pp=ko(),Rt=ke.createScopedLog("NuclearOption");let Ye;const lt={timer:null,interval:1,settings:{},initialized:!1,initAPI:function(e){return Ye=e,Ye.mixin("NuclearOption",{init:this.init.bind(this),initAsync:this.initAsync.bind(this),activate:this.activate.bind(this),isActive:this.isActive.bind(this),getBlockLength:this.getBlockLength.bind(this),getBlockType:this.getBlockType.bind(this),getContentType:this.getContentType.bind(this),getExpiration:this.getExpiration.bind(this),getFrequency:this.getFrequency.bind(this),getSecondsUntilActive:this.getSecondsUntilActive.bind(this),getSmartBomb:this.getSmartBomb.bind(this),getStartAmPm:this.getStartAmPm.bind(this),getStartHour:this.getStartHour.bind(this),getStartMin:this.getStartMin.bind(this),getStartType:this.getStartType.bind(this),saveSettings:this.saveSettings.bind(this),updateActiveDays:this.updateActiveDays.bind(this)})},init:function(e){Rt("init","Initializing NuclearOption",null,"DEBUG"),this.loadSettings(),this.timer=setInterval(this.tick.bind(this),this.interval*1e3),this.initialized=!0,typeof e=="function"&&e(),Ye.PubSub.listen("Settings.data.refreshed",(t,n)=>{n.changes.nuclearOptionSettings&&this.loadSettings()})},initAsync(){return new Promise(e=>this.init(e))},saveSettings:function(e){this.settings=e,e.activeDays=this.calculateActiveDays(e),Rt("saveSettings","Saving settings",e,"DEBUG"),Ye.Settings.set({nuclearOptionSettings:e})},calculateActiveDays:function(e){let t=[];return e.frequency==="activeDays"?t=Ye.StayFocusd.getActiveDays(!0):typeof e.frequency<"u"&&(t[0]=e.frequency==="everyDay",t[1]=e.frequency.indexOf("every")>-1,t[2]=e.frequency.indexOf("every")>-1,t[3]=e.frequency.indexOf("every")>-1,t[4]=e.frequency.indexOf("every")>-1,t[5]=e.frequency.indexOf("every")>-1,t[6]=e.frequency==="everyDay"),Rt("calculateActiveDays","Calculating active days",t,"DEBUG"),t},updateActiveDays:function(e){Rt("updateActiveDays","Updating active days",e,"DEBUG"),this.initialized||this.init(()=>{this.updateActiveDays(e)}),this.settings.activeDays=e,this.saveSettings(this.settings)},loadSettings:function(){Rt("loadSettings","Loading settings",this.settings,"DEBUG");const e=Ye.Settings.get("nuclearOptionSettings");e&&(this.settings=e)},isActive:function(){this.isCurrentlyActive()?this.isExpired()&&this.deactivate():this.isStarted()&&this.activate();const e=this.isCurrentlyActive();return Rt("isActive","Is Nuclear Option active?",e?"YES":"NO","TRACE"),e},isActiveToday:function(){const e=this.getFrequency(),t=this.getLastActiveDate(),n=this.getLastExpiredDate(),r=new Date().toDateString();if(e==="todayOnly"&&(t===r||t===null)&&n!==r)return!0;const i=new Date().getDay(),s=this.getActiveDays();return s.length===0?!1:s[i]},isStarted:function(){const e=this.getStartType(),t=this.getLastActiveDate(),n=this.getLastExpiredDate(),r=new Date().toDateString();if(!this.isActiveToday()||n===r)if(e==="atScheduledTime"){const i=new Date(r+" "+this.getStartHour()+":"+this.getStartMin()+" "+this.getStartAmPm());if(new Date(this.getExpiration())>i)return!1}else return!1;if(e==="now")return t===r;if(this.isActiveToday()){if(e==="atScheduledTime")return Ye.Date.hasTimePassed(this.getStartHour(),this.getStartMin(),this.getStartAmPm());if(e==="whenMaxTimeAllowedExceeded")return!!Ye.BlockedAllWebsites.isMaxTimeAllowedExceeded()}return!1},activate:function(){Ye.Analytics.event("TOGGLE_NUCLEAR_OPTION",{enabled:!0}),Rt("activate","Activating Nuclear Option");const e=this.hasScheduledTime()?Ye.Date.getTodayDateObj(this.getStartHour(),this.getStartMin(),this.getStartAmPm()):new Date;this.settings.expiration=e.getTime()+this.getBlockLength(),this.settings.lastActiveDate=new Date().toDateString(),this.settings.lastExpiredDate=null,this.settings.isCurrentlyActive=!0,this.saveSettings(this.settings),pp.hideBadge()},deactivate:function(){Ye.Analytics.event("TOGGLE_NUCLEAR_OPTION",{enabled:!1}),Rt("deactivate","Deactivating Nuclear Option"),this.settings.lastExpiredDate=new Date().toDateString(),this.settings.isCurrentlyActive=!1,this.saveSettings(this.settings)},isExpired:function(){if(this.getExpiration()===null)return!0;const e=new Date;return new Date(this.getExpiration())<e},isBlockable:function(e,t){if(this.isActive()===!1)return!1;switch(this.getBlockType()){case"all":return!0;case"allExceptAllowed":return!t;case"blocked":return e&&!t;default:return!1}},hasScheduledTime:function(){return this.getStartType()==="atScheduledTime"},getSecondsUntilActive:function(){return Ye.Date.secondsUntilTime(this.getStartHour(),this.getStartMin(),this.getStartAmPm())},hasSmartBomb:function(){return this.getContentType()==="smartBomb"},isCurrentlyActive:function(){return typeof this.settings.isCurrentlyActive>"u"?!1:this.settings.isCurrentlyActive},getSmartBomb:function(){return this.settings.smartBomb??{}},getContentType:function(){return typeof this.settings.contentType>"u"?"wholeSite":this.settings.contentType},getExpiration:function(){return typeof this.settings.expiration>"u"?null:Number(this.settings.expiration)},getLastActiveDate:function(){return typeof this.settings.lastActiveDate>"u"?null:this.settings.lastActiveDate},getLastExpiredDate:function(){return typeof this.settings.lastExpiredDate>"u"?null:this.settings.lastExpiredDate},getBlockType:function(){return typeof this.settings.blockType>"u"?"blocked":this.settings.blockType},getBlockLength:function(){if(typeof this.settings.blockLength>"u")return Br;{const e=this.settings.blockLength;return Number(e)===e&&e%1!==0||e<rn?Math.floor(e*60)*rn:e}},getStartType:function(){return typeof this.settings.startType>"u"?"now":this.settings.startType},getStartHour:function(){return this.settings.startHour??"00"},getStartMin:function(){return this.settings.startMin??"00"},getStartAmPm:function(){return this.settings.startAmPm??"am"},getFrequency:function(){return this.settings.frequency??null},getActiveDays:function(){return this.settings.activeDays??[]},tick:function(){if(this.hasScheduledTime()&&!this.isActive()){const e=this.getSecondsUntilActive();Rt("tick",e+" seconds until Nuclear Option",null,"TRACE"),jn.isset(e)&&jn.show("nuclear"),this.updateBadge()}else this.isActive()&&this.updatePopupTimer();return!0},updatePopupTimer(){Ye.StayFocusd.postTimerUpdatedMessage()},updateBadge:function(){const e=this.getSecondsUntilActive();e>0&&e<60&&Ye.StayFocusd.updateBadge(this.getSecondsUntilActive(),!0)}},yi=ke.createScopedLog("WebUsage"),mp=1e3;let ut;const yp={_timer:null,_isNewDay:null,_killPageAction:null,_updateBadgeAction:null,_postTimerUpdatedMessage:null,_showNotification:null,initAPI(e){return ut=e,ut.mixin("BlockedGroupsTimer",{init:this.init.bind(this),startCountdown:this.startCountdown.bind(this),stopCountdown:this.stopCountdown.bind(this),tick:this.tick.bind(this),isMaxTimeAllowedExceeded:this.isMaxTimeAllowedExceeded.bind(this),getTotalSecondsRemaining:this.getTotalSecondsRemaining.bind(this)})},async init(e,t,n,r,i){this._isNewDay=e,this._killPageAction=t,this._updateBadgeAction=n,this._postTimerUpdatedMessage=r,this._showNotification=i},startCountdown(e){if(this._timer&&this.stopCountdown(),!ut.Settings.get("activated",!0)){yi("startCountdown","Extension is not activated");return}yi("startCountdown","Starting countdown"),this._timer=setInterval(async()=>await this.tick(e),mp)},stopCountdown(){yi("stopCountdown","Stopping countdown"),this._timer&&clearInterval(this._timer),this._timer=null},async tick(e){var n;(n=this._isNewDay)!=null&&n.call(this)&&ut.BlockedGroupsRepository.clearElapsedTime();const t=ut.BlockedAllWebsites.getTime();if(t!=null)await ut.Storage.set({blockAllWebsitesElapsedTime:t.elapsedTime+1}),this.actionsAfterCheckingTime(e,t.elapsedTime,t.allowedTime-t.elapsedTime);else{const r=ut.BlockedGroupsRepository.getBlockedGroupByDomain(e);if(!r)return;await ut.BlockedGroupsRepository.incrementElapsedTime(r.groupName);const i=r.maxTimeAllowed-r.elapsedTime;this.actionsAfterCheckingTime(e,r.elapsedTime,i)}},actionsAfterCheckingTime(e,t,n){var r,i,s,a;if(yi("tick",`Elapsed time: ${t}. Time remaining: ${n}`,null,"DEBUG"),(r=this._showNotification)==null||r.call(this,n),n<=0){(i=this._killPageAction)==null||i.call(this,e);return}(s=this._postTimerUpdatedMessage)==null||s.call(this),(a=this._updateBadgeAction)==null||a.call(this,n)},isMaxTimeAllowedExceeded(e){const t=ut.BlockedAllWebsites.isMaxTimeAllowedExceeded();if(t!=null)return t;{const n=ut.BlockedGroupsRepository.getBlockedGroupByDomain(e);if(n)return n.elapsedTime>=n.maxTimeAllowed}return!1},getTotalSecondsRemaining(e){const t=ut.BlockedAllWebsites.getTotalSecondsRemaining();if(t!=null)return t;{const n=ut.BlockedGroupsRepository.getBlockedGroupByDomain(e);if(n!=null)return n.maxTimeAllowed-n.elapsedTime}}};let Wn;const vp={initAPI(e){return Wn=e,Wn.mixin("BlockedAllWebsites",{getTime:this.getTime.bind(this),isMaxTimeAllowedExceeded:this.isMaxTimeAllowedExceeded.bind(this),getTotalSecondsRemaining:this.getTotalSecondsRemaining.bind(this),clearElapsedTime:this.clearElapsedTime.bind(this)})},getTime(){if(Wn.Settings.get("isBlockAllWebsites")??!1){const t=Wn.Settings.get("blockAllWebsitesAllowedTime")??Sn*10,n=Wn.Settings.get("blockAllWebsitesElapsedTime")??0;return{allowedTime:t,elapsedTime:n}}return null},isMaxTimeAllowedExceeded(){const e=this.getTime();return e!=null?e.elapsedTime>=e.allowedTime:null},getTotalSecondsRemaining(){const e=this.getTime();return e!=null?e.allowedTime-e.elapsedTime:null},async clearElapsedTime(){await Wn.Storage.set({blockAllWebsitesElapsedTime:0})}};function vi(e,t){return Y.Domain.isMoreGeneralURL(e,t)||Y.Domain.matchesWildcard(e,t)}const Ct="blockedGroups",Do="blacklist",Mo="maxTimeAllowed",_s="Default";let Ue,qe=[];const bp={initAPI(e){return Ue=e,Ue.mixin("BlockedGroupsRepository",{init:this.init.bind(this),add:this.add.bind(this),get:this.get.bind(this),getByName:this.getByName.bind(this),update:this.update.bind(this),updateWebsites:this.updateWebsites.bind(this),addWebsite:this.addWebsite.bind(this),clearElapsedTime:this.clearElapsedTime.bind(this),incrementElapsedTime:this.incrementElapsedTime.bind(this),delete:this.delete.bind(this),isBlockable:this.isBlockable.bind(this),getBlockedGroupByDomain:this.getBlockedGroupByDomain.bind(this),getBlockedGroupsByDomain:this.getBlockedGroupsByDomain.bind(this),migrate:this.migrate.bind(this),importBlockedsites:this.importBlockedsites.bind(this)})},async init(){if(Y.Settings.get("disableSync")===!0){const n=!!(await Ue.Chrome.Storage.getSync(Ct))[Ct];await Ue.Storage.setBucket(Ct,"LOCAL",!n)}else{const n=!!(await Ue.Chrome.Storage.getLocal(Ct))[Ct];await Ue.Storage.setBucket(Ct,"SYNC",!n)}this.getGroups(),this.addListeners()},async getGroups(){const e=Ue.Settings.get(Ct);qe=e??[]},async add(e,t,n,r){if(qe.find(s=>s.groupName==e)==null){const s={groupName:e,maxTimeAllowed:t,websites:n,elapsedTime:r??0};qe.push(s),await this.saveChanges(),Y.Analytics.event("CREATE_BLOCKED_GROUP")}},get(){return qe},getByName(e){return qe.find(t=>t.groupName==e)},async update(e,t,n,r){const i=qe.find(s=>s.groupName==e);typeof i>"u"||(i.groupName!=t&&Y.Analytics.event("UPDATE_BLOCKED_GROUP_NAME"),i.groupName!="Default"&&(i.groupName=t),i.maxTimeAllowed!=n&&Y.Analytics.event("UPDATE_BLOCKED_GROUP_MAX_TIME_ALLOWED",{minutes:n/60}),i.maxTimeAllowed=n,i.websites=r,await this.saveChanges())},async updateWebsites(e,t){const n=qe.find(r=>r.groupName==e);typeof n>"u"||(n.websites=t,await this.saveChanges())},async addWebsite(e,t){const n=qe.find(r=>r.groupName==e);if(!(typeof n>"u"))return n.websites.find(r=>r==t)==null?(n.websites.push(t),await this.saveChanges(),!0):!1},async clearElapsedTime(){this.get().forEach(t=>t.elapsedTime=0),await this.saveChanges(),await Ue.BlockedAllWebsites.clearElapsedTime()},async delete(e){const t=qe.findIndex(n=>n.groupName==e);t>-1&&(qe.splice(t,1),await this.saveChanges(),Y.Analytics.event("DELETE_BLOCKED_GROUP"))},isBlockable(e){return e=e.toLowerCase(),qe.find(t=>t.websites.find(n=>vi(n,e)))!=null},getBlockedGroupByDomain(e){return e==null?null:(e=e.toLowerCase(),qe.find(t=>t.websites.find(n=>vi(n,e))))},getBlockedGroupsByDomain(e){return qe.filter(t=>t.websites.find(n=>vi(n,e)))},async migrate(){if(this.needMigrate()){const e=Ue.Settings.get(Do);let t=Ue.Settings.get(Mo);t==null?t=ta:t=t*Sn;let n=await Ue.Storage.get("elapsedTime");if((isNaN(n)||n==null)&&(n=0),e!=null){const r=Object.keys(e);await this.add(_s,t,r,n)}else await this.add(_s,t,[],n)}},needMigrate(){return Ue.Settings.get(Ct)==null},async importBlockedsites(){qe=[];const e=Ue.Settings.get(Do);if(e!=null){const t=Object.keys(e);let n=Ue.Settings.get(Mo);n==null?n=ta:n=n*Sn,await this.add(_s,n,t,0)}},async incrementElapsedTime(e){const t=this.getByName(e);t&&(t.elapsedTime+=1,await this.saveChanges())},async saveChanges(){await Ue.Storage.set({blockedGroups:qe})},addListeners(){Y.PubSub.listen("Settings.data.refreshed",async(e,t)=>{(t.changes.blockedGroups||t.changes.disableSync)&&(t.changes.disableSync&&(t.disableSync===!1?await Ue.Storage.setBucket(Ct,"SYNC"):await Ue.Storage.setBucket(Ct,"LOCAL")),this.getGroups())})}},bi=ke.createScopedLog("Message");class wp{constructor(t){_n(this,"DEFAULT_NS","__default");_n(this,"msgArray",null);_n(this,"msgString",null);_n(this,"namespace",null);if(this.namespace=this.DEFAULT_NS,t.indexOf(":")>-1&&(this.namespace=t.substr(0,t.indexOf(":")),t=t.substr(t.indexOf(":")+1,t.length)),t.indexOf(".")>-1){const n=t.split(".");this.msgArray=[n[0]||"*",n[1]||"*",n[2]||"*",n[3]||"*"],this.msgString=this.msgArray.join(".")}else this.msgArray=[t],this.msgString=t}matches(t){if(this.msgString===t)return bi("matches",this.msgString+" matches "+t+"?","YES","TRACE"),!0;const n=this.msgArray,r=t.split(".");if((n==null?void 0:n.length)!==r.length)return bi("matches",this.msgString+" matches "+t+"?","NO","TRACE"),!1;let i="",s="";const a=n.length>=r.length?n.length:r.length;for(let l=0;l<a;l++){if(n[l]!=="*"&&r[l]!=="*"&&n[l]!==r[l])return bi("matches",this.msgString+" matches "+t+"?","NO","TRACE"),!1;i+=n[l]==="*"?"0":"1",s+=r[l]==="*"?"0":"1"}return bi("matches",this.msgString+" matches "+t+"?",i>=s?"YES":"NO","TRACE"),i>=s}toString(){return this.msgString}getOriginator(){var t,n;return((t=this.msgArray)==null?void 0:t[0])==="*"?null:(n=this.msgArray)==null?void 0:n[0]}getDescriptor(){var t,n;return((t=this.msgArray)==null?void 0:t[3])==="*"?null:(n=this.msgArray)==null?void 0:n[3]}}const ge=ke.createScopedLog("StayFocusd"),$n=ko();let L;const No="onboarding-opened-at",Ap={firstInstallAllowance:60,interval:1,timer:null,apiURL:"https://www.stayfocusd.com",redirectURL:"https://www.stayfocusd.com/blocked/",uninstallUrl:"https://www.stayfocusd.com/goodbye/",onboardingUrl:"https://www.stayfocusd.com/extension-get-started",currentURL:null,version:null,selectedTabID:null,active:null,popupPort:null,initAPI:function(e){return L=e,L.mixin("StayFocusd",{getActiveDays:this.getActiveDays.bind(this),getActiveHours:this.getActiveHours.bind(this),getActiveHoursQueue:this.getActiveHoursQueue.bind(this),getAPIURL:()=>this.apiURL,getCurrentURL:()=>this.currentURL,getResetTime:this.getResetTime.bind(this),getResetTimeQueue:this.getResetTimeQueue.bind(this),getTotalSecondsRemaining:this.getTotalSecondsRemaining.bind(this),isActive:this.isActive.bind(this),isFirstInstallAllowanceActive:this.isFirstInstallAllowanceActive.bind(this),isUpdatePopupDisabled:this.isUpdatePopupDisabled.bind(this),localizeHTML:this.localizeHTML.bind(this),setActiveDays:this.setActiveDays.bind(this),setActiveHoursQueue:this.setActiveHoursQueue.bind(this),setResetTimeQueue:this.setResetTimeQueue.bind(this),updateBadge:this.updateBadge.bind(this),hideBadge:this.hideBadge.bind(this),postTimerUpdatedMessage:this.postTimerUpdatedMessage.bind(this),onInstalled:this.onInstalled.bind(this),onUpdated:this.onUpdated.bind(this),activated:this.activated.bind(this),setActivated:this.setActivated.bind(this),isActivateSwitchShown:this.isActivateSwitchShown.bind(this),setActivateSwitchShown:this.setActivateSwitchShown.bind(this)})},async init(){ge("init","Initializing StayFocusd",null,"DEBUG"),this.initCheckingTab(),await this.initSettings(),await this.initRemoteConfig(),this.initAnalytics(),this.initBugsnag(),await this.initRequirements(),await this.initBlockedGroups(),this.initBlockedGroupTimer(),await this.initWhitelist(),await this.initNuclearOption(),await this.initNotification(),this.initListeners(),this.initUninstallURL(),await this.initWebUsageCollect(),this.initScheduleJobs(),await this.forceOnboardingOnNewTab()},initBlockedGroupTimer(){const e=()=>this.isNewDay(),t=s=>this.killPage(s),n=s=>this.updateBadge(s),r=()=>this.postTimerUpdatedMessage(),i=s=>this.showNotification(s);L.BlockedGroupsTimer.init(e,t,n,r,i)},async initSettings(){await L.Settings.initAsync(),await L.Storage.setBucket(["backupKeys","disableUpdatePopup","isUpdated","previousVersion","productivityBypass"]),L.Storage.addOnChangeListener(async(e,t)=>{ge("init",t+" storage changed",e),L.Settings.refresh(()=>{L.PubSub.publish("Settings.data.refreshed",{areaName:t,changes:e})})}),this.isFirstInstall()&&this.setFirstInstallAllowance()},async initRemoteConfig(){await L.RemoteConfig.init(),await L.Chrome.Alarms.ensure("remote-config",{periodInMinutes:30}),L.Chrome.Alarms.addListener("onAlarm",async e=>{e.name==="remote-config"&&await L.RemoteConfig.refresh()}),await L.RemoteConfig.refresh()},initAnalytics(){L.Analytics.init()},initBugsnag(){L.Bugsnag.init("background")},async initWebUsageCollect(){await L.WebUsage.init(),chrome.runtime.onConnect.addListener(e=>{e.name=="getUsageSummaryData"&&e.onMessage.addListener(async t=>{if(t.message=="usage.getUsageSummaryData.request"){const n=await L.WebUsage.getUsageDatabase(),r=await n.sessionsRepo.findSessions(t.startDate,t.endDate),i=await n.adsRepo.findAds(t.startDate,t.endDate);e.postMessage({message:"usage.getUsageSummaryData.response",startDate:t.startDate,endDate:t.endDate,sessions:r,ads:i})}})})},initCheckingTab(){setInterval(()=>{L.Chrome.Tab.getSelected(void 0,e=>{e&&L.PubSub.publish("StayFocusd.tab.activity",{tabID:e.id,tab:e})})},1e3)},initScheduleJobs(){L.ScheduleJobs.init()},async initRequirements(){await L.Requirements.init()},async initBlockedGroups(){await L.BlockedGroupsRepository.init(),await L.BlockedGroupsRepository.migrate(),this.isNewDay()===!0&&L.BlockedGroupsRepository.clearElapsedTime()},async initWhitelist(){ge("initWhitelist","Initializing whitelist",null,"DEBUG"),await L.WhitelistRepository.init(),await L.WhitelistRepository.migrate()},async initNuclearOption(){ge("initNuclearOption","Initializing Nuclear Option",null,"DEBUG"),await lt.initAsync(),ge("initNuclearOption","Nuclear Option initialized",null,"DEBUG")},async initNotification(){ge("initNotification","Initializing Notification",null,"DEBUG"),await jn.initAsync(),ge("initNotification","Notification initialized",null,"DEBUG")},showNotification(e){jn.isset(e)&&jn.show("block")},initListeners(){ge("initListeners","Initializing listeners",null,"DEBUG"),L.PubSub.subscribe({async:!0,handler:async(e,t,n)=>{var a;function r(l){return chrome.runtime.lastError&&ge("initListeners","runtime.lastError",chrome.runtime.lastError),l!=null&&typeof l=="function"?l:()=>!0}if(n=r(n),!t||!t.tabID||(a=t.sender)!=null&&a.tab)return!0;const i=await L.Chrome.Tab.get(t.tabID);if(!i||i.status==="loading")return!0;const s=(i.url==""?i.pendingUrl:i.url)??"";return/^about:|^chrome-extension:|^chrome:\/\//i.test(s)||L.Chrome.Message.sendToTab(t.tabID,{message:e.toString(),payload:t},n),!0}}),L.Chrome.Message.on.addListener((e,t,n)=>(e.payload=e.payload||{},e.payload.sender=t||{},/^proxy-service.*$/.test(e.type)||t.tab&&L.PubSub.publish({message:e.message,payload:e.payload,onPublish:typeof n=="function"?n:()=>{}}),!0)),L.PubSub.listen("ActivityMonitor.component.initialized",()=>{L.Chrome.Tab.getSelected(void 0,e=>{e&&L.PubSub.publish("StayFocusd.tab.selected",{tab:e,tabID:e.id,blockable:this.isBlockable(e.url??"")})})}),L.PubSub.listen({message:"ActivityMonitor.overlay.hidden",async:!0,handler:(e,t,n)=>{const r={countdownStarted:L.BlockedGroupsTimer.startCountdown(this.currentURL)};typeof n=="function"&&n(r)}}),L.PubSub.listen({message:"ActivityMonitor.overlay.shown",async:!0,handler:(e,t,n)=>{const r={countdownStopped:L.BlockedGroupsTimer.stopCountdown()};typeof n=="function"&&n(r)}}),L.Chrome.Extension.addListener("onConnect",e=>{e.name==="popup"&&this.onPopupConnected(e)}),L.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)}),L.Chrome.Tab.addListener("onActivated",()=>{L.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)})}),L.Chrome.Tab.addListener("onUpdated",()=>{L.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)})}),L.Chrome.Tab.addListener("onRemoved",()=>{L.Chrome.Tab.getSelected(void 0,e=>{typeof e>"u"&&L.BlockedGroupsTimer.stopCountdown()})}),L.Chrome.Window.addListener("onRemoved",()=>{L.BlockedGroupsTimer.stopCountdown()}),L.Chrome.Window.addListener("onFocusChanged",()=>{L.Chrome.Tab.getSelected(void 0,async e=>{await this.onTabStateChange(e)})})},async onInstalled(e){await chrome.tabs.create({url:this.onboardingUrl,active:!0}),ge("onInstalled","Installed extension",e,"INFO");const{promise:t,resolve:n}=ke.getDecoupledPromise();chrome.runtime.onConnect.addListener(r=>{r.name=="startOnboardingAfterInstall"&&r.onMessage.addListener(async i=>{i.message=="start-onboarding"&&n()})}),await t,L.Settings.set({isNewUser:!0}),await this.openOnboarding()},async onUpdated(e){if(!e.previousVersion)return;const t=await L.Storage.get("previousVersion"),n=await L.Storage.get("disableUpdatePopup");t!==e.previousVersion&&(n!=="true"&&n!==!0&&$n.showBadge("NEW",wr.GREEN),L.Storage.set({isUpdated:!0,previousVersion:e.previousVersion}))},async openOnboarding(){ge("openOnboarding","Opening onboarding in new tab",void 0,"INFO"),await L.Storage.set({[No]:Date.now()}),await L.Chrome.Tab.update({url:this.getOptionsPage(),active:!0})},async forceOnboardingOnNewTab(){ge("initOnboarding","initializing...",void 0,"INFO");const e=await this.getFirstSensorTowerInstallDate();L.Chrome.Tab.addListener("onCreated",async t=>{if(Date.now()-e<rn)return;ge("initOnboarding","tab.onCreated",t,"DEBUG");const n=L.RemoteConfig.get("newTabTimeout"),r=await L.Requirements.isOnboardingCompleted(),i=await L.Storage.get(No)??0,s=Date.now()>=i+n;!r&&s&&(await L.Analytics.event("OPENING_ONBOARDING_ON_TAB_CREATED"),await this.openOnboarding())})},initUninstallURL(){L.Chrome.Extension.setUninstallURL(this.uninstallUrl)},onPopupConnected(e){ge("onPopupConnected","Popup connected",e,"DEBUG"),this.popupPort=e,e.onMessage.addListener(async t=>{const n=new wp(t.message);if(n.matches("*.domain.add.BLACKLIST")){const r=t.payload.groupName,i=t.payload.domain,s=await L.BlockedGroupsRepository.addWebsite(r,i);e.postMessage({message:"StayFocusd.domain.added."+n.getDescriptor(),payload:{success:s}}),await this.checkURL(t.payload.domain)}if(n.matches("*.domain.add.WHITELIST")){const r=[t.payload.domain],i=await L.WhitelistRepository.add(r);e.postMessage({message:"StayFocusd.domain.added."+n.getDescriptor(),payload:{success:i}}),await this.checkURL(t.payload.domain)}if(n.matches("PopupController.toggle.*.*")){const{value:r}=t.payload;this.setActivated(r),e.postMessage({message:"StayFocusd.toggled",payload:{value:this.activated()}}),L.Chrome.Tab.getSelected(void 0,async i=>{await this.onTabStateChange(i)})}return!0}),e.onDisconnect.addListener(()=>{this.popupPort=null}),this.postTimerUpdatedMessage()},postTimerUpdatedMessage:function(){L.PubSub.publish("StayFocusd.timer.updated",{tabID:this.selectedTabID,displayTimer:this.getDisplayTimer()}),this.popupPort&&this.popupPort.postMessage({message:"StayFocusd.timer.updated",payload:{displayTimer:this.getDisplayTimer()}})},onTabStateChange:async function(e){if(typeof e>"u")return;ge("onTabStateChange","Tab state changed",e),this.currentURL=e.url,this.selectedTabID=e.id,await this.checkURL(e.url);const t=this.isBlockable(e.url);L.PubSub.publish("StayFocusd.tab.selected",{tab:e,tabID:e.id,blockable:t})},checkURL:async function(e){e=typeof e>"u"||typeof e=="string"&&e.length===0?this.currentURL:e,ge("checkURL","Checking url: ",e),this.isNewDay()===!0&&L.BlockedGroupsRepository.clearElapsedTime(),L.BlockedGroupsTimer.stopCountdown(),this.isBlockable(e)?(L.Chrome.Tab.getSelected(void 0,t=>{this.setBadgeIcon(t,Fn.BLOCKED)}),this.isKillable(e)?this.killPage(e):L.BlockedGroupsTimer.startCountdown(e)):L.WhitelistRepository.isExists(e)?L.Chrome.Tab.getSelected(void 0,n=>{this.setBadgeIcon(n,Fn.ALLOWED)}):L.Chrome.Tab.getSelected(void 0,n=>{this.setBadgeIcon(n,Fn.DEFAULT)})},setBadgeIcon(e,t){e&&(this.activated()?lt.isActive()?$n.setIcon(Fn.NUCLEAR,e.id):$n.setIcon(t,e.id):$n.setIcon(Fn.DEACTIVATED,e.id))},isKillable:function(e){return L.BlockedGroupsTimer.isMaxTimeAllowedExceeded(e)||lt.isActive()},isProtectedURL:function(e){return e===null||typeof e>"u"||e.length===0?!1:e.indexOf(this.redirectURL)===0||e.indexOf("rescueMe")>=0||e.indexOf("chrome")>=0&&e.indexOf("chrome")<e.indexOf("://")&&(e.indexOf("sf")>-1||e.indexOf("devtools")>-1)},isBlockable:function(e){if(!this.activated()||this.isProtectedURL(e)||e===null||typeof e>"u"||e===""||this.isActive()===!1)return!1;const t=L.BlockedGroupsRepository.isBlockable(e),n=L.WhitelistRepository.isExists(e),r=lt.isBlockable(t,n);if(L.Settings.get("isBlockAllWebsites")&&!n||r||t&&!n)return!0;if(t&&n){const s=L.BlockedGroupsRepository.getBlockedGroupByDomain(e),a=(s==null?void 0:s.websites.find(o=>L.Domain.isMoreGeneralURL(o,e)))??"",c=L.WhitelistRepository.isExists(e)?e:"";return a===e&&c!==e?!0:a!==e&&c===e?!1:Qs.isMoreGeneralURL(c,a)}return n||lt.isActive()&&!r,!1},isNewDay:function(){let e=!1;const t=new Date;let n=t.getTime(),r=L.Settings.get("resetTimestamp"),i=this.getResetTime();if(/null/.test(i)&&(i="00:00",this.setResetTime(i)),typeof r>"u"||r===null||r===""){const s=i.split(":"),a=Math.floor(s[0]),l=Math.floor(s[1]);r=new Date(t.toDateString()+" "+a+":"+l).getTime(),this.updateResetTimestamp(i)}return r=Math.floor(r),n=Math.floor(n),n>r&&(e=!0,this.updateResetTimestamp(i)),e},updateBadge:function(e,t=!1){let n=!1,r;const i=Math.floor(e),s=i.toString();t&&i<=60?(n=!0,r=wr.BLACK):i<=30?(n=!0,r=wr.RED):i<=60&&(n=!0,r=wr.YELLOW),n?$n.showBadge(s,r,this.selectedTabID??void 0):this.hideBadge()},hideBadge(){$n.hideBadge(this.selectedTabID??void 0)},killPage:function(e){return ge("killPage","Killing page",null,"INFO"),L.BlockedGroupsTimer.stopCountdown(),L.Chrome.Window.getLastFocused(t=>{typeof t<"u"&&L.Chrome.Tab.getAllInWindow(t.id,n=>{for(const r in n)if(n[r].highlighted)if(L.BlockedGroupsTimer.isMaxTimeAllowedExceeded(e)||lt.isActive()&&!lt.hasSmartBomb()){const i=L.Settings.get("customStayFocusdMsg")||"";L.Chrome.Tab.update(n[r].id,{url:this.redirectURL+"?background&customMsg="+encodeURIComponent(i)})}else lt.isActive()&&lt.hasSmartBomb()&&L.PubSub.publish("StayFocusd.smartBomb.activate",{tabID:n[r].id,smartBomb:lt.getSmartBomb()})})}),!1},getTotalSecondsRemaining:function(){return L.BlockedGroupsTimer.getTotalSecondsRemaining(this.currentURL)},getDisplayTimer:function(){function e(){const r="Default",i=Y.BlockedGroupsRepository.getByName(r);return{groupName:r,time:Tn.formatDurationInSeconds(i.maxTimeAllowed-i.elapsedTime),nuclear:!1}}if(Y.NuclearOption.isActive()){const r=Y.NuclearOption.getExpiration();if(r){const i=(r-Date.now())/ea;return{groupName:Y.Chrome.Translation.get("nuclear"),time:Tn.formatDurationInSeconds(i),nuclear:!0}}}const t=L.BlockedAllWebsites.getTime();if(t!=null)return{groupName:null,time:Tn.formatDurationInSeconds(t.allowedTime-t.elapsedTime),nuclear:!1};if(this.currentURL==null||this.currentURL=="")return e();const n=L.BlockedGroupsRepository.getBlockedGroupByDomain(this.currentURL);return n==null?e():{groupName:n.groupName,time:Tn.formatDurationInSeconds(n.maxTimeAllowed-n.elapsedTime),nuclear:!1}},getDateString:function(){const e=new Date,t=e.getMonth()+1,n=e.getDate();return e.getFullYear()+"-"+t+"-"+n},setActiveDays:function(e){let t=null;e.length===0?t="none":t=e.join("|"),ge("setActiveDays","Setting active days",e),L.Settings.set({activeDays:t}),L.NuclearOption.updateActiveDays(this.getActiveDays(!0))},getActiveDays:function(e=!1){const t=L.Settings.get("activeDays");if(t==="none")return[];if(typeof t>"u"||t===null||t.length===0)return this.setActiveDays([0,1,2,3,4,5,6]),[0,1,2,3,4,5,6];if(typeof t!="string"||t.indexOf("|")===-1)return[Number(t)];const n=t.split("|"),r=[];for(let i=0;i<n.length;i++)r[i]=Number(n[i]);return e?this.getActiveDaysAsWeekArray(r):r},getActiveDaysAsWeekArray:function(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];t[r]=!0}for(let n=0;n<7;n++)t[n]=t[n]||!1;return t},isActiveDay:function(){const t=new Date().getDay(),n=this.getActiveDays();return typeof n>"u"||n===null||n.length===0?!1:n.inArray(t)},setActiveHours:function(e,t){ge("setActiveHours","Setting active hours",{startTime:e,endTime:t}),L.Settings.set({activeHours:e+"|"+t})},getActiveHours:function(){let e=!1,t=!1;const n=this.getActiveHoursQueue();if(n!==!1){const s=n;(new Date().getTime()>s.timestamp||this.isFirstInstallAllowanceActive())&&(e=s.startTime,t=s.endTime,this.clearActiveHoursQueue(),this.setActiveHours(e,t))}if(e===!1&&t===!1){let s=L.Settings.get("activeHours");(typeof s>"u"||s===null||s==="")&&(this.setActiveHours("00:00","23:59"),s=L.Settings.get("activeHours"));const a=s.split("|");e=a[0],t=a[1]}const r=e.split(":"),i=t.split(":");return{startTime:e,endTime:t,startHour:r[0],startMin:r[1],startHourInt:parseInt(r[0],10),startMinInt:parseInt(r[1],10),endHour:i[0],endMin:i[1],endHourInt:parseInt(i[0],10),endMinInt:parseInt(i[1],10)}},isActiveHour:function(){const e=this.getActiveHours(),t=new Date,n=t.getHours(),r=t.getMinutes();return this.isStartTimeLater(e)===!0?this.isBetween(n,r,e.startHourInt,e.startMinInt,23,59)||this.isBetween(n,r,0,0,e.endHourInt,e.endMinInt):this.isBetween(n,r,e.startHourInt,e.startMinInt,e.endHourInt,e.endMinInt)},isBetween:function(e,t,n,r,i,s){return e>n&&e<i?!0:e===n&&e===i?t>=r&&t<=s:e===n&&t>=r||e===i&&t<=s},isStartTimeLater:function(e){return e.startHourInt===e.endHourInt&&e.startMinInt>=e.endMinInt?!0:e.startHourInt>e.endHourInt},setActiveHoursQueue:function(e,t){const i=new Date().getTime()+L.Date.hoursToMilliseconds(24)+"|"+e+"|"+t;ge("setActiveHoursQueue","Setting active hours queue",i),L.Settings.set({activeHoursQueue:i})},getActiveHoursQueue:function(){const e=L.Settings.get("activeHoursQueue");if(typeof e>"u"||e===null||e==="")return!1;const t=e.split("|");return{timestamp:parseInt(t[0]),startTime:t[1],endTime:t[2]}},clearActiveHoursQueue:function(){ge("clearActiveHoursQueue","Clearing active hours queue"),L.Settings.remove("activeHoursQueue")},isActive:function(){return lt.isActive()===!0?!0:this.isActiveDay()===!0&&this.isActiveHour()===!0},activated:function(){return L.Settings.get("activated",!0)},setActivated:function(e){if(e===!1){if(!confirm(Y.Chrome.Translation.get("areYouSure"))||!confirm(Y.Chrome.Translation.get("disableExtension1"))||!confirm(Y.Chrome.Translation.get("disableExtension2"))||!confirm(Y.Chrome.Translation.get("disableExtension3"))||!confirm(Y.Chrome.Translation.get("disableExtension4"))||!confirm(Y.Chrome.Translation.get("disableExtension5"))||!confirm(Y.Chrome.Translation.get("disableExtension6"))||!confirm(Y.Chrome.Translation.get("disableExtension7"))||!confirm(Y.Chrome.Translation.get("disableExtension8"))||!confirm(Y.Chrome.Translation.get("disableFinalWarning")))return!1;alert(Y.Chrome.Translation.get("extensionDisabled"))}return L.Settings.set({activated:e}),this.checkURL(),L.Analytics.event(e?"EXTENSION_ACTIVATED":"EXTENSION_DEACTIVATED"),!0},isActivateSwitchShown:function(){return L.Settings.get("isActivateSwitchShown",!0)},setActivateSwitchShown:function(e){L.Settings.set({isActivateSwitchShown:e})},updateResetTimestamp:function(e){const t=e.split(":"),n=parseInt(t[0],10),r=parseInt(t[1],10),s=new Date(new Date().toDateString()+" "+n+":"+r).getTime()+864e5;ge("updateResetTimestamp","Updating reset timestamp to: "+s),L.Settings.set({resetTimestamp:s})},setResetTime:function(e){ge("setResetTime","Setting reset time to: "+e),L.Settings.set({resetTime:e})},getResetTime:function(){let e=L.Settings.get("resetTime");const t=this.getResetTimeQueue(),n="00:00";if(t!==!1){const i=new Date().getTime(),s=t;(i>s.timestamp||this.isFirstInstallAllowanceActive())&&(e=s.resetTime,this.clearResetTimeQueue(),this.setResetTime(e),this.updateResetTimestamp(e))}return(typeof e>"u"||e===null||e==="")&&(this.setResetTime(n),e=n,this.updateResetTimestamp(e)),e},setResetTimeQueue:function(e){const r=new Date().getTime()+L.Date.hoursToMilliseconds(24)+"|"+e;ge("setResetTimeQueue","Setting reset time queue: "+r),L.Settings.set({resetTimeQueue:r})},getResetTimeQueue:function(){const e=L.Settings.get("resetTimeQueue");if(ke.isEmpty(e))return!1;const t=e.split("|");return{timestamp:t[0],resetTime:t[1]}},clearResetTimeQueue:function(){ge("clearResetTimeQueue","Clearing reset time queue"),L.Settings.remove("resetTimeQueue")},isFirstInstall:function(){return typeof L.Settings.get("firstInstallDate")!="string"},async getFirstSensorTowerInstallDate(){let e=await L.Storage.get("firstSensorTowerInstallDate");return typeof e!="number"&&(e=Date.now(),await L.Storage.set({firstSensorTowerInstallDate:e})),e},getOptionsPage:function(){return jt.runtime.getURL("options.html")},isUpdatePopupDisabled:function(){const e=L.Settings.get("disableUpdatePopup");return e===!0||e==="true"},setFirstInstallAllowance:function(){const e=new Date;L.Settings.set({firstInstallDate:e.toDateString()}),e.setMinutes(e.getMinutes()+this.firstInstallAllowance),ge("setFirstInstallAllowance","Setting first install allowance to: "+e.getTime()),L.Settings.set({firstInstallAllowanceExpiration:e.getTime()})},isFirstInstallAllowanceActive:function(){const e=new Date;return L.Settings.get("firstInstallAllowanceExpiration")>e.getTime()},localizeHTML:function(e){ge("localizeHTML","Localizing HTML");const t=e.getElementsByTagName("*");for(let n=0;n<t.length;n++)t[n].dataset&&t[n].dataset.i18n&&(t[n].innerHTML=L.Chrome.Translation.get(t[n].dataset.i18n))}};Array.prototype.inArray=function(e){for(const t in this)if(this.hasOwnProperty(t)&&this[t]==e)return!0;return!1};const Ro="whitelist",bt="whitelistNew";let wt,Lt=[];const Lo=[Y,Js,eu,Xt,tu,nu,Qs,ke,iu,It,su,He,au,cu,df,fp,Po,jn,lt,bp,vp,yp,{initAPI(e){return wt=e,wt.mixin("WhitelistRepository",{init:this.init.bind(this),add:this.add.bind(this),getAll:this.getAll.bind(this),isExists:this.isExists.bind(this),delete:this.delete.bind(this),migrate:this.migrate.bind(this),importWhitelist:this.importWhitelist.bind(this)})},async init(){if(await Y.Settings.get("disableSync")===!0){const n=!!(await wt.Chrome.Storage.getSync(bt))[bt];await Y.Storage.setBucket(bt,"LOCAL",!n)}else{const n=!!(await wt.Chrome.Storage.getLocal(bt))[bt];await Y.Storage.setBucket(bt,"SYNC",!n)}this.getWhitelist(),this.addListeners()},getWhitelist(){const e=wt.Settings.get(bt);Lt=e??[]},async add(e){let t=!1;for(let n=0;n<e.length;n++){const r=e[n];r&&Lt.find(i=>i==r)==null&&(t=!0,Lt.push(r),await this.saveChanges())}return t},getAll(){return Lt},async delete(e){const t=Lt.findIndex(n=>n==e);t>-1&&(Lt.splice(t,1),await this.saveChanges())},isExists(e){return e==null?!1:(e=e.toLowerCase(),Lt.find(t=>vi(t,e))!=null)},async migrate(){if(this.needMigrate()){const e=wt.Settings.get(Ro);if(e!=null){const t=Object.keys(e);await this.add(t)}}},needMigrate(){return wt.Settings.get(bt)==null},async importWhitelist(){Lt=[];const e=wt.Settings.get(Ro);if(e!=null){const t=Object.keys(e);await this.add(t)}},async saveChanges(){await wt.Storage.set({[bt]:Lt})},addListeners(){Y.PubSub.listen("Settings.data.refreshed",async(e,t)=>{(t.changes.whitelistNew||t.changes.disableSync)&&(t.changes.disableSync&&(t.disableSync===!1?await wt.Storage.setBucket(bt,"SYNC"):await wt.Storage.setBucket(bt,"LOCAL")),this.getWhitelist())})}},Ap];Y.mixin({mixin:Y.mixin.bind(Y),PubSub:Po});for(let e=0;e<Lo.length;e++){const t=Lo[e];typeof t=="object"&&t!==null&&typeof t.initAPI=="function"&&t.initAPI(Y)}Js.initAPI(Y),Xt.initAPI(Y);const _p=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),xp=new Map(_p);class xs extends Error{constructor(n){super(xs._prepareSuperMessage(n));_n(this,"name","NonError")}static _prepareSuperMessage(n){try{return JSON.stringify(n)}catch{return String(n)}}}const Sp=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],Ss=new WeakSet,Tp=e=>{Ss.add(e);const t=e.toJSON();return Ss.delete(e),t},Uo=e=>xp.get(e)??Error,Ts=({from:e,seen:t,to:n,forceEnumerable:r,maxDepth:i,depth:s,useToJSON:a,serialize:l})=>{if(!n)if(Array.isArray(e))n=[];else if(!l&&Bo(e)){const o=Uo(e.name);n=new o}else n={};if(t.push(e),s>=i)return n;if(a&&typeof e.toJSON=="function"&&!Ss.has(e))return Tp(e);const c=o=>Ts({from:o,seen:[...t],forceEnumerable:r,maxDepth:i,depth:s,useToJSON:a,serialize:l});for(const[o,u]of Object.entries(e)){if(u&&u instanceof Uint8Array&&u.constructor.name==="Buffer"){n[o]="[object Buffer]";continue}if(u!==null&&typeof u=="object"&&typeof u.pipe=="function"){n[o]="[object Stream]";continue}if(typeof u!="function"){if(!u||typeof u!="object"){try{n[o]=u}catch{}continue}if(!t.includes(e[o])){s++,n[o]=c(e[o]);continue}n[o]="[Circular]"}}for(const{property:o,enumerable:u}of Sp)typeof e[o]<"u"&&e[o]!==null&&Object.defineProperty(n,o,{value:Bo(e[o])?c(e[o]):e[o],enumerable:r?!0:u,configurable:!0,writable:!0});return n};function Ep(e,t={}){const{maxDepth:n=Number.POSITIVE_INFINITY,useToJSON:r=!0}=t;return typeof e=="object"&&e!==null?Ts({from:e,seen:[],forceEnumerable:!0,maxDepth:n,depth:0,useToJSON:r,serialize:!0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}function Cp(e,t={}){const{maxDepth:n=Number.POSITIVE_INFINITY}=t;if(e instanceof Error)return e;if(Op(e)){const r=Uo(e.name);return Ts({from:e,seen:[],to:new r,maxDepth:n,depth:0,serialize:!1})}return new xs(e)}function Bo(e){return!!e&&typeof e=="object"&&"name"in e&&"message"in e&&"stack"in e}function Op(e){return!!e&&typeof e=="object"&&"message"in e&&!Array.isArray(e)}var Ip=Object.defineProperty,Pp=Object.defineProperties,kp=Object.getOwnPropertyDescriptors,jo=Object.getOwnPropertySymbols,Dp=Object.prototype.hasOwnProperty,Mp=Object.prototype.propertyIsEnumerable,Fo=(e,t,n)=>t in e?Ip(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Wo=(e,t)=>{for(var n in t||(t={}))Dp.call(t,n)&&Fo(e,n,t[n]);if(jo)for(var n of jo(t))Mp.call(t,n)&&Fo(e,n,t[n]);return e},$o=(e,t)=>Pp(e,kp(t)),Np=(e,t,n)=>new Promise((r,i)=>{var s=c=>{try{l(n.next(c))}catch(o){i(o)}},a=c=>{try{l(n.throw(c))}catch(o){i(o)}},l=c=>c.done?r(c.value):Promise.resolve(c.value).then(s,a);l((n=n.apply(e,t)).next())});function Rp(e){let t,n={};function r(){Object.entries(n).length===0&&(t==null||t(),t=void 0)}let i=Math.floor(Math.random()*1e4);function s(){return i++}return{sendMessage(a,l,...c){return Np(this,null,function*(){var o,u;const h={id:s(),type:a,data:l,timestamp:Date.now()};(o=e.logger)==null||o.debug(`[messaging] sendMessage {id=${h.id}} ─ᐅ`,h,...c);const d=yield e.sendMessage(h,...c),{res:f,err:g}=d??{err:new Error("No response")};if((u=e.logger)==null||u.debug(`[messaging] sendMessage {id=${h.id}} ᐊ─`,{res:f,err:g}),g!=null)throw Cp(g);return f})},onMessage(a,l){var c,o,u;if(t==null&&((c=e.logger)==null||c.debug(`[messaging] "${a}" initialized the message listener for this context`),t=e.addRootListener(h=>{var d,f;if(typeof h.type!="string"||typeof h.timestamp!="number"){const A=Error(`[messaging] Unknown message format, must include the 'type' & 'timestamp' fields, received: ${JSON.stringify(h)}`);throw(d=e.logger)==null||d.error(A),A}(f=e==null?void 0:e.logger)==null||f.debug("[messaging] Received message",h);const g=n[h.type];if(g==null)return;const m=g(h);return Promise.resolve(m).then(A=>{var E;return(E=e==null?void 0:e.logger)==null||E.debug(`[messaging] onMessage {id=${h.id}} ─ᐅ`,{res:A}),{res:A}}).catch(A=>{var E;return(E=e==null?void 0:e.logger)==null||E.debug(`[messaging] onMessage {id=${h.id}} ─ᐅ`,{err:A}),{err:Ep(A)}})})),n[a]!=null){const h=Error(`[messaging] In this JS context, only one listener can be setup for ${a}`);throw(o=e.logger)==null||o.error(h),h}return n[a]=l,(u=e.logger)==null||u.log(`[messaging] Added listener for ${a}`),()=>{delete n[a],r()}},removeAllListeners(){Object.keys(n).forEach(a=>{delete n[a]}),r()}}}function Lp(e){return Rp($o(Wo({},e),{sendMessage(t,n){return n==null?jt.runtime.sendMessage(t):jt.tabs.sendMessage(n,t)},addRootListener(t){const n=(r,i)=>t(typeof r=="object"?$o(Wo({},r),{sender:i}):r);return jt.runtime.onMessage.addListener(n),()=>jt.runtime.onMessage.removeListener(n)}}))}/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Up=function(t){return t!=null&&typeof t=="object"&&Array.isArray(t)===!1};/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2018, Jon Schlinkert.
 * Released under the MIT License.
 */const Vo=Up;var Bp=function(e,t,n){if(Vo(n)||(n={default:n}),!Ho(e))return typeof n.default<"u"?n.default:e;typeof t=="number"&&(t=String(t));const r=Array.isArray(t),i=typeof t=="string",s=n.separator||".",a=n.joinChar||(typeof s=="string"?s:".");if(!i&&!r)return e;if(i&&t in e)return Es(t,e,n)?e[t]:n.default;let l=r?t:jp(t,s,n),c=l.length,o=0;do{let u=l[o];for(typeof u=="number"&&(u=String(u));u&&u.slice(-1)==="\\";)u=Go([u.slice(0,-1),l[++o]||""],a,n);if(u in e){if(!Es(u,e,n))return n.default;e=e[u]}else{let h=!1,d=o+1;for(;d<c;)if(u=Go([u,l[d++]],a,n),h=u in e){if(!Es(u,e,n))return n.default;e=e[u],o=d-1;break}if(!h)return n.default}}while(++o<c&&Ho(e));return o===c?e:n.default};function Go(e,t,n){return typeof n.join=="function"?n.join(e):e[0]+t+e[1]}function jp(e,t,n){return typeof n.split=="function"?n.split(e):e.split(t)}function Es(e,t,n){return typeof n.isValid=="function"?n.isValid(e,t):!0}function Ho(e){return Vo(e)||Array.isArray(e)||typeof e=="function"}const Fp=Qe(Bp);var Wp=(e,t,n)=>new Promise((r,i)=>{var s=c=>{try{l(n.next(c))}catch(o){i(o)}},a=c=>{try{l(n.throw(c))}catch(o){i(o)}},l=c=>c.done?r(c.value):Promise.resolve(c.value).then(s,a);l((n=n.apply(e,t)).next())});function $p(){if(!Vp())return!1;const e=jt.runtime.getManifest();return e.background?e.manifest_version===3?zp():Hp():!1}function Vp(){var e;return!!((e=jt.runtime)!=null&&e.id)}var Gp=["/_generated_background_page.html"];function Hp(){return typeof window<"u"&&Gp.includes(location.pathname)}function zp(){return typeof window>"u"}function qp(e,t,n){let r;const i=`proxy-service.${e}`,{onMessage:s,sendMessage:a}=Lp(n);function l(c){const o=()=>{},u=new Proxy(o,{apply(h,d,f){return Wp(this,null,function*(){return yield a(i,{path:c,args:f})})},get(h,d,f){return d==="__proxy"||typeof d=="symbol"?Reflect.get(h,d,f):l(c==null?d:`${c}.${d}`)}});return u.__proxy=!0,u}return[function(...o){return r=t(...o),s(i,({data:u})=>{const h=u.path==null?r:Fp(r??{},u.path);if(h)return Promise.resolve(h.bind(r)(...u.args))}),r},function(){if(!$p())return l();if(r==null)throw Error(`Failed to get an instance of ${e}: in background, but registerService has not been called. Did you forget to call registerService?`);return r}]}const[ly,Zp]=qp("BackgroundApi",()=>Oo({ofetchDefaults:{baseURL:"https://stayfocusd.st-panel-api.com"}})),Kp=Y.Chrome.Extension.getID();function Yp(){Y.Chrome.Message.on.addListener(function(e,t,n){return e.payload=e.payload||{},e.payload.sender=t||{},t.tab||Y.PubSub.publish({message:e.message,payload:e.payload,onPublish:typeof n=="function"?n:function(){}}),!0}),Y.PubSub.subscribe({async:!0,handler:function(e,t,n){t=t||{};function r(i){return chrome.runtime.lastError&&Dr.log("Content.js subscribe to all messages","runtime.lastError",chrome.runtime.lastError),i!=null&&typeof i=="function"?()=>i:()=>!0}return n=r(n),(!t.sender||t.sender.id!==Kp)&&Y.Chrome.Message.send(null,{message:e.toString(),payload:t},null,n),!0}})}Yp();const Jp=async()=>{bc({api:Zp(),appId:di.APP_ID,enabled:async()=>await Y.Settings.get("hasAcceptedPrivacyPolicy"),installId:await Y.Storage.get("install-id"),chatGptUrl:await Y.RemoteConfig.get("chatGptUrl"),conversationUrl:await Y.RemoteConfig.get("chatGptConversationUrl"),promptConfig:{countryList:["US"],storageKey:"@stayfocusd/prompt-collector",forbiddenWords:await Y.RemoteConfig.get("forbiddenPromptWords")},statusConfig:{storageKey:"@stayfocusd/chatgpt-status"}})};(async()=>(await Y.Storage.initAsync(),await Y.RemoteConfig.init(),await Y.Settings.initAsync(),Jp()))()})();
//# sourceMappingURL=prompt-collector.js.map
