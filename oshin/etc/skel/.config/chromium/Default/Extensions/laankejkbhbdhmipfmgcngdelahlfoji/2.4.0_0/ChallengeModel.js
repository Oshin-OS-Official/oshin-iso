var o=Object.defineProperty;var u=(r,t,e)=>t in r?o(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var n=(r,t,e)=>(u(r,typeof t!="symbol"?t+"":t,e),e);import{L as g}from"./Logger.js";import{A as i}from"./CoreAPI.js";var l=function(r,t,e,s,h){g.log(r+"."+t,e,s,h)};class y{constructor(){n(this,"bp",null);n(this,"defaultText",null);n(this,"keyCounter",0);n(this,"minLength",0);n(this,"required",null);n(this,"text",null);var t=["s","b","p","a","y"];this.bp="_"+t[1]+t[4]+t[2]+t[3]+t[0]+t[0],this.addListeners()}addListeners(){var t=this;i.PubSub.listen("ChallengeModel.text.set",function(e,s){t.text=s.text})}load(t){this.defaultText=i.Chrome.Translation.get("defaultChallengeText"),this.minLength=decodeURIComponent(this.defaultText).length,this.required=i.Settings.get("challengeRequired"),this.clearProductivityBypass(),typeof t=="function"&&t()}setRequired(t){i.Analytics.event("TOGGLE_SETTINGS_CHALLENGE_REQUIRED",{required:t}),i.Settings.set({challengeRequired:t}),this.required=t}isRequired(){return this.required===!0}getText(t){return t?this.text=this.defaultText:this.text||(this.text=i.Settings.get("challengeText"),this.text=typeof this.text=="string"?decodeURIComponent(this.text):this.defaultText,this.text.length<this.minLength&&(this.text=this.defaultText)),this.text}setText(t){if(!this.isLongEnough(t))return alert(i.Chrome.Translation.get("challengeTextTooShort",this.minLength.toString())),!1;if(!this.isUniqueEnough(t))return alert(i.Chrome.Translation.get("notEnoughVariation")),!1;t=t.split(`
`).join(" "),t=t.split("\r").join(" "),t=t.split("	").join(" "),t=t.replace(/ +(?= )/g,""),t=i.Utils.sanitizeMSWordChars(t),i.Settings.set({challengeText:encodeURIComponent(t)},function(){i.PubSub.publish("ChallengeModel.text.set",{text:t}),alert(i.Chrome.Translation.get("challengeTextSet"))})}resetText(){this.setText(this.defaultText)}setProductivityBypass(){l(this.originator,"setProductivityBypass","Setting productivity bypass"),i.Settings.set({productivityBypass:!0})}clearProductivityBypass(){l(this.originator,"clearProductivityBypass","Clearing productivity bypass"),i.Settings.remove("productivityBypass")}isProductivityBypassActive(){return i.Settings.get("productivityBypass")===!0}isRightLength(t){return this.keyCounter===t.length}isLongEnough(t){return t.length>=this.minLength}isUniqueEnough(t){for(var e=[],s=0;s<t.length;s++){var h=t.charAt(s);e.inArray(h)||e.push(h)}return e.length>=5}isCorrect(t,e){var s=this.text.substring(0,Math.max(t.length+e,0)),h=this.bp.substring(0,Math.max(t.length+e,0)),a=t.substring(0,Math.max(t.length+e,0));return a===s||a===h}isComplete(t){return t.length===this.text.length||t===this.bp}getKeyCounter(){return this.keyCounter}updateKeyCounter(t){this.keyCounter=t}resetKeyCounter(){this.keyCounter=0}}export{y as default};
//# sourceMappingURL=ChallengeModel.js.map
